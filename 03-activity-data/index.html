<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>3. Activity Data – REDD+ Uncertainty Training</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../04-monte-carlo/index.html" rel="next">
<link href="../02-emission-factors/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-49a404399acb846fa9462a115fe112f4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="../site_libs/htmltools-fill/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets/htmlwidgets.js"></script><script src="../site_libs/jquery/jquery-3.6.0.min.js"></script><link href="../site_libs/leaflet/leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet/leaflet.js"></script><link href="../site_libs/leafletfix/leafletfix.css" rel="stylesheet">
<script src="../site_libs/proj4/proj4.min.js"></script><script src="../site_libs/Proj4Leaflet/proj4leaflet.js"></script><link href="../site_libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-binding/leaflet.js"></script><script src="../site_libs/leaflet-providers/leaflet-providers_2.0.0.js"></script><script src="../site_libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script><script src="../site_libs/Leaflet.glify/addGlifyPoints.js"></script><script src="../site_libs/Leaflet.glify/addGlifyPolygons.js"></script><script src="../site_libs/Leaflet.glify/addGlifyPolylines.js"></script><script src="../site_libs/Leaflet.glify/glify-browser.js"></script><link href="../site_libs/tabwid/tabwid.css" rel="stylesheet">
<script src="../site_libs/tabwid/tabwid.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="3. Activity Data – REDD+ Uncertainty Training">
<meta property="og:description" content="">
<meta property="og:image" content="assets/images/png/datacube_static_clean.png">
<meta property="og:site_name" content="REDD+ Uncertainty Training">
</head>
<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../03-activity-data/index.html"><span class="chapter-title">3. Activity Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">eBook Layout</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/training-resource/uncertainty" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-allometry/index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Allometry</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-emission-factors/index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Emission Factors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-activity-data/index.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">3. Activity Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-monte-carlo/index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Monte Carlo</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references/index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">References</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../AA-Appendix/glossary-terms.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Glossary of Terms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../AA-Appendix/additional-reading.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Additional Reading</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title"><strong>Table of Contents</strong></h2>
   
  <ul>
<li>
<a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
<li><a href="#a-data-cube-framework-for-uncertainty-reduction" id="toc-a-data-cube-framework-for-uncertainty-reduction" class="nav-link" data-scroll-target="#a-data-cube-framework-for-uncertainty-reduction">A Data Cube Framework for Uncertainty Reduction</a></li>
  <li><a href="#time-series-diminesions" id="toc-time-series-diminesions" class="nav-link" data-scroll-target="#time-series-diminesions">Time Series Diminesions</a></li>
  <li><a href="#ipcc-approaches" id="toc-ipcc-approaches" class="nav-link" data-scroll-target="#ipcc-approaches">IPCC Approaches</a></li>
  </ul>
</li>
  <li><a href="#assemble-data-cube" id="toc-assemble-data-cube" class="nav-link" data-scroll-target="#assemble-data-cube">3.2 Assemble Data Cube</a></li>
  <li><a href="#normalize-data-cube" id="toc-normalize-data-cube" class="nav-link" data-scroll-target="#normalize-data-cube">3.3 Normalize Data Cube</a></li>
  <li><a href="#training-data-samples" id="toc-training-data-samples" class="nav-link" data-scroll-target="#training-data-samples">3.4 Training Data Samples</a></li>
  <li><a href="#classify-data-cube" id="toc-classify-data-cube" class="nav-link" data-scroll-target="#classify-data-cube">3.5 Classify Data Cube</a></li>
  <li><a href="#probability-data-cube" id="toc-probability-data-cube" class="nav-link" data-scroll-target="#probability-data-cube">3.6 Probability Data Cube</a></li>
  <li>
<a href="#training-data-enhancements" id="toc-training-data-enhancements" class="nav-link" data-scroll-target="#training-data-enhancements">3.7 Training Data Enhancements</a>
  <ul class="collapse">
<li><a href="#pixel-entropy-sampling" id="toc-pixel-entropy-sampling" class="nav-link" data-scroll-target="#pixel-entropy-sampling">Pixel Entropy Sampling</a></li>
  <li><a href="#hierarchical-clustering" id="toc-hierarchical-clustering" class="nav-link" data-scroll-target="#hierarchical-clustering">Hierarchical Clustering</a></li>
  <li><a href="#self-organizing-maps" id="toc-self-organizing-maps" class="nav-link" data-scroll-target="#self-organizing-maps"><strong>Self-Organizing Maps</strong></a></li>
  <li><a href="#class-imbalances" id="toc-class-imbalances" class="nav-link" data-scroll-target="#class-imbalances">Class Imbalances</a></li>
  <li><a href="#geographic-variance" id="toc-geographic-variance" class="nav-link" data-scroll-target="#geographic-variance">Geographic Variance</a></li>
  <li><a href="#noise-filtering" id="toc-noise-filtering" class="nav-link" data-scroll-target="#noise-filtering">Noise Filtering</a></li>
  </ul>
</li>
  <li><a href="#smooth-data-cube" id="toc-smooth-data-cube" class="nav-link" data-scroll-target="#smooth-data-cube">3.8 Smooth Data Cube</a></li>
  <li>
<a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">3.8 Cross-Validation</a>
  <ul class="collapse">
<li><a href="#monte-carlo-cross-validation" id="toc-monte-carlo-cross-validation" class="nav-link" data-scroll-target="#monte-carlo-cross-validation">Monte Carlo Cross-Validation</a></li>
  </ul>
</li>
  <li>
<a href="#accuracy-assessment" id="toc-accuracy-assessment" class="nav-link" data-scroll-target="#accuracy-assessment">3.9 Accuracy Assessment</a>
  <ul class="collapse">
<li><a href="#confusion-matrix" id="toc-confusion-matrix" class="nav-link" data-scroll-target="#confusion-matrix">Confusion Matrix</a></li>
  </ul>
</li>
  <li><a href="#reproducible-workflow" id="toc-reproducible-workflow" class="nav-link" data-scroll-target="#reproducible-workflow">3.10 Reproducible Workflow</a></li>
  <li><a href="#sec-summary" id="toc-sec-summary" class="nav-link" data-scroll-target="#sec-summary">3.11 Chapter Summary</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/training-resource/uncertainty/edit/main/03-activity-data/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/training-resource/uncertainty/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">3. Activity Data</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="overview" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="overview">Overview</h2>
<p>Activity data (AD) represents the spatial extent and temporal dynamics of land-use change in REDD+ accounting. This chapter addresses uncertainty quantification in land cover classification, change detection, and spatial aggregation. These components typically constitute the greatest contribution to total REDD+ uncertainty <span class="citation" data-cites="ballantyne2015audit">(<a href="../references/index.html#ref-ballantyne2015audit" role="doc-biblioref">Ballantyne et al., 2015</a>)</span>.</p>
<section id="a-data-cube-framework-for-uncertainty-reduction" class="level3"><h3 class="anchored" data-anchor-id="a-data-cube-framework-for-uncertainty-reduction">A Data Cube Framework for Uncertainty Reduction</h3>
<p>Satellite-based activity data classification faces three fundamental sources of uncertainty: spatial misalignment between sensor bands, temporal gaps from cloud contamination, and spectral inconsistency from varying atmospheric conditions. Traditional scene-based processing handles individual images independently and fails to address these uncertainties systematically. This introduces geometric discontinuities at tile boundaries and creates systematic bias when deforestation occurs during cloudy periods, propagating uncorrected atmospheric effects into phenological signatures.</p>
</section><section id="time-series-diminesions" class="level3"><h3 class="anchored" data-anchor-id="time-series-diminesions">Time Series Diminesions</h3>
<p>Data cubes provide a structured solution by organizing satellite imagery into multidimensional arrays with consistent spatial, temporal, and spectral dimensions. This architecture enables analysis-ready workflows that normalize heterogeneous acquisitions into regular spatiotemporal grids through three coupled preprocessing operations:</p>
<ul>
<li>Spatial Normalization: Reprojecting all inputs to common coordinate systems with uniform pixel spacing reduces geometric uncertainty. This typically addresses the 5-10% classification error found at forest boundaries where precise delineation determines area estimates.</li>
<li>Temporal Normalization: Compositing algorithms rank scenes by atmospheric quality to fill cloud gaps and interpolate missing observations. This prevents the 15-25% systematic underestimation of forest loss documented when clearing events coincide with persistent cloud cover (Hansen et al., 2014).</li>
<li>Spectral Normalization: Consistent atmospheric corrections and sensor calibrations across the time series ensure temporal patterns reflect genuine phenological dynamics. This prevents data processing artifacts from inflating classification variance by 10-20%.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="assets/images/png/datacube_static_clean.png" class="img-fluid figure-img"></p>
<figcaption>Geometric representation of a multidimensional time-series dataset of land use change analysis. The diagram illustrates the intersection of spatial (x,y,z) and temporal planes (t) using dimensional logic to highlight the signficance of data alignment and temporal sampling to preprocessing treatments and uncertainty reductions (Author’s illustration, 2026/01).</figcaption></figure>
</div>
<p>For REDD+ monitoring under IPCC Approach 3 requirements, data cube architecture provides the foundation for pixel-level uncertainty tracking essential for defensible carbon accounting. By organizing probability estimates and model residuals as additional cube attributes, analysts can map spatial patterns of uncertainty and implement adaptive validation strategies targeting high-uncertainty regions.</p>
<p>This spatially explicit quantification directly supports ART-TREES Section 8 compliance by providing the pixel-level confidence estimates required for Monte Carlo emission simulations. This allows uncertainty deductions to be calculated from empirical probability distributions rather than conservative default assumptions. Empirical studies demonstrate that proper data cube preprocessing reduces total classification uncertainty by 40-60% compared to scene-based approaches. For a 1 million <span class="math inline">\(tCO_2e\)</span> REDD+ project, this represents $200,000–$300,000 in protected revenue at a $5/tonne carbon price.</p>
</section><section id="ipcc-approaches" class="level3"><h3 class="anchored" data-anchor-id="ipcc-approaches">IPCC Approaches</h3>
<p>The IPCC defines three hierarchical approaches for activity data collection that differ in spatial explicitness and uncertainty characteristics <span class="citation" data-cites="ipccChapter2Generic2019">(<a href="../references/index.html#ref-ipccChapter2Generic2019" role="doc-biblioref">IPCC, 2019</a>)</span>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 33%">
<col style="width: 30%">
<col style="width: 18%">
</colgroup>
<thead><tr class="header">
<th>Approach</th>
<th>Data Type</th>
<th>Spatial Resolution</th>
<th>Uncertainty</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Approach 1</td>
<td>Area statistics</td>
<td>Aggregated totals</td>
<td>Highest</td>
</tr>
<tr class="even">
<td>Approach 2</td>
<td>Sample-based matrices</td>
<td>Point/grid sampling</td>
<td>Moderate</td>
</tr>
<tr class="odd">
<td>Approach 3</td>
<td>Wall-to-wall maps</td>
<td>Spatially explicit</td>
<td>Lowest</td>
</tr>
</tbody>
</table>
<p>This chapter implements Approach 3 methods using satellite time series classification within data cube frameworks, which ART-TREES programs predominantly adopt due to requirements for spatially explicit monitoring, pixel-level change detection, and integration with emission factor stratification. The data cube architecture and machine learning workflows demonstrated in Sections 3.2-3.9 operationalize Approach 3 while providing the uncertainty quantification infrastructure required under ART-TREES Section 8. Data cubes enable Approach 3’s lower uncertainty bounds by ensuring consistent spatial alignment for wall-to-wall mapping, maintaining temporal continuity for change detection, and preserving spectral fidelity for accurate classification—benefits unattainable through aggregated statistics (Approach 1) or sample-based approaches (Approach 2) that inherently discard spatial context.</p>
<p>The chapter is structured around the data cube framework for organizing and analyzing spatiotemporal land cover data, followed by uncertainty estimation techniques aligned with IPCC methodologies. We organize the technical content into the following components:</p>
<ul>
<li>Data Cube Architecture (Sections 3.1-3.3): Spatiotemporal array structures for satellite time series, demonstrating how proper cube construction reduces baseline uncertainty through spatial harmonization, temporal gap-filling, and spectral normalization before classification begins.</li>
<li>Training Data Enhancement (Sections 3.4-3.7): Sample quality assessment and optimization through active learning, hierarchical clustering, class balancing, and geographic coverage analysis—addressing the 20-40% classification uncertainty stemming from inadequate or biased training data.</li>
<li>Classification and Smoothing (Section 3.8): Probability cube generation and Bayesian spatial smoothing that reduces salt-and-pepper noise while preserving legitimate landscape heterogeneity, typically improving validation agreement by 10-15% compared to discrete pixel-based classifications.</li>
<li>Uncertainty Quantification (Sections 3.9-3.10): Monte Carlo cross-validation and stratified accuracy assessment providing robust out-of-sample performance estimates required for ART-TREES deduction calculations, with emphasis on class-specific error patterns and spatial uncertainty distributions.</li>
<li>Reproducible Workflow (Section 3.11): Complete implementation code for all preprocessing, classification, and validation procedures, enabling transparent methodology documentation required for third-party verification under REDD+ standards.</li>
</ul>
<p>The subsequent sections demonstrate how systematic application of data cube principles reduces activity data uncertainty from typical scene-based levels of 35-45% to optimized values of 15-25%, directly protecting carbon credit revenues through lower ART-TREES uncertainty deductions while maintaining scientific rigor required for MRV compliance.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Environment Setup</span></span>
<span><span class="co"># ------------------------</span></span>
<span></span>
<span><span class="fu">easypackages</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/easypackages/man/packages.html">packages</a></span><span class="op">(</span></span>
<span>  <span class="st">"bslib"</span>, <span class="st">"caret"</span>, <span class="st">"cols4all"</span>, <span class="st">"covr"</span>, <span class="st">"cowplot"</span>, <span class="st">"dendextend"</span>, <span class="st">"digest"</span>,<span class="st">"DiagrammeR"</span>, </span>
<span>  <span class="st">"dtwclust"</span>, <span class="st">"downlit"</span>, <span class="st">"devtools"</span>, <span class="st">"e1071"</span>, <span class="st">"exactextractr"</span>,<span class="st">"elevatr"</span>, <span class="st">"FNN"</span>, </span>
<span>  <span class="st">"future"</span>, <span class="st">"forestdata"</span>,<span class="st">"gdalcubes"</span>, <span class="st">"gdalUtilities"</span>, <span class="st">"geojsonsf"</span>, <span class="st">"geos"</span>, </span>
<span>  <span class="st">"ggplot2"</span>, <span class="st">"ggstats"</span>, <span class="st">"ggspatial"</span>, <span class="st">"ggmap"</span>, <span class="st">"ggplotify"</span>, <span class="st">"ggpubr"</span>, <span class="st">"ggrepel"</span>, </span>
<span>  <span class="st">"giscoR"</span>, <span class="st">"hdf5r"</span>, <span class="st">"httr"</span>, <span class="st">"httr2"</span>, <span class="st">"htmltools"</span>, <span class="st">"jsonlite"</span>, <span class="st">"kohonen"</span>, <span class="st">"leafem"</span>, </span>
<span>  <span class="st">"leaflet.providers"</span>, <span class="st">"libgeos"</span>,<span class="st">"luz"</span>,<span class="st">"lwgeom"</span>, <span class="st">"leaflet"</span>, <span class="st">"leafgl"</span>, <span class="st">"MLmetrics"</span>,</span>
<span>  <span class="st">"mapedit"</span>, <span class="st">"mapview"</span>, <span class="st">"maptiles"</span>, <span class="st">"methods"</span>, <span class="st">"mgcv"</span>, <span class="st">"ncdf4"</span>, <span class="st">"nnet"</span>, <span class="st">"openxlsx"</span>, </span>
<span>  <span class="st">"parallel"</span>, <span class="st">"plotly"</span>, <span class="st">"randomForestExplainer"</span>,<span class="st">"randomForest"</span>, <span class="st">"rasterVis"</span>, <span class="st">"raster"</span>, </span>
<span>  <span class="st">"Rcpp"</span>, <span class="st">"RcppArmadillo"</span>, <span class="st">"RcppCensSpatial"</span>, <span class="st">"rayshader"</span>, <span class="st">"RcppEigen"</span>, <span class="st">"RcppParallel"</span>, </span>
<span>  <span class="st">"RColorBrewer"</span>, <span class="st">"reactable"</span>, <span class="st">"rgl"</span>, <span class="st">"rsconnect"</span>,<span class="st">"RStoolbox"</span>, <span class="st">"rts"</span>, <span class="st">"s2"</span>, <span class="st">"sf"</span>, </span>
<span>  <span class="st">"scales"</span>, <span class="st">"sits"</span>, <span class="st">"sitsdata"</span>, <span class="st">"spdep"</span>, <span class="st">"stars"</span>, <span class="st">"stringr"</span>,<span class="st">"supercells"</span>, <span class="st">"smotefamily"</span>, </span>
<span>  <span class="st">"terra"</span>, <span class="st">"testthat"</span>, <span class="st">"tidyverse"</span>, <span class="st">"tidyterra"</span>, <span class="st">"tools"</span>, <span class="st">"torch"</span>, <span class="st">"tmap"</span>, <span class="st">"tmaptools"</span>, </span>
<span>  <span class="st">"terrainr"</span>, <span class="st">"xgboost"</span>, <span class="st">"webshot"</span>, <span class="st">"webshot2"</span>,</span>
<span>  prompt <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2</a></span><span class="op">(</span>use_s2 <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="assemble-data-cube" class="level2"><h2 class="anchored" data-anchor-id="assemble-data-cube">3.2 Assemble Data Cube</h2>
<p>The <code>sits</code> package installation comes pre-loaded with an API library of connections<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> to ARD collections (<a href="https://ceos.org/ard/">Analysis-Ready-Data</a>) via STAC protocols (<a href="https://stacspec.org/en">SpatioTemporal Asset Catalogs</a>). This built-in component allows programmatic access to cloud-hosted imagery from AWS, Microsoft Planetary Computer, EarthData, Copernicus many other leading warehouses. However, raw ARD collections present several challenges for classification workflows:</p>
<ul>
<li>Spatial harmonization: Band-specific resolutions require harmonization to common grid avoiding edge anomalies and gaps</li>
<li>Temporal harmonization: Revisit cycles vary due to orbital geometry, platform scheduling, and atmospheric conditions</li>
<li>Cloud removal: Atmospheric interference introduces missing observations that corrupt spectral time series</li>
</ul>
<p>For REDD+ monitoring, temporal gaps create systematic underestimation of forest loss when clearing events coincide with cloud-covered periods; a known source of activity data bias requiring explicit quantification in uncertainty budgets. The <code>sits_regularize()</code> function provides wrapper to <code>gdalcubes</code> operations that transforms heterogeneous imagery into regular or normalized data cubes through coupled spatial and temporal harmonizations.</p>
<ul>
<li>Spatial harmonization reprojects all inputs to a common coordinate reference system and resamples to uniform pixel spacing. For instance, fusing Sentinel-1 SAR with Sentinel-2 optical data requires re-projection to the MGRS grid at consistent resolution (typically 10m), ensuring geometric alignment and eliminating co-registration errors that propagate into classification uncertainty.</li>
<li>Temporal harmonization establishes fixed observation intervals (16-day, monthly, seasonal) via cloud-optimized compositing. Within each interval, the algorithm ranks available scenes by cloud cover percentage, using the clearest image as reference and filling gaps from progressively cloudier acquisitions. Pixels with persistent cloud contamination are flagged as NA and gap-filled through temporal interpolation during feature extraction.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ARD Tile Grids
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sentinel-2 acquisitions are organized according to the Military Grid Reference System (MGRS), which partitions global coverage into 60 longitudinal zones spanning 8° each. Within zones, 6° latitudinal blocks are further subdivided into 110 km × 110 km tiles with 10 km overlap to ensure seamless mosaicking. This tiling structure is critical for REDD+ monitoring systems that track forest change across administrative boundaries, as tile edges can introduce geometric discontinuities if not properly managed during data cube construction.</p>
<p>Landsat missions (4,5,7,8,9) employ the Worldwide Reference System-2 (WRS-2), which references scenes by path (descending orbital track) and row (latitudinal frame center). The WRS-2 grid comprises 233 paths globally, each containing 119 rows. All WRS-2 imagery is delivered with geometric correction to UTM projection, facilitating direct integration with ground reference data and cadastral boundaries commonly used in jurisdictional REDD+ accounting. For operational monitoring systems, understanding these tiling schemes is essential for:</p>
<ul>
<li>Stratification: Validation samples must account for tile boundaries to avoid spatial clustering</li>
<li>Co-registration: Cross-sensor fusion (Landsat-Sentinel) requires explicit handling of differing grid systems</li>
<li>Computation: Processing workflows optimized for native tile extents reduce unnecessary resampling and associated geometric errors</li>
</ul>
</div>
</div>
<p>This analysis replicates methods from <span class="citation" data-cites="simoes2021satellite">Simoes et al. (<a href="../references/index.html#ref-simoes2021satellite" role="doc-biblioref">2021</a>)</span>, which assembles a data cube from MPC’s collection of Sentinel-2 ARD-imagery comprising a single tiled area in the state of Rondonia for the full calendar year of 2022.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Following assembly, we normalize raw imagery into a bi-monthly regularized cube below. We specified 10 multispectral bands spanning visible through shortwave infrared wavelengths (B02-B12), plus the B8A narrow NIR band and the CLOUD quality mask for atmospheric filtering.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create data cube from Microsoft Planetary Computer ARD</span></span>
<span><span class="va">cube_s2_raw</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source            <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection    <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  tiles             <span class="op">=</span> <span class="st">"20LMR"</span>,</span>
<span>  bands             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date    <span class="op">=</span> <span class="st">"2022-01-01"</span>,</span>
<span>  end_date      <span class="op">=</span> <span class="st">"2022-12-31"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Check timelines of assembled tiles</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">cube_s2_raw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="normalize-data-cube" class="level2"><h2 class="anchored" data-anchor-id="normalize-data-cube">3.3 Normalize Data Cube</h2>
<p>Although default <code>sits</code> operations assemble cubes in the cloud, increased temporal and spatial extents and finer resolutions often require significant processing times. Especially with larger data cube operations, we recommend assembling data cubes in the cloud and downloading copies of the cube imagery to your drive before normalizing imagery into a regular cube from the local directory of downloads. This speeds up operations and avoids network interruptions or queue lags.</p>
<p>Three normalization procedures were implemented to ensure spatiotemporally harmonized analysis-ready dataset:</p>
<ul>
<li>Local Download:&nbsp;The cloud-hosted imagery was copied to local storage to accelerate subsequent processing and avoid network interruptions during computationally intensive operations. This step is particularly important for large jurisdictional monitoring areas where repeated cloud access would create bottlenecks.</li>
<li>Spatial-Temporal Regularization:&nbsp;The heterogeneous cube was transformed into a regular grid using the following parameters:
<ul>
<li>Spatial resolution:&nbsp;40m uniform pixel spacing (harmonizing the native 10m/20m bands)</li>
<li>Temporal resolution:&nbsp;16-day intervals (P16D) aligned with standard phenological monitoring cycles</li>
<li>Cloud compositing:&nbsp;For each 16-day period, cloud-free pixels were prioritized; gaps filled through temporal interpolation</li>
<li>Coordinate system:&nbsp;Maintained original UTM Zone 20S projection</li>
</ul>
</li>
</ul>
<p>This regularization addresses both spatial misalignment between bands and temporal gaps from cloud contamination, the latter being a critical source of activity data bias in REDD+ monitoring when forest clearing coincides with persistent cloud cover.</p>
<ul>
<li>Spectral Index Derivation:&nbsp;Three vegetation indices were calculated and added to the cube as additional analytical bands:
<ul>
<li>NDVI&nbsp;(Normalized Difference Vegetation Index): (NIR - Red) / (NIR + Red); general vegetation vigor</li>
<li>NBR&nbsp;(Normalized Burn Ratio): (NIR - SWIR2) / (NIR + SWIR2) — burn scar and deforestation detection</li>
<li>EVI&nbsp;(Enhanced Vegetation Index): 2.5 × (NIR - Red) / (NIR + 6×Red - 7.5×Blue + 1); reduces atmospheric effects</li>
</ul>
</li>
</ul>
<p>The regularized cube structure shows 13 spectral attributes (10 original bands + 3 indices) organized in a spatiotemporal array spanning 23 temporal steps at 40m resolution (see cube structure below). Implementation details are provided in Section 3.11</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Copy cube to local files</span></span>
<span><span class="va">cube_s2_local</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cube_copy.html">sits_cube_copy</a></span><span class="op">(</span></span>
<span>  cube              <span class="op">=</span> <span class="va">cube_s2_raw</span>,</span>
<span>  output_dir    <span class="op">=</span> <span class="st">"./assets/images/raw/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Normalize cube from local files</span></span>
<span><span class="va">cube_s2_reg</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_regularize.html">sits_regularize</a></span><span class="op">(</span></span>
<span>    cube                <span class="op">=</span> <span class="va">cube_s2_local</span>,</span>
<span>    output_dir  <span class="op">=</span> <span class="st">"./assets/images/reg/"</span>,</span>
<span>    res                 <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    period      <span class="op">=</span> <span class="st">"P16D"</span>,</span>
<span>    multicores  <span class="op">=</span> <span class="fl">6</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute spectral index bands for cube</span></span>
<span><span class="va">cube_s2_reg</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span></span>
<span>    data                <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    NDVI                <span class="op">=</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B04</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="va">B04</span><span class="op">)</span>,</span>
<span>  output_dir    <span class="op">=</span> <span class="st">"./assets/images/reg/"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cube_s2_reg</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span></span>
<span>    data                <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    NBR                 <span class="op">=</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B12</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="va">B12</span><span class="op">)</span>,</span>
<span>  output_dir    <span class="op">=</span> <span class="st">"./assets/images/reg/"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cube_s2_reg</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span></span>
<span>    data                <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    EVI                 <span class="op">=</span> <span class="fl">2.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B04</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="fl">6.0</span> <span class="op">*</span> <span class="va">B04</span> <span class="op">-</span> <span class="fl">7.5</span> <span class="op">*</span> <span class="va">B02</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>  output_dir    <span class="op">=</span> <span class="st">"./assets/images/reg/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check cube structure</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">cube_s2_reg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot single-date RGB image</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_reg</span>, </span>
<span>         red <span class="op">=</span> <span class="st">"B11"</span>, </span>
<span>         green <span class="op">=</span> <span class="st">"B8A"</span>, </span>
<span>         blue <span class="op">=</span> <span class="st">"B02"</span>, </span>
<span>         date <span class="op">=</span> <span class="st">"2022-07-16"</span></span>
<span>         <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<pre><code>NA 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |======================================================================| 100%
NA Rows: 1
NA Columns: 11
NA $ source     &lt;chr&gt; "MPC"
NA $ collection &lt;chr&gt; "SENTINEL-2-L2A"
NA $ satellite  &lt;chr&gt; "SENTINEL-2"
NA $ sensor     &lt;chr&gt; "MSI"
NA $ tile       &lt;chr&gt; "20LMR"
NA $ xmin       &lt;dbl&gt; 399960
NA $ xmax       &lt;dbl&gt; 509760
NA $ ymin       &lt;dbl&gt; 8990200
NA $ ymax       &lt;dbl&gt; 9100000
NA $ crs        &lt;chr&gt; "PROJCRS[\"WGS 84 / UTM zone 20S\",\n    BASEGEOGCRS[\"WGS …
NA $ file_info  &lt;list&gt; [&lt;tbl_df[299 x 13]&gt;]</code></pre>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</section><section id="training-data-samples" class="level2"><h2 class="anchored" data-anchor-id="training-data-samples">3.4 Training Data Samples</h2>
<p>Training data quality directly determines classification accuracy and, consequently, activity data uncertainty. This analysis uses the <code>samples_deforestation_rondonia</code> dataset (n=6,007 signatures) distributed with the <code>sitsdata</code> package, comprising nine forest disturbance classes collected through expert visual interpretation of Sentinel-2 imagery representing deforestation events across Rondônia state in the Brazilian Amazon:</p>
<ul>
<li>
<code>Clear_Cut_Bare_Soil</code>: Post-clearing exposed soil</li>
<li>
<code>Clear_Cut_Burned_Area</code>: Burned clearing residues</li>
<li>
<code>Clear_Cut_Vegetation</code>: Regrowth or residual vegetation post-harvest</li>
<li>
<code>Forest</code>: Intact forest including <code>Mountainside_Forest</code>, <code>Riparian_Forest</code>
</li>
<li>
<code>Water</code>, <code>Wetland</code>, <code>Seasonally_Flooded</code>: Hydrological features</li>
</ul>
<p>The time series spans 2022-01-05 to 2022-12-23 at 16-day intervals, containing 10 Sentinel-2 bands (<code>B02</code>, <code>B03</code>, <code>B04</code>, <code>B05</code>, <code>B06</code>, <code>B07</code>, <code>B8A</code>, <code>B08</code>, <code>B11</code> and <code>B12</code>). Temporal validity aligns with the agricultural calendar to capture seasonal dynamics of land conversion.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Demo Training Samples</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"samples_deforestation_rondonia"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">summary</span>(samples_deforestation_rondonia)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 9 × 3</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   label                 count   prop</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                 <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span> Clear_Cut_Bare_Soil     <span class="dv">944</span> <span class="fl">0.157</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span> Clear_Cut_Burned_Area   <span class="dv">983</span> <span class="fl">0.164</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span> Clear_Cut_Vegetation    <span class="dv">603</span> <span class="fl">0.100</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span> Forest                  <span class="dv">964</span> <span class="fl">0.160</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span> Mountainside_Forest     <span class="dv">211</span> <span class="fl">0.0351</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span> Riparian_Forest        <span class="dv">1247</span> <span class="fl">0.208</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">7</span> Seasonally_Flooded      <span class="dv">731</span> <span class="fl">0.122</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">8</span> Water                   <span class="dv">109</span> <span class="fl">0.0181</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">9</span> Wetland                 <span class="dv">215</span> <span class="fl">0.0358</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">head</span>(samples_deforestation_rondonia)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 6 × 7</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   longitude latitude start_date end_date   label               cube  time_series</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span>     </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span>     <span class="sc">-</span><span class="fl">66.5</span>    <span class="sc">-</span><span class="fl">9.63</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.70</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.81</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Forest              SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.64</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Vegetati… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Burned_A… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We imported the <code>samples_deforestation_rondonia</code> reference dataset (n=6,007 labeled time series) from the sitsdata package. This dataset represents expert visual interpretation of Sentinel-2 imagery across nine forest disturbance classes spanning the 2022 monitoring period. The class distribution shows reasonable balance across deforestation stages, with <code>Riparian_Forest</code> (20.8%) and <code>Clear_Cut_Burned_Area</code> (16.4%) as the most represented classes, while rare classes like Water (1.8%) and Wetland (3.6%) have sufficient samples for model training (&gt;100 observations each). Each training sample consists of:</p>
<ul>
<li>Spatial coordinates:&nbsp;Longitude/latitude in WGS84</li>
<li>Temporal extent:&nbsp;2022-01-05 to 2022-12-23 (23 acquisition dates)</li>
<li>Spectral values:&nbsp;10 Sentinel-2 bands at 16-day intervals</li>
<li>Class label:&nbsp;One of nine disturbance categories</li>
<li>Cube reference:&nbsp;Source imagery identification</li>
</ul>
<p>The temporal span aligns with the agricultural calendar to capture seasonal dynamics of forest-to-agriculture conversion, including dry-season clearing (May-June) followed by burning (August-September). This phenological coverage is critical for distinguishing between deforestation stages using time series classification</p>
<p>Visualizing class-specific temporal trajectories aids in assessing spectral separability; a key determinant of classification uncertainty. The <code>sits_patterns()</code> function fits generalized additive models (GAM) to training data, producing smoothed temporal signatures that represent idealized class behavior. We derive vegetation indices (NDVI, EVI, NBR) to enhance interpretability.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Compute spectral indexes for training samples</span></span>
<span><span class="va">training_samples_with_indices</span> <span class="op">&lt;-</span> <span class="va">samples_deforestation_rondonia</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span>NDVI <span class="op">=</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B04</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="va">B04</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span>NBR <span class="op">=</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B12</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="va">B12</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span>EVI <span class="op">=</span> <span class="fl">2.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B04</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="fl">6.0</span> <span class="op">*</span> <span class="va">B04</span> <span class="op">-</span> <span class="fl">7.5</span> <span class="op">*</span> <span class="va">B02</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Generate and plot patterns</span></span>
<span><span class="va">training_samples_indices</span> <span class="op">&lt;-</span> <span class="va">training_samples_with_indices</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_select.html">sits_select</a></span><span class="op">(</span>bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NDVI"</span>, <span class="st">"EVI"</span>, <span class="st">"NBR"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_patterns.html">sits_patterns</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>To assess spectral separability between classes—a key determinant of classification uncertainty—we calculated vegetation indices (NDVI, EVI, NBR) for all training samples and extracted class-specific temporal patterns using generalized additive models (GAM). These smoothed signatures represent idealized phenological trajectories for each disturbance class.</p>
<p>The temporal patterns (Figure X) reveal distinct phenological contrasts that enable classification:</p>
<ul>
<li>
<code>Forest</code> classes: (Forest, Mountainside_Forest, Riparian_Forest): High stable NDVI/EVI (&gt;0.7) throughout the year, with minimal seasonal variation reflecting evergreen tropical forest characteristics</li>
<li>
<code>Clear_Cut_Bare_Soil</code>: Abrupt decline in all indices coinciding with clearing events, with NDVI dropping to &lt;0.2</li>
<li>
<code>Clear_Cut_Burned_Area</code>: Sharp SWIR spike (low NBR values ~-0.3) during August-September dry season, indicating active burning</li>
<li>
<code>Clear_Cut_Vegetation</code>: Gradual NIR/NDVI recovery through the monitoring period, showing regrowth trajectories</li>
<li>
<code>Water/Wetland</code> classes: Consistently low NDVI (&lt;0.3) with seasonal fluctuations in EVI reflecting inundation cycles</li>
</ul>
<p>These temporal contrasts provide the spectral-temporal feature space for subsequent Random Forest classification. Classes with overlapping signatures (e.g., Seasonally_Flooded vs.&nbsp;Wetland) represent known confusion sources requiring careful validation.</p>
</section><section id="classify-data-cube" class="level2"><h2 class="anchored" data-anchor-id="classify-data-cube">3.5 Classify Data Cube</h2>
<p>Random Forest models provide robust baseline classifiers for activity data, balancing computational efficiency with adequate performance for Tier 2-3 REDD+ requirements. The <code>sits_train()</code> function implements parallelized Random Forest training with default hyperparameters optimized for satellite time series.</p>
<p>We trained a Random Forest classifier using the following hyperparameters optimized for satellite time series classification:</p>
<ul>
<li>Number of trees:&nbsp;120 (balancing accuracy and computational efficiency)</li>
<li>Variables per split (<code>mtry</code>):&nbsp;10 (approximately √p where p = total features)</li>
<li>Training samples:&nbsp;6,007 labeled time series across 9 classes</li>
<li>Input features:&nbsp;10 spectral bands × 23 temporal observations = 230 features per sample</li>
</ul>
<p>The Random Forest algorithm constructs an ensemble of decision trees through bootstrap aggregation (bagging), where each tree trains on a random subset of samples and features. Final predictions aggregate votes across all trees, providing robust performance without requiring extensive hyperparameter tuning, critical for operational REDD+ systems where model calibration time is constrained.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Train model using Random Forest algorithm</span></span>
<span><span class="va">model_randomForest</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_train.html">sits_train</a></span><span class="op">(</span></span>
<span>  samples <span class="op">=</span> <span class="va">samples_deforestation_rondonia</span>,</span>
<span>  ml_method     <span class="op">=</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_rfor.html">sits_rfor</a></span><span class="op">(</span></span>
<span>    num_trees <span class="op">=</span> <span class="fl">120</span>,</span>
<span>    mtry            <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the model results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_randomForest</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<section id="variable-importance" class="level4"><h4 class="anchored" data-anchor-id="variable-importance">Variable Importance</h4>
<p>The feature importance ranking (Figure X) identifies which bands and temporal observations contribute most to class discrimination:</p>
<ul>
<li>SWIR bands (B11, B12)&nbsp;show highest importance, confirming importance to deforestation detection due to sensitivity to bare soil</li>
<li>NIR bands (B8A, B08)&nbsp;rank second, critical for vegetation structure and biomass proxies</li>
<li>Temporal depth matters:&nbsp;Later-season observations September-November carry weights (post-clearing phenology)</li>
<li>Red-edge bands (B05-B07)&nbsp;provide moderate importance, useful for subtle degradation detection</li>
</ul>
<p>Vairable importance ranking informs:</p>
<ul>
<li><p>Sensor planning:&nbsp;Prioritizing SWIR channels in future satellite missions</p></li>
<li><p>Uncertainty attribution:&nbsp;SWIR-band errors propagate more strongly into final classifications</p></li>
<li><p>Transfer learning:&nbsp;When adapting models to new regions, maintaining SWIR coverage is essential.</p></li>
</ul></section></section><section id="probability-data-cube" class="level2"><h2 class="anchored" data-anchor-id="probability-data-cube">3.6 Probability Data Cube</h2>
<p>Classification outputs are generated as probability cubes rather than discrete label maps to preserve model uncertainty information. The <code>sits_classify()</code> function applies trained models to regularized data cubes using fault-tolerant parallel processing, producing per-class probability layers that quantify model confidence at the pixel level.</p>
<p>The trained Random Forest model was applied to the regularized data cube using parallelized classification across 4 processing cores with 16GB memory allocation. Rather than producing discrete class labels, the classification generates a probability cube where each pixel contains membership probabilities for all nine classes (summing to 1.0).</p>
<p><strong>Why Probability Cubes Matter:</strong></p>
<p>Traditional discrete classifications discard critical uncertainty information. Probability cubes preserve pixel-level model confidence, enabling:</p>
<ul>
<li>Uncertainty mapping: Low maximum probability values indicate high uncertainty at class boundaries or in mixed pixels</li>
<li>Adaptive validation: High-uncertainty regions receive greater sampling density during accuracy assessment</li>
<li>Monte Carlo propagation: Probability distributions feed directly into emission uncertainty simulations (Chapter 4)</li>
<li>Temporal change detection: Probability time series detect gradual transitions but missed discrete labeling</li>
</ul>
<p>The Forest class probability layer (Figure X) shows high confidence (p &gt; 0.9, dark green) in intact forest areas, with lower probabilities (p = 0.4-0.7, light green) along forest edges and in degraded patches. These spatial patterns of uncertainty directly inform subsequent validation stratification and area estimation.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Classify data cube</span></span>
<span><span class="va">cube_s2_probs</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_classify.html">sits_classify</a></span><span class="op">(</span></span>
<span>    data            <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    ml_model        <span class="op">=</span> <span class="va">model_randomForest</span>,</span>
<span>    output_dir  <span class="op">=</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span>    version         <span class="op">=</span> <span class="st">"rf-1228"</span>, <span class="co"># adds suffix to output filename</span></span>
<span>    multicores  <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    memsize         <span class="op">=</span> <span class="fl">16</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_probs</span>, </span>
<span>         labels <span class="op">=</span> <span class="st">"Forest"</span>, </span>
<span>         palette <span class="op">=</span> <span class="st">"YlGn"</span></span>
<span>         <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-d.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Each pixel in the probability cube contains <code>n</code> probability values (where <code>n</code> = number of classes), summing to 1.0. Low maximum probability values indicate pixels with high classification uncertainty, typically occurring at class boundaries, in mixed pixels, or where spectral-temporal signatures deviate from training data. These pixel-level uncertainty metrics support subsequent:</p>
<ul>
<li>Adaptive stratification: High-uncertainty pixels receive higher validation sampling density</li>
<li>Uncertainty propagation: Probability distributions feed Monte Carlo emission simulations</li>
<li>Quality control: Spatial patterns of low confidence identify systematic classification errors</li>
<li>Temporal tracking: Probability time series detect gradual transitions missed by discrete labeling</li>
</ul>
<p>Probability cubes thus serve as the foundation for rigorous uncertainty quantification in subsequent workflow stages.</p>
</section><section id="training-data-enhancements" class="level2"><h2 class="anchored" data-anchor-id="training-data-enhancements">3.7 Training Data Enhancements</h2>
<p>Classification accuracy in REDD+ monitoring depends critically on training sample quality. Large, well-labeled datasets improve model performance regardless of algorithm choice, while noisy or mislabeled samples degrade classification accuracy and inflate activity data uncertainty <span class="citation" data-cites="maxwell2018implementation frenay2013classification">(<a href="../references/index.html#ref-frenay2013classification" role="doc-biblioref">Frénay &amp; Verleysen, 2013</a>; <a href="../references/index.html#ref-maxwell2018implementation" role="doc-biblioref">Maxwell et al., 2018</a>)</span>. This section demonstrates processing methods to identify problematic samples, reduce class imbalance, and address geographic variance before re-training models.</p>
<section id="pixel-entropy-sampling" class="level3"><h3 class="anchored" data-anchor-id="pixel-entropy-sampling">Pixel Entropy Sampling</h3>
<p>Active learning uses pixel-level classification uncertainty to systematically improve classification accuracy through iterative model refinement <span class="citation" data-cites="crawford2013active cao2012automatic">(<a href="../references/index.html#ref-cao2012automatic" role="doc-biblioref">Cao et al., 2012</a>; <a href="../references/index.html#ref-crawford2013active" role="doc-biblioref">Crawford et al., 2013</a>)</span>. When there is a finite set of alternative classes, the expected value of conflict is given by the Shannon entropy <span class="citation" data-cites="shannonMathematicalTheoryCommunication1948">(<a href="../references/index.html#ref-shannonMathematicalTheoryCommunication1948" role="doc-biblioref">Shannon, 1948</a>)</span>. Entropy may be used to describe the variations in class membership probabilities associated with each pixel. The <code>sits_uncertainty()</code> function quantifies four types of uncertainty metrics:</p>
<p><span class="math display">\[
\text{H} = -\sum_{i=1}^n Pr(i) \times \log(Pr(i))
\]</span></p>
<p>where <span class="math inline">\(Pr(i)\)</span> represents the highest membership probability for pixel <span class="math inline">\(i\)</span> across <span class="math inline">\(n\)</span> classes. For REDD+ applications, the <code>margin</code> of confidence typically provides the most actionable results, such as for highlighting transition zones where forest degradation or regeneration creates spectral ambiguity between classes. This margin is defined as the difference between the highest and second-highest class probabilities (Margin = p₁ - p₂), where low values approaching zero indicate ambiguous pixels where the classifier struggles to discriminate between competing classes.</p>
<p>The margin uncertainty cube reveals spatial patterns of classification difficulty across the landscape. High uncertainty concentrations appear along forest-agriculture boundaries where mixed pixels contain both forest and bare soil signatures, within wetland complexes where spectral similarity confuses Seasonally_Flooded and Wetland classes, and across regeneration zones where <code>Clear_Cut_Vegetation</code> becomes spectrally ambiguous with early-stage <code>Forest</code> regrowth. To systematically improve these problematic areas, we identified 300 candidate locations for additional training samples using a minimum uncertainty threshold of margin &lt; 0.4 with 10-pixel minimum spacing to ensure geographic dispersion. These samples, once labeled through expert interpretation and merged with the original training set for iterative model refinement, typically drive uncertainty convergence within 2-3 iterations.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generate uncertainty cube and sample high-uncertainty pixels</span></span>
<span><span class="va">cube_s2_uncertainty</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_uncertainty.html">sits_uncertainty</a></span><span class="op">(</span></span>
<span>    cube <span class="op">=</span> <span class="va">cube_s2_probs</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"margin"</span>, </span>
<span>    output_dir <span class="op">=</span> <span class="st">"./assets/images/uncertainty/"</span>,</span>
<span>    multicores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    memsize <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize high-uncertainty areas</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_uncertainty</span>, palette <span class="op">=</span> <span class="st">"Oranges"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-l1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>After extracting spectral signatures for the 300 high-uncertainty locations and retraining the Random Forest model with the expanded dataset (n_total = 6,307), we compared uncertainty maps between model versions to assess improvement. The side-by-side visualizations showed subtle spatial differences, with version 2 exhibiting slightly reduced uncertainty in previously ambiguous forest-wetland transitions. However, the convergence metrics revealed a counterintuitive result where mean uncertainty actually increased slightly in version 2. This pattern suggests that the additional samples exposed previously undetected class overlaps rather than resolving them, revealing legitimate spectral ambiguity that existed but wasn’t apparent in the original training set. This demonstrates an important REDD+ lesson: adding training samples doesn’t always reduce uncertainty, and proper convergence requires multiple iterations with strategic sample selection until uncertainty metrics stabilize.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find samples with high uncertainty</span></span>
<span><span class="va">new_samples_locations</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_uncertainty_sampling.html">sits_uncertainty_sampling</a></span><span class="op">(</span></span>
<span>    uncert_cube <span class="op">=</span> <span class="va">cube_s2_uncertainty</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    min_uncert <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    sampling_window <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Visualize new training points</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_view.html">sits_view</a></span><span class="op">(</span><span class="va">new_samples_locations</span><span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write</a></span><span class="op">(</span><span class="va">new_samples_locations</span>, </span>
<span>    <span class="st">"./assets/samples/new_samples_location.gpkg"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<p></p>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-0f74e8eba9e9bf321dcc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-0f74e8eba9e9bf321dcc">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"ESRI",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OSM",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addWMSTiles","args":["https://tiles.maps.eox.at/wms/",null,"Sentinel-2",{"styles":"","format":"image/jpeg","transparent":false,"version":"1.1.1","layers":"s2cloudless-2023_3857"}]},{"method":"addGlifyPoints","args":[[[-8.865204360326592,-63.05193062426965],[-8.932762872354346,-63.58715952693512],[-8.920924237767505,-63.03665710502161],[-8.74298744495157,-63.28938753169655],[-8.727718467378574,-63.04463841165219],[-8.66269568720946,-63.24824058944249],[-8.85434854007654,-63.90349417934754],[-8.876005634833911,-63.66891880288559],[-8.75889463629147,-63.80016924688943],[-8.771665138819419,-63.1088358857449],[-8.932293971811541,-63.146541853698054],[-8.285943316398056,-62.94288104188018],[-8.963486690680497,-63.31284821916283],[-8.613216807757402,-63.36399507668817],[-8.98827645959854,-63.70241891703824],[-8.639415026485057,-63.54416262336702],[-9.046882062674422,-63.703624033867854],[-8.495473486649024,-63.50452733307768],[-8.714039479049402,-63.29409249077777],[-8.644569975453837,-63.60488376920641],[-8.681223512935079,-62.93773210728629],[-8.958784990846418,-63.3108428866539],[-8.666885303571165,-63.56219918780816],[-8.61236429770593,-63.88764499282152],[-8.943174620029662,-63.73362222913118],[-8.754749716772915,-63.874888811581116],[-8.37404224687062,-62.92343076897986],[-9.074940672131165,-63.78229546926195],[-8.66202058794895,-63.15661609190626],[-8.353618670065224,-63.84091727409769],[-8.18050901209247,-63.34743271822889],[-8.540545904356739,-63.61053419774469],[-8.702933141212831,-63.055362526296754],[-8.792468938035773,-63.83279057456713],[-8.654236129981761,-63.408935814869736],[-8.787585910763458,-63.38380353221982],[-8.80515981994328,-63.73189335549186],[-8.744386643867069,-63.89740951798618],[-8.68555668792435,-63.83673439700127],[-8.925547438754153,-63.68119686122428],[-8.622298076572957,-63.493606419853414],[-8.859458182548689,-63.613779257676995],[-9.127003533420297,-63.87559576683033],[-8.595437668401976,-63.17949070235243],[-9.044067571723122,-63.19663176552305],[-8.856516076106603,-62.92005965237009],[-8.751778538758433,-63.04627781791331],[-9.045938725180276,-63.81007363434201],[-8.410345182991712,-63.44155890047696],[-8.998358424952734,-63.628749462628384],[-9.001965942706324,-63.634760070412014],[-8.976747088916849,-63.76934860724028],[-8.555489721022031,-63.08605577089851],[-8.55029234090743,-63.499692364759014],[-9.013948701828026,-63.6087611022763],[-8.479203234096127,-63.49614783053467],[-8.261022404334868,-63.73957438580507],[-8.771669096258753,-63.094106231703364],[-8.44125680438345,-63.46121592009698],[-8.63055268126347,-63.1313357847885],[-8.943515725070958,-63.74399222878843],[-9.054251455523008,-63.36333602979027],[-8.795143606628868,-63.20304550740291],[-8.957360331493774,-63.693990853023486],[-8.84347078865704,-63.75088314776545],[-8.495768692672707,-63.85394309367669],[-8.670985705917888,-63.70727243257301],[-8.290977823779466,-63.77794897863737],[-8.982181342598,-63.228257663879646],[-8.58160683782484,-63.71710202193795],[-8.623158616249263,-63.526689552986866],[-8.340581632282229,-63.00771984791931],[-8.86555541942294,-63.38206521532219],[-8.205992352848593,-63.37469157802149],[-8.953921541589246,-63.59083199488312],[-9.113640339033715,-63.698112080184934],[-8.61313032042519,-63.244754554939675],[-8.418843557291506,-63.790373785789164],[-9.102869909819697,-63.40415482866463],[-8.383592154713496,-63.567053360014036],[-8.947150125308761,-62.929136672098885],[-8.152405728754223,-63.15786414626506],[-8.355806144466321,-63.51397349221841],[-8.670009944631182,-62.955913817717885],[-8.635455765815017,-63.05426195869049],[-8.461710755467115,-63.587153109032826],[-9.015711956347046,-63.52069549114328],[-8.93829855686387,-63.360309574853645],[-8.956420146753599,-63.326123505529836],[-8.273306620599586,-63.35550435960534],[-9.052862358195195,-63.299094268797646],[-8.4050443332426,-63.48787814026574],[-8.194580346763404,-62.91947076933446],[-8.332537604869154,-63.45872650890691],[-8.191509778880262,-62.94961286463008],[-9.082976515981063,-63.399400572915894],[-8.178482853986486,-62.939083482001095],[-8.78015934309212,-63.13447943698987],[-8.938976665441585,-63.75235111555604],[-8.363735114385664,-63.047139256465144],[-8.223605084095837,-63.29698893240817],[-8.597281768439293,-63.07225113226216],[-8.76860516125415,-63.01482047971336],[-8.91416765633715,-63.219847125512565],[-8.760390464059128,-63.86035620508793],[-8.979827029307724,-63.43312896244814],[-8.857773996306841,-63.74436464295696],[-8.880513058160203,-63.77042013133352],[-8.821650156338075,-63.71664970617007],[-8.870433167283291,-63.125235439454066],[-9.10582703776253,-63.88118596234646],[-8.778786980144089,-63.313237424626195],[-9.117919960240458,-63.370680833011335],[-8.764425707235862,-63.38868942879614],[-8.353257553604937,-63.52614017893193],[-8.526924200667608,-63.83420557998908],[-8.236559308547333,-62.99845643604219],[-8.511883209584235,-63.39297392930204],[-9.12746313572349,-63.65773218208299],[-8.809077340617662,-63.19505104116225],[-8.733329043030858,-63.00809140195956],[-8.230982075714474,-63.347113387439514],[-8.701097046180053,-63.4017141586981],[-8.514583679541124,-63.15473839539013],[-8.331893386276166,-62.93869668967178],[-8.294970507072609,-63.40256303150068],[-8.779919653397956,-63.86312863727038],[-9.036879524315795,-63.73108137056231],[-8.552598745200324,-63.0684260987624],[-8.572438470716406,-63.86574434604216],[-8.661642383833154,-63.76833311239947],[-8.443634387462826,-63.43868968184709],[-8.604863436384939,-63.75804015459638],[-8.528535836920588,-63.383359383540714],[-8.946792226938589,-63.04612025314859],[-8.651444274537083,-63.60471295533856],[-9.02585337534276,-63.360396047225734],[-8.574860593244576,-63.52535063619433],[-8.576997980220067,-63.66438833044699],[-8.341506702974767,-63.52031207813165],[-9.016894107367133,-63.7739822387941],[-8.24408383637682,-63.24306981318535],[-8.390629897296598,-63.43881168747807],[-9.086225661880535,-63.180456448893324],[-9.022090920586304,-63.607501011103615],[-8.739427342131966,-63.199560465967586],[-8.15815167955446,-63.7068873078391],[-8.218959678013341,-63.20346865765567],[-9.050064809350554,-63.5325733838453],[-8.272069617895443,-63.732694263555985],[-8.902317945888159,-63.62094470755593],[-8.28954092509141,-63.772679639929244],[-8.415198419896415,-63.46845193667383],[-8.670153025268354,-63.41113454094092],[-8.380003622225212,-63.394293781125306],[-8.58657974835394,-63.165127654498434],[-8.80605247754269,-62.99245261780273],[-8.910572278574723,-63.65970442484068],[-9.051053961141273,-63.69762703046941],[-8.67684523730089,-63.554942248827594],[-8.385989117515763,-63.01898394060284],[-8.766934401720864,-63.761093129965644],[-8.784274041458547,-63.435081697181865],[-8.212173381437827,-63.74365982033843],[-8.204729663284107,-63.75817127188708],[-8.921642925613009,-63.373391314072066],[-9.034127391938517,-63.40571570411222],[-8.625732404016937,-63.326925093300844],[-9.054249230665329,-63.033576720927385],[-8.253161799618336,-63.68399327780422],[-8.55719511213095,-63.88733508353249],[-8.6927944787399,-63.09572275049742],[-8.878593064866642,-63.035925291278076],[-8.209343243309526,-63.89035947955727],[-8.677519190936913,-63.871800689990295],[-8.549344529022646,-62.944659835458104],[-8.14497790591879,-63.571977511912266],[-8.227023592729406,-63.32132438465002],[-8.471511376128857,-63.56536449282924],[-8.322852649766249,-62.99300704082016],[-8.690422105008288,-63.157718708894976],[-8.433743542731067,-63.38253870669112],[-8.595671375474039,-63.36179720543271],[-8.271213508753982,-63.45702088618814],[-8.51666438842993,-63.48438423279242],[-8.766231415025729,-63.83691407452267],[-8.987729586763743,-63.60253114777443],[-8.57526548218614,-63.89519145486849],[-8.831602656766643,-63.80414441339882],[-8.255957383016348,-63.73956495811104],[-8.539958422083847,-63.638337386735984],[-8.82170155416678,-63.86413472389055],[-8.190389082725956,-63.1760364791203],[-8.750695760821538,-62.98827146986103],[-8.622258674420593,-63.74280688142042],[-8.396912723863737,-63.48060144809253],[-8.662149439894117,-63.86940218929052],[-8.794288476073932,-63.642585455886376],[-8.83943910604914,-63.57591680049035],[-8.961735681240071,-63.67562433184296],[-8.168352557363109,-62.9434425719054],[-8.343748050189605,-63.46346219892579],[-8.937525506978687,-63.75434919515363],[-8.359127266040325,-63.46130058608592],[-8.984504207629596,-63.688402279382544],[-8.180345689378965,-63.73833559695427],[-8.597888370151516,-63.80782520148496],[-8.158040429216076,-63.0585531381793],[-8.697866979933627,-63.060816142981494],[-8.29240351437973,-63.43525141041214],[-8.214698831997826,-63.74747751116193],[-8.81360028200587,-63.1943259430872],[-9.07470908115197,-63.50239920308962],[-8.808001511755776,-63.175590957612464],[-8.907279394806784,-63.24240021542652],[-8.700457927352549,-63.3115357333869],[-8.668483526754839,-63.249880553222624],[-9.04463958928771,-63.53147355440207],[-8.788320255966125,-62.94698898953867],[-8.689186716489843,-62.964092935027864],[-8.536616230202215,-63.440067382507976],[-8.537910188509844,-63.67286159237643],[-9.035548715594107,-63.428464000006976],[-8.759197905216698,-63.02009351918108],[-9.071796510123132,-63.81395310753843],[-8.945624939086319,-63.25061246067897],[-8.722295271272943,-63.907355833857224],[-8.767875566605692,-62.93117129581735],[-8.937754630324346,-63.631737820734195],[-9.094728683533333,-63.907546891836994],[-8.653906663456782,-62.93646406704354],[-8.938928514113131,-63.25515609079914],[-8.596039270673367,-63.35525419838636],[-8.644862385283401,-63.057353674955536],[-8.6304369490763,-63.32565670163225],[-8.722996031784369,-63.12791326255073],[-8.571525465641109,-63.23982062546931],[-8.739083545663144,-63.548124674218464],[-8.27061543911696,-63.329350369452854],[-8.451287787785406,-62.914512556563196],[-8.827952215143718,-63.3578375073613],[-8.653409186703486,-63.894466390645654],[-9.010586155219176,-63.56199261115618],[-9.065146240717441,-63.31948737372601],[-9.074279129784605,-63.412312477704916],[-8.86211497733355,-63.38533564847107],[-8.863454942328424,-63.87732689116848],[-8.730864748526855,-63.87846924001082],[-8.2453059184793,-63.72792368778156],[-8.794764075216829,-63.68077424650406],[-8.987785496083355,-63.849788019235284],[-8.502006747020731,-63.61574262461128],[-8.86605236422285,-63.21199704700335],[-9.071232217644738,-63.73897599137412],[-9.036870449954034,-63.8981217916821],[-9.097250270235746,-63.414704804295425],[-8.263693780003035,-62.961408271326135],[-8.716447631162671,-63.42554850398402],[-8.271485376674695,-63.75502960822873],[-8.796049380615893,-63.42018333337273],[-8.615103830263008,-63.876201023529816],[-8.235711745374825,-63.49475065911006],[-8.922875897929506,-63.75322764238475],[-8.64446144325724,-63.41456051182276],[-8.65372310440466,-62.92210262836794],[-8.366079970704975,-62.912169708552234],[-8.498424599539852,-63.26357972689581],[-8.352150908392632,-62.915987446622445],[-8.193839280315109,-63.143354376829365],[-9.113463957127877,-63.298416458539045],[-8.903375391618079,-63.735543618724115],[-8.676682384896484,-63.65747276215865],[-8.227483833209607,-63.41175558925681],[-8.282241493529787,-63.26470534492152],[-8.968322226845203,-62.98680901209596],[-8.462510443885616,-63.047696299003206],[-8.228447033760517,-63.349835013060044],[-9.028783963193872,-63.48595831551486],[-8.633095204763812,-63.098434366299315],[-8.512175744777222,-63.45639406909034],[-8.664516968648199,-63.22860797209744],[-9.008855776926294,-63.507948622183015],[-8.794831097534509,-62.93607652022417],[-9.054237099263972,-63.37753076825231],[-8.679094270518709,-63.49822529634633],[-8.688605107668577,-63.17589864088279],[-9.04202915187302,-63.68723742692776],[-8.789462865996734,-63.800962072128215],[-8.336963440189159,-62.990827088597726],[-8.749969903716792,-63.042822686335775],[-8.160804066336546,-63.33089386764715],[-8.200005369209341,-63.39266191623895],[-9.032222713267657,-63.31945832870147],[-8.76878169061303,-63.059372860509065],[-8.63855608038039,-63.51107812274938],[-8.72720026995873,-63.89845925179638],[-8.632375435658048,-63.749551988314366],[-8.726851857478453,-63.72283133386844],[-8.626434126188233,-63.63357416359552],[-8.803238094891357,-63.46056393918396]],[{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275}],null,null,1,10,"samples",null,{"stroke":false},"overlayPane"]},{"method":"addLegend","args":[{"colors":["#FFB3B5"],"labels":["NoClass"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"Classes","extra":null,"layerId":null,"className":"info legend","group":null}]},{"method":"addLayersControl","args":[["ESRI","OSM","Sentinel-2"],"samples",{"collapsed":false,"autoZIndex":true,"position":"topright"}]}],"flyToBounds":[-9.12746313572349,-63.90754689183699,-8.14497790591879,-62.91216970855223,[]],"limits":{"lat":[-9.12746313572349,-8.14497790591879],"lng":[-63.90754689183699,-62.91216970855223]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract new spectral signatures</span></span>
<span><span class="va">new_samples</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_get_data.html">sits_get_data</a></span><span class="op">(</span></span>
<span>    cube <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    samples <span class="op">=</span> <span class="va">new_samples_locations</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#new_samples$label &lt;- "Wetland"</span></span>
<span><span class="va">new_samples_aligned</span> <span class="op">&lt;-</span> <span class="fu">sits_select</span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_samples</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, </span>
<span>                    <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"B8A"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge with original samples</span></span>
<span><span class="va">new_samples_merge</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">samples_deforestation_rondonia</span>,</span>
<span>  <span class="va">new_samples_aligned</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train new model &amp; evaluate</span></span>
<span><span class="va">model_randomForest_v2</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_train.html">sits_train</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="va">new_samples_merge</span>, </span>
<span>  ml_method <span class="op">=</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_rfor.html">sits_rfor</a></span><span class="op">(</span>num_trees <span class="op">=</span> <span class="fl">120</span>,mtry <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classify new cube</span></span>
<span><span class="co"># Classify data cube</span></span>
<span><span class="va">cube_s2_probs_v2</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_classify.html">sits_classify</a></span><span class="op">(</span></span>
<span>    data            <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    ml_model        <span class="op">=</span> <span class="va">model_randomForest_v2</span>,</span>
<span>    output_dir  <span class="op">=</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span>    version         <span class="op">=</span> <span class="st">"rf-1228-v2"</span>, <span class="co"># adds suffix to output filename</span></span>
<span>    multicores  <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    memsize         <span class="op">=</span> <span class="fl">16</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Derive new uncertainty cube and compare</span></span>
<span><span class="va">cube_s2_uncertainty_v2</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_uncertainty.html">sits_uncertainty</a></span><span class="op">(</span></span>
<span>    <span class="va">cube_s2_probs_v2</span>, </span>
<span>    type <span class="op">=</span> <span class="st">"margin"</span>, </span>
<span>  output_dir <span class="op">=</span> <span class="st">"./assets/images/uncertainty_v2/"</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize side-by-side</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_uncertainty</span>, palette <span class="op">=</span> <span class="st">"Reds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_uncertainty_v2</span>, palette <span class="op">=</span> <span class="st">"Oranges"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell quarto-layout-panel" data-layout-ncol="2">

</div>
<div id="fig-entropy-b" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-entropy-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-l1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-entropy-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1
</figcaption></figure>
</div>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Search for convergence (extract filepath first)</span></span>
<span><span class="va">get_uncert_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">uncert_cube</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">files</span> <span class="op">&lt;-</span> <span class="va">uncert_cube</span><span class="op">$</span><span class="va">file_info</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">path</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html">values</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate statistics</span></span>
<span><span class="va">uncert_v1_vals</span> <span class="op">&lt;-</span> <span class="fu">get_uncert_values</span><span class="op">(</span><span class="va">cube_s2_uncertainty</span><span class="op">)</span></span>
<span><span class="va">uncert_v2_vals</span> <span class="op">&lt;-</span> <span class="fu">get_uncert_values</span><span class="op">(</span><span class="va">cube_s2_uncertainty_v2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">uncertainty_check</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  iteration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"v1"</span>, <span class="st">"v2"</span><span class="op">)</span>,</span>
<span>  mean_uncert <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">uncert_v1_vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">uncert_v2_vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  sd_uncert <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">uncert_v1_vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">uncert_v2_vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  pct_high_uncert <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">uncert_v1_vals</span> <span class="op">&gt;</span> <span class="fl">0.4</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">uncert_v1_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">uncert_v2_vals</span> <span class="op">&gt;</span> <span class="fl">0.4</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">uncert_v2_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">uncertainty_check</span>, <span class="st">"./assets/samples/uncertainty_check.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-99196448{table-layout:auto;width:100%;}.cl-99141b64{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-99141b78{font-family:'Helvetica';font-size:9pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-99163e44{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-99163e4e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-991659b0{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-991659ba{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-991659bb{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-991659c4{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-991659c5{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-991659ce{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-99196448">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-991659b0"><p class="cl-99163e44"><span class="cl-99141b64">...1</span></p></th>
<th class="cl-991659ba"><p class="cl-99163e4e"><span class="cl-99141b64">iteration</span></p></th>
<th class="cl-991659b0"><p class="cl-99163e44"><span class="cl-99141b64">mean_uncert</span></p></th>
<th class="cl-991659b0"><p class="cl-99163e44"><span class="cl-99141b64">sd_uncert</span></p></th>
<th class="cl-991659b0"><p class="cl-99163e44"><span class="cl-99141b64">pct_high_uncert</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-991659bb"><p class="cl-99163e44"><span class="cl-99141b78">1</span></p></td>
<td class="cl-991659c4"><p class="cl-99163e4e"><span class="cl-99141b78">v1</span></p></td>
<td class="cl-991659bb"><p class="cl-99163e44"><span class="cl-99141b78">4,508.770</span></p></td>
<td class="cl-991659bb"><p class="cl-99163e44"><span class="cl-99141b78">2,741.364</span></p></td>
<td class="cl-991659bb"><p class="cl-99163e44"><span class="cl-99141b78">99.66006</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-991659c5"><p class="cl-99163e44"><span class="cl-99141b78">2</span></p></td>
<td class="cl-991659ce"><p class="cl-99163e4e"><span class="cl-99141b78">v2</span></p></td>
<td class="cl-991659c5"><p class="cl-99163e44"><span class="cl-99141b78">5,465.921</span></p></td>
<td class="cl-991659c5"><p class="cl-99163e44"><span class="cl-99141b78">2,729.796</span></p></td>
<td class="cl-991659c5"><p class="cl-99163e44"><span class="cl-99141b78">99.82174</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Short class relabelling, the above method showcases an iterative revision workflow typically used to integrate new samples and retrain models until uncertainty stabilizes. For ART-TREES compliance, uncertainty reduction directly decreases activity data deductions and simplifies third-party verification.</p>
</section><section id="hierarchical-clustering" class="level3"><h3 class="anchored" data-anchor-id="hierarchical-clustering">Hierarchical Clustering</h3>
<p>We implemented two clustering approaches for evaluating training data quality based on dataset size: Agglomerative Hierarchical Clustering (<code>AHC</code>) for datasets under 10,000 samples, and Self-Organizing Maps (SOM) for larger collections (Gonçalves et al., 2008; Neagoe et al., 2014; Yao et al., 2016). The computational complexity difference is significant—AHC operates at O(n²) requiring substantial memory, while SOM scales linearly, making it preferable for operational REDD+ monitoring systems processing large reference datasets.</p>
<p>Hierarchical clustering computes dissimilarity between samples using dynamic time warping (DTW), which reliably measures differences in satellite time series by accounting for temporal shifts in phenological patterns (Maus et al., 2019; Petitjean et al., 2012). The sits_cluster_dendro() function generates dendrograms using <code>DTW</code> distance with Ward’s linkage criterion to minimize within-cluster variance, applied here to NDVI and EVI time series spanning 23 temporal observations per sample. The adjusted Rand index (Rand, 1971) identified seven as the optimal cluster count, and examining the resulting cluster composition revealed distinct groupings that illuminate class separability and potential quality issues.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Cluster samples using DTW distance and Ward linkage</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cluster_dendro.html">sits_cluster_dendro</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="va">training_samples_with_indices</span>, </span>
<span>    bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NDVI"</span>, <span class="st">"EVI"</span><span class="op">)</span>,</span>
<span>    dist_method <span class="op">=</span> <span class="st">"dtw_basic"</span>,</span>
<span>    linkage <span class="op">=</span> <span class="st">"ward.D2"</span><span class="op">)</span></span>
<span>    </span>
<span><span class="co"># Examine cluster composition</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cluster_frequency.html">sits_cluster_frequency</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-g.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<pre><code>                           1    2    3    4    5    6    7 Total
  Clear_Cut_Bare_Soil    121    9  104  705    5    0    0   944
  Clear_Cut_Burned_Area   79    5   23  874    0    0    2   983
  Clear_Cut_Vegetation   259  164   43  103    0    0   34   603
  Forest                 174  732    5    6    0    0   47   964
  Mountainside_Forest     12  145    2    0    0    0   52   211
  Riparian_Forest         39  327   11    6    0    0  864  1247
  Seasonally_Flooded     414   94  160   25   29    0    9   731
  Water                    0    0    1    2    2  104    0   109
  Wetland                 56    1   55   19   53   31    0   215
  Total                 1154 1477  404 1740   89  135 1008  6007</code></pre>
<p>Cluster 4 strongly dominated by <code>Clear-cut</code> classes with 705 <code>Bare_Soil</code> and 874 <code>Burned_Area</code> samples (1,579 total) demonstrated strong spectral-temporal similarity among cleared areas, while Cluster 2 contained predominantly forest types with 732 <code>Forest</code>, 327 <code>Riparian</code>, and 145 <code>Mountainside</code> samples (1,204 total), confirming these classes share fundamental phenological characteristics. Conversely, Cluster 5 showed high mixture across multiple classes with the lowest purity, suggesting these 89 samples occupy ambiguous spectral space representing either mislabeled observations, edge pixels with mixed land cover, or transitional states not well-represented by discrete classes. We removed Cluster 5 entirely from the training set, and after retaining only dominant labels within remaining clusters through the <code>sits_cluster_clean()</code> function, the refined dataset contained 5,893 samples with improved class purity, with only 25 additional samples removed from other clusters.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove cluster#5 from the samples</span></span>
<span><span class="va">clusters_new</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">clusters</span>, <span class="va">cluster</span> <span class="op">!=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">clusters_clean</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cluster_clean.html">sits_cluster_clean</a></span><span class="op">(</span><span class="va">clusters_new</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check clusters samples frequency</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cluster_frequency.html">sits_cluster_frequency</a></span><span class="op">(</span><span class="va">clusters_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate SOM with optimal grid dimensions</span></span>
<span><span class="va">som_map</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_map.html">sits_som_map</a></span><span class="op">(</span></span>
<span>    <span class="va">training_samples_with_indices</span>, </span>
<span>  grid_xdim <span class="op">=</span> <span class="fl">10</span>, </span>
<span>  grid_ydim <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean samples by removing mixed neurons</span></span>
<span><span class="va">samples_clean</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_clean_samples.html">sits_som_clean_samples</a></span><span class="op">(</span><span class="va">som_map</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize sample clustering &amp; class confusions</span></span>
<span><span class="va">som_eval</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_evaluate_cluster.html">sits_som_evaluate_cluster</a></span><span class="op">(</span><span class="va">som_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">som_eval</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">som_map</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<pre><code>                         1  2  3  4 Total
  Clear_Cut_Burned_Area  0  5  0  0     5
  Forest                 0  0  0  6     6
  Mountainside_Forest   12  0  2  0    14
  Total                 12  5  2  6    25</code></pre>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-som-a" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-som-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-h1.png" id="fig-som-a" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-som-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2
</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-som-freq" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-som-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-h2.png" id="fig-som-freq" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-som-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3
</figcaption></figure>
</div>
</div>
</div>
</div>
</section><section id="self-organizing-maps" class="level3"><h3 class="anchored" data-anchor-id="self-organizing-maps"><strong>Self-Organizing Maps</strong></h3>
<p>For larger datasets exceeding 10,000 samples, Self-Organizing Maps provide a computationally efficient alternative through unsupervised learning that projects high-dimensional time series onto two-dimensional grids while preserving topological relationships. The sits_som_map() function configured with 10×10 neurons (100 total cells) and DTW distance metric organizes samples such that similar signatures map to nearby neurons, with learning parameters alpha=1.0 and rlen=20 following standard Kohonen optimization. Applied to the full spectral-temporal dataset (10 bands × 23 dates), the SOM evaluation plot reveals class distribution patterns across the neural grid that indicate data quality and class separability.</p>
<p>Single-class neurons appearing as pure colored cells indicate well-separated classes with distinct spectral signatures, while mixed neurons containing multiple colors reveal spectral confusion requiring investigation, and empty gray cells suggest gaps in feature space not represented by training samples. The SOM frequency map showing neuron activation patterns identifies high-density neurons containing many similar samples and low-density neurons that may represent outliers or rare spectral conditions. Samples from mixed neurons were flagged for expert review, and the SOM-based cleaning through <code>sits_som_clean_samples</code>() removed observations from neurons containing multiple classes, improving overall dataset purity while maintaining within-class variability essential for model generalization. This approach proves particularly valuable for operational REDD+ systems processing large reference datasets collected through crowdsourcing or automated methods where quality control becomes challenging at scale.</p>
</section><section id="class-imbalances" class="level3"><h3 class="anchored" data-anchor-id="class-imbalances">Class Imbalances</h3>
<p>Imbalanced training sets bias classifiers toward over-represented classes and inflate omission errors for rare forest types, which poses particular problems when those rare classes represent critical high-carbon-stock forests for REDD+ accounting. Our original dataset showed significant imbalance with <code>Riparian_Forest</code> at 20.8% and <code>Clear_Cut_Burned_Area</code> at 16.4% dominating, while Water at 1.8% and Wetland at 3.6% remained severely under-represented. This 11:1 ratio between majority and minority classes causes Random Forest algorithms to under-predict rare classes through implicit class-frequency weighting during tree construction.</p>
<p>We applied a hybrid resampling strategy through sits_reduce_imbalance() that combines oversampling and undersampling approaches to achieve balanced representation. The Synthetic Minority Over-sampling Technique (SMOTE) generated synthetic samples for rare classes below 200 observations by creating realistic time series through interpolation between existing samples in feature space, while random undersampling removed samples from majority classes exceeding 400 observations to match minority class frequencies. This dual approach targets all classes toward a 200-400 sample range, reducing the majority:minority ratio from 11:1 to 2:1 while avoiding the pitfalls of either strategy alone—oversampling prevents discarding potentially informative data from majority classes, while undersampling reduces computational load.</p>
<p>The post-balancing summary demonstrated dramatically improved class distribution with all nine classes falling within the target range, and comparing SOM visualizations before and after balancing revealed the transformation from large clusters dominated by <code>Riparian_Forest</code> and <code>Clear_Cut_Burned_Area</code> to more uniform distribution across the neural grid with better representation of minority classes. This balanced training improves classifier sensitivity to rare forest types such as degraded riparian forests and seasonally flooded forests that may have high carbon stocks but low spatial extent, directly reducing omission errors in activity data—a critical source of conservative bias in emission estimates under REDD+ accounting frameworks.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Balance samples across classes</span></span>
<span><span class="va">samples_balanced</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_reduce_imbalance.html">sits_reduce_imbalance</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="va">training_samples_with_indices</span>,</span>
<span>    n_samples_over <span class="op">=</span> <span class="fl">200</span>,   <span class="co"># Oversample rare classes</span></span>
<span>    n_samples_under <span class="op">=</span> <span class="fl">400</span>,  <span class="co"># Undersample common classes</span></span>
<span>    multicores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Re-evaluate using SOM clustering</span></span>
<span><span class="va">som_map_balanced</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_map.html">sits_som_map</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">samples_balanced</span>,</span>
<span>    grid_xdim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    grid_ydim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>    distance <span class="op">=</span> <span class="st">"dtw"</span>,</span>
<span>    rlen <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Store estimates in tibble</span></span>
<span><span class="va">som_eval_balanced</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_evaluate_cluster.html">sits_som_evaluate_cluster</a></span><span class="op">(</span></span>
<span>    <span class="va">som_map_balanced</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">som_eval</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">som_eval_balanced</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">samples_balanced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-som-b" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-som-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-i1.png" id="fig-som-b" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-som-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4
</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-som-c" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-som-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-h1.png" id="fig-som-c" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-som-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5
</figcaption></figure>
</div>
</div>
</div>
</div>
<pre><code># A tibble: 9 × 3
  label                 count   prop
  &lt;chr&gt;                 &lt;int&gt;  &lt;dbl&gt;
1 Clear_Cut_Bare_Soil     400 0.134 
2 Clear_Cut_Burned_Area   388 0.130 
3 Clear_Cut_Vegetation    392 0.131 
4 Forest                  400 0.134 
5 Mountainside_Forest     211 0.0707
6 Riparian_Forest         396 0.133 
7 Seasonally_Flooded      384 0.129 
8 Water                   200 0.0670
9 Wetland                 215 0.0720</code></pre>
</section><section id="geographic-variance" class="level3"><h3 class="anchored" data-anchor-id="geographic-variance">Geographic Variance</h3>
<p>Training samples must capture spatial variability across the entire monitoring jurisdiction to avoid geographic bias where clustered sampling creates gaps with higher prediction uncertainty due to extrapolation beyond training data conditions (Meyer &amp; Pebesma, 2022). The sits_geo_dist() function quantifies this coverage by comparing two distance distributions: sample-to-sample distances measuring how far apart training points are from each other, and prediction-location-to-sample distances measuring how far each pixel in the study area lies from its nearest training sample. Ideally these distributions should align closely, indicating that every prediction location falls within the same distance range as the training samples are from each other, while mismatched distributions reveal insufficient spatial coverage in certain regions.</p>
<p>The distance distribution plot comparing these two curves identifies geographic gaps where the prediction-to-sample curve extends beyond the sample-to-sample curve, indicating regions requiring additional sampling. For jurisdictional REDD+ monitoring, these gaps often occur in remote protected areas with limited field access, recent deforestation hotspots not captured during original sampling campaigns, and ecotonal boundaries with unique spectral characteristics that deviate from the main training distribution. Addressing these geographic gaps through targeted field campaigns reduces spatial uncertainty and improves model transferability across the full monitoring domain, ensuring that classification accuracy remains consistent rather than degrading in under-sampled regions where verification may be most critical.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Derive jurisdiction boundary</span></span>
<span><span class="va">bbox_cube</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_bbox.html">sits_bbox</a></span><span class="op">(</span><span class="va">cube_s2_reg</span><span class="op">)</span> </span>
<span><span class="va">bbox_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">aoi</span><span class="op">$</span><span class="va">xmin</span>, </span>
<span>    ymin <span class="op">=</span> <span class="va">aoi</span><span class="op">$</span><span class="va">ymin</span>, </span>
<span>    xmax <span class="op">=</span> <span class="va">aoi</span><span class="op">$</span><span class="va">xmax</span>, </span>
<span>    ymax <span class="op">=</span> <span class="va">aoi</span><span class="op">$</span><span class="va">ymax</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">$</span><span class="va">crs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to sf </span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="va">bbox_sf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assess geographic coverage</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_geo_dist.html">sits_geo_dist</a></span><span class="op">(</span></span>
<span>    <span class="va">training_samples_with_indices</span>, roi <span class="op">=</span> <span class="va">aoi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-j.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Mismatched distributions indicate insufficient spatial coverage. Areas with few nearby training samples will exhibit higher classification uncertainty, requiring either additional field sampling or explicit uncertainty quantification in those regions during accuracy assessment.</p>
</section><section id="noise-filtering" class="level3"><h3 class="anchored" data-anchor-id="noise-filtering">Noise Filtering</h3>
<p>Satellite time series contain noise from atmospheric contamination including residual clouds and aerosols, sensor artifacts, and geometric co-registration errors that introduce random variation obscuring genuine phenological patterns. The Whittaker smoother (<code>sits_whittaker()</code>) applies penalized least squares regression to balance fidelity to observed values against temporal smoothness, controlled by parameter lambda where low values preserve more detail and high values enforce stronger smoothing. Applied with conservative lambda=0.5, the filtering preserved legitimate rapid changes such as abrupt deforestation events while removing high-frequency noise that degraded classification accuracy.</p>
<p>Comparing filtered versus original time series across representative classes revealed the smoothing clarified underlying temporal trends; <code>Clear_Cut_Bare_Soil</code> showed declining <code>NDVI</code> with sharp fluctuations reduced, <code>Forest</code> maintained stable high-<code>NDVI</code> phenology with minor fluctuations eliminated, <code>Clear_Cut_Burned_Area</code> revealed abrupt drops during burning events more clearly, and <code>Seasonally_Flooded</code> preserved seasonal oscillation patterns while reducing measurement noise. For REDD+ applications, conservative filtering with lambda ≤ 1.0 is recommended to avoid smoothing over short-duration clearing events that represent genuine forest loss, ensuring that the filtered training samples provide cleaner inputs for model training while preserving the temporal dynamics essential for accurate activity data classification. Implementation details for all enhancement procedures are provided in Section 3.11.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Apply Whittaker filter with conservative smoothing</span></span>
<span><span class="va">samples_balanced_ndvi</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_select.html">sits_select</a></span><span class="op">(</span></span>
<span>    <span class="va">samples_balanced</span>, bands <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply Whitakker filter</span></span>
<span><span class="va">samples_balanced_whit</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_whittaker.html">sits_whittaker</a></span><span class="op">(</span></span>
<span>    <span class="va">samples_balanced_ndvi</span>, lambda <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge to visualize</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_merge.html">sits_merge</a></span><span class="op">(</span></span>
<span>    <span class="va">samples_balanced_ndvi</span>, </span>
<span>    <span class="va">samples_balanced_whit</span>,</span>
<span>    suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">".WHIT"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-layout-panel" data-layout-ncol="4">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k1a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k1b.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k2a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k2b.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k3a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k3b.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k4a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k4b.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k5a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k5b.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k6a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k6b.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k7a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k7b.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k8a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k8b.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Over-smoothing (high lambda values) eliminates legitimate phenological variation, reducing model discriminatory power. Conservative filtering (lambda ≤ 1.0) balances noise reduction with pattern preservation <span class="citation" data-cites="Atkinson2012 Zhou2016">(<a href="../references/index.html#ref-Atkinson2012" role="doc-biblioref"><strong>Atkinson2012?</strong></a>; <a href="../references/index.html#ref-Zhou2016" role="doc-biblioref"><strong>Zhou2016?</strong></a>)</span>.</p>
<p>Integration with Uncertainty Workflows: Quality-controlled training data directly reduces classification uncertainty by minimizing systematic errors from mislabeling and improving model generalization. Combined with the cross-validation procedures in Section 3.8 and accuracy assessment in Section 3.9, these enhancement methods establish a rigorous foundation for defensible activity data uncertainty quantification under ART-TREES requirements.</p>
</section></section><section id="smooth-data-cube" class="level2"><h2 class="anchored" data-anchor-id="smooth-data-cube">3.8 Smooth Data Cube</h2>
<p>Pixel-based classification inherently produces salt-and-pepper noise due to within-class spectral variability and mixed pixels. Isolated misclassified pixels surrounded by different classes represent systematic over-fitting to training data rather than true landscape heterogeneity, inflating area uncertainty and complicating change detection in REDD+ applications. The sits_smooth() function addresses this through Bayesian post-processing that incorporates spatial context from neighboring pixels to refine probability estimates. The algorithm computes spatially-weighted probability adjustments based on neighborhood composition, then updates pixel probabilities using Bayesian inference that combines original model estimates with spatial priors derived from surrounding pixels. This process produces a refined probability cube with reduced outlier effects while preserving legitimate small patches that represent genuine landscape features rather than classification artifacts.</p>
<p>The smoothed Forest probability map (Figure X) demonstrates the effect—high-confidence pixels (p &gt; 0.9) appear in dark green representing intact forest cores, while transitional zones along forest edges show moderate probabilities (p = 0.4-0.7) in lighter green, reflecting genuine mixed-pixel conditions rather than random noise. Spatial smoothing affects activity data uncertainty in competing directions that must be carefully balanced. The approach reduces random error by eliminating isolated misclassifications that inflate variance, and typically improves validation agreement by aligning with human interpretation scales that naturally incorporate spatial context. However, smoothing introduces potential spatial bias by potentially smoothing over legitimate small-scale heterogeneity, and modifies probability distributions in ways that change pixel-level uncertainty estimates. For REDD+ reporting, smoothed probability cubes typically yield lower reported uncertainties due to reduced classification noise, but verification bodies may require documentation of smoothing parameters demonstrating that methodological choices preserve ecologically meaningful patterns.</p>
<p>Final classified maps derive from smoothed probability cubes through maximum likelihood labeling where each pixel receives the class with highest posterior probability. The <code>sits_label_classification()</code> function performs this deterministic assignment while maintaining provenance links to underlying probability distributions, ensuring that uncertainty information remains accessible for subsequent Monte Carlo emission simulations. The classified cube (Figure X) showing all nine disturbance classes provides the activity data foundation for REDD+ accounting, though full uncertainty quantification requires additional analysis beyond discrete classification. The advanced procedures in Sections 3.9-3.10 using caret and terra packages address this need through stratified validation with area-adjusted accuracy assessment and Monte Carlo calibration workflows for robust uncertainty estimation. Implementation details for smoothing and labeling procedures are provided in Section 3.10.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-e.png" class="img-fluid figure-img"></p>
<figcaption>Smoothed probability map for class <code>Forest</code>.</figcaption></figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Smoothing Risks
</div>
</div>
<div class="callout-body-container callout-body">
<p>Spatial smoothing affects activity data uncertainty in competing directions:</p>
<ul>
<li>Reduces random error: Eliminates isolated misclassifications that inflate variance</li>
<li>Introduces spatial bias: May smooth over legitimate small-scale heterogeneity</li>
<li>Improves validation agreement: Better alignment with typical human interpretation scales</li>
<li>Modifies probability distributions: Changes the shape of pixel-level uncertainty estimates</li>
</ul>
<p>For REDD+ reporting, smoothed probability cubes typically yield lower reported uncertainties due to reduced classification noise, but verification bodies may require documentation of smoothing parameters demonstrating methodological choices.</p>
</div>
</div>
<hr>
<p>Final classified maps are derived from smoothed probability cubes through maximum likelihood labeling: each pixel is assigned the class with highest posterior probability. The <code>sits_label_classification()</code> function performs this deterministic assignment while maintaining provenance links to underlying probability distributions.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-f.png" class="img-fluid figure-img"></p>
<figcaption>Classified cube obtained by Random Forest model.</figcaption></figure>
</div>
<p>The classified cube produced by <code>sits</code> workflows provides the activity data foundation for REDD+ accounting, but uncertainty quantification requires additional analysis beyond the discrete classification procedures. Sections 3.2-3.5 demonstrate more more advanced operations using <code>caret</code> <span class="citation" data-cites="kuhn2011caret">(<a href="../references/index.html#ref-kuhn2011caret" role="doc-biblioref">Kuhn, 2011</a>)</span>, <code>ForestToolbox</code> <span class="citation" data-cites="ForesToolboxRS">(<a href="../references/index.html#ref-ForesToolboxRS" role="doc-biblioref">Tarazona Coronel et al., 2021</a>)</span>, and <code>terra</code> packages <span class="citation" data-cites="terra-2">(<a href="../references/index.html#ref-terra-2" role="doc-biblioref">Hijmans, 2025</a>)</span> required to:</p>
<ol type="1">
<li>Extract pixel-level probability distributions for Monte Carlo sampling (Section 3.3)</li>
<li>Implement stratified validation with area-adjusted accuracy assessment (Section 3.4)</li>
<li>Calibrate Random Forest hyperparameters through iterative uncertainty minimization (Section 3.5)</li>
</ol>
<hr></section><section id="cross-validation" class="level2"><h2 class="anchored" data-anchor-id="cross-validation">3.8 Cross-Validation</h2>
<p>Cross-validation quantifies model generalization capacity by partitioning training data into independent subsets for iterative testing. To integrate sits time series data with caret-based validation workflows, we first converted the nested time series structure into a tabular feature matrix suitable for Monte Carlo simulation. For each of the 6,007 training samples, we extracted six statistical summaries across the temporal dimension: mean and standard deviation for NIR (<code>B8A</code>), SWIR (<code>B11</code>), and <code>NDVI</code>. This feature engineering reduces the 230-dimensional input space (10 bands × 23 dates) to a 6-dimensional summary statistics space that enables rapid iterative testing while maintaining discriminatory power for the nine disturbance classes. Although this simplified representation loses some temporal resolution compared to the full time series used in sits classification, it provides computational efficiency essential for Monte Carlo simulation requiring thousands of iterations to achieve ART-TREES compliance.</p>
<p>Now, let’s Extract statistical summaries from <code>sits</code> time series for <code>caret</code> compatibility:</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract features from cube samples</span></span>
<span><span class="va">extract_features</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sits_samples</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">features_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sits_samples</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ts</span> <span class="op">&lt;-</span> <span class="va">sits_samples</span><span class="op">$</span><span class="va">time_series</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>      label <span class="op">=</span> <span class="va">sits_samples</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>      mean_B8A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      sd_B8A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      mean_B11 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B11</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      sd_B11 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B11</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      mean_NDVI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span> <span class="op">-</span> <span class="va">ts</span><span class="op">$</span><span class="va">B04</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span> <span class="op">+</span> <span class="va">ts</span><span class="op">$</span><span class="va">B04</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      sd_NDVI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span> <span class="op">-</span> <span class="va">ts</span><span class="op">$</span><span class="va">B04</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span> <span class="op">+</span> <span class="va">ts</span><span class="op">$</span><span class="va">B04</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">features_list</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">train_features</span> <span class="op">&lt;-</span> <span class="fu">extract_features</span><span class="op">(</span><span class="va">samples_deforestation_rondonia</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="monte-carlo-cross-validation" class="level3"><h3 class="anchored" data-anchor-id="monte-carlo-cross-validation">Monte Carlo Cross-Validation</h3>
<p>We implemented Monte Carlo Leave-Group-Out Cross-Validation (LGOCV) to quantify model stability and generalization capacity through repeated random partitioning. The simulation configuration used 75% calibration and 25% validation splits across 10 iterations for demonstration purposes, though ART-TREES requirements for activity data uncertainty demand 10,000 iterations for statistically robust performance estimates. This dramatic increase from demonstration to operational scale reflects the need to stabilize mean performance estimates, quantify variance across different data partitions, capture rare failure modes in specific train-test combinations, and meet statistical significance thresholds for MRV reporting. Each iteration randomly partitioned the feature dataset while maintaining class proportions, fitted a Random Forest with 120 trees optimized for Kappa statistic (which accounts for class imbalance better than raw accuracy), and generated predictions on the withheld validation set.</p>
<p>The cross-validation summary demonstrates model stability across iterations with mean accuracy of 70.9% (±1.5%) and mean Kappa of 0.656 (±0.017). The low standard deviations indicate consistent performance despite random partitioning, suggesting the model generalizes well to unseen data. However, the moderate Kappa value around 0.66 indicates room for improvement through additional training samples in confused classes, hyperparameter optimization, or integration of ancillary data such as elevation or soil maps. These metrics would feed directly into ART-TREES Equation 11 for activity data uncertainty deductions, where the relative standard deviation of cross-validated predictions determines the half-width of the 90% confidence interval used in carbon credit calculations. The demonstration with 10 iterations provides proof-of-concept, but operational implementation requires scaling to thousands of iterations to meet ART-TREES statistical confidence requirements.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Configure Monte Carlo simulation</span></span>
<span><span class="va">mc_simulation</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"LGOCV"</span>,</span>
<span>  number <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Increase to 10,000 iterations for ART-TREES submissions</span></span>
<span>  p <span class="op">=</span> <span class="fl">0.75</span>, <span class="co"># 75:25% split</span></span>
<span>  savePredictions <span class="op">=</span> <span class="st">"final"</span>,</span>
<span>  classProbs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  summaryFunction <span class="op">=</span> <span class="fu">caret</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/caret/man/postResample.html">multiClassSummary</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train over monte carlo simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">model_randomRandom_mc</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span></span>
<span>  <span class="va">label</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">train_features</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"rf"</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">mc_simulation</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"Kappa"</span>,</span>
<span>  ntree <span class="op">=</span> <span class="fl">120</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarize stability</span></span>
<span><span class="va">model_randomRandom_mc_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Accuracy"</span>, <span class="st">"Kappa"</span><span class="op">)</span>,</span>
<span>  mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">model_randomRandom_mc</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">Accuracy</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">model_randomRandom_mc</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">Kappa</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">model_randomRandom_mc</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">Accuracy</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">model_randomRandom_mc</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">Kappa</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="va">model_randomRandom_mc_summary</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span>, part <span class="op">=</span> <span class="st">"body"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, part <span class="op">=</span> <span class="st">"footer"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_table_properties.html">set_table_properties</a></span><span class="op">(</span>layout <span class="op">=</span> <span class="st">"autofit"</span>, width<span class="op">=</span><span class="fl">1</span>, align <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="tabwid">
<style>.cl-abf86fdc{table-layout:auto;width:100%;}.cl-abf36866{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-abf3687a{font-family:'Helvetica';font-size:9pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-abf56e72{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-abf56e86{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-abf587e0{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-abf587f4{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-abf587f5{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-abf587fe{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-abf587ff{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-abf58808{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-abf86fdc">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-abf587e0"><p class="cl-abf56e72"><span class="cl-abf36866">metric</span></p></th>
<th class="cl-abf587f4"><p class="cl-abf56e86"><span class="cl-abf36866">mean</span></p></th>
<th class="cl-abf587f4"><p class="cl-abf56e86"><span class="cl-abf36866">sd</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-abf587f5"><p class="cl-abf56e72"><span class="cl-abf3687a">Accuracy</span></p></td>
<td class="cl-abf587fe"><p class="cl-abf56e86"><span class="cl-abf3687a">0.7091516</span></p></td>
<td class="cl-abf587fe"><p class="cl-abf56e86"><span class="cl-abf3687a">0.01467986</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-abf587ff"><p class="cl-abf56e72"><span class="cl-abf3687a">Kappa</span></p></td>
<td class="cl-abf58808"><p class="cl-abf56e86"><span class="cl-abf3687a">0.6560266</span></p></td>
<td class="cl-abf58808"><p class="cl-abf56e86"><span class="cl-abf3687a">0.01749026</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="accuracy-assessment" class="level2"><h2 class="anchored" data-anchor-id="accuracy-assessment">3.9 Accuracy Assessment</h2>
<p>Accuracy assessment quantifies classification performance against independent reference data through stratified train-test partitioning that ensures adequate representation across all nine forest disturbance classes. We partitioned the feature dataset into training (80%, n≈4,806) and testing (20%, n≈1,201) subsets using stratified random sampling that maintains original class proportions in both subsets. This prevents bias from over- or under-representing rare classes during evaluation, which becomes critical given our 11:1 imbalance between majority and minority classes. All class labels were converted to factors with consistent levels across training and testing sets to prevent errors when rare classes appear in only one subset—a common issue with imbalanced datasets that causes prediction failures during validation. The model trained on the 80% calibration set with 120 Random Forest trees was then evaluated on the withheld 20% test set to generate confusion matrix statistics.</p>
<p>The confusion matrix quantifies classification performance by comparing predicted labels against reference labels for the 1,201 withheld test samples, revealing both overall accuracy and class-specific error patterns critical for REDD+ uncertainty assessment. Overall performance achieved 73.9% accuracy (95% CI: 71.4-76.4%) with Kappa of 0.692, significantly better than random assignment (p &lt; 2.2e-16) and indicating moderate agreement beyond chance. Class-specific performance varied dramatically, with high-performing classes achieving sensitivity above 85%—Water reached 100% sensitivity with 95.5% precision through its distinctive spectral signature, Riparian_Forest achieved 88% sensitivity despite constituting 20.8% of the dataset, and <code>Forest</code> showed 86.5% sensitivity representing core forest discrimination. Moderate performers included <code>Clear_Cut_Burned_Area</code> at 73.5% sensitivity, <code>Seasonally_Flooded</code> at 69.2%, and <code>Clear_Cut_Bare_Soil</code> at 69.2%, while <code>Mountainside_Forest</code> suffered severe under-<code>prediction</code> at only 7.1% sensitivity.</p>
<p>The critical failure in <code>Mountainside_Forest</code> classification with 7.1% sensitivity stems from its low prevalence in the training set (3.5% of samples), spectral overlap with other forest types, and topographic effects not captured in spectral features alone. Key confusion patterns emerged between <code>Clear_Cut_Bare_Soil</code> and <code>Clear_Cut_Burned_Area</code> (72 total misclassifications) due to similar bare soil signatures, among forest types (<code>Forest</code>, <code>Mountainside_Forest</code>, <code>Riparian_Forest</code>) sharing vegetation characteristics, and between hydrological classes (<code>Seasonally_Flooded</code> and Wetland<code>)</code> with overlapping seasonal inundation dynamics. For REDD+ implications, the 73.9% accuracy translates to approximately 26% activity data uncertainty before applying ART-TREES area adjustment corrections. Class-specific errors, particularly the Mountainside_Forest omissions, would inflate uncertainty in jurisdictions with significant topographic variability, requiring either targeted training sample augmentation for rare classes, stratified validation with higher sampling density in confused regions, or integration of DEM-derived topographic variables as additional features. Implementation details for accuracy assessment procedures are provided in Section 3.10.</p>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ensure consistent factor levels</span></span>
<span><span class="va">all_classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">train_features</span><span class="op">$</span><span class="va">label</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stratified partition</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span></span>
<span>  <span class="va">train_features</span><span class="op">$</span><span class="va">label</span>,</span>
<span>  p <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  list <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">train_features</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">train_features</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Ensure labels are factors with same levels</span></span>
<span><span class="va">train_data</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">$</span><span class="va">label</span>, levels <span class="op">=</span> <span class="va">all_classes</span><span class="op">)</span></span>
<span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span>, levels <span class="op">=</span> <span class="va">all_classes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train model</span></span>
<span><span class="va">accuracy_model</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span></span>
<span>  <span class="va">label</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">train_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"rf"</span>,</span>
<span>  ntree <span class="op">=</span> <span class="fl">120</span>,</span>
<span>  importance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  trControl <span class="op">=</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predict</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">accuracy_model</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure predictions have same levels</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">predictions</span>, levels <span class="op">=</span> <span class="va">all_classes</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="confusion-matrix" class="level3"><h3 class="anchored" data-anchor-id="confusion-matrix">Confusion Matrix</h3>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generate confusion matrix</span></span>
<span><span class="va">confMatrix</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">predictions</span>,</span>
<span>  reference <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">label</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">confMatrix</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Clear_Cut_Bare_Soil Forest Clear_Cut_Vegetation</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                   130      2                    8</span></span>
<span><span class="co">##   Forest                                  0    166                   11</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                   16      1                   74</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                  41      0                    4</span></span>
<span><span class="co">##   Wetland                                 1      0                    0</span></span>
<span><span class="co">##   Water                                   0      0                    0</span></span>
<span><span class="co">##   Mountainside_Forest                     0      0                    1</span></span>
<span><span class="co">##   Seasonally_Flooded                      0      7                    8</span></span>
<span><span class="co">##   Riparian_Forest                         0     16                   14</span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Clear_Cut_Burned_Area Wetland Water Mountainside_Forest</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                      31       2     0                   0</span></span>
<span><span class="co">##   Forest                                    0       1     0                  15</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                     10       1     0                   3</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                   144       0     0                   0</span></span>
<span><span class="co">##   Wetland                                   3      27     0                   0</span></span>
<span><span class="co">##   Water                                     0       1    21                   0</span></span>
<span><span class="co">##   Mountainside_Forest                       0       0     0                   3</span></span>
<span><span class="co">##   Seasonally_Flooded                        6      11     0                   1</span></span>
<span><span class="co">##   Riparian_Forest                           2       0     0                  20</span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Seasonally_Flooded Riparian_Forest</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                    6               3</span></span>
<span><span class="co">##   Forest                                19              20</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                   7               5</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                  2               0</span></span>
<span><span class="co">##   Wetland                                1               0</span></span>
<span><span class="co">##   Water                                  0               0</span></span>
<span><span class="co">##   Mountainside_Forest                    2               0</span></span>
<span><span class="co">##   Seasonally_Flooded                   101               2</span></span>
<span><span class="co">##   Riparian_Forest                        8             219</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Overall Statistics</span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##                Accuracy : 0.7393         </span></span>
<span><span class="co">##                  95% CI : (0.7135, 0.764)</span></span>
<span><span class="co">##     No Information Rate : 0.208          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16      </span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##                   Kappa : 0.6916         </span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : NA             </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistics by Class:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                      Class: Clear_Cut_Bare_Soil Class: Forest</span></span>
<span><span class="co">## Sensitivity                              0.6915        0.8646</span></span>
<span><span class="co">## Specificity                              0.9485        0.9343</span></span>
<span><span class="co">## Pos Pred Value                           0.7143        0.7155</span></span>
<span><span class="co">## Neg Pred Value                           0.9429        0.9731</span></span>
<span><span class="co">## Prevalence                               0.1571        0.1604</span></span>
<span><span class="co">## Detection Rate                           0.1086        0.1387</span></span>
<span><span class="co">## Detection Prevalence                     0.1520        0.1938</span></span>
<span><span class="co">## Balanced Accuracy                        0.8200        0.8995</span></span>
<span><span class="co">##                      Class: Clear_Cut_Vegetation Class: Clear_Cut_Burned_Area</span></span>
<span><span class="co">## Sensitivity                              0.61667                       0.7347</span></span>
<span><span class="co">## Specificity                              0.96007                       0.9530</span></span>
<span><span class="co">## Pos Pred Value                           0.63248                       0.7539</span></span>
<span><span class="co">## Neg Pred Value                           0.95741                       0.9483</span></span>
<span><span class="co">## Prevalence                               0.10025                       0.1637</span></span>
<span><span class="co">## Detection Rate                           0.06182                       0.1203</span></span>
<span><span class="co">## Detection Prevalence                     0.09774                       0.1596</span></span>
<span><span class="co">## Balanced Accuracy                        0.78837                       0.8439</span></span>
<span><span class="co">##                      Class: Wetland Class: Water Class: Mountainside_Forest</span></span>
<span><span class="co">## Sensitivity                 0.62791      1.00000                   0.071429</span></span>
<span><span class="co">## Specificity                 0.99567      0.99915                   0.997403</span></span>
<span><span class="co">## Pos Pred Value              0.84375      0.95455                   0.500000</span></span>
<span><span class="co">## Neg Pred Value              0.98627      1.00000                   0.967254</span></span>
<span><span class="co">## Prevalence                  0.03592      0.01754                   0.035088</span></span>
<span><span class="co">## Detection Rate              0.02256      0.01754                   0.002506</span></span>
<span><span class="co">## Detection Prevalence        0.02673      0.01838                   0.005013</span></span>
<span><span class="co">## Balanced Accuracy           0.81179      0.99957                   0.534416</span></span>
<span><span class="co">##                      Class: Seasonally_Flooded Class: Riparian_Forest</span></span>
<span><span class="co">## Sensitivity                            0.69178                 0.8795</span></span>
<span><span class="co">## Specificity                            0.96670                 0.9367</span></span>
<span><span class="co">## Pos Pred Value                         0.74265                 0.7849</span></span>
<span><span class="co">## Neg Pred Value                         0.95759                 0.9673</span></span>
<span><span class="co">## Prevalence                             0.12197                 0.2080</span></span>
<span><span class="co">## Detection Rate                         0.08438                 0.1830</span></span>
<span><span class="co">## Detection Prevalence                   0.11362                 0.2331</span></span>
<span><span class="co">## Balanced Accuracy                      0.82924                 0.9081</span></span>
<span></span>
<span><span class="co"># Extract metrics</span></span>
<span><span class="va">accuracy_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Overall Accuracy"</span>, <span class="st">"Kappa"</span>, <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="va">confMatrix</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="st">"Accuracy"</span><span class="op">]</span>,</span>
<span>    <span class="va">confMatrix</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="st">"Kappa"</span><span class="op">]</span>,</span>
<span>    <span class="va">confMatrix</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="st">"AccuracyLower"</span><span class="op">]</span>,</span>
<span>    <span class="va">confMatrix</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="st">"AccuracyUpper"</span><span class="op">]</span></span>
<span>  <span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">accuracy_metrics</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span>, part <span class="op">=</span> <span class="st">"body"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/fontsize.html">fontsize</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, part <span class="op">=</span> <span class="st">"footer"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/set_table_properties.html">set_table_properties</a></span><span class="op">(</span>layout <span class="op">=</span> <span class="st">"autofit"</span>, width<span class="op">=</span><span class="fl">1</span>, align <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="tabwid">
<style>.cl-aceb130e{table-layout:auto;width:100%;}.cl-ace6414e{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ace64162{font-family:'Helvetica';font-size:9pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ace8362a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ace8363e{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ace84dd6{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ace84de0{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ace84dea{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ace84deb{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ace84df4{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ace84dfe{background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-aceb130e">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-ace84dd6"><p class="cl-ace8362a"><span class="cl-ace6414e">metric</span></p></th>
<th class="cl-ace84de0"><p class="cl-ace8363e"><span class="cl-ace6414e">value</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-ace84dea"><p class="cl-ace8362a"><span class="cl-ace64162">Overall Accuracy</span></p></td>
<td class="cl-ace84deb"><p class="cl-ace8363e"><span class="cl-ace64162">0.7393</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ace84dea"><p class="cl-ace8362a"><span class="cl-ace64162">Kappa</span></p></td>
<td class="cl-ace84deb"><p class="cl-ace8363e"><span class="cl-ace64162">0.6916</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ace84dea"><p class="cl-ace8362a"><span class="cl-ace64162">95% CI Lower</span></p></td>
<td class="cl-ace84deb"><p class="cl-ace8363e"><span class="cl-ace64162">0.7135</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-ace84df4"><p class="cl-ace8362a"><span class="cl-ace64162">95% CI Upper</span></p></td>
<td class="cl-ace84dfe"><p class="cl-ace8363e"><span class="cl-ace64162">0.7640</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold"><summary>View Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">confMatrix</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Clear_Cut_Bare_Soil Forest Clear_Cut_Vegetation</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                   130      2                    8</span></span>
<span><span class="co">##   Forest                                  0    166                   11</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                   16      1                   74</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                  41      0                    4</span></span>
<span><span class="co">##   Wetland                                 1      0                    0</span></span>
<span><span class="co">##   Water                                   0      0                    0</span></span>
<span><span class="co">##   Mountainside_Forest                     0      0                    1</span></span>
<span><span class="co">##   Seasonally_Flooded                      0      7                    8</span></span>
<span><span class="co">##   Riparian_Forest                         0     16                   14</span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Clear_Cut_Burned_Area Wetland Water Mountainside_Forest</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                      31       2     0                   0</span></span>
<span><span class="co">##   Forest                                    0       1     0                  15</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                     10       1     0                   3</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                   144       0     0                   0</span></span>
<span><span class="co">##   Wetland                                   3      27     0                   0</span></span>
<span><span class="co">##   Water                                     0       1    21                   0</span></span>
<span><span class="co">##   Mountainside_Forest                       0       0     0                   3</span></span>
<span><span class="co">##   Seasonally_Flooded                        6      11     0                   1</span></span>
<span><span class="co">##   Riparian_Forest                           2       0     0                  20</span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Seasonally_Flooded Riparian_Forest</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                    6               3</span></span>
<span><span class="co">##   Forest                                19              20</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                   7               5</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                  2               0</span></span>
<span><span class="co">##   Wetland                                1               0</span></span>
<span><span class="co">##   Water                                  0               0</span></span>
<span><span class="co">##   Mountainside_Forest                    2               0</span></span>
<span><span class="co">##   Seasonally_Flooded                   101               2</span></span>
<span><span class="co">##   Riparian_Forest                        8             219</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Overall Statistics</span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##                Accuracy : 0.7393         </span></span>
<span><span class="co">##                  95% CI : (0.7135, 0.764)</span></span>
<span><span class="co">##     No Information Rate : 0.208          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16      </span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##                   Kappa : 0.6916         </span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : NA             </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistics by Class:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                      Class: Clear_Cut_Bare_Soil Class: Forest</span></span>
<span><span class="co">## Sensitivity                              0.6915        0.8646</span></span>
<span><span class="co">## Specificity                              0.9485        0.9343</span></span>
<span><span class="co">## Pos Pred Value                           0.7143        0.7155</span></span>
<span><span class="co">## Neg Pred Value                           0.9429        0.9731</span></span>
<span><span class="co">## Prevalence                               0.1571        0.1604</span></span>
<span><span class="co">## Detection Rate                           0.1086        0.1387</span></span>
<span><span class="co">## Detection Prevalence                     0.1520        0.1938</span></span>
<span><span class="co">## Balanced Accuracy                        0.8200        0.8995</span></span>
<span><span class="co">##                      Class: Clear_Cut_Vegetation Class: Clear_Cut_Burned_Area</span></span>
<span><span class="co">## Sensitivity                              0.61667                       0.7347</span></span>
<span><span class="co">## Specificity                              0.96007                       0.9530</span></span>
<span><span class="co">## Pos Pred Value                           0.63248                       0.7539</span></span>
<span><span class="co">## Neg Pred Value                           0.95741                       0.9483</span></span>
<span><span class="co">## Prevalence                               0.10025                       0.1637</span></span>
<span><span class="co">## Detection Rate                           0.06182                       0.1203</span></span>
<span><span class="co">## Detection Prevalence                     0.09774                       0.1596</span></span>
<span><span class="co">## Balanced Accuracy                        0.78837                       0.8439</span></span>
<span><span class="co">##                      Class: Wetland Class: Water Class: Mountainside_Forest</span></span>
<span><span class="co">## Sensitivity                 0.62791      1.00000                   0.071429</span></span>
<span><span class="co">## Specificity                 0.99567      0.99915                   0.997403</span></span>
<span><span class="co">## Pos Pred Value              0.84375      0.95455                   0.500000</span></span>
<span><span class="co">## Neg Pred Value              0.98627      1.00000                   0.967254</span></span>
<span><span class="co">## Prevalence                  0.03592      0.01754                   0.035088</span></span>
<span><span class="co">## Detection Rate              0.02256      0.01754                   0.002506</span></span>
<span><span class="co">## Detection Prevalence        0.02673      0.01838                   0.005013</span></span>
<span><span class="co">## Balanced Accuracy           0.81179      0.99957                   0.534416</span></span>
<span><span class="co">##                      Class: Seasonally_Flooded Class: Riparian_Forest</span></span>
<span><span class="co">## Sensitivity                            0.69178                 0.8795</span></span>
<span><span class="co">## Specificity                            0.96670                 0.9367</span></span>
<span><span class="co">## Pos Pred Value                         0.74265                 0.7849</span></span>
<span><span class="co">## Neg Pred Value                         0.95759                 0.9673</span></span>
<span><span class="co">## Prevalence                             0.12197                 0.2080</span></span>
<span><span class="co">## Detection Rate                         0.08438                 0.1830</span></span>
<span><span class="co">## Detection Prevalence                   0.11362                 0.2331</span></span>
<span><span class="co">## Balanced Accuracy                      0.82924                 0.9081</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="reproducible-workflow" class="level2"><h2 class="anchored" data-anchor-id="reproducible-workflow">3.10 Reproducible Workflow</h2>
<div class="cell">
<details class="code-fold"><summary>View Code</summary><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Environment Setup</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>easypackages<span class="sc">::</span><span class="fu">packages</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bslib"</span>, <span class="st">"caret"</span>, <span class="st">"cols4all"</span>, <span class="st">"covr"</span>, <span class="st">"cowplot"</span>, <span class="st">"dendextend"</span>, <span class="st">"digest"</span>,<span class="st">"DiagrammeR"</span>, <span class="st">"dtwclust"</span>, <span class="st">"downlit"</span>, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"devtools"</span>, <span class="st">"e1071"</span>, <span class="st">"exactextractr"</span>,<span class="st">"elevatr"</span>, <span class="st">"FNN"</span>, <span class="st">"future"</span>, <span class="st">"forestdata"</span>,<span class="st">"gdalcubes"</span>, <span class="st">"gdalUtilities"</span>, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"geojsonsf"</span>, <span class="st">"geos"</span>, <span class="st">"ggplot2"</span>, <span class="st">"ggstats"</span>, <span class="st">"ggspatial"</span>, <span class="st">"ggmap"</span>, <span class="st">"ggplotify"</span>, <span class="st">"ggpubr"</span>, <span class="st">"ggrepel"</span>, </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"giscoR"</span>, <span class="st">"hdf5r"</span>, <span class="st">"httr"</span>, <span class="st">"httr2"</span>, <span class="st">"htmltools"</span>, <span class="st">"jsonlite"</span>, <span class="st">"kohonen"</span>, <span class="st">"leafem"</span>, <span class="st">"leaflet.providers"</span>, </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"libgeos"</span>,<span class="st">"luz"</span>,<span class="st">"lwgeom"</span>, <span class="st">"leaflet"</span>, <span class="st">"leafgl"</span>, <span class="st">"MLmetrics"</span>, <span class="st">"mapedit"</span>, <span class="st">"mapview"</span>, <span class="st">"maptiles"</span>, <span class="st">"methods"</span>, </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mgcv"</span>, <span class="st">"ncdf4"</span>, <span class="st">"nnet"</span>, <span class="st">"openxlsx"</span>, <span class="st">"parallel"</span>, <span class="st">"plotly"</span>, <span class="st">"randomForestExplainer"</span>,<span class="st">"randomForest"</span>, </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rasterVis"</span>, <span class="st">"raster"</span>, <span class="st">"Rcpp"</span>, <span class="st">"RcppArmadillo"</span>, <span class="st">"RcppCensSpatial"</span>, <span class="st">"rayshader"</span>, <span class="st">"RcppEigen"</span>, <span class="st">"RcppParallel"</span>, </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RColorBrewer"</span>, <span class="st">"reactable"</span>, <span class="st">"rgl"</span>, <span class="st">"rsconnect"</span>,<span class="st">"RStoolbox"</span>, <span class="st">"rts"</span>, <span class="st">"s2"</span>, <span class="st">"sf"</span>, <span class="st">"scales"</span>, <span class="st">"sits"</span>, <span class="st">"sitsdata"</span>,   </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"spdep"</span>, <span class="st">"stars"</span>, <span class="st">"stringr"</span>,<span class="st">"supercells"</span>, <span class="st">"smotefamily"</span>, <span class="st">"terra"</span>, <span class="st">"testthat"</span>, <span class="st">"tidyverse"</span>, <span class="st">"tidyterra"</span>, </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tools"</span>, <span class="st">"torch"</span>, <span class="st">"tmap"</span>, <span class="st">"tmaptools"</span>, <span class="st">"terrainr"</span>, <span class="st">"xgboost"</span>, <span class="st">"webshot"</span>, <span class="st">"webshot2"</span>, <span class="at">prompt =</span> F)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="at">use_s2 =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Assemble Data Cube</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data cube from Microsoft Planetary Computer ARD</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>cube_s2_raw <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube</span>(</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">source            =</span> <span class="st">"MPC"</span>,</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">collection    =</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">tiles             =</span> <span class="st">"20LMR"</span>,</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">bands             =</span> <span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"CLOUD"</span>),</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">start_date    =</span> <span class="st">"2022-01-01"</span>,</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">end_date      =</span> <span class="st">"2022-12-31"</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Check timelines of assembled tiles</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_timeline</span>(cube_s2_raw)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize Data Cube</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy cube to local files</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>cube_s2_local <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube_copy</span>(</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">cube          =</span> cube_s2_raw,</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/raw/"</span>)</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize cube from local files</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_regularize</span>(</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube                =</span> cube_s2_local,</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/reg/"</span>,</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">res         =</span> <span class="dv">40</span>,</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">period      =</span> <span class="st">"P16D"</span>,</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">6</span>)</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute spectral index bands for cube</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">data      =</span> cube_s2_reg,</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">NDVI      =</span> (B08 <span class="sc">-</span> B04)<span class="sc">/</span>(B08 <span class="sc">+</span> B04),</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir=</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">data   =</span> cube_s2_reg,</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">NBR    =</span> (B08 <span class="sc">-</span> B12) <span class="sc">/</span> (B08 <span class="sc">+</span> B12),</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">data                =</span> cube_s2_reg,</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">EVI                 =</span> <span class="fl">2.5</span> <span class="sc">*</span> (B08 <span class="sc">-</span> B04) <span class="sc">/</span> ((B08 <span class="sc">+</span> <span class="fl">6.0</span> <span class="sc">*</span> B04 <span class="sc">-</span> <span class="fl">7.5</span> <span class="sc">*</span> B02) <span class="sc">+</span> <span class="fl">1.0</span>),</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cube structure</span></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(cube_s2_reg)</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot single-date RGB image</span></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_reg, </span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">red =</span> <span class="st">"B11"</span>, </span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">green =</span> <span class="st">"B8A"</span>, </span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">blue =</span> <span class="st">"B02"</span>, </span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="st">"2022-07-16"</span>)</span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> </span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===</span>                                                                   <span class="er">|</span>   <span class="dv">4</span>%</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======</span>                                                                <span class="er">|</span>   <span class="dv">9</span>%</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========</span>                                                             <span class="er">|</span>  <span class="dv">13</span>%</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============</span>                                                          <span class="er">|</span>  <span class="dv">17</span>%</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============</span>                                                       <span class="er">|</span>  <span class="dv">22</span>%</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================</span>                                                    <span class="er">|</span>  <span class="dv">26</span>%</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================</span>                                                 <span class="er">|</span>  <span class="dv">30</span>%</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================</span>                                              <span class="er">|</span>  <span class="dv">35</span>%</span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================</span>                                           <span class="er">|</span>  <span class="dv">39</span>%</span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">43</span>%</span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================</span>                                     <span class="er">|</span>  <span class="dv">48</span>%</span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================</span>                                 <span class="er">|</span>  <span class="dv">52</span>%</span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">57</span>%</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================================</span>                           <span class="er">|</span>  <span class="dv">61</span>%</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================================</span>                        <span class="er">|</span>  <span class="dv">65</span>%</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================================</span>                     <span class="er">|</span>  <span class="dv">70</span>%</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================================================</span>                  <span class="er">|</span>  <span class="dv">74</span>%</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================================================</span>               <span class="er">|</span>  <span class="dv">78</span>%</span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================================</span>            <span class="er">|</span>  <span class="dv">83</span>%</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================================================</span>         <span class="er">|</span>  <span class="dv">87</span>%</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================================</span>      <span class="er">|</span>  <span class="dv">91</span>%</span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================================================</span>   <span class="er">|</span>  <span class="dv">96</span>%</span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> Rows<span class="sc">:</span> <span class="dv">1</span></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> Columns<span class="sc">:</span> <span class="dv">11</span></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> source     <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"MPC"</span></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> collection <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"SENTINEL-2-L2A"</span></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> satellite  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"SENTINEL-2"</span></span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> sensor     <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"MSI"</span></span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> tile       <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"20LMR"</span></span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> xmin       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="dv">399960</span></span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> xmax       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="dv">509760</span></span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> ymin       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="dv">8990200</span></span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> ymax       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="dv">9100000</span></span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> crs        <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"PROJCRS[</span><span class="sc">\"</span><span class="st">WGS 84 / UTM zone 20S</span><span class="sc">\"</span><span class="st">,</span><span class="sc">\n</span><span class="st">    BASEGEOGCRS[</span><span class="sc">\"</span><span class="st">WGS "</span></span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> file_info  <span class="sc">&lt;</span>list<span class="sc">&gt;</span> [<span class="sc">&lt;</span>tbl_df[<span class="dv">299</span> x <span class="dv">13</span>]<span class="sc">&gt;</span>]</span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Training Data </span></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Demo Training Samples</span></span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"samples_deforestation_rondonia"</span>)</span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">summary</span>(samples_deforestation_rondonia)</span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 9 × 3</span></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   label                 count   prop</span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                 <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span> Clear_Cut_Bare_Soil     <span class="dv">944</span> <span class="fl">0.157</span> </span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span> Clear_Cut_Burned_Area   <span class="dv">983</span> <span class="fl">0.164</span> </span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span> Clear_Cut_Vegetation    <span class="dv">603</span> <span class="fl">0.100</span> </span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span> Forest                  <span class="dv">964</span> <span class="fl">0.160</span> </span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span> Mountainside_Forest     <span class="dv">211</span> <span class="fl">0.0351</span></span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span> Riparian_Forest        <span class="dv">1247</span> <span class="fl">0.208</span> </span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">7</span> Seasonally_Flooded      <span class="dv">731</span> <span class="fl">0.122</span> </span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">8</span> Water                   <span class="dv">109</span> <span class="fl">0.0181</span></span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">9</span> Wetland                 <span class="dv">215</span> <span class="fl">0.0358</span></span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">head</span>(samples_deforestation_rondonia)</span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 6 × 7</span></span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   longitude latitude start_date end_date   label               cube  time_series</span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span>     </span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span>     <span class="sc">-</span><span class="fl">66.5</span>    <span class="sc">-</span><span class="fl">9.63</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.70</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.81</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Forest              SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.64</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Vegetati… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Burned_A… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span></span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Demo Training Samples</span></span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"samples_deforestation_rondonia"</span>)</span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">summary</span>(samples_deforestation_rondonia)</span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 9 × 3</span></span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   label                 count   prop</span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                 <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span> Clear_Cut_Bare_Soil     <span class="dv">944</span> <span class="fl">0.157</span> </span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span> Clear_Cut_Burned_Area   <span class="dv">983</span> <span class="fl">0.164</span> </span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span> Clear_Cut_Vegetation    <span class="dv">603</span> <span class="fl">0.100</span> </span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span> Forest                  <span class="dv">964</span> <span class="fl">0.160</span> </span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span> Mountainside_Forest     <span class="dv">211</span> <span class="fl">0.0351</span></span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span> Riparian_Forest        <span class="dv">1247</span> <span class="fl">0.208</span> </span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">7</span> Seasonally_Flooded      <span class="dv">731</span> <span class="fl">0.122</span> </span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">8</span> Water                   <span class="dv">109</span> <span class="fl">0.0181</span></span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">9</span> Wetland                 <span class="dv">215</span> <span class="fl">0.0358</span></span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">head</span>(samples_deforestation_rondonia)</span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 6 × 7</span></span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   longitude latitude start_date end_date   label               cube  time_series</span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span>     </span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span>     <span class="sc">-</span><span class="fl">66.5</span>    <span class="sc">-</span><span class="fl">9.63</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.70</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.81</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Forest              SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.64</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Vegetati… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Burned_A… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span></span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute spectral indexes for training samples</span></span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a>training_samples_with_indices <span class="ot">&lt;-</span> samples_deforestation_rondonia <span class="sc">|&gt;</span> </span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a>    sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">NDVI =</span> (B08 <span class="sc">-</span> B04)<span class="sc">/</span>(B08 <span class="sc">+</span> B04)) <span class="sc">|&gt;</span> </span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">NBR =</span> (B08 <span class="sc">-</span> B12) <span class="sc">/</span> (B08 <span class="sc">+</span> B12)) <span class="sc">|&gt;</span> </span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">EVI =</span> <span class="fl">2.5</span> <span class="sc">*</span> (B08 <span class="sc">-</span> B04) <span class="sc">/</span> ((B08 <span class="sc">+</span> <span class="fl">6.0</span> <span class="sc">*</span> B04 <span class="sc">-</span> <span class="fl">7.5</span> <span class="sc">*</span> B02) <span class="sc">+</span> <span class="fl">1.0</span>)) </span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and plot patterns</span></span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a>training_samples_indices <span class="ot">&lt;-</span> training_samples_with_indices <span class="sc">|&gt;</span> </span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a>    sits<span class="sc">::</span><span class="fu">sits_select</span>(<span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"NDVI"</span>, <span class="st">"EVI"</span>, <span class="st">"NBR"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_patterns</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model using Random Forest algorithm</span></span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a>model_randomForest <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_train</span>(</span>
<span id="cb26-212"><a href="#cb26-212" aria-hidden="true" tabindex="-1"></a>  <span class="at">samples =</span> samples_deforestation_rondonia,</span>
<span id="cb26-213"><a href="#cb26-213" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_method =</span> sits<span class="sc">::</span><span class="fu">sits_rfor</span>(</span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_trees =</span> <span class="dv">120</span>,</span>
<span id="cb26-215"><a href="#cb26-215" aria-hidden="true" tabindex="-1"></a>    <span class="at">mtry =</span> <span class="dv">10</span>))</span>
<span id="cb26-216"><a href="#cb26-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the model results</span></span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_randomForest)</span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability Data Cube</span></span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability data cube</span></span>
<span id="cb26-227"><a href="#cb26-227" aria-hidden="true" tabindex="-1"></a>cube_s2_probs <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_classify</span>(</span>
<span id="cb26-228"><a href="#cb26-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">data       =</span> cube_s2_reg,</span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_model   =</span> model_randomForest,</span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a>    <span class="at">version    =</span> <span class="st">"rf-1228"</span>, <span class="co"># adds suffix to output filename</span></span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize    =</span> <span class="dv">16</span>)</span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-235"><a href="#cb26-235" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_probs, <span class="at">labels =</span> <span class="st">"Forest"</span>, <span class="at">palette =</span> <span class="st">"YlGn"</span>)</span>
<span id="cb26-236"><a href="#cb26-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate uncertainty cube and sample high-uncertainty pixels</span></span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a>cube_s2_uncertainty <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty</span>(</span>
<span id="cb26-240"><a href="#cb26-240" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube =</span> cube_s2_probs,</span>
<span id="cb26-241"><a href="#cb26-241" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"margin"</span>, </span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">"./assets/images/uncertainty/"</span>,</span>
<span id="cb26-243"><a href="#cb26-243" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb26-244"><a href="#cb26-244" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize =</span> <span class="dv">16</span>)</span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize high-uncertainty areas</span></span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty, <span class="at">palette =</span> <span class="st">"Oranges"</span>)</span>
<span id="cb26-248"><a href="#cb26-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-249"><a href="#cb26-249" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract new spectral signatures</span></span>
<span id="cb26-250"><a href="#cb26-250" aria-hidden="true" tabindex="-1"></a>new_samples <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_get_data</span>(</span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube =</span> cube_s2_reg,</span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> new_samples_locations)</span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a><span class="co">#new_samples$label &lt;- "Wetland"</span></span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a>new_samples_aligned <span class="ot">&lt;-</span> <span class="fu">sits_select</span>(<span class="at">data =</span> new_samples,</span>
<span id="cb26-256"><a href="#cb26-256" aria-hidden="true" tabindex="-1"></a>  <span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, </span>
<span id="cb26-257"><a href="#cb26-257" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"B8A"</span>))</span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with original samples</span></span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a>new_samples_merge <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb26-261"><a href="#cb26-261" aria-hidden="true" tabindex="-1"></a>    samples_deforestation_rondonia,</span>
<span id="cb26-262"><a href="#cb26-262" aria-hidden="true" tabindex="-1"></a>  new_samples_aligned)</span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a><span class="co"># Train new model &amp; evaluate</span></span>
<span id="cb26-265"><a href="#cb26-265" aria-hidden="true" tabindex="-1"></a>model_randomForest_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_train</span>(</span>
<span id="cb26-266"><a href="#cb26-266" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> new_samples_merge, </span>
<span id="cb26-267"><a href="#cb26-267" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_method =</span> sits<span class="sc">::</span><span class="fu">sits_rfor</span>(<span class="at">num_trees =</span> <span class="dv">120</span>,<span class="at">mtry =</span> <span class="dv">10</span>))</span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a>cube_s2_probs_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_classify</span>(</span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">data            =</span> cube_s2_reg,</span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_model        =</span> model_randomForest_v2,</span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-1228-v2"</span>, <span class="co"># adds suffix to output filename</span></span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb26-275"><a href="#cb26-275" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span></span>
<span id="cb26-276"><a href="#cb26-276" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-277"><a href="#cb26-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-278"><a href="#cb26-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive new uncertainty cube and compare</span></span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a>cube_s2_uncertainty_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty</span>(</span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a>    cube_s2_probs_v2, </span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"margin"</span>, </span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">"./assets/images/uncertainty_v2/"</span>,</span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a>  <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a>  <span class="at">memsize =</span> <span class="dv">16</span>)</span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize side-by-side</span></span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty, <span class="at">palette =</span> <span class="st">"Reds"</span>)</span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty_v2, <span class="at">palette =</span> <span class="st">"Oranges"</span>)</span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-291"><a href="#cb26-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for convergence (extract filepath first)</span></span>
<span id="cb26-292"><a href="#cb26-292" aria-hidden="true" tabindex="-1"></a>get_uncert_values <span class="ot">&lt;-</span> <span class="cf">function</span>(uncert_cube) {</span>
<span id="cb26-293"><a href="#cb26-293" aria-hidden="true" tabindex="-1"></a>  files <span class="ot">&lt;-</span> uncert_cube<span class="sc">$</span>file_info[[<span class="dv">1</span>]]<span class="sc">$</span>path</span>
<span id="cb26-294"><a href="#cb26-294" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(files)</span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">values</span>(r)</span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate statistics</span></span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a>uncert_v1_vals <span class="ot">&lt;-</span> <span class="fu">get_uncert_values</span>(cube_s2_uncertainty)</span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a>uncert_v2_vals <span class="ot">&lt;-</span> <span class="fu">get_uncert_values</span>(cube_s2_uncertainty_v2)</span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-302"><a href="#cb26-302" aria-hidden="true" tabindex="-1"></a>uncertainty_check <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb26-303"><a href="#cb26-303" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration =</span> <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>),</span>
<span id="cb26-304"><a href="#cb26-304" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb26-305"><a href="#cb26-305" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(uncert_v1_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-306"><a href="#cb26-306" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(uncert_v2_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-307"><a href="#cb26-307" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb26-308"><a href="#cb26-308" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb26-309"><a href="#cb26-309" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(uncert_v1_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-310"><a href="#cb26-310" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(uncert_v2_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-311"><a href="#cb26-311" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb26-312"><a href="#cb26-312" aria-hidden="true" tabindex="-1"></a>  <span class="at">pct_high_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb26-313"><a href="#cb26-313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(uncert_v1_vals <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(uncert_v1_vals)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb26-314"><a href="#cb26-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(uncert_v2_vals <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(uncert_v2_vals)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb26-315"><a href="#cb26-315" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-316"><a href="#cb26-316" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-317"><a href="#cb26-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-318"><a href="#cb26-318" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(uncertainty_check, <span class="st">"./assets/samples/uncertainty_check.csv"</span>)</span>
<span id="cb26-319"><a href="#cb26-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-320"><a href="#cb26-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-321"><a href="#cb26-321" aria-hidden="true" tabindex="-1"></a><span class="co"># Training Data Enhancements</span></span>
<span id="cb26-322"><a href="#cb26-322" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb26-323"><a href="#cb26-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-324"><a href="#cb26-324" aria-hidden="true" tabindex="-1"></a>Cluster samples using DTW distance and Ward linkage</span>
<span id="cb26-325"><a href="#cb26-325" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cluster_dendro</span>(</span>
<span id="cb26-326"><a href="#cb26-326" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> training_samples_with_indices, </span>
<span id="cb26-327"><a href="#cb26-327" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"NDVI"</span>, <span class="st">"EVI"</span>),</span>
<span id="cb26-328"><a href="#cb26-328" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_method =</span> <span class="st">"dtw_basic"</span>,</span>
<span id="cb26-329"><a href="#cb26-329" aria-hidden="true" tabindex="-1"></a>    <span class="at">linkage =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb26-330"><a href="#cb26-330" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-331"><a href="#cb26-331" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine cluster composition</span></span>
<span id="cb26-332"><a href="#cb26-332" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_cluster_frequency</span>(clusters)</span>
<span id="cb26-333"><a href="#cb26-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-334"><a href="#cb26-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove cluster#5 from the samples</span></span>
<span id="cb26-335"><a href="#cb26-335" aria-hidden="true" tabindex="-1"></a>clusters_new <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(clusters, cluster <span class="sc">!=</span> <span class="dv">5</span>)</span>
<span id="cb26-336"><a href="#cb26-336" aria-hidden="true" tabindex="-1"></a>clusters_clean <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cluster_clean</span>(clusters_new)</span>
<span id="cb26-337"><a href="#cb26-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-338"><a href="#cb26-338" aria-hidden="true" tabindex="-1"></a><span class="co"># Check clusters samples frequency</span></span>
<span id="cb26-339"><a href="#cb26-339" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_cluster_frequency</span>(clusters_clean)</span>
<span id="cb26-340"><a href="#cb26-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-341"><a href="#cb26-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate SOM with optimal grid dimensions</span></span>
<span id="cb26-342"><a href="#cb26-342" aria-hidden="true" tabindex="-1"></a>som_map <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_map</span>(</span>
<span id="cb26-343"><a href="#cb26-343" aria-hidden="true" tabindex="-1"></a>    training_samples_with_indices, </span>
<span id="cb26-344"><a href="#cb26-344" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid_xdim =</span> <span class="dv">10</span>, </span>
<span id="cb26-345"><a href="#cb26-345" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid_ydim =</span> <span class="dv">10</span>)</span>
<span id="cb26-346"><a href="#cb26-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-347"><a href="#cb26-347" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean samples by removing mixed neurons</span></span>
<span id="cb26-348"><a href="#cb26-348" aria-hidden="true" tabindex="-1"></a>samples_clean <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_clean_samples</span>(som_map)</span>
<span id="cb26-349"><a href="#cb26-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-350"><a href="#cb26-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize sample clustering &amp; class confusions</span></span>
<span id="cb26-351"><a href="#cb26-351" aria-hidden="true" tabindex="-1"></a>som_eval <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_evaluate_cluster</span>(som_map)</span>
<span id="cb26-352"><a href="#cb26-352" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval)</span>
<span id="cb26-353"><a href="#cb26-353" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_map)</span>
<span id="cb26-354"><a href="#cb26-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-355"><a href="#cb26-355" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive jurisdiction boundary</span></span>
<span id="cb26-356"><a href="#cb26-356" aria-hidden="true" tabindex="-1"></a>bbox_cube <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_bbox</span>(cube_s2_reg) </span>
<span id="cb26-357"><a href="#cb26-357" aria-hidden="true" tabindex="-1"></a>bbox_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(</span>
<span id="cb26-358"><a href="#cb26-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">xmin =</span> aoi<span class="sc">$</span>xmin, </span>
<span id="cb26-359"><a href="#cb26-359" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> aoi<span class="sc">$</span>ymin, </span>
<span id="cb26-360"><a href="#cb26-360" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> aoi<span class="sc">$</span>xmax, </span>
<span id="cb26-361"><a href="#cb26-361" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> aoi<span class="sc">$</span>ymax),</span>
<span id="cb26-362"><a href="#cb26-362" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(aoi<span class="sc">$</span>crs))</span>
<span id="cb26-363"><a href="#cb26-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-364"><a href="#cb26-364" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sf </span></span>
<span id="cb26-365"><a href="#cb26-365" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(sf<span class="sc">::</span><span class="fu">st_as_sfc</span>(bbox_sf))</span>
<span id="cb26-366"><a href="#cb26-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-367"><a href="#cb26-367" aria-hidden="true" tabindex="-1"></a><span class="co"># Assess geographic coverage</span></span>
<span id="cb26-368"><a href="#cb26-368" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_geo_dist</span>(</span>
<span id="cb26-369"><a href="#cb26-369" aria-hidden="true" tabindex="-1"></a>    training_samples_with_indices, <span class="at">roi =</span> aoi)</span>
<span id="cb26-370"><a href="#cb26-370" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(distances)</span>
<span id="cb26-371"><a href="#cb26-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-372"><a href="#cb26-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-373"><a href="#cb26-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-374"><a href="#cb26-374" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance samples across classes</span></span>
<span id="cb26-375"><a href="#cb26-375" aria-hidden="true" tabindex="-1"></a>samples_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_reduce_imbalance</span>(</span>
<span id="cb26-376"><a href="#cb26-376" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> training_samples_with_indices,</span>
<span id="cb26-377"><a href="#cb26-377" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_samples_over =</span> <span class="dv">200</span>,   <span class="co"># Oversample rare classes</span></span>
<span id="cb26-378"><a href="#cb26-378" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_samples_under =</span> <span class="dv">400</span>,  <span class="co"># Undersample common classes</span></span>
<span id="cb26-379"><a href="#cb26-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>)</span>
<span id="cb26-380"><a href="#cb26-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-381"><a href="#cb26-381" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-evaluate using SOM clustering</span></span>
<span id="cb26-382"><a href="#cb26-382" aria-hidden="true" tabindex="-1"></a>som_map_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_map</span>(</span>
<span id="cb26-383"><a href="#cb26-383" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> samples_balanced,</span>
<span id="cb26-384"><a href="#cb26-384" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid_xdim =</span> <span class="dv">10</span>,</span>
<span id="cb26-385"><a href="#cb26-385" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid_ydim =</span> <span class="dv">10</span>,</span>
<span id="cb26-386"><a href="#cb26-386" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">1.0</span>,</span>
<span id="cb26-387"><a href="#cb26-387" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance =</span> <span class="st">"dtw"</span>,</span>
<span id="cb26-388"><a href="#cb26-388" aria-hidden="true" tabindex="-1"></a>    <span class="at">rlen =</span> <span class="dv">20</span>)</span>
<span id="cb26-389"><a href="#cb26-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-390"><a href="#cb26-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Store estimates in tibble</span></span>
<span id="cb26-391"><a href="#cb26-391" aria-hidden="true" tabindex="-1"></a>som_eval_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_evaluate_cluster</span>(</span>
<span id="cb26-392"><a href="#cb26-392" aria-hidden="true" tabindex="-1"></a>    som_map_balanced)</span>
<span id="cb26-393"><a href="#cb26-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-394"><a href="#cb26-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize results</span></span>
<span id="cb26-395"><a href="#cb26-395" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval) </span>
<span id="cb26-396"><a href="#cb26-396" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval_balanced) </span>
<span id="cb26-397"><a href="#cb26-397" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(samples_balanced)</span>
<span id="cb26-398"><a href="#cb26-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-399"><a href="#cb26-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-400"><a href="#cb26-400" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Whittaker filter with conservative smoothing</span></span>
<span id="cb26-401"><a href="#cb26-401" aria-hidden="true" tabindex="-1"></a>samples_balanced_ndvi <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_select</span>(</span>
<span id="cb26-402"><a href="#cb26-402" aria-hidden="true" tabindex="-1"></a>    samples_balanced, <span class="at">bands =</span> <span class="st">"NDVI"</span>)</span>
<span id="cb26-403"><a href="#cb26-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-404"><a href="#cb26-404" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Whitakker filter</span></span>
<span id="cb26-405"><a href="#cb26-405" aria-hidden="true" tabindex="-1"></a>samples_balanced_whit <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_whittaker</span>(</span>
<span id="cb26-406"><a href="#cb26-406" aria-hidden="true" tabindex="-1"></a>    samples_balanced_ndvi, <span class="at">lambda =</span> <span class="fl">0.5</span>)</span>
<span id="cb26-407"><a href="#cb26-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-408"><a href="#cb26-408" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge to visualize</span></span>
<span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_merge</span>(</span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a>    samples_balanced_ndvi, </span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a>    samples_balanced_whit,</span>
<span id="cb26-412"><a href="#cb26-412" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">".WHIT"</span>)) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb26-413"><a href="#cb26-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure consistent factor levels</span></span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a>all_classes <span class="ot">&lt;-</span> <span class="fu">unique</span>(train_features<span class="sc">$</span>label)</span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a><span class="co"># Criss Validation</span></span>
<span id="cb26-420"><a href="#cb26-420" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb26-421"><a href="#cb26-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-422"><a href="#cb26-422" aria-hidden="true" tabindex="-1"></a><span class="co"># Stratified partition</span></span>
<span id="cb26-423"><a href="#cb26-423" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb26-424"><a href="#cb26-424" aria-hidden="true" tabindex="-1"></a>train_idx <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(</span>
<span id="cb26-425"><a href="#cb26-425" aria-hidden="true" tabindex="-1"></a>  train_features<span class="sc">$</span>label,</span>
<span id="cb26-426"><a href="#cb26-426" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.8</span>,</span>
<span id="cb26-427"><a href="#cb26-427" aria-hidden="true" tabindex="-1"></a>  <span class="at">list =</span> <span class="cn">FALSE</span></span>
<span id="cb26-428"><a href="#cb26-428" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-429"><a href="#cb26-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-430"><a href="#cb26-430" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_features[train_idx, ]</span>
<span id="cb26-431"><a href="#cb26-431" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> train_features[<span class="sc">-</span>train_idx, ]</span>
<span id="cb26-432"><a href="#cb26-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-433"><a href="#cb26-433" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure labels are factors with same levels</span></span>
<span id="cb26-434"><a href="#cb26-434" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data<span class="sc">$</span>label, <span class="at">levels =</span> all_classes)</span>
<span id="cb26-435"><a href="#cb26-435" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data<span class="sc">$</span>label, <span class="at">levels =</span> all_classes)</span>
<span id="cb26-436"><a href="#cb26-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-437"><a href="#cb26-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model</span></span>
<span id="cb26-438"><a href="#cb26-438" aria-hidden="true" tabindex="-1"></a>accuracy_model <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb26-439"><a href="#cb26-439" aria-hidden="true" tabindex="-1"></a>  label <span class="sc">~</span> .,</span>
<span id="cb26-440"><a href="#cb26-440" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb26-441"><a href="#cb26-441" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb26-442"><a href="#cb26-442" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">120</span>,</span>
<span id="cb26-443"><a href="#cb26-443" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-444"><a href="#cb26-444" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"none"</span>)</span>
<span id="cb26-445"><a href="#cb26-445" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-446"><a href="#cb26-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-447"><a href="#cb26-447" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb26-448"><a href="#cb26-448" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(accuracy_model, test_data)</span>
<span id="cb26-449"><a href="#cb26-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-450"><a href="#cb26-450" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure predictions have same levels</span></span>
<span id="cb26-451"><a href="#cb26-451" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">factor</span>(predictions, <span class="at">levels =</span> all_classes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="sec-summary" class="level2"><h2 class="anchored" data-anchor-id="sec-summary">3.11 Chapter Summary</h2>
<p>This chapter established a comprehensive framework for activity data uncertainty quantification in REDD+ monitoring systems. Key contributions include:</p>
<ol type="1">
<li>Data cube architecture: Structured approach to spatiotemporal land cover analysis</li>
<li>IPCC methodology alignment: Clear guidance on Approach 3 requirements</li>
<li>Pixel-level uncertainty tracking: Model residuals for adaptive sampling</li>
<li>Random Forest optimization: Monte Carlo calibration workflows</li>
<li>Rigorous accuracy assessment: Confusion matrices with area adjustment</li>
</ol>
<p>Activity data provides spatial extent; allometry converts extent to biomass. Combined uncertainty requires:</p>
<p><span class="math display">\[
U_{total}^2 = U_{activity}^2 + U_{allometry}^2 + 2 \times \text{Cov}(A, B)
\]</span></p>
<p>Where covariance term captures spatial correlation between classification errors and biomass estimation errors.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-ballantyne2015audit" class="csl-entry" role="listitem">
Ballantyne, A., Andres, R., Houghton, R., Stocker, B., Wanninkhof, R., Anderegg, W., Cooper, L., DeGrandpre, M., Tans, P., Miller, J., &amp; al., et. (2015). Audit of the global carbon budget: Estimate errors and their impact on uptake uncertainty. <em>Biogeosciences (Online)</em>, <em>12</em>(8), 2565–2584.
</div>
<div id="ref-cao2012automatic" class="csl-entry" role="listitem">
Cao, S., Yu, Q., &amp; Zhang, J. (2012). Automatic division for pure/mixed pixels based on probabilities entropy and spatial heterogeneity. <em>2012 First International Conference on Agro-Geoinformatics (Agro-Geoinformatics)</em>, 1–4.
</div>
<div id="ref-crawford2013active" class="csl-entry" role="listitem">
Crawford, M. M., Tuia, D., &amp; Yang, H. L. (2013). Active learning: Any value for classification of remotely sensed data? <em>Proceedings of the IEEE</em>, <em>101</em>(3), 593–608.
</div>
<div id="ref-frenay2013classification" class="csl-entry" role="listitem">
Frénay, B., &amp; Verleysen, M. (2013). Classification in the presence of label noise: A survey. <em>IEEE Transactions on Neural Networks and Learning Systems</em>, <em>25</em>(5), 845–869.
</div>
<div id="ref-terra-2" class="csl-entry" role="listitem">
Hijmans, R. J. (2025). <em>Terra: Spatial data analysis</em>. <a href="https://CRAN.R-project.org/package=terra">https://CRAN.R-project.org/package=terra</a>
</div>
<div id="ref-ipcc2013RevisedSupplementary2014" class="csl-entry" role="listitem">
IPCC. (n.d.). <em>2013 revised supplementary methods and good practice guidance arising from the kyoto protocol</em>.
</div>
<div id="ref-ipccReportConferenceParties2012" class="csl-entry" role="listitem">
IPCC. (2012). <em>Report of the conference of the parties serving as the meeting of the parties to the kyoto protocol on its seventh session,</em>. <em>FCCC/KP/CMP/2011/10</em>(Durban Meeting November 28th to December 11th, 2011), 824.
</div>
<div id="ref-ipccChapter2Generic2019" class="csl-entry" role="listitem">
IPCC. (2019). Chapter 2: Generic methodologies applicable to multiple land-use categories. In <em>2019 refinement to the 2006 IPCC guidelines for national greenhouse gas inventories</em> (Agriculture, Forestry and Other Land Use, Vol. 4). Intergovernmental Panel on Climate Change. <a href="https://www.ipcc-nggip.iges.or.jp/public/2019rf/pdf/4_Volume4/19R_V4_Ch02_Generic%20Methods.pdf">https://www.ipcc-nggip.iges.or.jp/public/2019rf/pdf/4_Volume4/19R_V4_Ch02_Generic%20Methods.pdf</a>
</div>
<div id="ref-kuhn2011caret" class="csl-entry" role="listitem">
Kuhn, M. (2011). <em>The caret package</em>.
</div>
<div id="ref-maxwell2018implementation" class="csl-entry" role="listitem">
Maxwell, A. E., Warner, T. A., &amp; Fang, F. (2018). Implementation of machine-learning classification in remote sensing: An applied review. <em>International Journal of Remote Sensing</em>, <em>39</em>(9), 2784–2817.
</div>
<div id="ref-shannonMathematicalTheoryCommunication1948" class="csl-entry" role="listitem">
Shannon, C. E. (1948). A mathematical theory of communication. <em>Bell System Technical Journal</em>, <em>27</em>(3), 379–423. <a href="https://doi.org/10.1002/j.1538-7305.1948.tb01338.x">https://doi.org/10.1002/j.1538-7305.1948.tb01338.x</a>
</div>
<div id="ref-simoes2021satellite" class="csl-entry" role="listitem">
Simoes, R., Camara, G., Queiroz, G., Souza, F., Andrade, P. R., Santos, L., Carvalho, A., &amp; Ferreira, K. (2021). Satellite image time series analysis for big earth observation data. <em>Remote Sensing</em>, <em>13</em>(13), 2428.
</div>
<div id="ref-ForesToolboxRS" class="csl-entry" role="listitem">
Tarazona Coronel, Y., Zabala, A., Pons, X., Broquetas, A., Nowosad, J., &amp; A. Zurqani, H. (2021). <em>Fusing landsat and <span></span>SAR<span></span> data for mapping tropical deforestation through machine learning classification and the <span></span>PVts<span></span>-β non-seasonal detection approach</em>. <a href="https://doi.org/10.1080/07038992.2021.1941823">https://doi.org/10.1080/07038992.2021.1941823</a>
</div>
<div id="ref-unfccc2010report" class="csl-entry" role="listitem">
UNFCCC, C. (2010). Report of the conference of the parties on its fifteenth session, held in copenhagen from 7 to 19 december 2009. <em>FCCC/CP/2009/11/Add. 1</em>.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1">
<p>In version 1.5.3,<code>sits</code> supports access to the following ARD image cloud providers:</p>
<ul>
<li>Amazon Web Services (AWS): Open data Sentinel-2/2A Level-2A collections for the Earth’s land surface.</li>
<li>Brazil Data Cube (BDC): Open data collections of Sentinel-2/2A, Landsat-8, CBERS-4/4A, and MOD13Q1 products for Brazil. These collections are organized as regular data cubes.</li>
<li>Copernicus Data Space Ecosystem (CDSE): Open data collections of Sentinel-1 RTC and Sentinel-2/2A images.</li>
<li>Digital Earth Africa (DEAFRICA): Open data collections of Sentinel-1 RTC, Sentinel-2/2A, Landsat-5/7/8/9 for Africa. Additional products include ALOS_PALSAR mosaics, DEM_COP_30, NDVI_ANOMALY based on Landsat data, and monthly and daily rainfall data from CHIRPS.</li>
<li>Digital Earth Australia (DEAUSTRALIA): Open data ARD collections of Sentinel-2A/2B and Landsat-5/7/8/9 images, yearly geomedians of Landsat 5/7/8 images; yearly fractional land cover from 1986 to 2024.</li>
<li>Harmonized Landsat-Sentinel (HLS): HLS, provided by NASA, is an open data collection that processes Landsat 8 and Sentinel-2 imagery to a common standard.</li>
<li>Microsoft Planetary Computer (MPC): Open data collections of Sentinel-1 GRD, Sentinel-1 RTC, Sentinel-2/2A, Landsat-4/5/7/8/9 images for the Earth’s land areas. Also supported are the Copernicus DEM-30 and MOD13Q1, MOD10A1, MOD09A1 products, and the Harmonized Landsat-Sentinel collections (HLSL30 and HLSS30).</li>
<li>Swiss Data Cube (SDC): Collection of Sentinel-2/2A and Landsat-8 images for Switzerland.</li>
<li>Terrascope: Cloud service with EO products, which includes the ESA World Cover map.</li>
<li>USGS: Landsat-4/5/7/8/9 collections available in AWS, which require access payment.</li>
</ul>
<p>In addition, <code>sits</code> supports the use of Planet monthly mosaics stored as local files. For a detailed description of the providers and collections supported by <code>sits</code>, please run <code>sits_list_collections()</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn2"><p>For addressing the most problematic uncertainty tasks needing longitudinal analyses of extended timelines (1984-2024), such as disaggregation of wildfire uncertainty and the inter-annual variability of natural disturbances, we recommend practicing data cube operations with Landsat imagery <span class="citation" data-cites="ipccReportConferenceParties2012 ipccChapter2Generic2019 ipcc2013RevisedSupplementary2014 unfccc2010report">(<a href="../references/index.html#ref-ipcc2013RevisedSupplementary2014" role="doc-biblioref">IPCC, n.d., p. O.9</a>; <a href="../references/index.html#ref-ipccReportConferenceParties2012" role="doc-biblioref">2012, p. 847</a>; <a href="../references/index.html#ref-ipccChapter2Generic2019" role="doc-biblioref">2019, p. 2.67</a>; <a href="../references/index.html#ref-unfccc2010report" role="doc-biblioref">UNFCCC, 2010, pp. 17–18</a>)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../02-emission-factors/index.html" class="pagination-link" aria-label="2. Emission Factors">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">2. Emission Factors</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../04-monte-carlo/index.html" class="pagination-link" aria-label="4. Monte Carlo">
        <span class="nav-page-text"><span class="chapter-title">4. Monte Carlo</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb27" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "3. Activity Data"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">  docx:</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">    reference-doc: ../references/style.docx</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: github</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk:</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">    prefer-html: true</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "png"</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">    dpi: 300</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../references/references.bib</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> ../references/apa.csl</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview {.unnumbered}</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>Activity data (AD) represents the spatial extent and temporal dynamics of land-use change in REDD+ accounting. This chapter addresses uncertainty quantification in land cover classification, change detection, and spatial aggregation. These components typically constitute the greatest contribution to total REDD+ uncertainty <span class="co">[</span><span class="ot">@ballantyne2015audit</span><span class="co">]</span>.</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="fu">### A Data Cube Framework for Uncertainty Reduction</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>Satellite-based activity data classification faces three fundamental sources of uncertainty: spatial misalignment between sensor bands, temporal gaps from cloud contamination, and spectral inconsistency from varying atmospheric conditions. Traditional scene-based processing handles individual images independently and fails to address these uncertainties systematically. This introduces geometric discontinuities at tile boundaries and creates systematic bias when deforestation occurs during cloudy periods, propagating uncorrected atmospheric effects into phenological signatures.</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time Series Diminesions</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>Data cubes provide a structured solution by organizing satellite imagery into multidimensional arrays with consistent spatial, temporal, and spectral dimensions. This architecture enables analysis-ready workflows that normalize heterogeneous acquisitions into regular spatiotemporal grids through three coupled preprocessing operations:</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial Normalization: Reprojecting all inputs to common coordinate systems with uniform pixel spacing reduces geometric uncertainty. This typically addresses the 5-10% classification error found at forest boundaries where precise delineation determines area estimates.</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal Normalization: Compositing algorithms rank scenes by atmospheric quality to fill cloud gaps and interpolate missing observations. This prevents the 15-25% systematic underestimation of forest loss documented when clearing events coincide with persistent cloud cover (Hansen et al., 2014).</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spectral Normalization: Consistent atmospheric corrections and sensor calibrations across the time series ensure temporal patterns reflect genuine phenological dynamics. This prevents data processing artifacts from inflating classification variance by 10-20%.</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="al">![Geometric representation of a multidimensional time-series dataset of land use change analysis. The diagram illustrates the intersection of spatial (x,y,z) and temporal planes (t) using dimensional logic to highlight the signficance of data alignment and temporal sampling to preprocessing treatments and uncertainty reductions (Author’s illustration, 2026/01).](assets/images/png/datacube_static_clean.png)</span>{fig-align="center"}</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>For REDD+ monitoring under IPCC Approach 3 requirements, data cube architecture provides the foundation for pixel-level uncertainty tracking essential for defensible carbon accounting. By organizing probability estimates and model residuals as additional cube attributes, analysts can map spatial patterns of uncertainty and implement adaptive validation strategies targeting high-uncertainty regions.</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>This spatially explicit quantification directly supports ART-TREES Section 8 compliance by providing the pixel-level confidence estimates required for Monte Carlo emission simulations. This allows uncertainty deductions to be calculated from empirical probability distributions rather than conservative default assumptions. Empirical studies demonstrate that proper data cube preprocessing reduces total classification uncertainty by 40-60% compared to scene-based approaches. For a 1 million $tCO_2e$ REDD+ project, this represents \$200,000–\$300,000 in protected revenue at a \$5/tonne carbon price.</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="fu">### IPCC Approaches</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>The IPCC defines three hierarchical approaches for activity data collection that differ in spatial explicitness and uncertainty characteristics <span class="co">[</span><span class="ot">@ipccChapter2Generic2019</span><span class="co">]</span>:</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach   <span class="pp">|</span> Data Type             <span class="pp">|</span> Spatial Resolution  <span class="pp">|</span> Uncertainty <span class="pp">|</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------|-----------------------|---------------------|-------------|</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach 1 <span class="pp">|</span> Area statistics       <span class="pp">|</span> Aggregated totals   <span class="pp">|</span> Highest     <span class="pp">|</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach 2 <span class="pp">|</span> Sample-based matrices <span class="pp">|</span> Point/grid sampling <span class="pp">|</span> Moderate    <span class="pp">|</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach 3 <span class="pp">|</span> Wall-to-wall maps     <span class="pp">|</span> Spatially explicit  <span class="pp">|</span> Lowest      <span class="pp">|</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>This chapter implements Approach 3 methods using satellite time series classification within data cube frameworks, which ART-TREES programs predominantly adopt due to requirements for spatially explicit monitoring, pixel-level change detection, and integration with emission factor stratification. The data cube architecture and machine learning workflows demonstrated in Sections 3.2-3.9 operationalize Approach 3 while providing the uncertainty quantification infrastructure required under ART-TREES Section 8. Data cubes enable Approach 3's lower uncertainty bounds by ensuring consistent spatial alignment for wall-to-wall mapping, maintaining temporal continuity for change detection, and preserving spectral fidelity for accurate classification—benefits unattainable through aggregated statistics (Approach 1) or sample-based approaches (Approach 2) that inherently discard spatial context.</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>The chapter is structured around the data cube framework for organizing and analyzing spatiotemporal land cover data, followed by uncertainty estimation techniques aligned with IPCC methodologies. We organize the technical content into the following components:</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Data Cube Architecture (Sections 3.1-3.3): Spatiotemporal array structures for satellite time series, demonstrating how proper cube construction reduces baseline uncertainty through spatial harmonization, temporal gap-filling, and spectral normalization before classification begins.</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Training Data Enhancement (Sections 3.4-3.7): Sample quality assessment and optimization through active learning, hierarchical clustering, class balancing, and geographic coverage analysis—addressing the 20-40% classification uncertainty stemming from inadequate or biased training data.</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Classification and Smoothing (Section 3.8): Probability cube generation and Bayesian spatial smoothing that reduces salt-and-pepper noise while preserving legitimate landscape heterogeneity, typically improving validation agreement by 10-15% compared to discrete pixel-based classifications.</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Uncertainty Quantification (Sections 3.9-3.10): Monte Carlo cross-validation and stratified accuracy assessment providing robust out-of-sample performance estimates required for ART-TREES deduction calculations, with emphasis on class-specific error patterns and spatial uncertainty distributions.</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Reproducible Workflow (Section 3.11): Complete implementation code for all preprocessing, classification, and validation procedures, enabling transparent methodology documentation required for third-party verification under REDD+ standards.</span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>The subsequent sections demonstrate how systematic application of data cube principles reduces activity data uncertainty from typical scene-based levels of 35-45% to optimized values of 15-25%, directly protecting carbon credit revenues through lower ART-TREES uncertainty deductions while maintaining scientific rigor required for MRV compliance.</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Environment Setup</span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------</span></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>easypackages<span class="sc">::</span><span class="fu">packages</span>(</span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bslib"</span>, <span class="st">"caret"</span>, <span class="st">"cols4all"</span>, <span class="st">"covr"</span>, <span class="st">"cowplot"</span>, <span class="st">"dendextend"</span>, <span class="st">"digest"</span>,<span class="st">"DiagrammeR"</span>, </span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dtwclust"</span>, <span class="st">"downlit"</span>, <span class="st">"devtools"</span>, <span class="st">"e1071"</span>, <span class="st">"exactextractr"</span>,<span class="st">"elevatr"</span>, <span class="st">"FNN"</span>, </span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>  <span class="st">"future"</span>, <span class="st">"forestdata"</span>,<span class="st">"gdalcubes"</span>, <span class="st">"gdalUtilities"</span>, <span class="st">"geojsonsf"</span>, <span class="st">"geos"</span>, </span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ggplot2"</span>, <span class="st">"ggstats"</span>, <span class="st">"ggspatial"</span>, <span class="st">"ggmap"</span>, <span class="st">"ggplotify"</span>, <span class="st">"ggpubr"</span>, <span class="st">"ggrepel"</span>, </span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>  <span class="st">"giscoR"</span>, <span class="st">"hdf5r"</span>, <span class="st">"httr"</span>, <span class="st">"httr2"</span>, <span class="st">"htmltools"</span>, <span class="st">"jsonlite"</span>, <span class="st">"kohonen"</span>, <span class="st">"leafem"</span>, </span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>  <span class="st">"leaflet.providers"</span>, <span class="st">"libgeos"</span>,<span class="st">"luz"</span>,<span class="st">"lwgeom"</span>, <span class="st">"leaflet"</span>, <span class="st">"leafgl"</span>, <span class="st">"MLmetrics"</span>,</span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mapedit"</span>, <span class="st">"mapview"</span>, <span class="st">"maptiles"</span>, <span class="st">"methods"</span>, <span class="st">"mgcv"</span>, <span class="st">"ncdf4"</span>, <span class="st">"nnet"</span>, <span class="st">"openxlsx"</span>, </span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a>  <span class="st">"parallel"</span>, <span class="st">"plotly"</span>, <span class="st">"randomForestExplainer"</span>,<span class="st">"randomForest"</span>, <span class="st">"rasterVis"</span>, <span class="st">"raster"</span>, </span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Rcpp"</span>, <span class="st">"RcppArmadillo"</span>, <span class="st">"RcppCensSpatial"</span>, <span class="st">"rayshader"</span>, <span class="st">"RcppEigen"</span>, <span class="st">"RcppParallel"</span>, </span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RColorBrewer"</span>, <span class="st">"reactable"</span>, <span class="st">"rgl"</span>, <span class="st">"rsconnect"</span>,<span class="st">"RStoolbox"</span>, <span class="st">"rts"</span>, <span class="st">"s2"</span>, <span class="st">"sf"</span>, </span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>  <span class="st">"scales"</span>, <span class="st">"sits"</span>, <span class="st">"sitsdata"</span>, <span class="st">"spdep"</span>, <span class="st">"stars"</span>, <span class="st">"stringr"</span>,<span class="st">"supercells"</span>, <span class="st">"smotefamily"</span>, </span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"terra"</span>, <span class="st">"testthat"</span>, <span class="st">"tidyverse"</span>, <span class="st">"tidyterra"</span>, <span class="st">"tools"</span>, <span class="st">"torch"</span>, <span class="st">"tmap"</span>, <span class="st">"tmaptools"</span>, </span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"terrainr"</span>, <span class="st">"xgboost"</span>, <span class="st">"webshot"</span>, <span class="st">"webshot2"</span>,</span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">prompt =</span> F)</span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="at">use_s2 =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>),</span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a>        <span class="at">htmltools.dir.version =</span> <span class="cn">FALSE</span>, </span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">htmltools.preserve.raw =</span> <span class="cn">FALSE</span></span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("ytarazona/ForesToolboxRS")</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(ForesToolboxRS))</span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>, </span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>, </span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">error =</span> <span class="cn">FALSE</span>, </span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="cn">NA</span>, </span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">tidy.opts =</span> <span class="fu">list</span>(<span class="at">width.cutoff =</span> <span class="dv">60</span>)</span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.2 Assemble Data Cube</span></span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a>The <span class="in">`sits`</span> package installation comes pre-loaded with an API library of connections<span class="ot">[^index-1]</span> to ARD collections (<span class="co">[</span><span class="ot">Analysis-Ready-Data</span><span class="co">](https://ceos.org/ard/)</span>) via STAC protocols (<span class="co">[</span><span class="ot">SpatioTemporal Asset Catalogs</span><span class="co">](https://stacspec.org/en)</span>). This built-in component allows programmatic access to cloud-hosted imagery from AWS, Microsoft Planetary Computer, EarthData, Copernicus many other leading warehouses. However, raw ARD collections present several challenges for classification workflows:</span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial harmonization: Band-specific resolutions require harmonization to common grid avoiding edge anomalies and gaps</span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal harmonization: Revisit cycles vary due to orbital geometry, platform scheduling, and atmospheric conditions</span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cloud removal: Atmospheric interference introduces missing observations that corrupt spectral time series</span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a>For REDD+ monitoring, temporal gaps create systematic underestimation of forest loss when clearing events coincide with cloud-covered periods; a known source of activity data bias requiring explicit quantification in uncertainty budgets. The <span class="in">`sits_regularize()`</span> function provides wrapper to <span class="in">`gdalcubes`</span> operations that transforms heterogeneous imagery into regular or normalized data cubes through coupled spatial and temporal harmonizations.</span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial harmonization reprojects all inputs to a common coordinate reference system and resamples to uniform pixel spacing. For instance, fusing Sentinel-1 SAR with Sentinel-2 optical data requires re-projection to the MGRS grid at consistent resolution (typically 10m), ensuring geometric alignment and eliminating co-registration errors that propagate into classification uncertainty.</span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal harmonization establishes fixed observation intervals (16-day, monthly, seasonal) via cloud-optimized compositing. Within each interval, the algorithm ranks available scenes by cloud cover percentage, using the clearest image as reference and filling gaps from progressively cloudier acquisitions. Pixels with persistent cloud contamination are flagged as NA and gap-filled through temporal interpolation during feature extraction.</span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a><span class="fu">## ARD Tile Grids</span></span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a>Sentinel-2 acquisitions are organized according to the Military Grid Reference System (MGRS), which partitions global coverage into 60 longitudinal zones spanning 8° each. Within zones, 6° latitudinal blocks are further subdivided into 110 km × 110 km tiles with 10 km overlap to ensure seamless mosaicking. This tiling structure is critical for REDD+ monitoring systems that track forest change across administrative boundaries, as tile edges can introduce geometric discontinuities if not properly managed during data cube construction.</span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a>Landsat missions (4,5,7,8,9) employ the Worldwide Reference System-2 (WRS-2), which references scenes by path (descending orbital track) and row (latitudinal frame center). The WRS-2 grid comprises 233 paths globally, each containing 119 rows. All WRS-2 imagery is delivered with geometric correction to UTM projection, facilitating direct integration with ground reference data and cadastral boundaries commonly used in jurisdictional REDD+ accounting. For operational monitoring systems, understanding these tiling schemes is essential for:</span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stratification: Validation samples must account for tile boundaries to avoid spatial clustering</span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Co-registration: Cross-sensor fusion (Landsat-Sentinel) requires explicit handling of differing grid systems</span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Computation: Processing workflows optimized for native tile extents reduce unnecessary resampling and associated geometric errors</span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a>This analysis replicates methods from @simoes2021satellite, which assembles a data cube from MPC's collection of Sentinel-2 ARD-imagery comprising a single tiled area in the state of Rondonia for the full calendar year of 2022.<span class="ot">[^index-2]</span> Following assembly, we normalize raw imagery into a bi-monthly regularized cube below. We specified 10 multispectral bands spanning visible through shortwave infrared wavelengths (B02-B12), plus the B8A narrow NIR band and the CLOUD quality mask for atmospheric filtering.</span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data cube from Microsoft Planetary Computer ARD</span></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a>cube_s2_raw <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube</span>(</span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a>  <span class="at">source            =</span> <span class="st">"MPC"</span>,</span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a>  <span class="at">collection    =</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a>  <span class="at">tiles             =</span> <span class="st">"20LMR"</span>,</span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a>  <span class="at">bands             =</span> <span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"CLOUD"</span>),</span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">start_date    =</span> <span class="st">"2022-01-01"</span>,</span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">end_date      =</span> <span class="st">"2022-12-31"</span></span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Check timelines of assembled tiles</span></span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_timeline</span>(cube_s2_raw)</span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.3 Normalize Data Cube</span></span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a>Although default <span class="in">`sits`</span> operations assemble cubes in the cloud, increased temporal and spatial extents and finer resolutions often require significant processing times. Especially with larger data cube operations, we recommend assembling data cubes in the cloud and downloading copies of the cube imagery to your drive before normalizing imagery into a regular cube from the local directory of downloads. This speeds up operations and avoids network interruptions or queue lags.</span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true" tabindex="-1"></a>Three normalization procedures were implemented to ensure spatiotemporally harmonized analysis-ready dataset:</span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Local Download:&nbsp;The cloud-hosted imagery was copied to local storage to accelerate subsequent processing and avoid network interruptions during computationally intensive operations. This step is particularly important for large jurisdictional monitoring areas where repeated cloud access would create bottlenecks.</span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial-Temporal Regularization:&nbsp;The heterogeneous cube was transformed into a regular grid using the following parameters:</span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Spatial resolution:&nbsp;40m uniform pixel spacing (harmonizing the native 10m/20m bands)</span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Temporal resolution:&nbsp;16-day intervals (P16D) aligned with standard phenological monitoring cycles</span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Cloud compositing:&nbsp;For each 16-day period, cloud-free pixels were prioritized; gaps filled through temporal interpolation</span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Coordinate system:&nbsp;Maintained original UTM Zone 20S projection</span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a>This regularization addresses both spatial misalignment between bands and temporal gaps from cloud contamination, the latter being a critical source of activity data bias in REDD+ monitoring when forest clearing coincides with persistent cloud cover.</span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spectral Index Derivation:&nbsp;Three vegetation indices were calculated and added to the cube as additional analytical bands:</span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>NDVI&nbsp;(Normalized Difference Vegetation Index): (NIR - Red) / (NIR + Red); general vegetation vigor</span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>NBR&nbsp;(Normalized Burn Ratio): (NIR - SWIR2) / (NIR + SWIR2) — burn scar and deforestation detection</span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>EVI&nbsp;(Enhanced Vegetation Index): 2.5 × (NIR - Red) / (NIR + 6×Red - 7.5×Blue + 1); reduces atmospheric effects</span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a>The regularized cube structure shows 13 spectral attributes (10 original bands + 3 indices) organized in a spatiotemporal array spanning 23 temporal steps at 40m resolution (see cube structure below). Implementation details are provided in Section 3.11</span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy cube to local files</span></span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a>cube_s2_local <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube_copy</span>(</span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a>  <span class="at">cube              =</span> cube_s2_raw,</span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/raw/"</span>)</span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize cube from local files</span></span>
<span id="cb27-200"><a href="#cb27-200" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_regularize</span>(</span>
<span id="cb27-201"><a href="#cb27-201" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube                =</span> cube_s2_local,</span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/reg/"</span>,</span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">res                 =</span> <span class="dv">40</span>,</span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">period      =</span> <span class="st">"P16D"</span>,</span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">6</span></span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-208"><a href="#cb27-208" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute spectral index bands for cube</span></span>
<span id="cb27-209"><a href="#cb27-209" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">data                =</span> cube_s2_reg,</span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">NDVI                =</span> (B08 <span class="sc">-</span> B04)<span class="sc">/</span>(B08 <span class="sc">+</span> B04),</span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a>    <span class="at">data                =</span> cube_s2_reg,</span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a>    <span class="at">NBR                 =</span> (B08 <span class="sc">-</span> B12) <span class="sc">/</span> (B08 <span class="sc">+</span> B12),</span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a>    <span class="at">data                =</span> cube_s2_reg,</span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a>    <span class="at">EVI                 =</span> <span class="fl">2.5</span> <span class="sc">*</span> (B08 <span class="sc">-</span> B04) <span class="sc">/</span> ((B08 <span class="sc">+</span> <span class="fl">6.0</span> <span class="sc">*</span> B04 <span class="sc">-</span> <span class="fl">7.5</span> <span class="sc">*</span> B02) <span class="sc">+</span> <span class="fl">1.0</span>),</span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cube structure</span></span>
<span id="cb27-225"><a href="#cb27-225" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(cube_s2_reg)</span>
<span id="cb27-226"><a href="#cb27-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-227"><a href="#cb27-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot single-date RGB image</span></span>
<span id="cb27-228"><a href="#cb27-228" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_reg, </span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a>         <span class="at">red =</span> <span class="st">"B11"</span>, </span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a>         <span class="at">green =</span> <span class="st">"B8A"</span>, </span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a>         <span class="at">blue =</span> <span class="st">"B02"</span>, </span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="st">"2022-07-16"</span></span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a><span class="co"># Access local data cube</span></span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube</span>(</span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a>    <span class="at">source          =</span> <span class="st">"MPC"</span>,</span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a>  <span class="at">collection    =</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_dir      =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-251"><a href="#cb27-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-252"><a href="#cb27-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cube structure</span></span>
<span id="cb27-253"><a href="#cb27-253" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(cube_s2_reg)</span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot one temporal instance</span></span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_reg, </span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a>         <span class="at">red =</span> <span class="st">"B11"</span>, </span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a>         <span class="at">green =</span> <span class="st">"B8A"</span>, </span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a>         <span class="at">blue =</span> <span class="st">"B02"</span>, </span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="st">"2022-07-16"</span></span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a><span class="co"># Files are also available remotely from sitsdata directory </span></span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/Rondonia-20LMR/"</span>, <span class="at">package =</span> <span class="st">"sitsdata"</span>)</span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data cube</span></span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a>rondonia_20LMR <span class="ot">&lt;-</span> <span class="fu">sits_cube</span>(</span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a>    <span class="at">source =</span> <span class="st">"MPC"</span>,</span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a>    <span class="at">collection =</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_dir =</span> data_dir</span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-284"><a href="#cb27-284" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the cube</span></span>
<span id="cb27-285"><a href="#cb27-285" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rondonia_20LMR, <span class="at">date =</span> <span class="st">"2022-07-16"</span>, <span class="at">band =</span> <span class="st">"NDVI"</span>)</span>
<span id="cb27-286"><a href="#cb27-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-287"><a href="#cb27-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.4 Training Data Samples</span></span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a>Training data quality directly determines classification accuracy and, consequently, activity data uncertainty. This analysis uses the <span class="in">`samples_deforestation_rondonia`</span> dataset (n=6,007 signatures) distributed with the <span class="in">`sitsdata`</span> package, comprising nine forest disturbance classes collected through expert visual interpretation of Sentinel-2 imagery representing deforestation events across Rondônia state in the Brazilian Amazon:</span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Clear_Cut_Bare_Soil`</span>: Post-clearing exposed soil</span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Clear_Cut_Burned_Area`</span>: Burned clearing residues</span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Clear_Cut_Vegetation`</span>: Regrowth or residual vegetation post-harvest</span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Forest`</span>: Intact forest including <span class="in">`Mountainside_Forest`</span>, <span class="in">`Riparian_Forest`</span></span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Water`</span>, <span class="in">`Wetland`</span>, <span class="in">`Seasonally_Flooded`</span>: Hydrological features</span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a>The time series spans 2022-01-05 to 2022-12-23 at 16-day intervals, containing 10 Sentinel-2 bands (<span class="in">`B02`</span>, <span class="in">`B03`</span>, <span class="in">`B04`</span>, <span class="in">`B05`</span>, <span class="in">`B06`</span>, <span class="in">`B07`</span>, <span class="in">`B8A`</span>, <span class="in">`B08`</span>, <span class="in">`B11`</span> and <span class="in">`B12`</span>). Temporal validity aligns with the agricultural calendar to capture seasonal dynamics of land conversion.</span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Demo Training Samples</span></span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"samples_deforestation_rondonia"</span>)</span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">summary</span>(samples_deforestation_rondonia)</span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">head</span>(samples_deforestation_rondonia)</span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a>We imported the <span class="in">`samples_deforestation_rondonia`</span> reference dataset (n=6,007 labeled time series) from the sitsdata package. This dataset represents expert visual interpretation of Sentinel-2 imagery across nine forest disturbance classes spanning the 2022 monitoring period. The class distribution shows reasonable balance across deforestation stages, with <span class="in">`Riparian_Forest`</span> (20.8%) and <span class="in">`Clear_Cut_Burned_Area`</span> (16.4%) as the most represented classes, while rare classes like Water (1.8%) and Wetland (3.6%) have sufficient samples for model training (<span class="sc">\&gt;</span>100 observations each). Each training sample consists of:</span>
<span id="cb27-316"><a href="#cb27-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-317"><a href="#cb27-317" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial coordinates:&nbsp;Longitude/latitude in WGS84</span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal extent:&nbsp;2022-01-05 to 2022-12-23 (23 acquisition dates)</span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spectral values:&nbsp;10 Sentinel-2 bands at 16-day intervals</span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Class label:&nbsp;One of nine disturbance categories</span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cube reference:&nbsp;Source imagery identification</span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a>The temporal span aligns with the agricultural calendar to capture seasonal dynamics of forest-to-agriculture conversion, including dry-season clearing (May-June) followed by burning (August-September). This phenological coverage is critical for distinguishing between deforestation stages using time series classification</span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a>Visualizing class-specific temporal trajectories aids in assessing spectral separability; a key determinant of classification uncertainty. The <span class="in">`sits_patterns()`</span> function fits generalized additive models (GAM) to training data, producing smoothed temporal signatures that represent idealized class behavior. We derive vegetation indices (NDVI, EVI, NBR) to enhance interpretability.</span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-330"><a href="#cb27-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-331"><a href="#cb27-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb27-334"><a href="#cb27-334" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb27-335"><a href="#cb27-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-336"><a href="#cb27-336" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute spectral indexes for training samples</span></span>
<span id="cb27-337"><a href="#cb27-337" aria-hidden="true" tabindex="-1"></a>training_samples_with_indices <span class="ot">&lt;-</span> samples_deforestation_rondonia <span class="sc">|&gt;</span> </span>
<span id="cb27-338"><a href="#cb27-338" aria-hidden="true" tabindex="-1"></a>    sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">NDVI =</span> (B08 <span class="sc">-</span> B04)<span class="sc">/</span>(B08 <span class="sc">+</span> B04)) <span class="sc">|&gt;</span> </span>
<span id="cb27-339"><a href="#cb27-339" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">NBR =</span> (B08 <span class="sc">-</span> B12) <span class="sc">/</span> (B08 <span class="sc">+</span> B12)) <span class="sc">|&gt;</span> </span>
<span id="cb27-340"><a href="#cb27-340" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">EVI =</span> <span class="fl">2.5</span> <span class="sc">*</span> (B08 <span class="sc">-</span> B04) <span class="sc">/</span> ((B08 <span class="sc">+</span> <span class="fl">6.0</span> <span class="sc">*</span> B04 <span class="sc">-</span> <span class="fl">7.5</span> <span class="sc">*</span> B02) <span class="sc">+</span> <span class="fl">1.0</span>)) </span>
<span id="cb27-341"><a href="#cb27-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-342"><a href="#cb27-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and plot patterns</span></span>
<span id="cb27-343"><a href="#cb27-343" aria-hidden="true" tabindex="-1"></a>training_samples_indices <span class="ot">&lt;-</span> training_samples_with_indices <span class="sc">|&gt;</span> </span>
<span id="cb27-344"><a href="#cb27-344" aria-hidden="true" tabindex="-1"></a>    sits<span class="sc">::</span><span class="fu">sits_select</span>(<span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"NDVI"</span>, <span class="st">"EVI"</span>, <span class="st">"NBR"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb27-345"><a href="#cb27-345" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_patterns</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb27-346"><a href="#cb27-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-347"><a href="#cb27-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-348"><a href="#cb27-348" aria-hidden="true" tabindex="-1"></a>To assess spectral separability between classes—a key determinant of classification uncertainty—we calculated vegetation indices (NDVI, EVI, NBR) for all training samples and extracted class-specific temporal patterns using generalized additive models (GAM). These smoothed signatures represent idealized phenological trajectories for each disturbance class.</span>
<span id="cb27-349"><a href="#cb27-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-350"><a href="#cb27-350" aria-hidden="true" tabindex="-1"></a>The temporal patterns (Figure X) reveal distinct phenological contrasts that enable classification:</span>
<span id="cb27-351"><a href="#cb27-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-352"><a href="#cb27-352" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Forest`</span> classes: (Forest, Mountainside_Forest, Riparian_Forest): High stable NDVI/EVI (<span class="sc">\&gt;</span>0.7) throughout the year, with minimal seasonal variation reflecting evergreen tropical forest characteristics</span>
<span id="cb27-353"><a href="#cb27-353" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Clear_Cut_Bare_Soil`</span>: Abrupt decline in all indices coinciding with clearing events, with NDVI dropping to <span class="sc">\&lt;</span>0.2</span>
<span id="cb27-354"><a href="#cb27-354" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Clear_Cut_Burned_Area`</span>: Sharp SWIR spike (low NBR values \~-0.3) during August-September dry season, indicating active burning</span>
<span id="cb27-355"><a href="#cb27-355" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Clear_Cut_Vegetation`</span>: Gradual NIR/NDVI recovery through the monitoring period, showing regrowth trajectories</span>
<span id="cb27-356"><a href="#cb27-356" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Water/Wetland`</span> classes: Consistently low NDVI (<span class="sc">\&lt;</span>0.3) with seasonal fluctuations in EVI reflecting inundation cycles</span>
<span id="cb27-357"><a href="#cb27-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-358"><a href="#cb27-358" aria-hidden="true" tabindex="-1"></a>These temporal contrasts provide the spectral-temporal feature space for subsequent Random Forest classification. Classes with overlapping signatures (e.g., Seasonally_Flooded vs. Wetland) represent known confusion sources requiring careful validation.</span>
<span id="cb27-359"><a href="#cb27-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-360"><a href="#cb27-360" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.5 Classify Data Cube</span></span>
<span id="cb27-361"><a href="#cb27-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-362"><a href="#cb27-362" aria-hidden="true" tabindex="-1"></a>Random Forest models provide robust baseline classifiers for activity data, balancing computational efficiency with adequate performance for Tier 2-3 REDD+ requirements. The <span class="in">`sits_train()`</span> function implements parallelized Random Forest training with default hyperparameters optimized for satellite time series.</span>
<span id="cb27-363"><a href="#cb27-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-364"><a href="#cb27-364" aria-hidden="true" tabindex="-1"></a>We trained a Random Forest classifier using the following hyperparameters optimized for satellite time series classification:</span>
<span id="cb27-365"><a href="#cb27-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-366"><a href="#cb27-366" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Number of trees:&nbsp;120 (balancing accuracy and computational efficiency)</span>
<span id="cb27-367"><a href="#cb27-367" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Variables per split (<span class="in">`mtry`</span>):&nbsp;10 (approximately √p where p = total features)</span>
<span id="cb27-368"><a href="#cb27-368" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Training samples:&nbsp;6,007 labeled time series across 9 classes</span>
<span id="cb27-369"><a href="#cb27-369" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Input features:&nbsp;10 spectral bands × 23 temporal observations = 230 features per sample</span>
<span id="cb27-370"><a href="#cb27-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-371"><a href="#cb27-371" aria-hidden="true" tabindex="-1"></a>The Random Forest algorithm constructs an ensemble of decision trees through bootstrap aggregation (bagging), where each tree trains on a random subset of samples and features. Final predictions aggregate votes across all trees, providing robust performance without requiring extensive hyperparameter tuning, critical for operational REDD+ systems where model calibration time is constrained.</span>
<span id="cb27-372"><a href="#cb27-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-375"><a href="#cb27-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-376"><a href="#cb27-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-377"><a href="#cb27-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-378"><a href="#cb27-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-379"><a href="#cb27-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb27-380"><a href="#cb27-380" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb27-381"><a href="#cb27-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-382"><a href="#cb27-382" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model using Random Forest algorithm</span></span>
<span id="cb27-383"><a href="#cb27-383" aria-hidden="true" tabindex="-1"></a>model_randomForest <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_train</span>(</span>
<span id="cb27-384"><a href="#cb27-384" aria-hidden="true" tabindex="-1"></a>  <span class="at">samples =</span> samples_deforestation_rondonia,</span>
<span id="cb27-385"><a href="#cb27-385" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_method     =</span> sits<span class="sc">::</span><span class="fu">sits_rfor</span>(</span>
<span id="cb27-386"><a href="#cb27-386" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_trees =</span> <span class="dv">120</span>,</span>
<span id="cb27-387"><a href="#cb27-387" aria-hidden="true" tabindex="-1"></a>    <span class="at">mtry            =</span> <span class="dv">10</span>)</span>
<span id="cb27-388"><a href="#cb27-388" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-389"><a href="#cb27-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-390"><a href="#cb27-390" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the model results</span></span>
<span id="cb27-391"><a href="#cb27-391" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_randomForest)</span>
<span id="cb27-392"><a href="#cb27-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-393"><a href="#cb27-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-394"><a href="#cb27-394" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Variable Importance</span></span>
<span id="cb27-395"><a href="#cb27-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-396"><a href="#cb27-396" aria-hidden="true" tabindex="-1"></a>The feature importance ranking (Figure X) identifies which bands and temporal observations contribute most to class discrimination:</span>
<span id="cb27-397"><a href="#cb27-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-398"><a href="#cb27-398" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>SWIR bands (B11, B12)&nbsp;show highest importance, confirming importance to deforestation detection due to sensitivity to bare soil</span>
<span id="cb27-399"><a href="#cb27-399" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>NIR bands (B8A, B08)&nbsp;rank second, critical for vegetation structure and biomass proxies</span>
<span id="cb27-400"><a href="#cb27-400" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal depth matters:&nbsp;Later-season observations September-November carry weights (post-clearing phenology)</span>
<span id="cb27-401"><a href="#cb27-401" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Red-edge bands (B05-B07)&nbsp;provide moderate importance, useful for subtle degradation detection</span>
<span id="cb27-402"><a href="#cb27-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-403"><a href="#cb27-403" aria-hidden="true" tabindex="-1"></a>Vairable importance ranking informs:</span>
<span id="cb27-404"><a href="#cb27-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-405"><a href="#cb27-405" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sensor planning:&nbsp;Prioritizing SWIR channels in future satellite missions</span>
<span id="cb27-406"><a href="#cb27-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-407"><a href="#cb27-407" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Uncertainty attribution:&nbsp;SWIR-band errors propagate more strongly into final classifications</span>
<span id="cb27-408"><a href="#cb27-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-409"><a href="#cb27-409" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Transfer learning:&nbsp;When adapting models to new regions, maintaining SWIR coverage is essential.</span>
<span id="cb27-410"><a href="#cb27-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-411"><a href="#cb27-411" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.6 Probability Data Cube</span></span>
<span id="cb27-412"><a href="#cb27-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-413"><a href="#cb27-413" aria-hidden="true" tabindex="-1"></a>Classification outputs are generated as probability cubes rather than discrete label maps to preserve model uncertainty information. The <span class="in">`sits_classify()`</span> function applies trained models to regularized data cubes using fault-tolerant parallel processing, producing per-class probability layers that quantify model confidence at the pixel level.</span>
<span id="cb27-414"><a href="#cb27-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-415"><a href="#cb27-415" aria-hidden="true" tabindex="-1"></a>The trained Random Forest model was applied to the regularized data cube using parallelized classification across 4 processing cores with 16GB memory allocation. Rather than producing discrete class labels, the classification generates a probability cube where each pixel contains membership probabilities for all nine classes (summing to 1.0).</span>
<span id="cb27-416"><a href="#cb27-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-417"><a href="#cb27-417" aria-hidden="true" tabindex="-1"></a>**Why Probability Cubes Matter:**</span>
<span id="cb27-418"><a href="#cb27-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-419"><a href="#cb27-419" aria-hidden="true" tabindex="-1"></a>Traditional discrete classifications discard critical uncertainty information. Probability cubes preserve pixel-level model confidence, enabling:</span>
<span id="cb27-420"><a href="#cb27-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-421"><a href="#cb27-421" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Uncertainty mapping: Low maximum probability values indicate high uncertainty at class boundaries or in mixed pixels</span>
<span id="cb27-422"><a href="#cb27-422" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adaptive validation: High-uncertainty regions receive greater sampling density during accuracy assessment</span>
<span id="cb27-423"><a href="#cb27-423" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Monte Carlo propagation: Probability distributions feed directly into emission uncertainty simulations (Chapter 4)</span>
<span id="cb27-424"><a href="#cb27-424" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal change detection: Probability time series detect gradual transitions but missed discrete labeling</span>
<span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a>The Forest class probability layer (Figure X) shows high confidence (p <span class="sc">\&gt;</span> 0.9, dark green) in intact forest areas, with lower probabilities (p = 0.4-0.7, light green) along forest edges and in degraded patches. These spatial patterns of uncertainty directly inform subsequent validation stratification and area estimation.</span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-430"><a href="#cb27-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-431"><a href="#cb27-431" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-432"><a href="#cb27-432" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-433"><a href="#cb27-433" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-434"><a href="#cb27-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb27-435"><a href="#cb27-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-436"><a href="#cb27-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-437"><a href="#cb27-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify data cube</span></span>
<span id="cb27-438"><a href="#cb27-438" aria-hidden="true" tabindex="-1"></a>cube_s2_probs <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_classify</span>(</span>
<span id="cb27-439"><a href="#cb27-439" aria-hidden="true" tabindex="-1"></a>    <span class="at">data            =</span> cube_s2_reg,</span>
<span id="cb27-440"><a href="#cb27-440" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_model        =</span> model_randomForest,</span>
<span id="cb27-441"><a href="#cb27-441" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span id="cb27-442"><a href="#cb27-442" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-1228"</span>, <span class="co"># adds suffix to output filename</span></span>
<span id="cb27-443"><a href="#cb27-443" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb27-444"><a href="#cb27-444" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span></span>
<span id="cb27-445"><a href="#cb27-445" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-446"><a href="#cb27-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-447"><a href="#cb27-447" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_probs, </span>
<span id="cb27-448"><a href="#cb27-448" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels =</span> <span class="st">"Forest"</span>, </span>
<span id="cb27-449"><a href="#cb27-449" aria-hidden="true" tabindex="-1"></a>         <span class="at">palette =</span> <span class="st">"YlGn"</span></span>
<span id="cb27-450"><a href="#cb27-450" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb27-451"><a href="#cb27-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-452"><a href="#cb27-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-453"><a href="#cb27-453" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-d.png)</span>{fig-align="center"}</span>
<span id="cb27-454"><a href="#cb27-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-455"><a href="#cb27-455" aria-hidden="true" tabindex="-1"></a>Each pixel in the probability cube contains <span class="in">`n`</span> probability values (where <span class="in">`n`</span> = number of classes), summing to 1.0. Low maximum probability values indicate pixels with high classification uncertainty, typically occurring at class boundaries, in mixed pixels, or where spectral-temporal signatures deviate from training data. These pixel-level uncertainty metrics support subsequent:</span>
<span id="cb27-456"><a href="#cb27-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-457"><a href="#cb27-457" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adaptive stratification: High-uncertainty pixels receive higher validation sampling density</span>
<span id="cb27-458"><a href="#cb27-458" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Uncertainty propagation: Probability distributions feed Monte Carlo emission simulations</span>
<span id="cb27-459"><a href="#cb27-459" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Quality control: Spatial patterns of low confidence identify systematic classification errors</span>
<span id="cb27-460"><a href="#cb27-460" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal tracking: Probability time series detect gradual transitions missed by discrete labeling</span>
<span id="cb27-461"><a href="#cb27-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-462"><a href="#cb27-462" aria-hidden="true" tabindex="-1"></a>Probability cubes thus serve as the foundation for rigorous uncertainty quantification in subsequent workflow stages.</span>
<span id="cb27-463"><a href="#cb27-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-464"><a href="#cb27-464" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.7 Training Data Enhancements</span></span>
<span id="cb27-465"><a href="#cb27-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-466"><a href="#cb27-466" aria-hidden="true" tabindex="-1"></a>Classification accuracy in REDD+ monitoring depends critically on training sample quality. Large, well-labeled datasets improve model performance regardless of algorithm choice, while noisy or mislabeled samples degrade classification accuracy and inflate activity data uncertainty <span class="co">[</span><span class="ot">@maxwell2018implementation; @frenay2013classification</span><span class="co">]</span>. This section demonstrates processing methods to identify problematic samples, reduce class imbalance, and address geographic variance before re-training models.</span>
<span id="cb27-467"><a href="#cb27-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-468"><a href="#cb27-468" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pixel Entropy Sampling</span></span>
<span id="cb27-469"><a href="#cb27-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-470"><a href="#cb27-470" aria-hidden="true" tabindex="-1"></a>Active learning uses pixel-level classification uncertainty to systematically improve classification accuracy through iterative model refinement <span class="co">[</span><span class="ot">@crawford2013active; @cao2012automatic</span><span class="co">]</span>. When there is a finite set of alternative classes, the expected value of conflict is given by the Shannon entropy <span class="co">[</span><span class="ot">@shannonMathematicalTheoryCommunication1948</span><span class="co">]</span>. Entropy may be used to describe the variations in class membership probabilities associated with each pixel. The <span class="in">`sits_uncertainty()`</span> function quantifies four types of uncertainty metrics:</span>
<span id="cb27-471"><a href="#cb27-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-472"><a href="#cb27-472" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-473"><a href="#cb27-473" aria-hidden="true" tabindex="-1"></a>\text{H} = -\sum_{i=1}^n Pr(i) \times \log(Pr(i))</span>
<span id="cb27-474"><a href="#cb27-474" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-475"><a href="#cb27-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-476"><a href="#cb27-476" aria-hidden="true" tabindex="-1"></a>where $Pr(i)$ represents the highest membership probability for pixel $i$ across $n$ classes. For REDD+ applications, the <span class="in">`margin`</span> of confidence typically provides the most actionable results, such as for highlighting transition zones where forest degradation or regeneration creates spectral ambiguity between classes. This margin is defined as the difference between the highest and second-highest class probabilities (Margin = p₁ - p₂), where low values approaching zero indicate ambiguous pixels where the classifier struggles to discriminate between competing classes.</span>
<span id="cb27-477"><a href="#cb27-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-478"><a href="#cb27-478" aria-hidden="true" tabindex="-1"></a>The margin uncertainty cube reveals spatial patterns of classification difficulty across the landscape. High uncertainty concentrations appear along forest-agriculture boundaries where mixed pixels contain both forest and bare soil signatures, within wetland complexes where spectral similarity confuses Seasonally_Flooded and Wetland classes, and across regeneration zones where <span class="in">`Clear_Cut_Vegetation`</span> becomes spectrally ambiguous with early-stage <span class="in">`Forest`</span> regrowth. To systematically improve these problematic areas, we identified 300 candidate locations for additional training samples using a minimum uncertainty threshold of margin <span class="sc">\&lt;</span> 0.4 with 10-pixel minimum spacing to ensure geographic dispersion. These samples, once labeled through expert interpretation and merged with the original training set for iterative model refinement, typically drive uncertainty convergence within 2-3 iterations.</span>
<span id="cb27-479"><a href="#cb27-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-482"><a href="#cb27-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-483"><a href="#cb27-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-484"><a href="#cb27-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate uncertainty cube and sample high-uncertainty pixels</span></span>
<span id="cb27-485"><a href="#cb27-485" aria-hidden="true" tabindex="-1"></a>cube_s2_uncertainty <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty</span>(</span>
<span id="cb27-486"><a href="#cb27-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube =</span> cube_s2_probs,</span>
<span id="cb27-487"><a href="#cb27-487" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"margin"</span>, </span>
<span id="cb27-488"><a href="#cb27-488" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">"./assets/images/uncertainty/"</span>,</span>
<span id="cb27-489"><a href="#cb27-489" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb27-490"><a href="#cb27-490" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize =</span> <span class="dv">16</span>)</span>
<span id="cb27-491"><a href="#cb27-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-492"><a href="#cb27-492" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize high-uncertainty areas</span></span>
<span id="cb27-493"><a href="#cb27-493" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty, <span class="at">palette =</span> <span class="st">"Oranges"</span>)</span>
<span id="cb27-494"><a href="#cb27-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-495"><a href="#cb27-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-496"><a href="#cb27-496" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-l1.png)</span>{fig-align="center"}</span>
<span id="cb27-497"><a href="#cb27-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-498"><a href="#cb27-498" aria-hidden="true" tabindex="-1"></a>After extracting spectral signatures for the 300 high-uncertainty locations and retraining the Random Forest model with the expanded dataset (n_total = 6,307), we compared uncertainty maps between model versions to assess improvement. The side-by-side visualizations showed subtle spatial differences, with version 2 exhibiting slightly reduced uncertainty in previously ambiguous forest-wetland transitions. However, the convergence metrics revealed a counterintuitive result where mean uncertainty actually increased slightly in version 2. This pattern suggests that the additional samples exposed previously undetected class overlaps rather than resolving them, revealing legitimate spectral ambiguity that existed but wasn't apparent in the original training set. This demonstrates an important REDD+ lesson: adding training samples doesn't always reduce uncertainty, and proper convergence requires multiple iterations with strategic sample selection until uncertainty metrics stabilize.</span>
<span id="cb27-499"><a href="#cb27-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-502"><a href="#cb27-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-503"><a href="#cb27-503" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-504"><a href="#cb27-504" aria-hidden="true" tabindex="-1"></a><span class="co"># Find samples with high uncertainty</span></span>
<span id="cb27-505"><a href="#cb27-505" aria-hidden="true" tabindex="-1"></a>new_samples_locations <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty_sampling</span>(</span>
<span id="cb27-506"><a href="#cb27-506" aria-hidden="true" tabindex="-1"></a>    <span class="at">uncert_cube =</span> cube_s2_uncertainty,</span>
<span id="cb27-507"><a href="#cb27-507" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">300</span>,</span>
<span id="cb27-508"><a href="#cb27-508" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_uncert =</span> <span class="fl">0.4</span>,</span>
<span id="cb27-509"><a href="#cb27-509" aria-hidden="true" tabindex="-1"></a>    <span class="at">sampling_window =</span> <span class="dv">10</span>) </span>
<span id="cb27-510"><a href="#cb27-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-511"><a href="#cb27-511" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize new training points</span></span>
<span id="cb27-512"><a href="#cb27-512" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_view</span>(new_samples_locations)</span>
<span id="cb27-513"><a href="#cb27-513" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(new_samples_locations, </span>
<span id="cb27-514"><a href="#cb27-514" aria-hidden="true" tabindex="-1"></a>    <span class="st">"./assets/samples/new_samples_location.gpkg"</span>)</span>
<span id="cb27-515"><a href="#cb27-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-516"><a href="#cb27-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-525"><a href="#cb27-525" aria-hidden="true" tabindex="-1"></a>new_samples_locations <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./assets/samples/new_samples_location.gpkg"</span>, <span class="at">quiet=</span>T)</span>
<span id="cb27-526"><a href="#cb27-526" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_view</span>(new_samples_locations)</span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract new spectral signatures</span></span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a>new_samples <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_get_data</span>(</span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube =</span> cube_s2_reg,</span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> new_samples_locations)</span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a><span class="co">#new_samples$label &lt;- "Wetland"</span></span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a>new_samples_aligned <span class="ot">&lt;-</span> <span class="fu">sits_select</span>(<span class="at">data =</span> new_samples,</span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a>  <span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, </span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"B8A"</span>))</span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with original samples</span></span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a>new_samples_merge <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a>    samples_deforestation_rondonia,</span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a>  new_samples_aligned)</span>
<span id="cb27-548"><a href="#cb27-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-549"><a href="#cb27-549" aria-hidden="true" tabindex="-1"></a><span class="co"># Train new model &amp; evaluate</span></span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a>model_randomForest_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_train</span>(</span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> new_samples_merge, </span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_method =</span> sits<span class="sc">::</span><span class="fu">sits_rfor</span>(<span class="at">num_trees =</span> <span class="dv">120</span>,<span class="at">mtry =</span> <span class="dv">10</span>))</span>
<span id="cb27-553"><a href="#cb27-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-554"><a href="#cb27-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify new cube</span></span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify data cube</span></span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a>cube_s2_probs_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_classify</span>(</span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a>    <span class="at">data            =</span> cube_s2_reg,</span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_model        =</span> model_randomForest_v2,</span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-1228-v2"</span>, <span class="co"># adds suffix to output filename</span></span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive new uncertainty cube and compare</span></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a>cube_s2_uncertainty_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty</span>(</span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a>    cube_s2_probs_v2, </span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"margin"</span>, </span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">"./assets/images/uncertainty_v2/"</span>,</span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a>  <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a>  <span class="at">memsize =</span> <span class="dv">16</span>)</span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize side-by-side</span></span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty, <span class="at">palette =</span> <span class="st">"Reds"</span>)</span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty_v2, <span class="at">palette =</span> <span class="st">"Oranges"</span>)</span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a>::: {#fig-entropy-b layout-ncol="2"}</span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-l1.png)</span>{fig-align="center" width="100%"} <span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-l2.png)</span>{fig-align="center" width="100%"}</span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for convergence (extract filepath first)</span></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a>get_uncert_values <span class="ot">&lt;-</span> <span class="cf">function</span>(uncert_cube) {</span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a>  files <span class="ot">&lt;-</span> uncert_cube<span class="sc">$</span>file_info[[<span class="dv">1</span>]]<span class="sc">$</span>path</span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(files)</span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">values</span>(r)</span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate statistics</span></span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a>uncert_v1_vals <span class="ot">&lt;-</span> <span class="fu">get_uncert_values</span>(cube_s2_uncertainty)</span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a>uncert_v2_vals <span class="ot">&lt;-</span> <span class="fu">get_uncert_values</span>(cube_s2_uncertainty_v2)</span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a>uncertainty_check <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration =</span> <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>),</span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(uncert_v1_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(uncert_v2_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(uncert_v1_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(uncert_v2_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a>  <span class="at">pct_high_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(uncert_v1_vals <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(uncert_v1_vals)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(uncert_v2_vals <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(uncert_v2_vals)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-611"><a href="#cb27-611" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-612"><a href="#cb27-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(uncertainty_check, <span class="st">"./assets/samples/uncertainty_check.csv"</span>)</span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-618"><a href="#cb27-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-619"><a href="#cb27-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb27-620"><a href="#cb27-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-621"><a href="#cb27-621" aria-hidden="true" tabindex="-1"></a>uncertainty_check <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"assets/samples/uncertainty_check.csv"</span>) </span>
<span id="cb27-622"><a href="#cb27-622" aria-hidden="true" tabindex="-1"></a>uncertainty_check <span class="sc">|&gt;</span> </span>
<span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">flextable</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">fontsize</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">part =</span> <span class="st">"body"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">fontsize</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">part =</span> <span class="st">"footer"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">set_table_properties</span>(<span class="at">layout =</span> <span class="st">"autofit"</span>, <span class="at">width=</span><span class="dv">1</span>, <span class="at">align =</span> <span class="st">"center"</span>) </span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a>Short class relabelling, the above method showcases an iterative revision workflow typically used to integrate new samples and retrain models until uncertainty stabilizes. For ART-TREES compliance, uncertainty reduction directly decreases activity data deductions and simplifies third-party verification.</span>
<span id="cb27-630"><a href="#cb27-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-631"><a href="#cb27-631" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hierarchical Clustering</span></span>
<span id="cb27-632"><a href="#cb27-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-633"><a href="#cb27-633" aria-hidden="true" tabindex="-1"></a>We implemented two clustering approaches for evaluating training data quality based on dataset size: Agglomerative Hierarchical Clustering (<span class="in">`AHC`</span>) for datasets under 10,000 samples, and Self-Organizing Maps (SOM) for larger collections (Gonçalves et al., 2008; Neagoe et al., 2014; Yao et al., 2016). The computational complexity difference is significant—AHC operates at O(n²) requiring substantial memory, while SOM scales linearly, making it preferable for operational REDD+ monitoring systems processing large reference datasets.</span>
<span id="cb27-634"><a href="#cb27-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-635"><a href="#cb27-635" aria-hidden="true" tabindex="-1"></a>Hierarchical clustering computes dissimilarity between samples using dynamic time warping (DTW), which reliably measures differences in satellite time series by accounting for temporal shifts in phenological patterns (Maus et al., 2019; Petitjean et al., 2012). The sits_cluster_dendro() function generates dendrograms using <span class="in">`DTW`</span> distance with Ward's linkage criterion to minimize within-cluster variance, applied here to NDVI and EVI time series spanning 23 temporal observations per sample. The adjusted Rand index (Rand, 1971) identified seven as the optimal cluster count, and examining the resulting cluster composition revealed distinct groupings that illuminate class separability and potential quality issues.</span>
<span id="cb27-636"><a href="#cb27-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-639"><a href="#cb27-639" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-640"><a href="#cb27-640" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-641"><a href="#cb27-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-642"><a href="#cb27-642" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster samples using DTW distance and Ward linkage</span></span>
<span id="cb27-643"><a href="#cb27-643" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cluster_dendro</span>(</span>
<span id="cb27-644"><a href="#cb27-644" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> training_samples_with_indices, </span>
<span id="cb27-645"><a href="#cb27-645" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"NDVI"</span>, <span class="st">"EVI"</span>),</span>
<span id="cb27-646"><a href="#cb27-646" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_method =</span> <span class="st">"dtw_basic"</span>,</span>
<span id="cb27-647"><a href="#cb27-647" aria-hidden="true" tabindex="-1"></a>    <span class="at">linkage =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb27-648"><a href="#cb27-648" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-649"><a href="#cb27-649" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine cluster composition</span></span>
<span id="cb27-650"><a href="#cb27-650" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_cluster_frequency</span>(clusters)</span>
<span id="cb27-651"><a href="#cb27-651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-652"><a href="#cb27-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-653"><a href="#cb27-653" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-g.png)</span>{fig-align="center"}</span>
<span id="cb27-654"><a href="#cb27-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-655"><a href="#cb27-655" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb27-656"><a href="#cb27-656" aria-hidden="true" tabindex="-1"></a><span class="in">                           1    2    3    4    5    6    7 Total</span></span>
<span id="cb27-657"><a href="#cb27-657" aria-hidden="true" tabindex="-1"></a><span class="in">  Clear_Cut_Bare_Soil    121    9  104  705    5    0    0   944</span></span>
<span id="cb27-658"><a href="#cb27-658" aria-hidden="true" tabindex="-1"></a><span class="in">  Clear_Cut_Burned_Area   79    5   23  874    0    0    2   983</span></span>
<span id="cb27-659"><a href="#cb27-659" aria-hidden="true" tabindex="-1"></a><span class="in">  Clear_Cut_Vegetation   259  164   43  103    0    0   34   603</span></span>
<span id="cb27-660"><a href="#cb27-660" aria-hidden="true" tabindex="-1"></a><span class="in">  Forest                 174  732    5    6    0    0   47   964</span></span>
<span id="cb27-661"><a href="#cb27-661" aria-hidden="true" tabindex="-1"></a><span class="in">  Mountainside_Forest     12  145    2    0    0    0   52   211</span></span>
<span id="cb27-662"><a href="#cb27-662" aria-hidden="true" tabindex="-1"></a><span class="in">  Riparian_Forest         39  327   11    6    0    0  864  1247</span></span>
<span id="cb27-663"><a href="#cb27-663" aria-hidden="true" tabindex="-1"></a><span class="in">  Seasonally_Flooded     414   94  160   25   29    0    9   731</span></span>
<span id="cb27-664"><a href="#cb27-664" aria-hidden="true" tabindex="-1"></a><span class="in">  Water                    0    0    1    2    2  104    0   109</span></span>
<span id="cb27-665"><a href="#cb27-665" aria-hidden="true" tabindex="-1"></a><span class="in">  Wetland                 56    1   55   19   53   31    0   215</span></span>
<span id="cb27-666"><a href="#cb27-666" aria-hidden="true" tabindex="-1"></a><span class="in">  Total                 1154 1477  404 1740   89  135 1008  6007</span></span>
<span id="cb27-667"><a href="#cb27-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-668"><a href="#cb27-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-669"><a href="#cb27-669" aria-hidden="true" tabindex="-1"></a>Cluster 4 strongly dominated by <span class="in">`Clear-cut`</span> classes with 705 <span class="in">`Bare_Soil`</span> and 874 <span class="in">`Burned_Area`</span> samples (1,579 total) demonstrated strong spectral-temporal similarity among cleared areas, while Cluster 2 contained predominantly forest types with 732 <span class="in">`Forest`</span>, 327 <span class="in">`Riparian`</span>, and 145 <span class="in">`Mountainside`</span> samples (1,204 total), confirming these classes share fundamental phenological characteristics. Conversely, Cluster 5 showed high mixture across multiple classes with the lowest purity, suggesting these 89 samples occupy ambiguous spectral space representing either mislabeled observations, edge pixels with mixed land cover, or transitional states not well-represented by discrete classes. We removed Cluster 5 entirely from the training set, and after retaining only dominant labels within remaining clusters through the <span class="in">`sits_cluster_clean()`</span> function, the refined dataset contained 5,893 samples with improved class purity, with only 25 additional samples removed from other clusters.</span>
<span id="cb27-670"><a href="#cb27-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-673"><a href="#cb27-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-674"><a href="#cb27-674" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-675"><a href="#cb27-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove cluster#5 from the samples</span></span>
<span id="cb27-677"><a href="#cb27-677" aria-hidden="true" tabindex="-1"></a>clusters_new <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(clusters, cluster <span class="sc">!=</span> <span class="dv">5</span>)</span>
<span id="cb27-678"><a href="#cb27-678" aria-hidden="true" tabindex="-1"></a>clusters_clean <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cluster_clean</span>(clusters_new)</span>
<span id="cb27-679"><a href="#cb27-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-680"><a href="#cb27-680" aria-hidden="true" tabindex="-1"></a><span class="co"># Check clusters samples frequency</span></span>
<span id="cb27-681"><a href="#cb27-681" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_cluster_frequency</span>(clusters_clean)</span>
<span id="cb27-682"><a href="#cb27-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-683"><a href="#cb27-683" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate SOM with optimal grid dimensions</span></span>
<span id="cb27-684"><a href="#cb27-684" aria-hidden="true" tabindex="-1"></a>som_map <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_map</span>(</span>
<span id="cb27-685"><a href="#cb27-685" aria-hidden="true" tabindex="-1"></a>    training_samples_with_indices, </span>
<span id="cb27-686"><a href="#cb27-686" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid_xdim =</span> <span class="dv">10</span>, </span>
<span id="cb27-687"><a href="#cb27-687" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid_ydim =</span> <span class="dv">10</span>)</span>
<span id="cb27-688"><a href="#cb27-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-689"><a href="#cb27-689" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean samples by removing mixed neurons</span></span>
<span id="cb27-690"><a href="#cb27-690" aria-hidden="true" tabindex="-1"></a>samples_clean <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_clean_samples</span>(som_map)</span>
<span id="cb27-691"><a href="#cb27-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-692"><a href="#cb27-692" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize sample clustering &amp; class confusions</span></span>
<span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a>som_eval <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_evaluate_cluster</span>(som_map)</span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval)</span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_map)</span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-697"><a href="#cb27-697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-698"><a href="#cb27-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a><span class="in">                         1  2  3  4 Total</span></span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a><span class="in">  Clear_Cut_Burned_Area  0  5  0  0     5</span></span>
<span id="cb27-702"><a href="#cb27-702" aria-hidden="true" tabindex="-1"></a><span class="in">  Forest                 0  0  0  6     6</span></span>
<span id="cb27-703"><a href="#cb27-703" aria-hidden="true" tabindex="-1"></a><span class="in">  Mountainside_Forest   12  0  2  0    14</span></span>
<span id="cb27-704"><a href="#cb27-704" aria-hidden="true" tabindex="-1"></a><span class="in">  Total                 12  5  2  6    25</span></span>
<span id="cb27-705"><a href="#cb27-705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-706"><a href="#cb27-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-707"><a href="#cb27-707" aria-hidden="true" tabindex="-1"></a>::: {layout-ncol="2"}</span>
<span id="cb27-708"><a href="#cb27-708" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-h1.png)</span>{#fig-som-a}</span>
<span id="cb27-709"><a href="#cb27-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-710"><a href="#cb27-710" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-h2.png)</span>{#fig-som-freq}</span>
<span id="cb27-711"><a href="#cb27-711" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-712"><a href="#cb27-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-713"><a href="#cb27-713" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Self-Organizing Maps**</span></span>
<span id="cb27-714"><a href="#cb27-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-715"><a href="#cb27-715" aria-hidden="true" tabindex="-1"></a>For larger datasets exceeding 10,000 samples, Self-Organizing Maps provide a computationally efficient alternative through unsupervised learning that projects high-dimensional time series onto two-dimensional grids while preserving topological relationships. The sits_som_map() function configured with 10×10 neurons (100 total cells) and DTW distance metric organizes samples such that similar signatures map to nearby neurons, with learning parameters alpha=1.0 and rlen=20 following standard Kohonen optimization. Applied to the full spectral-temporal dataset (10 bands × 23 dates), the SOM evaluation plot reveals class distribution patterns across the neural grid that indicate data quality and class separability.</span>
<span id="cb27-716"><a href="#cb27-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-717"><a href="#cb27-717" aria-hidden="true" tabindex="-1"></a>Single-class neurons appearing as pure colored cells indicate well-separated classes with distinct spectral signatures, while mixed neurons containing multiple colors reveal spectral confusion requiring investigation, and empty gray cells suggest gaps in feature space not represented by training samples. The SOM frequency map showing neuron activation patterns identifies high-density neurons containing many similar samples and low-density neurons that may represent outliers or rare spectral conditions. Samples from mixed neurons were flagged for expert review, and the SOM-based cleaning through <span class="in">`sits_som_clean_samples`</span>() removed observations from neurons containing multiple classes, improving overall dataset purity while maintaining within-class variability essential for model generalization. This approach proves particularly valuable for operational REDD+ systems processing large reference datasets collected through crowdsourcing or automated methods where quality control becomes challenging at scale.</span>
<span id="cb27-718"><a href="#cb27-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-719"><a href="#cb27-719" aria-hidden="true" tabindex="-1"></a><span class="fu">### Class Imbalances</span></span>
<span id="cb27-720"><a href="#cb27-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-721"><a href="#cb27-721" aria-hidden="true" tabindex="-1"></a>Imbalanced training sets bias classifiers toward over-represented classes and inflate omission errors for rare forest types, which poses particular problems when those rare classes represent critical high-carbon-stock forests for REDD+ accounting. Our original dataset showed significant imbalance with <span class="in">`Riparian_Forest`</span> at 20.8% and <span class="in">`Clear_Cut_Burned_Area`</span> at 16.4% dominating, while Water at 1.8% and Wetland at 3.6% remained severely under-represented. This 11:1 ratio between majority and minority classes causes Random Forest algorithms to under-predict rare classes through implicit class-frequency weighting during tree construction.</span>
<span id="cb27-722"><a href="#cb27-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-723"><a href="#cb27-723" aria-hidden="true" tabindex="-1"></a>We applied a hybrid resampling strategy through sits_reduce_imbalance() that combines oversampling and undersampling approaches to achieve balanced representation. The Synthetic Minority Over-sampling Technique (SMOTE) generated synthetic samples for rare classes below 200 observations by creating realistic time series through interpolation between existing samples in feature space, while random undersampling removed samples from majority classes exceeding 400 observations to match minority class frequencies. This dual approach targets all classes toward a 200-400 sample range, reducing the majority:minority ratio from 11:1 to 2:1 while avoiding the pitfalls of either strategy alone—oversampling prevents discarding potentially informative data from majority classes, while undersampling reduces computational load.</span>
<span id="cb27-724"><a href="#cb27-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-725"><a href="#cb27-725" aria-hidden="true" tabindex="-1"></a>The post-balancing summary demonstrated dramatically improved class distribution with all nine classes falling within the target range, and comparing SOM visualizations before and after balancing revealed the transformation from large clusters dominated by <span class="in">`Riparian_Forest`</span> and <span class="in">`Clear_Cut_Burned_Area`</span> to more uniform distribution across the neural grid with better representation of minority classes. This balanced training improves classifier sensitivity to rare forest types such as degraded riparian forests and seasonally flooded forests that may have high carbon stocks but low spatial extent, directly reducing omission errors in activity data—a critical source of conservative bias in emission estimates under REDD+ accounting frameworks.</span>
<span id="cb27-726"><a href="#cb27-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-729"><a href="#cb27-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-730"><a href="#cb27-730" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-731"><a href="#cb27-731" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance samples across classes</span></span>
<span id="cb27-732"><a href="#cb27-732" aria-hidden="true" tabindex="-1"></a>samples_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_reduce_imbalance</span>(</span>
<span id="cb27-733"><a href="#cb27-733" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> training_samples_with_indices,</span>
<span id="cb27-734"><a href="#cb27-734" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_samples_over =</span> <span class="dv">200</span>,   <span class="co"># Oversample rare classes</span></span>
<span id="cb27-735"><a href="#cb27-735" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_samples_under =</span> <span class="dv">400</span>,  <span class="co"># Undersample common classes</span></span>
<span id="cb27-736"><a href="#cb27-736" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>)</span>
<span id="cb27-737"><a href="#cb27-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-738"><a href="#cb27-738" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-evaluate using SOM clustering</span></span>
<span id="cb27-739"><a href="#cb27-739" aria-hidden="true" tabindex="-1"></a>som_map_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_map</span>(</span>
<span id="cb27-740"><a href="#cb27-740" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> samples_balanced,</span>
<span id="cb27-741"><a href="#cb27-741" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid_xdim =</span> <span class="dv">10</span>,</span>
<span id="cb27-742"><a href="#cb27-742" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid_ydim =</span> <span class="dv">10</span>,</span>
<span id="cb27-743"><a href="#cb27-743" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">1.0</span>,</span>
<span id="cb27-744"><a href="#cb27-744" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance =</span> <span class="st">"dtw"</span>,</span>
<span id="cb27-745"><a href="#cb27-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">rlen =</span> <span class="dv">20</span>)</span>
<span id="cb27-746"><a href="#cb27-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-747"><a href="#cb27-747" aria-hidden="true" tabindex="-1"></a><span class="co"># Store estimates in tibble</span></span>
<span id="cb27-748"><a href="#cb27-748" aria-hidden="true" tabindex="-1"></a>som_eval_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_evaluate_cluster</span>(</span>
<span id="cb27-749"><a href="#cb27-749" aria-hidden="true" tabindex="-1"></a>    som_map_balanced)</span>
<span id="cb27-750"><a href="#cb27-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-751"><a href="#cb27-751" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize results</span></span>
<span id="cb27-752"><a href="#cb27-752" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval) </span>
<span id="cb27-753"><a href="#cb27-753" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval_balanced) </span>
<span id="cb27-754"><a href="#cb27-754" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(samples_balanced)</span>
<span id="cb27-755"><a href="#cb27-755" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-756"><a href="#cb27-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-757"><a href="#cb27-757" aria-hidden="true" tabindex="-1"></a>::: {layout-ncol="2"}</span>
<span id="cb27-758"><a href="#cb27-758" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-i1.png)</span>{#fig-som-b}</span>
<span id="cb27-759"><a href="#cb27-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-760"><a href="#cb27-760" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-h1.png)</span>{#fig-som-c}</span>
<span id="cb27-761"><a href="#cb27-761" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-762"><a href="#cb27-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-763"><a href="#cb27-763" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb27-764"><a href="#cb27-764" aria-hidden="true" tabindex="-1"></a><span class="in"># A tibble: 9 × 3</span></span>
<span id="cb27-765"><a href="#cb27-765" aria-hidden="true" tabindex="-1"></a><span class="in">  label                 count   prop</span></span>
<span id="cb27-766"><a href="#cb27-766" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;chr&gt;                 &lt;int&gt;  &lt;dbl&gt;</span></span>
<span id="cb27-767"><a href="#cb27-767" aria-hidden="true" tabindex="-1"></a><span class="in">1 Clear_Cut_Bare_Soil     400 0.134 </span></span>
<span id="cb27-768"><a href="#cb27-768" aria-hidden="true" tabindex="-1"></a><span class="in">2 Clear_Cut_Burned_Area   388 0.130 </span></span>
<span id="cb27-769"><a href="#cb27-769" aria-hidden="true" tabindex="-1"></a><span class="in">3 Clear_Cut_Vegetation    392 0.131 </span></span>
<span id="cb27-770"><a href="#cb27-770" aria-hidden="true" tabindex="-1"></a><span class="in">4 Forest                  400 0.134 </span></span>
<span id="cb27-771"><a href="#cb27-771" aria-hidden="true" tabindex="-1"></a><span class="in">5 Mountainside_Forest     211 0.0707</span></span>
<span id="cb27-772"><a href="#cb27-772" aria-hidden="true" tabindex="-1"></a><span class="in">6 Riparian_Forest         396 0.133 </span></span>
<span id="cb27-773"><a href="#cb27-773" aria-hidden="true" tabindex="-1"></a><span class="in">7 Seasonally_Flooded      384 0.129 </span></span>
<span id="cb27-774"><a href="#cb27-774" aria-hidden="true" tabindex="-1"></a><span class="in">8 Water                   200 0.0670</span></span>
<span id="cb27-775"><a href="#cb27-775" aria-hidden="true" tabindex="-1"></a><span class="in">9 Wetland                 215 0.0720</span></span>
<span id="cb27-776"><a href="#cb27-776" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-777"><a href="#cb27-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-778"><a href="#cb27-778" aria-hidden="true" tabindex="-1"></a><span class="fu">### Geographic Variance</span></span>
<span id="cb27-779"><a href="#cb27-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-780"><a href="#cb27-780" aria-hidden="true" tabindex="-1"></a>Training samples must capture spatial variability across the entire monitoring jurisdiction to avoid geographic bias where clustered sampling creates gaps with higher prediction uncertainty due to extrapolation beyond training data conditions (Meyer &amp; Pebesma, 2022). The sits_geo_dist() function quantifies this coverage by comparing two distance distributions: sample-to-sample distances measuring how far apart training points are from each other, and prediction-location-to-sample distances measuring how far each pixel in the study area lies from its nearest training sample. Ideally these distributions should align closely, indicating that every prediction location falls within the same distance range as the training samples are from each other, while mismatched distributions reveal insufficient spatial coverage in certain regions.</span>
<span id="cb27-781"><a href="#cb27-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-782"><a href="#cb27-782" aria-hidden="true" tabindex="-1"></a>The distance distribution plot comparing these two curves identifies geographic gaps where the prediction-to-sample curve extends beyond the sample-to-sample curve, indicating regions requiring additional sampling. For jurisdictional REDD+ monitoring, these gaps often occur in remote protected areas with limited field access, recent deforestation hotspots not captured during original sampling campaigns, and ecotonal boundaries with unique spectral characteristics that deviate from the main training distribution. Addressing these geographic gaps through targeted field campaigns reduces spatial uncertainty and improves model transferability across the full monitoring domain, ensuring that classification accuracy remains consistent rather than degrading in under-sampled regions where verification may be most critical.</span>
<span id="cb27-783"><a href="#cb27-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-786"><a href="#cb27-786" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-787"><a href="#cb27-787" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-788"><a href="#cb27-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-789"><a href="#cb27-789" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive jurisdiction boundary</span></span>
<span id="cb27-790"><a href="#cb27-790" aria-hidden="true" tabindex="-1"></a>bbox_cube <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_bbox</span>(cube_s2_reg) </span>
<span id="cb27-791"><a href="#cb27-791" aria-hidden="true" tabindex="-1"></a>bbox_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(</span>
<span id="cb27-792"><a href="#cb27-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">xmin =</span> aoi<span class="sc">$</span>xmin, </span>
<span id="cb27-793"><a href="#cb27-793" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> aoi<span class="sc">$</span>ymin, </span>
<span id="cb27-794"><a href="#cb27-794" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> aoi<span class="sc">$</span>xmax, </span>
<span id="cb27-795"><a href="#cb27-795" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> aoi<span class="sc">$</span>ymax),</span>
<span id="cb27-796"><a href="#cb27-796" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(aoi<span class="sc">$</span>crs))</span>
<span id="cb27-797"><a href="#cb27-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-798"><a href="#cb27-798" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sf </span></span>
<span id="cb27-799"><a href="#cb27-799" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(sf<span class="sc">::</span><span class="fu">st_as_sfc</span>(bbox_sf))</span>
<span id="cb27-800"><a href="#cb27-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-801"><a href="#cb27-801" aria-hidden="true" tabindex="-1"></a><span class="co"># Assess geographic coverage</span></span>
<span id="cb27-802"><a href="#cb27-802" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_geo_dist</span>(</span>
<span id="cb27-803"><a href="#cb27-803" aria-hidden="true" tabindex="-1"></a>    training_samples_with_indices, <span class="at">roi =</span> aoi)</span>
<span id="cb27-804"><a href="#cb27-804" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(distances)</span>
<span id="cb27-805"><a href="#cb27-805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-806"><a href="#cb27-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-807"><a href="#cb27-807" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-j.png)</span>{fig-align="center"}</span>
<span id="cb27-808"><a href="#cb27-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-809"><a href="#cb27-809" aria-hidden="true" tabindex="-1"></a>Mismatched distributions indicate insufficient spatial coverage. Areas with few nearby training samples will exhibit higher classification uncertainty, requiring either additional field sampling or explicit uncertainty quantification in those regions during accuracy assessment.</span>
<span id="cb27-810"><a href="#cb27-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-811"><a href="#cb27-811" aria-hidden="true" tabindex="-1"></a><span class="fu">### Noise Filtering</span></span>
<span id="cb27-812"><a href="#cb27-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-813"><a href="#cb27-813" aria-hidden="true" tabindex="-1"></a>Satellite time series contain noise from atmospheric contamination including residual clouds and aerosols, sensor artifacts, and geometric co-registration errors that introduce random variation obscuring genuine phenological patterns. The Whittaker smoother (<span class="in">`sits_whittaker()`</span>) applies penalized least squares regression to balance fidelity to observed values against temporal smoothness, controlled by parameter lambda where low values preserve more detail and high values enforce stronger smoothing. Applied with conservative lambda=0.5, the filtering preserved legitimate rapid changes such as abrupt deforestation events while removing high-frequency noise that degraded classification accuracy.</span>
<span id="cb27-814"><a href="#cb27-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-815"><a href="#cb27-815" aria-hidden="true" tabindex="-1"></a>Comparing filtered versus original time series across representative classes revealed the smoothing clarified underlying temporal trends; <span class="in">`Clear_Cut_Bare_Soil`</span> showed declining <span class="in">`NDVI`</span> with sharp fluctuations reduced, <span class="in">`Forest`</span> maintained stable high-<span class="in">`NDVI`</span> phenology with minor fluctuations eliminated, <span class="in">`Clear_Cut_Burned_Area`</span> revealed abrupt drops during burning events more clearly, and <span class="in">`Seasonally_Flooded`</span> preserved seasonal oscillation patterns while reducing measurement noise. For REDD+ applications, conservative filtering with lambda ≤ 1.0 is recommended to avoid smoothing over short-duration clearing events that represent genuine forest loss, ensuring that the filtered training samples provide cleaner inputs for model training while preserving the temporal dynamics essential for accurate activity data classification. Implementation details for all enhancement procedures are provided in Section 3.11.</span>
<span id="cb27-816"><a href="#cb27-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-819"><a href="#cb27-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-820"><a href="#cb27-820" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-821"><a href="#cb27-821" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Whittaker filter with conservative smoothing</span></span>
<span id="cb27-822"><a href="#cb27-822" aria-hidden="true" tabindex="-1"></a>samples_balanced_ndvi <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_select</span>(</span>
<span id="cb27-823"><a href="#cb27-823" aria-hidden="true" tabindex="-1"></a>    samples_balanced, <span class="at">bands =</span> <span class="st">"NDVI"</span>)</span>
<span id="cb27-824"><a href="#cb27-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-825"><a href="#cb27-825" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Whitakker filter</span></span>
<span id="cb27-826"><a href="#cb27-826" aria-hidden="true" tabindex="-1"></a>samples_balanced_whit <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_whittaker</span>(</span>
<span id="cb27-827"><a href="#cb27-827" aria-hidden="true" tabindex="-1"></a>    samples_balanced_ndvi, <span class="at">lambda =</span> <span class="fl">0.5</span>)</span>
<span id="cb27-828"><a href="#cb27-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-829"><a href="#cb27-829" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge to visualize</span></span>
<span id="cb27-830"><a href="#cb27-830" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_merge</span>(</span>
<span id="cb27-831"><a href="#cb27-831" aria-hidden="true" tabindex="-1"></a>    samples_balanced_ndvi, </span>
<span id="cb27-832"><a href="#cb27-832" aria-hidden="true" tabindex="-1"></a>    samples_balanced_whit,</span>
<span id="cb27-833"><a href="#cb27-833" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">".WHIT"</span>)) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb27-834"><a href="#cb27-834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-835"><a href="#cb27-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-836"><a href="#cb27-836" aria-hidden="true" tabindex="-1"></a>::: {layout-ncol="4"}</span>
<span id="cb27-837"><a href="#cb27-837" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k1a.png)</span></span>
<span id="cb27-838"><a href="#cb27-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-839"><a href="#cb27-839" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k1b.png)</span></span>
<span id="cb27-840"><a href="#cb27-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-841"><a href="#cb27-841" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k2a.png)</span></span>
<span id="cb27-842"><a href="#cb27-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-843"><a href="#cb27-843" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k2b.png)</span></span>
<span id="cb27-844"><a href="#cb27-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-845"><a href="#cb27-845" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k3a.png)</span></span>
<span id="cb27-846"><a href="#cb27-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-847"><a href="#cb27-847" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k3b.png)</span></span>
<span id="cb27-848"><a href="#cb27-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-849"><a href="#cb27-849" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k4a.png)</span></span>
<span id="cb27-850"><a href="#cb27-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-851"><a href="#cb27-851" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k4b.png)</span></span>
<span id="cb27-852"><a href="#cb27-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-853"><a href="#cb27-853" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k5a.png)</span></span>
<span id="cb27-854"><a href="#cb27-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-855"><a href="#cb27-855" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k5b.png)</span></span>
<span id="cb27-856"><a href="#cb27-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-857"><a href="#cb27-857" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k6a.png)</span></span>
<span id="cb27-858"><a href="#cb27-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-859"><a href="#cb27-859" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k6b.png)</span></span>
<span id="cb27-860"><a href="#cb27-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-861"><a href="#cb27-861" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k7a.png)</span></span>
<span id="cb27-862"><a href="#cb27-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-863"><a href="#cb27-863" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k7b.png)</span></span>
<span id="cb27-864"><a href="#cb27-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-865"><a href="#cb27-865" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k8a.png)</span></span>
<span id="cb27-866"><a href="#cb27-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-867"><a href="#cb27-867" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-k8b.png)</span></span>
<span id="cb27-868"><a href="#cb27-868" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-869"><a href="#cb27-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-870"><a href="#cb27-870" aria-hidden="true" tabindex="-1"></a>Over-smoothing (high lambda values) eliminates legitimate phenological variation, reducing model discriminatory power. Conservative filtering (lambda ≤ 1.0) balances noise reduction with pattern preservation <span class="co">[</span><span class="ot">@Atkinson2012; @Zhou2016</span><span class="co">]</span>.</span>
<span id="cb27-871"><a href="#cb27-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-872"><a href="#cb27-872" aria-hidden="true" tabindex="-1"></a>Integration with Uncertainty Workflows: Quality-controlled training data directly reduces classification uncertainty by minimizing systematic errors from mislabeling and improving model generalization. Combined with the cross-validation procedures in Section 3.8 and accuracy assessment in Section 3.9, these enhancement methods establish a rigorous foundation for defensible activity data uncertainty quantification under ART-TREES requirements.</span>
<span id="cb27-873"><a href="#cb27-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-874"><a href="#cb27-874" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.8 Smooth Data Cube</span></span>
<span id="cb27-875"><a href="#cb27-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-876"><a href="#cb27-876" aria-hidden="true" tabindex="-1"></a>Pixel-based classification inherently produces salt-and-pepper noise due to within-class spectral variability and mixed pixels. Isolated misclassified pixels surrounded by different classes represent systematic over-fitting to training data rather than true landscape heterogeneity, inflating area uncertainty and complicating change detection in REDD+ applications. The sits_smooth() function addresses this through Bayesian post-processing that incorporates spatial context from neighboring pixels to refine probability estimates. The algorithm computes spatially-weighted probability adjustments based on neighborhood composition, then updates pixel probabilities using Bayesian inference that combines original model estimates with spatial priors derived from surrounding pixels. This process produces a refined probability cube with reduced outlier effects while preserving legitimate small patches that represent genuine landscape features rather than classification artifacts.</span>
<span id="cb27-877"><a href="#cb27-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-878"><a href="#cb27-878" aria-hidden="true" tabindex="-1"></a>The smoothed Forest probability map (Figure X) demonstrates the effect—high-confidence pixels (p <span class="sc">\&gt;</span> 0.9) appear in dark green representing intact forest cores, while transitional zones along forest edges show moderate probabilities (p = 0.4-0.7) in lighter green, reflecting genuine mixed-pixel conditions rather than random noise. Spatial smoothing affects activity data uncertainty in competing directions that must be carefully balanced. The approach reduces random error by eliminating isolated misclassifications that inflate variance, and typically improves validation agreement by aligning with human interpretation scales that naturally incorporate spatial context. However, smoothing introduces potential spatial bias by potentially smoothing over legitimate small-scale heterogeneity, and modifies probability distributions in ways that change pixel-level uncertainty estimates. For REDD+ reporting, smoothed probability cubes typically yield lower reported uncertainties due to reduced classification noise, but verification bodies may require documentation of smoothing parameters demonstrating that methodological choices preserve ecologically meaningful patterns.</span>
<span id="cb27-879"><a href="#cb27-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-880"><a href="#cb27-880" aria-hidden="true" tabindex="-1"></a>Final classified maps derive from smoothed probability cubes through maximum likelihood labeling where each pixel receives the class with highest posterior probability. The <span class="in">`sits_label_classification()`</span> function performs this deterministic assignment while maintaining provenance links to underlying probability distributions, ensuring that uncertainty information remains accessible for subsequent Monte Carlo emission simulations. The classified cube (Figure X) showing all nine disturbance classes provides the activity data foundation for REDD+ accounting, though full uncertainty quantification requires additional analysis beyond discrete classification. The advanced procedures in Sections 3.9-3.10 using caret and terra packages address this need through stratified validation with area-adjusted accuracy assessment and Monte Carlo calibration workflows for robust uncertainty estimation. Implementation details for smoothing and labeling procedures are provided in Section 3.10.</span>
<span id="cb27-881"><a href="#cb27-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-884"><a href="#cb27-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-885"><a href="#cb27-885" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-886"><a href="#cb27-886" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-887"><a href="#cb27-887" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-888"><a href="#cb27-888" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb27-889"><a href="#cb27-889" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb27-890"><a href="#cb27-890" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-891"><a href="#cb27-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-892"><a href="#cb27-892" aria-hidden="true" tabindex="-1"></a><span class="co"># Bayesian smoothing </span></span>
<span id="cb27-893"><a href="#cb27-893" aria-hidden="true" tabindex="-1"></a>cube_s2_bayes <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_smooth</span>(</span>
<span id="cb27-894"><a href="#cb27-894" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube            =</span> cube_s2_probs,</span>
<span id="cb27-895"><a href="#cb27-895" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/bayes/"</span>,</span>
<span id="cb27-896"><a href="#cb27-896" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-raster"</span>, <span class="co"># adds suffix to output raster</span></span>
<span id="cb27-897"><a href="#cb27-897" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb27-898"><a href="#cb27-898" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span></span>
<span id="cb27-899"><a href="#cb27-899" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-900"><a href="#cb27-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-901"><a href="#cb27-901" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_bayes, </span>
<span id="cb27-902"><a href="#cb27-902" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Forest"</span>), </span>
<span id="cb27-903"><a href="#cb27-903" aria-hidden="true" tabindex="-1"></a>         <span class="at">palette =</span> <span class="st">"YlGn"</span></span>
<span id="cb27-904"><a href="#cb27-904" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb27-905"><a href="#cb27-905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-906"><a href="#cb27-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-907"><a href="#cb27-907" aria-hidden="true" tabindex="-1"></a><span class="al">![Smoothed probability map for class `Forest`.](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-e.png)</span>{fig-align="center"}</span>
<span id="cb27-908"><a href="#cb27-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-909"><a href="#cb27-909" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb27-910"><a href="#cb27-910" aria-hidden="true" tabindex="-1"></a><span class="fu">## Smoothing Risks</span></span>
<span id="cb27-911"><a href="#cb27-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-912"><a href="#cb27-912" aria-hidden="true" tabindex="-1"></a>Spatial smoothing affects activity data uncertainty in competing directions:</span>
<span id="cb27-913"><a href="#cb27-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-914"><a href="#cb27-914" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Reduces random error: Eliminates isolated misclassifications that inflate variance</span>
<span id="cb27-915"><a href="#cb27-915" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Introduces spatial bias: May smooth over legitimate small-scale heterogeneity</span>
<span id="cb27-916"><a href="#cb27-916" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Improves validation agreement: Better alignment with typical human interpretation scales</span>
<span id="cb27-917"><a href="#cb27-917" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Modifies probability distributions: Changes the shape of pixel-level uncertainty estimates</span>
<span id="cb27-918"><a href="#cb27-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-919"><a href="#cb27-919" aria-hidden="true" tabindex="-1"></a>For REDD+ reporting, smoothed probability cubes typically yield lower reported uncertainties due to reduced classification noise, but verification bodies may require documentation of smoothing parameters demonstrating methodological choices.</span>
<span id="cb27-920"><a href="#cb27-920" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-921"><a href="#cb27-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-922"><a href="#cb27-922" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb27-923"><a href="#cb27-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-924"><a href="#cb27-924" aria-hidden="true" tabindex="-1"></a>Final classified maps are derived from smoothed probability cubes through maximum likelihood labeling: each pixel is assigned the class with highest posterior probability. The <span class="in">`sits_label_classification()`</span> function performs this deterministic assignment while maintaining provenance links to underlying probability distributions.</span>
<span id="cb27-925"><a href="#cb27-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-928"><a href="#cb27-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-929"><a href="#cb27-929" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-930"><a href="#cb27-930" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-931"><a href="#cb27-931" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-932"><a href="#cb27-932" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb27-933"><a href="#cb27-933" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb27-934"><a href="#cb27-934" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-935"><a href="#cb27-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-936"><a href="#cb27-936" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive lulc-classified raster</span></span>
<span id="cb27-937"><a href="#cb27-937" aria-hidden="true" tabindex="-1"></a>cube_s2_lulc <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_label_classification</span>(</span>
<span id="cb27-938"><a href="#cb27-938" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube                =</span> cube_s2_bayes,</span>
<span id="cb27-939"><a href="#cb27-939" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb27-940"><a href="#cb27-940" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span>,</span>
<span id="cb27-941"><a href="#cb27-941" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/classified/"</span>,</span>
<span id="cb27-942"><a href="#cb27-942" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-raster"</span></span>
<span id="cb27-943"><a href="#cb27-943" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-944"><a href="#cb27-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-945"><a href="#cb27-945" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb27-946"><a href="#cb27-946" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_lulc, <span class="at">legend_text_size =</span> <span class="fl">0.7</span>)</span>
<span id="cb27-947"><a href="#cb27-947" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-948"><a href="#cb27-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-949"><a href="#cb27-949" aria-hidden="true" tabindex="-1"></a><span class="al">![Classified cube obtained by Random Forest model.](https://raw.githubusercontent.com/training-resource/uncertainty/refs/heads/main/03-activity-data/assets/images/png/activity-data-f.png)</span></span>
<span id="cb27-950"><a href="#cb27-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-951"><a href="#cb27-951" aria-hidden="true" tabindex="-1"></a>The classified cube produced by <span class="in">`sits`</span> workflows provides the activity data foundation for REDD+ accounting, but uncertainty quantification requires additional analysis beyond the discrete classification procedures. Sections 3.2-3.5 demonstrate more more advanced operations using <span class="in">`caret`</span> <span class="co">[</span><span class="ot">@kuhn2011caret</span><span class="co">]</span>, <span class="in">`ForestToolbox`</span> <span class="co">[</span><span class="ot">@ForesToolboxRS</span><span class="co">]</span>, and <span class="in">`terra`</span> packages <span class="co">[</span><span class="ot">@terra-2</span><span class="co">]</span> required to:</span>
<span id="cb27-952"><a href="#cb27-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-953"><a href="#cb27-953" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Extract pixel-level probability distributions for Monte Carlo sampling (Section 3.3)</span>
<span id="cb27-954"><a href="#cb27-954" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Implement stratified validation with area-adjusted accuracy assessment (Section 3.4)</span>
<span id="cb27-955"><a href="#cb27-955" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Calibrate Random Forest hyperparameters through iterative uncertainty minimization (Section 3.5)</span>
<span id="cb27-956"><a href="#cb27-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-957"><a href="#cb27-957" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb27-958"><a href="#cb27-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-959"><a href="#cb27-959" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.8 Cross-Validation</span></span>
<span id="cb27-960"><a href="#cb27-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-961"><a href="#cb27-961" aria-hidden="true" tabindex="-1"></a>Cross-validation quantifies model generalization capacity by partitioning training data into independent subsets for iterative testing. To integrate sits time series data with caret-based validation workflows, we first converted the nested time series structure into a tabular feature matrix suitable for Monte Carlo simulation. For each of the 6,007 training samples, we extracted six statistical summaries across the temporal dimension: mean and standard deviation for NIR (<span class="in">`B8A`</span>), SWIR (<span class="in">`B11`</span>), and <span class="in">`NDVI`</span>. This feature engineering reduces the 230-dimensional input space (10 bands × 23 dates) to a 6-dimensional summary statistics space that enables rapid iterative testing while maintaining discriminatory power for the nine disturbance classes. Although this simplified representation loses some temporal resolution compared to the full time series used in sits classification, it provides computational efficiency essential for Monte Carlo simulation requiring thousands of iterations to achieve ART-TREES compliance.</span>
<span id="cb27-962"><a href="#cb27-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-963"><a href="#cb27-963" aria-hidden="true" tabindex="-1"></a>Now, let's Extract statistical summaries from <span class="in">`sits`</span> time series for <span class="in">`caret`</span> compatibility:</span>
<span id="cb27-964"><a href="#cb27-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-967"><a href="#cb27-967" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-968"><a href="#cb27-968" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb27-969"><a href="#cb27-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-970"><a href="#cb27-970" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract features from cube samples</span></span>
<span id="cb27-971"><a href="#cb27-971" aria-hidden="true" tabindex="-1"></a>extract_features <span class="ot">&lt;-</span> <span class="cf">function</span>(sits_samples) {</span>
<span id="cb27-972"><a href="#cb27-972" aria-hidden="true" tabindex="-1"></a>  features_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sits_samples), <span class="cf">function</span>(i) {</span>
<span id="cb27-973"><a href="#cb27-973" aria-hidden="true" tabindex="-1"></a>    ts <span class="ot">&lt;-</span> sits_samples<span class="sc">$</span>time_series[[i]]</span>
<span id="cb27-974"><a href="#cb27-974" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb27-975"><a href="#cb27-975" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> sits_samples<span class="sc">$</span>label[i],</span>
<span id="cb27-976"><a href="#cb27-976" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_B8A =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>B8A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-977"><a href="#cb27-977" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_B8A =</span> <span class="fu">sd</span>(ts<span class="sc">$</span>B8A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-978"><a href="#cb27-978" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_B11 =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>B11, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-979"><a href="#cb27-979" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_B11 =</span> <span class="fu">sd</span>(ts<span class="sc">$</span>B11, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-980"><a href="#cb27-980" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_NDVI =</span> <span class="fu">mean</span>((ts<span class="sc">$</span>B8A <span class="sc">-</span> ts<span class="sc">$</span>B04) <span class="sc">/</span> (ts<span class="sc">$</span>B8A <span class="sc">+</span> ts<span class="sc">$</span>B04), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-981"><a href="#cb27-981" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_NDVI =</span> <span class="fu">sd</span>((ts<span class="sc">$</span>B8A <span class="sc">-</span> ts<span class="sc">$</span>B04) <span class="sc">/</span> (ts<span class="sc">$</span>B8A <span class="sc">+</span> ts<span class="sc">$</span>B04), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-982"><a href="#cb27-982" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-983"><a href="#cb27-983" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb27-984"><a href="#cb27-984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, features_list)</span>
<span id="cb27-985"><a href="#cb27-985" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-986"><a href="#cb27-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-987"><a href="#cb27-987" aria-hidden="true" tabindex="-1"></a>train_features <span class="ot">&lt;-</span> <span class="fu">extract_features</span>(samples_deforestation_rondonia)</span>
<span id="cb27-988"><a href="#cb27-988" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-989"><a href="#cb27-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-990"><a href="#cb27-990" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monte Carlo Cross-Validation</span></span>
<span id="cb27-991"><a href="#cb27-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-992"><a href="#cb27-992" aria-hidden="true" tabindex="-1"></a>We implemented Monte Carlo Leave-Group-Out Cross-Validation (LGOCV) to quantify model stability and generalization capacity through repeated random partitioning. The simulation configuration used 75% calibration and 25% validation splits across 10 iterations for demonstration purposes, though ART-TREES requirements for activity data uncertainty demand 10,000 iterations for statistically robust performance estimates. This dramatic increase from demonstration to operational scale reflects the need to stabilize mean performance estimates, quantify variance across different data partitions, capture rare failure modes in specific train-test combinations, and meet statistical significance thresholds for MRV reporting. Each iteration randomly partitioned the feature dataset while maintaining class proportions, fitted a Random Forest with 120 trees optimized for Kappa statistic (which accounts for class imbalance better than raw accuracy), and generated predictions on the withheld validation set.</span>
<span id="cb27-993"><a href="#cb27-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-994"><a href="#cb27-994" aria-hidden="true" tabindex="-1"></a>The cross-validation summary demonstrates model stability across iterations with mean accuracy of 70.9% (±1.5%) and mean Kappa of 0.656 (±0.017). The low standard deviations indicate consistent performance despite random partitioning, suggesting the model generalizes well to unseen data. However, the moderate Kappa value around 0.66 indicates room for improvement through additional training samples in confused classes, hyperparameter optimization, or integration of ancillary data such as elevation or soil maps. These metrics would feed directly into ART-TREES Equation 11 for activity data uncertainty deductions, where the relative standard deviation of cross-validated predictions determines the half-width of the 90% confidence interval used in carbon credit calculations. The demonstration with 10 iterations provides proof-of-concept, but operational implementation requires scaling to thousands of iterations to meet ART-TREES statistical confidence requirements.</span>
<span id="cb27-995"><a href="#cb27-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-998"><a href="#cb27-998" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-999"><a href="#cb27-999" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb27-1000"><a href="#cb27-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1001"><a href="#cb27-1001" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure Monte Carlo simulation</span></span>
<span id="cb27-1002"><a href="#cb27-1002" aria-hidden="true" tabindex="-1"></a>mc_simulation <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(</span>
<span id="cb27-1003"><a href="#cb27-1003" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"LGOCV"</span>,</span>
<span id="cb27-1004"><a href="#cb27-1004" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>, <span class="co"># Increase to 10,000 iterations for ART-TREES submissions</span></span>
<span id="cb27-1005"><a href="#cb27-1005" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.75</span>, <span class="co"># 75:25% split</span></span>
<span id="cb27-1006"><a href="#cb27-1006" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb27-1007"><a href="#cb27-1007" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-1008"><a href="#cb27-1008" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> caret<span class="sc">::</span>multiClassSummary</span>
<span id="cb27-1009"><a href="#cb27-1009" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1010"><a href="#cb27-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1011"><a href="#cb27-1011" aria-hidden="true" tabindex="-1"></a><span class="co"># Train over monte carlo simulation</span></span>
<span id="cb27-1012"><a href="#cb27-1012" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb27-1013"><a href="#cb27-1013" aria-hidden="true" tabindex="-1"></a>model_randomRandom_mc <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb27-1014"><a href="#cb27-1014" aria-hidden="true" tabindex="-1"></a>  label <span class="sc">~</span> .,</span>
<span id="cb27-1015"><a href="#cb27-1015" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_features,</span>
<span id="cb27-1016"><a href="#cb27-1016" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb27-1017"><a href="#cb27-1017" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> mc_simulation,</span>
<span id="cb27-1018"><a href="#cb27-1018" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Kappa"</span>,</span>
<span id="cb27-1019"><a href="#cb27-1019" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">120</span></span>
<span id="cb27-1020"><a href="#cb27-1020" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1021"><a href="#cb27-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1022"><a href="#cb27-1022" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize stability</span></span>
<span id="cb27-1023"><a href="#cb27-1023" aria-hidden="true" tabindex="-1"></a>model_randomRandom_mc_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-1024"><a href="#cb27-1024" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">"Accuracy"</span>, <span class="st">"Kappa"</span>),</span>
<span id="cb27-1025"><a href="#cb27-1025" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">c</span>(<span class="fu">mean</span>(model_randomRandom_mc<span class="sc">$</span>resample<span class="sc">$</span>Accuracy), <span class="fu">mean</span>(model_randomRandom_mc<span class="sc">$</span>resample<span class="sc">$</span>Kappa)),</span>
<span id="cb27-1026"><a href="#cb27-1026" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">c</span>(<span class="fu">sd</span>(model_randomRandom_mc<span class="sc">$</span>resample<span class="sc">$</span>Accuracy), <span class="fu">sd</span>(model_randomRandom_mc<span class="sc">$</span>resample<span class="sc">$</span>Kappa))</span>
<span id="cb27-1027"><a href="#cb27-1027" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1028"><a href="#cb27-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1029"><a href="#cb27-1029" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">flextable</span>(model_randomRandom_mc_summary) <span class="sc">|&gt;</span></span>
<span id="cb27-1030"><a href="#cb27-1030" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">fontsize</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">part =</span> <span class="st">"body"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-1031"><a href="#cb27-1031" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">fontsize</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">part =</span> <span class="st">"footer"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-1032"><a href="#cb27-1032" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">set_table_properties</span>(<span class="at">layout =</span> <span class="st">"autofit"</span>, <span class="at">width=</span><span class="dv">1</span>, <span class="at">align =</span> <span class="st">"center"</span>) </span>
<span id="cb27-1033"><a href="#cb27-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1034"><a href="#cb27-1034" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1035"><a href="#cb27-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1036"><a href="#cb27-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.9 Accuracy Assessment</span></span>
<span id="cb27-1037"><a href="#cb27-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1038"><a href="#cb27-1038" aria-hidden="true" tabindex="-1"></a>Accuracy assessment quantifies classification performance against independent reference data through stratified train-test partitioning that ensures adequate representation across all nine forest disturbance classes. We partitioned the feature dataset into training (80%, n≈4,806) and testing (20%, n≈1,201) subsets using stratified random sampling that maintains original class proportions in both subsets. This prevents bias from over- or under-representing rare classes during evaluation, which becomes critical given our 11:1 imbalance between majority and minority classes. All class labels were converted to factors with consistent levels across training and testing sets to prevent errors when rare classes appear in only one subset—a common issue with imbalanced datasets that causes prediction failures during validation. The model trained on the 80% calibration set with 120 Random Forest trees was then evaluated on the withheld 20% test set to generate confusion matrix statistics.</span>
<span id="cb27-1039"><a href="#cb27-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1040"><a href="#cb27-1040" aria-hidden="true" tabindex="-1"></a>The confusion matrix quantifies classification performance by comparing predicted labels against reference labels for the 1,201 withheld test samples, revealing both overall accuracy and class-specific error patterns critical for REDD+ uncertainty assessment. Overall performance achieved 73.9% accuracy (95% CI: 71.4-76.4%) with Kappa of 0.692, significantly better than random assignment (p <span class="sc">\&lt;</span> 2.2e-16) and indicating moderate agreement beyond chance. Class-specific performance varied dramatically, with high-performing classes achieving sensitivity above 85%—Water reached 100% sensitivity with 95.5% precision through its distinctive spectral signature, Riparian_Forest achieved 88% sensitivity despite constituting 20.8% of the dataset, and <span class="in">`Forest`</span> showed 86.5% sensitivity representing core forest discrimination. Moderate performers included <span class="in">`Clear_Cut_Burned_Area`</span> at 73.5% sensitivity, <span class="in">`Seasonally_Flooded`</span> at 69.2%, and <span class="in">`Clear_Cut_Bare_Soil`</span> at 69.2%, while <span class="in">`Mountainside_Forest`</span> suffered severe under-<span class="in">`prediction`</span> at only 7.1% sensitivity.</span>
<span id="cb27-1041"><a href="#cb27-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1042"><a href="#cb27-1042" aria-hidden="true" tabindex="-1"></a>The critical failure in <span class="in">`Mountainside_Forest`</span> classification with 7.1% sensitivity stems from its low prevalence in the training set (3.5% of samples), spectral overlap with other forest types, and topographic effects not captured in spectral features alone. Key confusion patterns emerged between <span class="in">`Clear_Cut_Bare_Soil`</span> and <span class="in">`Clear_Cut_Burned_Area`</span> (72 total misclassifications) due to similar bare soil signatures, among forest types (<span class="in">`Forest`</span>, <span class="in">`Mountainside_Forest`</span>, <span class="in">`Riparian_Forest`</span>) sharing vegetation characteristics, and between hydrological classes (<span class="in">`Seasonally_Flooded`</span> and Wetland<span class="in">`)`</span> with overlapping seasonal inundation dynamics. For REDD+ implications, the 73.9% accuracy translates to approximately 26% activity data uncertainty before applying ART-TREES area adjustment corrections. Class-specific errors, particularly the Mountainside_Forest omissions, would inflate uncertainty in jurisdictions with significant topographic variability, requiring either targeted training sample augmentation for rare classes, stratified validation with higher sampling density in confused regions, or integration of DEM-derived topographic variables as additional features. Implementation details for accuracy assessment procedures are provided in Section 3.10.</span>
<span id="cb27-1043"><a href="#cb27-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1046"><a href="#cb27-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-1047"><a href="#cb27-1047" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb27-1048"><a href="#cb27-1048" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure consistent factor levels</span></span>
<span id="cb27-1049"><a href="#cb27-1049" aria-hidden="true" tabindex="-1"></a>all_classes <span class="ot">&lt;-</span> <span class="fu">unique</span>(train_features<span class="sc">$</span>label)</span>
<span id="cb27-1050"><a href="#cb27-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1051"><a href="#cb27-1051" aria-hidden="true" tabindex="-1"></a><span class="co"># Stratified partition</span></span>
<span id="cb27-1052"><a href="#cb27-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb27-1053"><a href="#cb27-1053" aria-hidden="true" tabindex="-1"></a>train_idx <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(</span>
<span id="cb27-1054"><a href="#cb27-1054" aria-hidden="true" tabindex="-1"></a>  train_features<span class="sc">$</span>label,</span>
<span id="cb27-1055"><a href="#cb27-1055" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.8</span>,</span>
<span id="cb27-1056"><a href="#cb27-1056" aria-hidden="true" tabindex="-1"></a>  <span class="at">list =</span> <span class="cn">FALSE</span></span>
<span id="cb27-1057"><a href="#cb27-1057" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1058"><a href="#cb27-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1059"><a href="#cb27-1059" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_features[train_idx, ]</span>
<span id="cb27-1060"><a href="#cb27-1060" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> train_features[<span class="sc">-</span>train_idx, ]</span>
<span id="cb27-1061"><a href="#cb27-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1062"><a href="#cb27-1062" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure labels are factors with same levels</span></span>
<span id="cb27-1063"><a href="#cb27-1063" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data<span class="sc">$</span>label, <span class="at">levels =</span> all_classes)</span>
<span id="cb27-1064"><a href="#cb27-1064" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data<span class="sc">$</span>label, <span class="at">levels =</span> all_classes)</span>
<span id="cb27-1065"><a href="#cb27-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1066"><a href="#cb27-1066" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model</span></span>
<span id="cb27-1067"><a href="#cb27-1067" aria-hidden="true" tabindex="-1"></a>accuracy_model <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb27-1068"><a href="#cb27-1068" aria-hidden="true" tabindex="-1"></a>  label <span class="sc">~</span> .,</span>
<span id="cb27-1069"><a href="#cb27-1069" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb27-1070"><a href="#cb27-1070" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb27-1071"><a href="#cb27-1071" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">120</span>,</span>
<span id="cb27-1072"><a href="#cb27-1072" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-1073"><a href="#cb27-1073" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"none"</span>)</span>
<span id="cb27-1074"><a href="#cb27-1074" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1075"><a href="#cb27-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1076"><a href="#cb27-1076" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb27-1077"><a href="#cb27-1077" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(accuracy_model, test_data)</span>
<span id="cb27-1078"><a href="#cb27-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1079"><a href="#cb27-1079" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure predictions have same levels</span></span>
<span id="cb27-1080"><a href="#cb27-1080" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">factor</span>(predictions, <span class="at">levels =</span> all_classes)</span>
<span id="cb27-1081"><a href="#cb27-1081" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1082"><a href="#cb27-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1083"><a href="#cb27-1083" aria-hidden="true" tabindex="-1"></a><span class="fu">### Confusion Matrix</span></span>
<span id="cb27-1084"><a href="#cb27-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1087"><a href="#cb27-1087" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-1088"><a href="#cb27-1088" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb27-1089"><a href="#cb27-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1090"><a href="#cb27-1090" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate confusion matrix</span></span>
<span id="cb27-1091"><a href="#cb27-1091" aria-hidden="true" tabindex="-1"></a>confMatrix <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb27-1092"><a href="#cb27-1092" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> predictions,</span>
<span id="cb27-1093"><a href="#cb27-1093" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> test_data<span class="sc">$</span>label</span>
<span id="cb27-1094"><a href="#cb27-1094" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1095"><a href="#cb27-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1096"><a href="#cb27-1096" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confMatrix)</span>
<span id="cb27-1097"><a href="#cb27-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1098"><a href="#cb27-1098" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract metrics</span></span>
<span id="cb27-1099"><a href="#cb27-1099" aria-hidden="true" tabindex="-1"></a>accuracy_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-1100"><a href="#cb27-1100" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">"Overall Accuracy"</span>, <span class="st">"Kappa"</span>, <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span>),</span>
<span id="cb27-1101"><a href="#cb27-1101" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">round</span>(<span class="fu">c</span>(</span>
<span id="cb27-1102"><a href="#cb27-1102" aria-hidden="true" tabindex="-1"></a>    confMatrix<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>],</span>
<span id="cb27-1103"><a href="#cb27-1103" aria-hidden="true" tabindex="-1"></a>    confMatrix<span class="sc">$</span>overall[<span class="st">"Kappa"</span>],</span>
<span id="cb27-1104"><a href="#cb27-1104" aria-hidden="true" tabindex="-1"></a>    confMatrix<span class="sc">$</span>overall[<span class="st">"AccuracyLower"</span>],</span>
<span id="cb27-1105"><a href="#cb27-1105" aria-hidden="true" tabindex="-1"></a>    confMatrix<span class="sc">$</span>overall[<span class="st">"AccuracyUpper"</span>]</span>
<span id="cb27-1106"><a href="#cb27-1106" aria-hidden="true" tabindex="-1"></a>  ), <span class="dv">4</span>)</span>
<span id="cb27-1107"><a href="#cb27-1107" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1108"><a href="#cb27-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1109"><a href="#cb27-1109" aria-hidden="true" tabindex="-1"></a>accuracy_metrics <span class="sc">|&gt;</span></span>
<span id="cb27-1110"><a href="#cb27-1110" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">flextable</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-1111"><a href="#cb27-1111" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">fontsize</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">part =</span> <span class="st">"body"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-1112"><a href="#cb27-1112" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">fontsize</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">part =</span> <span class="st">"footer"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-1113"><a href="#cb27-1113" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">set_table_properties</span>(<span class="at">layout =</span> <span class="st">"autofit"</span>, <span class="at">width=</span><span class="dv">1</span>, <span class="at">align =</span> <span class="st">"center"</span>) </span>
<span id="cb27-1114"><a href="#cb27-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1115"><a href="#cb27-1115" aria-hidden="true" tabindex="-1"></a>confMatrix</span>
<span id="cb27-1116"><a href="#cb27-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1117"><a href="#cb27-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1118"><a href="#cb27-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.10 Reproducible Workflow</span></span>
<span id="cb27-1119"><a href="#cb27-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1122"><a href="#cb27-1122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-1123"><a href="#cb27-1123" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb27-1124"><a href="#cb27-1124" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb27-1125"><a href="#cb27-1125" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-1126"><a href="#cb27-1126" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb27-1127"><a href="#cb27-1127" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb27-1128"><a href="#cb27-1128" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb27-1129"><a href="#cb27-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1130"><a href="#cb27-1130" aria-hidden="true" tabindex="-1"></a><span class="co"># Environment Setup</span></span>
<span id="cb27-1131"><a href="#cb27-1131" aria-hidden="true" tabindex="-1"></a>easypackages<span class="sc">::</span><span class="fu">packages</span>(</span>
<span id="cb27-1132"><a href="#cb27-1132" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bslib"</span>, <span class="st">"caret"</span>, <span class="st">"cols4all"</span>, <span class="st">"covr"</span>, <span class="st">"cowplot"</span>, <span class="st">"dendextend"</span>, <span class="st">"digest"</span>,<span class="st">"DiagrammeR"</span>, <span class="st">"dtwclust"</span>, <span class="st">"downlit"</span>, </span>
<span id="cb27-1133"><a href="#cb27-1133" aria-hidden="true" tabindex="-1"></a>  <span class="st">"devtools"</span>, <span class="st">"e1071"</span>, <span class="st">"exactextractr"</span>,<span class="st">"elevatr"</span>, <span class="st">"FNN"</span>, <span class="st">"future"</span>, <span class="st">"forestdata"</span>,<span class="st">"gdalcubes"</span>, <span class="st">"gdalUtilities"</span>, </span>
<span id="cb27-1134"><a href="#cb27-1134" aria-hidden="true" tabindex="-1"></a>  <span class="st">"geojsonsf"</span>, <span class="st">"geos"</span>, <span class="st">"ggplot2"</span>, <span class="st">"ggstats"</span>, <span class="st">"ggspatial"</span>, <span class="st">"ggmap"</span>, <span class="st">"ggplotify"</span>, <span class="st">"ggpubr"</span>, <span class="st">"ggrepel"</span>, </span>
<span id="cb27-1135"><a href="#cb27-1135" aria-hidden="true" tabindex="-1"></a>  <span class="st">"giscoR"</span>, <span class="st">"hdf5r"</span>, <span class="st">"httr"</span>, <span class="st">"httr2"</span>, <span class="st">"htmltools"</span>, <span class="st">"jsonlite"</span>, <span class="st">"kohonen"</span>, <span class="st">"leafem"</span>, <span class="st">"leaflet.providers"</span>, </span>
<span id="cb27-1136"><a href="#cb27-1136" aria-hidden="true" tabindex="-1"></a>  <span class="st">"libgeos"</span>,<span class="st">"luz"</span>,<span class="st">"lwgeom"</span>, <span class="st">"leaflet"</span>, <span class="st">"leafgl"</span>, <span class="st">"MLmetrics"</span>, <span class="st">"mapedit"</span>, <span class="st">"mapview"</span>, <span class="st">"maptiles"</span>, <span class="st">"methods"</span>, </span>
<span id="cb27-1137"><a href="#cb27-1137" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mgcv"</span>, <span class="st">"ncdf4"</span>, <span class="st">"nnet"</span>, <span class="st">"openxlsx"</span>, <span class="st">"parallel"</span>, <span class="st">"plotly"</span>, <span class="st">"randomForestExplainer"</span>,<span class="st">"randomForest"</span>, </span>
<span id="cb27-1138"><a href="#cb27-1138" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rasterVis"</span>, <span class="st">"raster"</span>, <span class="st">"Rcpp"</span>, <span class="st">"RcppArmadillo"</span>, <span class="st">"RcppCensSpatial"</span>, <span class="st">"rayshader"</span>, <span class="st">"RcppEigen"</span>, <span class="st">"RcppParallel"</span>, </span>
<span id="cb27-1139"><a href="#cb27-1139" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RColorBrewer"</span>, <span class="st">"reactable"</span>, <span class="st">"rgl"</span>, <span class="st">"rsconnect"</span>,<span class="st">"RStoolbox"</span>, <span class="st">"rts"</span>, <span class="st">"s2"</span>, <span class="st">"sf"</span>, <span class="st">"scales"</span>, <span class="st">"sits"</span>, <span class="st">"sitsdata"</span>,   </span>
<span id="cb27-1140"><a href="#cb27-1140" aria-hidden="true" tabindex="-1"></a>  <span class="st">"spdep"</span>, <span class="st">"stars"</span>, <span class="st">"stringr"</span>,<span class="st">"supercells"</span>, <span class="st">"smotefamily"</span>, <span class="st">"terra"</span>, <span class="st">"testthat"</span>, <span class="st">"tidyverse"</span>, <span class="st">"tidyterra"</span>, </span>
<span id="cb27-1141"><a href="#cb27-1141" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tools"</span>, <span class="st">"torch"</span>, <span class="st">"tmap"</span>, <span class="st">"tmaptools"</span>, <span class="st">"terrainr"</span>, <span class="st">"xgboost"</span>, <span class="st">"webshot"</span>, <span class="st">"webshot2"</span>, <span class="at">prompt =</span> F)</span>
<span id="cb27-1142"><a href="#cb27-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1143"><a href="#cb27-1143" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="at">use_s2 =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-1144"><a href="#cb27-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1145"><a href="#cb27-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1146"><a href="#cb27-1146" aria-hidden="true" tabindex="-1"></a><span class="co"># Assemble Data Cube</span></span>
<span id="cb27-1147"><a href="#cb27-1147" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb27-1148"><a href="#cb27-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1149"><a href="#cb27-1149" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data cube from Microsoft Planetary Computer ARD</span></span>
<span id="cb27-1150"><a href="#cb27-1150" aria-hidden="true" tabindex="-1"></a>cube_s2_raw <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube</span>(</span>
<span id="cb27-1151"><a href="#cb27-1151" aria-hidden="true" tabindex="-1"></a>  <span class="at">source            =</span> <span class="st">"MPC"</span>,</span>
<span id="cb27-1152"><a href="#cb27-1152" aria-hidden="true" tabindex="-1"></a>  <span class="at">collection    =</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span id="cb27-1153"><a href="#cb27-1153" aria-hidden="true" tabindex="-1"></a>  <span class="at">tiles             =</span> <span class="st">"20LMR"</span>,</span>
<span id="cb27-1154"><a href="#cb27-1154" aria-hidden="true" tabindex="-1"></a>  <span class="at">bands             =</span> <span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"CLOUD"</span>),</span>
<span id="cb27-1155"><a href="#cb27-1155" aria-hidden="true" tabindex="-1"></a>  <span class="at">start_date    =</span> <span class="st">"2022-01-01"</span>,</span>
<span id="cb27-1156"><a href="#cb27-1156" aria-hidden="true" tabindex="-1"></a>  <span class="at">end_date      =</span> <span class="st">"2022-12-31"</span>)</span>
<span id="cb27-1157"><a href="#cb27-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1158"><a href="#cb27-1158" aria-hidden="true" tabindex="-1"></a><span class="co"># Check timelines of assembled tiles</span></span>
<span id="cb27-1159"><a href="#cb27-1159" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_timeline</span>(cube_s2_raw)</span>
<span id="cb27-1160"><a href="#cb27-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1161"><a href="#cb27-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1162"><a href="#cb27-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1163"><a href="#cb27-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1164"><a href="#cb27-1164" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize Data Cube</span></span>
<span id="cb27-1165"><a href="#cb27-1165" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb27-1166"><a href="#cb27-1166" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb27-1167"><a href="#cb27-1167" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy cube to local files</span></span>
<span id="cb27-1168"><a href="#cb27-1168" aria-hidden="true" tabindex="-1"></a>cube_s2_local <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube_copy</span>(</span>
<span id="cb27-1169"><a href="#cb27-1169" aria-hidden="true" tabindex="-1"></a>  <span class="at">cube          =</span> cube_s2_raw,</span>
<span id="cb27-1170"><a href="#cb27-1170" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/raw/"</span>)</span>
<span id="cb27-1171"><a href="#cb27-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1172"><a href="#cb27-1172" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize cube from local files</span></span>
<span id="cb27-1173"><a href="#cb27-1173" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_regularize</span>(</span>
<span id="cb27-1174"><a href="#cb27-1174" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube                =</span> cube_s2_local,</span>
<span id="cb27-1175"><a href="#cb27-1175" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/reg/"</span>,</span>
<span id="cb27-1176"><a href="#cb27-1176" aria-hidden="true" tabindex="-1"></a>    <span class="at">res         =</span> <span class="dv">40</span>,</span>
<span id="cb27-1177"><a href="#cb27-1177" aria-hidden="true" tabindex="-1"></a>    <span class="at">period      =</span> <span class="st">"P16D"</span>,</span>
<span id="cb27-1178"><a href="#cb27-1178" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">6</span>)</span>
<span id="cb27-1179"><a href="#cb27-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1180"><a href="#cb27-1180" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute spectral index bands for cube</span></span>
<span id="cb27-1181"><a href="#cb27-1181" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb27-1182"><a href="#cb27-1182" aria-hidden="true" tabindex="-1"></a>    <span class="at">data      =</span> cube_s2_reg,</span>
<span id="cb27-1183"><a href="#cb27-1183" aria-hidden="true" tabindex="-1"></a>    <span class="at">NDVI      =</span> (B08 <span class="sc">-</span> B04)<span class="sc">/</span>(B08 <span class="sc">+</span> B04),</span>
<span id="cb27-1184"><a href="#cb27-1184" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir=</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb27-1185"><a href="#cb27-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1186"><a href="#cb27-1186" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb27-1187"><a href="#cb27-1187" aria-hidden="true" tabindex="-1"></a>    <span class="at">data   =</span> cube_s2_reg,</span>
<span id="cb27-1188"><a href="#cb27-1188" aria-hidden="true" tabindex="-1"></a>    <span class="at">NBR    =</span> (B08 <span class="sc">-</span> B12) <span class="sc">/</span> (B08 <span class="sc">+</span> B12),</span>
<span id="cb27-1189"><a href="#cb27-1189" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb27-1190"><a href="#cb27-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1191"><a href="#cb27-1191" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb27-1192"><a href="#cb27-1192" aria-hidden="true" tabindex="-1"></a>    <span class="at">data                =</span> cube_s2_reg,</span>
<span id="cb27-1193"><a href="#cb27-1193" aria-hidden="true" tabindex="-1"></a>    <span class="at">EVI                 =</span> <span class="fl">2.5</span> <span class="sc">*</span> (B08 <span class="sc">-</span> B04) <span class="sc">/</span> ((B08 <span class="sc">+</span> <span class="fl">6.0</span> <span class="sc">*</span> B04 <span class="sc">-</span> <span class="fl">7.5</span> <span class="sc">*</span> B02) <span class="sc">+</span> <span class="fl">1.0</span>),</span>
<span id="cb27-1194"><a href="#cb27-1194" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb27-1195"><a href="#cb27-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1196"><a href="#cb27-1196" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cube structure</span></span>
<span id="cb27-1197"><a href="#cb27-1197" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(cube_s2_reg)</span>
<span id="cb27-1198"><a href="#cb27-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1199"><a href="#cb27-1199" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot single-date RGB image</span></span>
<span id="cb27-1200"><a href="#cb27-1200" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_reg, </span>
<span id="cb27-1201"><a href="#cb27-1201" aria-hidden="true" tabindex="-1"></a>         <span class="at">red =</span> <span class="st">"B11"</span>, </span>
<span id="cb27-1202"><a href="#cb27-1202" aria-hidden="true" tabindex="-1"></a>         <span class="at">green =</span> <span class="st">"B8A"</span>, </span>
<span id="cb27-1203"><a href="#cb27-1203" aria-hidden="true" tabindex="-1"></a>         <span class="at">blue =</span> <span class="st">"B02"</span>, </span>
<span id="cb27-1204"><a href="#cb27-1204" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="st">"2022-07-16"</span>)</span>
<span id="cb27-1205"><a href="#cb27-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1206"><a href="#cb27-1206" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> </span>
<span id="cb27-1207"><a href="#cb27-1207" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1208"><a href="#cb27-1208" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb27-1209"><a href="#cb27-1209" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1210"><a href="#cb27-1210" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===</span>                                                                   <span class="er">|</span>   <span class="dv">4</span>%</span>
<span id="cb27-1211"><a href="#cb27-1211" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1212"><a href="#cb27-1212" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======</span>                                                                <span class="er">|</span>   <span class="dv">9</span>%</span>
<span id="cb27-1213"><a href="#cb27-1213" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1214"><a href="#cb27-1214" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=========</span>                                                             <span class="er">|</span>  <span class="dv">13</span>%</span>
<span id="cb27-1215"><a href="#cb27-1215" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1216"><a href="#cb27-1216" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============</span>                                                          <span class="er">|</span>  <span class="dv">17</span>%</span>
<span id="cb27-1217"><a href="#cb27-1217" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1218"><a href="#cb27-1218" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===============</span>                                                       <span class="er">|</span>  <span class="dv">22</span>%</span>
<span id="cb27-1219"><a href="#cb27-1219" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1220"><a href="#cb27-1220" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================</span>                                                    <span class="er">|</span>  <span class="dv">26</span>%</span>
<span id="cb27-1221"><a href="#cb27-1221" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1222"><a href="#cb27-1222" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================</span>                                                 <span class="er">|</span>  <span class="dv">30</span>%</span>
<span id="cb27-1223"><a href="#cb27-1223" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1224"><a href="#cb27-1224" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================</span>                                              <span class="er">|</span>  <span class="dv">35</span>%</span>
<span id="cb27-1225"><a href="#cb27-1225" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1226"><a href="#cb27-1226" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================</span>                                           <span class="er">|</span>  <span class="dv">39</span>%</span>
<span id="cb27-1227"><a href="#cb27-1227" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1228"><a href="#cb27-1228" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">43</span>%</span>
<span id="cb27-1229"><a href="#cb27-1229" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1230"><a href="#cb27-1230" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================</span>                                     <span class="er">|</span>  <span class="dv">48</span>%</span>
<span id="cb27-1231"><a href="#cb27-1231" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1232"><a href="#cb27-1232" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=====================================</span>                                 <span class="er">|</span>  <span class="dv">52</span>%</span>
<span id="cb27-1233"><a href="#cb27-1233" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1234"><a href="#cb27-1234" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">57</span>%</span>
<span id="cb27-1235"><a href="#cb27-1235" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1236"><a href="#cb27-1236" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===========================================</span>                           <span class="er">|</span>  <span class="dv">61</span>%</span>
<span id="cb27-1237"><a href="#cb27-1237" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1238"><a href="#cb27-1238" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================================</span>                        <span class="er">|</span>  <span class="dv">65</span>%</span>
<span id="cb27-1239"><a href="#cb27-1239" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1240"><a href="#cb27-1240" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=================================================</span>                     <span class="er">|</span>  <span class="dv">70</span>%</span>
<span id="cb27-1241"><a href="#cb27-1241" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1242"><a href="#cb27-1242" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================================================</span>                  <span class="er">|</span>  <span class="dv">74</span>%</span>
<span id="cb27-1243"><a href="#cb27-1243" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1244"><a href="#cb27-1244" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=======================================================</span>               <span class="er">|</span>  <span class="dv">78</span>%</span>
<span id="cb27-1245"><a href="#cb27-1245" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1246"><a href="#cb27-1246" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================================</span>            <span class="er">|</span>  <span class="dv">83</span>%</span>
<span id="cb27-1247"><a href="#cb27-1247" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1248"><a href="#cb27-1248" aria-hidden="true" tabindex="-1"></a>  <span class="er">|=============================================================</span>         <span class="er">|</span>  <span class="dv">87</span>%</span>
<span id="cb27-1249"><a href="#cb27-1249" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1250"><a href="#cb27-1250" aria-hidden="true" tabindex="-1"></a>  <span class="er">|================================================================</span>      <span class="er">|</span>  <span class="dv">91</span>%</span>
<span id="cb27-1251"><a href="#cb27-1251" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1252"><a href="#cb27-1252" aria-hidden="true" tabindex="-1"></a>  <span class="er">|===================================================================</span>   <span class="er">|</span>  <span class="dv">96</span>%</span>
<span id="cb27-1253"><a href="#cb27-1253" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb27-1254"><a href="#cb27-1254" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span>
<span id="cb27-1255"><a href="#cb27-1255" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> Rows<span class="sc">:</span> <span class="dv">1</span></span>
<span id="cb27-1256"><a href="#cb27-1256" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> Columns<span class="sc">:</span> <span class="dv">11</span></span>
<span id="cb27-1257"><a href="#cb27-1257" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> source     <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"MPC"</span></span>
<span id="cb27-1258"><a href="#cb27-1258" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> collection <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"SENTINEL-2-L2A"</span></span>
<span id="cb27-1259"><a href="#cb27-1259" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> satellite  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"SENTINEL-2"</span></span>
<span id="cb27-1260"><a href="#cb27-1260" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> sensor     <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"MSI"</span></span>
<span id="cb27-1261"><a href="#cb27-1261" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> tile       <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"20LMR"</span></span>
<span id="cb27-1262"><a href="#cb27-1262" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> xmin       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="dv">399960</span></span>
<span id="cb27-1263"><a href="#cb27-1263" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> xmax       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="dv">509760</span></span>
<span id="cb27-1264"><a href="#cb27-1264" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> ymin       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="dv">8990200</span></span>
<span id="cb27-1265"><a href="#cb27-1265" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> ymax       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="dv">9100000</span></span>
<span id="cb27-1266"><a href="#cb27-1266" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> crs        <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">"PROJCRS[</span><span class="sc">\"</span><span class="st">WGS 84 / UTM zone 20S</span><span class="sc">\"</span><span class="st">,</span><span class="sc">\n</span><span class="st">    BASEGEOGCRS[</span><span class="sc">\"</span><span class="st">WGS "</span></span>
<span id="cb27-1267"><a href="#cb27-1267" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">$</span> file_info  <span class="sc">&lt;</span>list<span class="sc">&gt;</span> [<span class="sc">&lt;</span>tbl_df[<span class="dv">299</span> x <span class="dv">13</span>]<span class="sc">&gt;</span>]</span>
<span id="cb27-1268"><a href="#cb27-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1269"><a href="#cb27-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1270"><a href="#cb27-1270" aria-hidden="true" tabindex="-1"></a><span class="co"># Training Data </span></span>
<span id="cb27-1271"><a href="#cb27-1271" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb27-1272"><a href="#cb27-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1273"><a href="#cb27-1273" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Demo Training Samples</span></span>
<span id="cb27-1274"><a href="#cb27-1274" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"samples_deforestation_rondonia"</span>)</span>
<span id="cb27-1275"><a href="#cb27-1275" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">summary</span>(samples_deforestation_rondonia)</span>
<span id="cb27-1276"><a href="#cb27-1276" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 9 × 3</span></span>
<span id="cb27-1277"><a href="#cb27-1277" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   label                 count   prop</span>
<span id="cb27-1278"><a href="#cb27-1278" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                 <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb27-1279"><a href="#cb27-1279" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span> Clear_Cut_Bare_Soil     <span class="dv">944</span> <span class="fl">0.157</span> </span>
<span id="cb27-1280"><a href="#cb27-1280" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span> Clear_Cut_Burned_Area   <span class="dv">983</span> <span class="fl">0.164</span> </span>
<span id="cb27-1281"><a href="#cb27-1281" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span> Clear_Cut_Vegetation    <span class="dv">603</span> <span class="fl">0.100</span> </span>
<span id="cb27-1282"><a href="#cb27-1282" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span> Forest                  <span class="dv">964</span> <span class="fl">0.160</span> </span>
<span id="cb27-1283"><a href="#cb27-1283" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span> Mountainside_Forest     <span class="dv">211</span> <span class="fl">0.0351</span></span>
<span id="cb27-1284"><a href="#cb27-1284" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span> Riparian_Forest        <span class="dv">1247</span> <span class="fl">0.208</span> </span>
<span id="cb27-1285"><a href="#cb27-1285" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">7</span> Seasonally_Flooded      <span class="dv">731</span> <span class="fl">0.122</span> </span>
<span id="cb27-1286"><a href="#cb27-1286" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">8</span> Water                   <span class="dv">109</span> <span class="fl">0.0181</span></span>
<span id="cb27-1287"><a href="#cb27-1287" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">9</span> Wetland                 <span class="dv">215</span> <span class="fl">0.0358</span></span>
<span id="cb27-1288"><a href="#cb27-1288" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">head</span>(samples_deforestation_rondonia)</span>
<span id="cb27-1289"><a href="#cb27-1289" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 6 × 7</span></span>
<span id="cb27-1290"><a href="#cb27-1290" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   longitude latitude start_date end_date   label               cube  time_series</span>
<span id="cb27-1291"><a href="#cb27-1291" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span>     </span>
<span id="cb27-1292"><a href="#cb27-1292" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span>     <span class="sc">-</span><span class="fl">66.5</span>    <span class="sc">-</span><span class="fl">9.63</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1293"><a href="#cb27-1293" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.70</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1294"><a href="#cb27-1294" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.81</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Forest              SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1295"><a href="#cb27-1295" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.64</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1296"><a href="#cb27-1296" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Vegetati… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1297"><a href="#cb27-1297" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Burned_A… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span></span>
<span id="cb27-1298"><a href="#cb27-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1299"><a href="#cb27-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1300"><a href="#cb27-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1301"><a href="#cb27-1301" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Demo Training Samples</span></span>
<span id="cb27-1302"><a href="#cb27-1302" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"samples_deforestation_rondonia"</span>)</span>
<span id="cb27-1303"><a href="#cb27-1303" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">summary</span>(samples_deforestation_rondonia)</span>
<span id="cb27-1304"><a href="#cb27-1304" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 9 × 3</span></span>
<span id="cb27-1305"><a href="#cb27-1305" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   label                 count   prop</span>
<span id="cb27-1306"><a href="#cb27-1306" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                 <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb27-1307"><a href="#cb27-1307" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span> Clear_Cut_Bare_Soil     <span class="dv">944</span> <span class="fl">0.157</span> </span>
<span id="cb27-1308"><a href="#cb27-1308" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span> Clear_Cut_Burned_Area   <span class="dv">983</span> <span class="fl">0.164</span> </span>
<span id="cb27-1309"><a href="#cb27-1309" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span> Clear_Cut_Vegetation    <span class="dv">603</span> <span class="fl">0.100</span> </span>
<span id="cb27-1310"><a href="#cb27-1310" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span> Forest                  <span class="dv">964</span> <span class="fl">0.160</span> </span>
<span id="cb27-1311"><a href="#cb27-1311" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span> Mountainside_Forest     <span class="dv">211</span> <span class="fl">0.0351</span></span>
<span id="cb27-1312"><a href="#cb27-1312" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span> Riparian_Forest        <span class="dv">1247</span> <span class="fl">0.208</span> </span>
<span id="cb27-1313"><a href="#cb27-1313" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">7</span> Seasonally_Flooded      <span class="dv">731</span> <span class="fl">0.122</span> </span>
<span id="cb27-1314"><a href="#cb27-1314" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">8</span> Water                   <span class="dv">109</span> <span class="fl">0.0181</span></span>
<span id="cb27-1315"><a href="#cb27-1315" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">9</span> Wetland                 <span class="dv">215</span> <span class="fl">0.0358</span></span>
<span id="cb27-1316"><a href="#cb27-1316" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">head</span>(samples_deforestation_rondonia)</span>
<span id="cb27-1317"><a href="#cb27-1317" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 6 × 7</span></span>
<span id="cb27-1318"><a href="#cb27-1318" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   longitude latitude start_date end_date   label               cube  time_series</span>
<span id="cb27-1319"><a href="#cb27-1319" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span>     </span>
<span id="cb27-1320"><a href="#cb27-1320" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span>     <span class="sc">-</span><span class="fl">66.5</span>    <span class="sc">-</span><span class="fl">9.63</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1321"><a href="#cb27-1321" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.70</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1322"><a href="#cb27-1322" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.81</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Forest              SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1323"><a href="#cb27-1323" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.64</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1324"><a href="#cb27-1324" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Vegetati… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb27-1325"><a href="#cb27-1325" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Burned_A… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span></span>
<span id="cb27-1326"><a href="#cb27-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1327"><a href="#cb27-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1328"><a href="#cb27-1328" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute spectral indexes for training samples</span></span>
<span id="cb27-1329"><a href="#cb27-1329" aria-hidden="true" tabindex="-1"></a>training_samples_with_indices <span class="ot">&lt;-</span> samples_deforestation_rondonia <span class="sc">|&gt;</span> </span>
<span id="cb27-1330"><a href="#cb27-1330" aria-hidden="true" tabindex="-1"></a>    sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">NDVI =</span> (B08 <span class="sc">-</span> B04)<span class="sc">/</span>(B08 <span class="sc">+</span> B04)) <span class="sc">|&gt;</span> </span>
<span id="cb27-1331"><a href="#cb27-1331" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">NBR =</span> (B08 <span class="sc">-</span> B12) <span class="sc">/</span> (B08 <span class="sc">+</span> B12)) <span class="sc">|&gt;</span> </span>
<span id="cb27-1332"><a href="#cb27-1332" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">EVI =</span> <span class="fl">2.5</span> <span class="sc">*</span> (B08 <span class="sc">-</span> B04) <span class="sc">/</span> ((B08 <span class="sc">+</span> <span class="fl">6.0</span> <span class="sc">*</span> B04 <span class="sc">-</span> <span class="fl">7.5</span> <span class="sc">*</span> B02) <span class="sc">+</span> <span class="fl">1.0</span>)) </span>
<span id="cb27-1333"><a href="#cb27-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1334"><a href="#cb27-1334" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and plot patterns</span></span>
<span id="cb27-1335"><a href="#cb27-1335" aria-hidden="true" tabindex="-1"></a>training_samples_indices <span class="ot">&lt;-</span> training_samples_with_indices <span class="sc">|&gt;</span> </span>
<span id="cb27-1336"><a href="#cb27-1336" aria-hidden="true" tabindex="-1"></a>    sits<span class="sc">::</span><span class="fu">sits_select</span>(<span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"NDVI"</span>, <span class="st">"EVI"</span>, <span class="st">"NBR"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb27-1337"><a href="#cb27-1337" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_patterns</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb27-1338"><a href="#cb27-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1339"><a href="#cb27-1339" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model using Random Forest algorithm</span></span>
<span id="cb27-1340"><a href="#cb27-1340" aria-hidden="true" tabindex="-1"></a>model_randomForest <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_train</span>(</span>
<span id="cb27-1341"><a href="#cb27-1341" aria-hidden="true" tabindex="-1"></a>  <span class="at">samples =</span> samples_deforestation_rondonia,</span>
<span id="cb27-1342"><a href="#cb27-1342" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_method =</span> sits<span class="sc">::</span><span class="fu">sits_rfor</span>(</span>
<span id="cb27-1343"><a href="#cb27-1343" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_trees =</span> <span class="dv">120</span>,</span>
<span id="cb27-1344"><a href="#cb27-1344" aria-hidden="true" tabindex="-1"></a>    <span class="at">mtry =</span> <span class="dv">10</span>))</span>
<span id="cb27-1345"><a href="#cb27-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1346"><a href="#cb27-1346" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the model results</span></span>
<span id="cb27-1347"><a href="#cb27-1347" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_randomForest)</span>
<span id="cb27-1348"><a href="#cb27-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1349"><a href="#cb27-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1350"><a href="#cb27-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1351"><a href="#cb27-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1352"><a href="#cb27-1352" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability Data Cube</span></span>
<span id="cb27-1353"><a href="#cb27-1353" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb27-1354"><a href="#cb27-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1355"><a href="#cb27-1355" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability data cube</span></span>
<span id="cb27-1356"><a href="#cb27-1356" aria-hidden="true" tabindex="-1"></a>cube_s2_probs <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_classify</span>(</span>
<span id="cb27-1357"><a href="#cb27-1357" aria-hidden="true" tabindex="-1"></a>    <span class="at">data       =</span> cube_s2_reg,</span>
<span id="cb27-1358"><a href="#cb27-1358" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_model   =</span> model_randomForest,</span>
<span id="cb27-1359"><a href="#cb27-1359" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span id="cb27-1360"><a href="#cb27-1360" aria-hidden="true" tabindex="-1"></a>    <span class="at">version    =</span> <span class="st">"rf-1228"</span>, <span class="co"># adds suffix to output filename</span></span>
<span id="cb27-1361"><a href="#cb27-1361" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb27-1362"><a href="#cb27-1362" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize    =</span> <span class="dv">16</span>)</span>
<span id="cb27-1363"><a href="#cb27-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1364"><a href="#cb27-1364" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_probs, <span class="at">labels =</span> <span class="st">"Forest"</span>, <span class="at">palette =</span> <span class="st">"YlGn"</span>)</span>
<span id="cb27-1365"><a href="#cb27-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1366"><a href="#cb27-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1367"><a href="#cb27-1367" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate uncertainty cube and sample high-uncertainty pixels</span></span>
<span id="cb27-1368"><a href="#cb27-1368" aria-hidden="true" tabindex="-1"></a>cube_s2_uncertainty <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty</span>(</span>
<span id="cb27-1369"><a href="#cb27-1369" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube =</span> cube_s2_probs,</span>
<span id="cb27-1370"><a href="#cb27-1370" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"margin"</span>, </span>
<span id="cb27-1371"><a href="#cb27-1371" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">"./assets/images/uncertainty/"</span>,</span>
<span id="cb27-1372"><a href="#cb27-1372" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb27-1373"><a href="#cb27-1373" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize =</span> <span class="dv">16</span>)</span>
<span id="cb27-1374"><a href="#cb27-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1375"><a href="#cb27-1375" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize high-uncertainty areas</span></span>
<span id="cb27-1376"><a href="#cb27-1376" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty, <span class="at">palette =</span> <span class="st">"Oranges"</span>)</span>
<span id="cb27-1377"><a href="#cb27-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1378"><a href="#cb27-1378" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract new spectral signatures</span></span>
<span id="cb27-1379"><a href="#cb27-1379" aria-hidden="true" tabindex="-1"></a>new_samples <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_get_data</span>(</span>
<span id="cb27-1380"><a href="#cb27-1380" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube =</span> cube_s2_reg,</span>
<span id="cb27-1381"><a href="#cb27-1381" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> new_samples_locations)</span>
<span id="cb27-1382"><a href="#cb27-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1383"><a href="#cb27-1383" aria-hidden="true" tabindex="-1"></a><span class="co">#new_samples$label &lt;- "Wetland"</span></span>
<span id="cb27-1384"><a href="#cb27-1384" aria-hidden="true" tabindex="-1"></a>new_samples_aligned <span class="ot">&lt;-</span> <span class="fu">sits_select</span>(<span class="at">data =</span> new_samples,</span>
<span id="cb27-1385"><a href="#cb27-1385" aria-hidden="true" tabindex="-1"></a>  <span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, </span>
<span id="cb27-1386"><a href="#cb27-1386" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"B8A"</span>))</span>
<span id="cb27-1387"><a href="#cb27-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1388"><a href="#cb27-1388" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with original samples</span></span>
<span id="cb27-1389"><a href="#cb27-1389" aria-hidden="true" tabindex="-1"></a>new_samples_merge <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb27-1390"><a href="#cb27-1390" aria-hidden="true" tabindex="-1"></a>    samples_deforestation_rondonia,</span>
<span id="cb27-1391"><a href="#cb27-1391" aria-hidden="true" tabindex="-1"></a>  new_samples_aligned)</span>
<span id="cb27-1392"><a href="#cb27-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1393"><a href="#cb27-1393" aria-hidden="true" tabindex="-1"></a><span class="co"># Train new model &amp; evaluate</span></span>
<span id="cb27-1394"><a href="#cb27-1394" aria-hidden="true" tabindex="-1"></a>model_randomForest_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_train</span>(</span>
<span id="cb27-1395"><a href="#cb27-1395" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> new_samples_merge, </span>
<span id="cb27-1396"><a href="#cb27-1396" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_method =</span> sits<span class="sc">::</span><span class="fu">sits_rfor</span>(<span class="at">num_trees =</span> <span class="dv">120</span>,<span class="at">mtry =</span> <span class="dv">10</span>))</span>
<span id="cb27-1397"><a href="#cb27-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1398"><a href="#cb27-1398" aria-hidden="true" tabindex="-1"></a>cube_s2_probs_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_classify</span>(</span>
<span id="cb27-1399"><a href="#cb27-1399" aria-hidden="true" tabindex="-1"></a>    <span class="at">data            =</span> cube_s2_reg,</span>
<span id="cb27-1400"><a href="#cb27-1400" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_model        =</span> model_randomForest_v2,</span>
<span id="cb27-1401"><a href="#cb27-1401" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span id="cb27-1402"><a href="#cb27-1402" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-1228-v2"</span>, <span class="co"># adds suffix to output filename</span></span>
<span id="cb27-1403"><a href="#cb27-1403" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb27-1404"><a href="#cb27-1404" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span></span>
<span id="cb27-1405"><a href="#cb27-1405" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-1406"><a href="#cb27-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1407"><a href="#cb27-1407" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive new uncertainty cube and compare</span></span>
<span id="cb27-1408"><a href="#cb27-1408" aria-hidden="true" tabindex="-1"></a>cube_s2_uncertainty_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty</span>(</span>
<span id="cb27-1409"><a href="#cb27-1409" aria-hidden="true" tabindex="-1"></a>    cube_s2_probs_v2, </span>
<span id="cb27-1410"><a href="#cb27-1410" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"margin"</span>, </span>
<span id="cb27-1411"><a href="#cb27-1411" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">"./assets/images/uncertainty_v2/"</span>,</span>
<span id="cb27-1412"><a href="#cb27-1412" aria-hidden="true" tabindex="-1"></a>  <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb27-1413"><a href="#cb27-1413" aria-hidden="true" tabindex="-1"></a>  <span class="at">memsize =</span> <span class="dv">16</span>)</span>
<span id="cb27-1414"><a href="#cb27-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1415"><a href="#cb27-1415" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize side-by-side</span></span>
<span id="cb27-1416"><a href="#cb27-1416" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty, <span class="at">palette =</span> <span class="st">"Reds"</span>)</span>
<span id="cb27-1417"><a href="#cb27-1417" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty_v2, <span class="at">palette =</span> <span class="st">"Oranges"</span>)</span>
<span id="cb27-1418"><a href="#cb27-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1419"><a href="#cb27-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1420"><a href="#cb27-1420" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for convergence (extract filepath first)</span></span>
<span id="cb27-1421"><a href="#cb27-1421" aria-hidden="true" tabindex="-1"></a>get_uncert_values <span class="ot">&lt;-</span> <span class="cf">function</span>(uncert_cube) {</span>
<span id="cb27-1422"><a href="#cb27-1422" aria-hidden="true" tabindex="-1"></a>  files <span class="ot">&lt;-</span> uncert_cube<span class="sc">$</span>file_info[[<span class="dv">1</span>]]<span class="sc">$</span>path</span>
<span id="cb27-1423"><a href="#cb27-1423" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(files)</span>
<span id="cb27-1424"><a href="#cb27-1424" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">values</span>(r)</span>
<span id="cb27-1425"><a href="#cb27-1425" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-1426"><a href="#cb27-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1427"><a href="#cb27-1427" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate statistics</span></span>
<span id="cb27-1428"><a href="#cb27-1428" aria-hidden="true" tabindex="-1"></a>uncert_v1_vals <span class="ot">&lt;-</span> <span class="fu">get_uncert_values</span>(cube_s2_uncertainty)</span>
<span id="cb27-1429"><a href="#cb27-1429" aria-hidden="true" tabindex="-1"></a>uncert_v2_vals <span class="ot">&lt;-</span> <span class="fu">get_uncert_values</span>(cube_s2_uncertainty_v2)</span>
<span id="cb27-1430"><a href="#cb27-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1431"><a href="#cb27-1431" aria-hidden="true" tabindex="-1"></a>uncertainty_check <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-1432"><a href="#cb27-1432" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration =</span> <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>),</span>
<span id="cb27-1433"><a href="#cb27-1433" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb27-1434"><a href="#cb27-1434" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(uncert_v1_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-1435"><a href="#cb27-1435" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(uncert_v2_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-1436"><a href="#cb27-1436" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-1437"><a href="#cb27-1437" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb27-1438"><a href="#cb27-1438" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(uncert_v1_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-1439"><a href="#cb27-1439" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(uncert_v2_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-1440"><a href="#cb27-1440" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-1441"><a href="#cb27-1441" aria-hidden="true" tabindex="-1"></a>  <span class="at">pct_high_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb27-1442"><a href="#cb27-1442" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(uncert_v1_vals <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(uncert_v1_vals)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb27-1443"><a href="#cb27-1443" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(uncert_v2_vals <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(uncert_v2_vals)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb27-1444"><a href="#cb27-1444" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-1445"><a href="#cb27-1445" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1446"><a href="#cb27-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1447"><a href="#cb27-1447" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(uncertainty_check, <span class="st">"./assets/samples/uncertainty_check.csv"</span>)</span>
<span id="cb27-1448"><a href="#cb27-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1449"><a href="#cb27-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1450"><a href="#cb27-1450" aria-hidden="true" tabindex="-1"></a><span class="co"># Training Data Enhancements</span></span>
<span id="cb27-1451"><a href="#cb27-1451" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb27-1452"><a href="#cb27-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1453"><a href="#cb27-1453" aria-hidden="true" tabindex="-1"></a>Cluster samples using DTW distance and Ward linkage</span>
<span id="cb27-1454"><a href="#cb27-1454" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cluster_dendro</span>(</span>
<span id="cb27-1455"><a href="#cb27-1455" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> training_samples_with_indices, </span>
<span id="cb27-1456"><a href="#cb27-1456" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"NDVI"</span>, <span class="st">"EVI"</span>),</span>
<span id="cb27-1457"><a href="#cb27-1457" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_method =</span> <span class="st">"dtw_basic"</span>,</span>
<span id="cb27-1458"><a href="#cb27-1458" aria-hidden="true" tabindex="-1"></a>    <span class="at">linkage =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb27-1459"><a href="#cb27-1459" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-1460"><a href="#cb27-1460" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine cluster composition</span></span>
<span id="cb27-1461"><a href="#cb27-1461" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_cluster_frequency</span>(clusters)</span>
<span id="cb27-1462"><a href="#cb27-1462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1463"><a href="#cb27-1463" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove cluster#5 from the samples</span></span>
<span id="cb27-1464"><a href="#cb27-1464" aria-hidden="true" tabindex="-1"></a>clusters_new <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(clusters, cluster <span class="sc">!=</span> <span class="dv">5</span>)</span>
<span id="cb27-1465"><a href="#cb27-1465" aria-hidden="true" tabindex="-1"></a>clusters_clean <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cluster_clean</span>(clusters_new)</span>
<span id="cb27-1466"><a href="#cb27-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1467"><a href="#cb27-1467" aria-hidden="true" tabindex="-1"></a><span class="co"># Check clusters samples frequency</span></span>
<span id="cb27-1468"><a href="#cb27-1468" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_cluster_frequency</span>(clusters_clean)</span>
<span id="cb27-1469"><a href="#cb27-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1470"><a href="#cb27-1470" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate SOM with optimal grid dimensions</span></span>
<span id="cb27-1471"><a href="#cb27-1471" aria-hidden="true" tabindex="-1"></a>som_map <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_map</span>(</span>
<span id="cb27-1472"><a href="#cb27-1472" aria-hidden="true" tabindex="-1"></a>    training_samples_with_indices, </span>
<span id="cb27-1473"><a href="#cb27-1473" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid_xdim =</span> <span class="dv">10</span>, </span>
<span id="cb27-1474"><a href="#cb27-1474" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid_ydim =</span> <span class="dv">10</span>)</span>
<span id="cb27-1475"><a href="#cb27-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1476"><a href="#cb27-1476" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean samples by removing mixed neurons</span></span>
<span id="cb27-1477"><a href="#cb27-1477" aria-hidden="true" tabindex="-1"></a>samples_clean <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_clean_samples</span>(som_map)</span>
<span id="cb27-1478"><a href="#cb27-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1479"><a href="#cb27-1479" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize sample clustering &amp; class confusions</span></span>
<span id="cb27-1480"><a href="#cb27-1480" aria-hidden="true" tabindex="-1"></a>som_eval <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_evaluate_cluster</span>(som_map)</span>
<span id="cb27-1481"><a href="#cb27-1481" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval)</span>
<span id="cb27-1482"><a href="#cb27-1482" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_map)</span>
<span id="cb27-1483"><a href="#cb27-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1484"><a href="#cb27-1484" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive jurisdiction boundary</span></span>
<span id="cb27-1485"><a href="#cb27-1485" aria-hidden="true" tabindex="-1"></a>bbox_cube <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_bbox</span>(cube_s2_reg) </span>
<span id="cb27-1486"><a href="#cb27-1486" aria-hidden="true" tabindex="-1"></a>bbox_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(</span>
<span id="cb27-1487"><a href="#cb27-1487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">xmin =</span> aoi<span class="sc">$</span>xmin, </span>
<span id="cb27-1488"><a href="#cb27-1488" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> aoi<span class="sc">$</span>ymin, </span>
<span id="cb27-1489"><a href="#cb27-1489" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> aoi<span class="sc">$</span>xmax, </span>
<span id="cb27-1490"><a href="#cb27-1490" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> aoi<span class="sc">$</span>ymax),</span>
<span id="cb27-1491"><a href="#cb27-1491" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(aoi<span class="sc">$</span>crs))</span>
<span id="cb27-1492"><a href="#cb27-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1493"><a href="#cb27-1493" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sf </span></span>
<span id="cb27-1494"><a href="#cb27-1494" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(sf<span class="sc">::</span><span class="fu">st_as_sfc</span>(bbox_sf))</span>
<span id="cb27-1495"><a href="#cb27-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1496"><a href="#cb27-1496" aria-hidden="true" tabindex="-1"></a><span class="co"># Assess geographic coverage</span></span>
<span id="cb27-1497"><a href="#cb27-1497" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_geo_dist</span>(</span>
<span id="cb27-1498"><a href="#cb27-1498" aria-hidden="true" tabindex="-1"></a>    training_samples_with_indices, <span class="at">roi =</span> aoi)</span>
<span id="cb27-1499"><a href="#cb27-1499" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(distances)</span>
<span id="cb27-1500"><a href="#cb27-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1501"><a href="#cb27-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1502"><a href="#cb27-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1503"><a href="#cb27-1503" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance samples across classes</span></span>
<span id="cb27-1504"><a href="#cb27-1504" aria-hidden="true" tabindex="-1"></a>samples_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_reduce_imbalance</span>(</span>
<span id="cb27-1505"><a href="#cb27-1505" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> training_samples_with_indices,</span>
<span id="cb27-1506"><a href="#cb27-1506" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_samples_over =</span> <span class="dv">200</span>,   <span class="co"># Oversample rare classes</span></span>
<span id="cb27-1507"><a href="#cb27-1507" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_samples_under =</span> <span class="dv">400</span>,  <span class="co"># Undersample common classes</span></span>
<span id="cb27-1508"><a href="#cb27-1508" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>)</span>
<span id="cb27-1509"><a href="#cb27-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1510"><a href="#cb27-1510" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-evaluate using SOM clustering</span></span>
<span id="cb27-1511"><a href="#cb27-1511" aria-hidden="true" tabindex="-1"></a>som_map_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_map</span>(</span>
<span id="cb27-1512"><a href="#cb27-1512" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> samples_balanced,</span>
<span id="cb27-1513"><a href="#cb27-1513" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid_xdim =</span> <span class="dv">10</span>,</span>
<span id="cb27-1514"><a href="#cb27-1514" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid_ydim =</span> <span class="dv">10</span>,</span>
<span id="cb27-1515"><a href="#cb27-1515" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">1.0</span>,</span>
<span id="cb27-1516"><a href="#cb27-1516" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance =</span> <span class="st">"dtw"</span>,</span>
<span id="cb27-1517"><a href="#cb27-1517" aria-hidden="true" tabindex="-1"></a>    <span class="at">rlen =</span> <span class="dv">20</span>)</span>
<span id="cb27-1518"><a href="#cb27-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1519"><a href="#cb27-1519" aria-hidden="true" tabindex="-1"></a><span class="co"># Store estimates in tibble</span></span>
<span id="cb27-1520"><a href="#cb27-1520" aria-hidden="true" tabindex="-1"></a>som_eval_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_evaluate_cluster</span>(</span>
<span id="cb27-1521"><a href="#cb27-1521" aria-hidden="true" tabindex="-1"></a>    som_map_balanced)</span>
<span id="cb27-1522"><a href="#cb27-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1523"><a href="#cb27-1523" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize results</span></span>
<span id="cb27-1524"><a href="#cb27-1524" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval) </span>
<span id="cb27-1525"><a href="#cb27-1525" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval_balanced) </span>
<span id="cb27-1526"><a href="#cb27-1526" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(samples_balanced)</span>
<span id="cb27-1527"><a href="#cb27-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1528"><a href="#cb27-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1529"><a href="#cb27-1529" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Whittaker filter with conservative smoothing</span></span>
<span id="cb27-1530"><a href="#cb27-1530" aria-hidden="true" tabindex="-1"></a>samples_balanced_ndvi <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_select</span>(</span>
<span id="cb27-1531"><a href="#cb27-1531" aria-hidden="true" tabindex="-1"></a>    samples_balanced, <span class="at">bands =</span> <span class="st">"NDVI"</span>)</span>
<span id="cb27-1532"><a href="#cb27-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1533"><a href="#cb27-1533" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Whitakker filter</span></span>
<span id="cb27-1534"><a href="#cb27-1534" aria-hidden="true" tabindex="-1"></a>samples_balanced_whit <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_whittaker</span>(</span>
<span id="cb27-1535"><a href="#cb27-1535" aria-hidden="true" tabindex="-1"></a>    samples_balanced_ndvi, <span class="at">lambda =</span> <span class="fl">0.5</span>)</span>
<span id="cb27-1536"><a href="#cb27-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1537"><a href="#cb27-1537" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge to visualize</span></span>
<span id="cb27-1538"><a href="#cb27-1538" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_merge</span>(</span>
<span id="cb27-1539"><a href="#cb27-1539" aria-hidden="true" tabindex="-1"></a>    samples_balanced_ndvi, </span>
<span id="cb27-1540"><a href="#cb27-1540" aria-hidden="true" tabindex="-1"></a>    samples_balanced_whit,</span>
<span id="cb27-1541"><a href="#cb27-1541" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">".WHIT"</span>)) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb27-1542"><a href="#cb27-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1543"><a href="#cb27-1543" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure consistent factor levels</span></span>
<span id="cb27-1544"><a href="#cb27-1544" aria-hidden="true" tabindex="-1"></a>all_classes <span class="ot">&lt;-</span> <span class="fu">unique</span>(train_features<span class="sc">$</span>label)</span>
<span id="cb27-1545"><a href="#cb27-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1546"><a href="#cb27-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1547"><a href="#cb27-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1548"><a href="#cb27-1548" aria-hidden="true" tabindex="-1"></a><span class="co"># Criss Validation</span></span>
<span id="cb27-1549"><a href="#cb27-1549" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb27-1550"><a href="#cb27-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1551"><a href="#cb27-1551" aria-hidden="true" tabindex="-1"></a><span class="co"># Stratified partition</span></span>
<span id="cb27-1552"><a href="#cb27-1552" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb27-1553"><a href="#cb27-1553" aria-hidden="true" tabindex="-1"></a>train_idx <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(</span>
<span id="cb27-1554"><a href="#cb27-1554" aria-hidden="true" tabindex="-1"></a>  train_features<span class="sc">$</span>label,</span>
<span id="cb27-1555"><a href="#cb27-1555" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.8</span>,</span>
<span id="cb27-1556"><a href="#cb27-1556" aria-hidden="true" tabindex="-1"></a>  <span class="at">list =</span> <span class="cn">FALSE</span></span>
<span id="cb27-1557"><a href="#cb27-1557" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1558"><a href="#cb27-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1559"><a href="#cb27-1559" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_features[train_idx, ]</span>
<span id="cb27-1560"><a href="#cb27-1560" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> train_features[<span class="sc">-</span>train_idx, ]</span>
<span id="cb27-1561"><a href="#cb27-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1562"><a href="#cb27-1562" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure labels are factors with same levels</span></span>
<span id="cb27-1563"><a href="#cb27-1563" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data<span class="sc">$</span>label, <span class="at">levels =</span> all_classes)</span>
<span id="cb27-1564"><a href="#cb27-1564" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data<span class="sc">$</span>label, <span class="at">levels =</span> all_classes)</span>
<span id="cb27-1565"><a href="#cb27-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1566"><a href="#cb27-1566" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model</span></span>
<span id="cb27-1567"><a href="#cb27-1567" aria-hidden="true" tabindex="-1"></a>accuracy_model <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb27-1568"><a href="#cb27-1568" aria-hidden="true" tabindex="-1"></a>  label <span class="sc">~</span> .,</span>
<span id="cb27-1569"><a href="#cb27-1569" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb27-1570"><a href="#cb27-1570" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb27-1571"><a href="#cb27-1571" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">120</span>,</span>
<span id="cb27-1572"><a href="#cb27-1572" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-1573"><a href="#cb27-1573" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"none"</span>)</span>
<span id="cb27-1574"><a href="#cb27-1574" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1575"><a href="#cb27-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1576"><a href="#cb27-1576" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb27-1577"><a href="#cb27-1577" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(accuracy_model, test_data)</span>
<span id="cb27-1578"><a href="#cb27-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1579"><a href="#cb27-1579" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure predictions have same levels</span></span>
<span id="cb27-1580"><a href="#cb27-1580" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">factor</span>(predictions, <span class="at">levels =</span> all_classes)</span>
<span id="cb27-1581"><a href="#cb27-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1582"><a href="#cb27-1582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1583"><a href="#cb27-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1584"><a href="#cb27-1584" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.11 Chapter Summary {#sec-summary}</span></span>
<span id="cb27-1585"><a href="#cb27-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1586"><a href="#cb27-1586" aria-hidden="true" tabindex="-1"></a>This chapter established a comprehensive framework for activity data uncertainty quantification in REDD+ monitoring systems. Key contributions include:</span>
<span id="cb27-1587"><a href="#cb27-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1588"><a href="#cb27-1588" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Data cube architecture: Structured approach to spatiotemporal land cover analysis</span>
<span id="cb27-1589"><a href="#cb27-1589" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>IPCC methodology alignment: Clear guidance on Approach 3 requirements</span>
<span id="cb27-1590"><a href="#cb27-1590" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Pixel-level uncertainty tracking: Model residuals for adaptive sampling</span>
<span id="cb27-1591"><a href="#cb27-1591" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Random Forest optimization: Monte Carlo calibration workflows</span>
<span id="cb27-1592"><a href="#cb27-1592" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Rigorous accuracy assessment: Confusion matrices with area adjustment</span>
<span id="cb27-1593"><a href="#cb27-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1594"><a href="#cb27-1594" aria-hidden="true" tabindex="-1"></a>Activity data provides spatial extent; allometry converts extent to biomass. Combined uncertainty requires:</span>
<span id="cb27-1595"><a href="#cb27-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1596"><a href="#cb27-1596" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-1597"><a href="#cb27-1597" aria-hidden="true" tabindex="-1"></a>U_{total}^2 = U_{activity}^2 + U_{allometry}^2 + 2 \times \text{Cov}(A, B)</span>
<span id="cb27-1598"><a href="#cb27-1598" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-1599"><a href="#cb27-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1600"><a href="#cb27-1600" aria-hidden="true" tabindex="-1"></a>Where covariance term captures spatial correlation between classification errors and biomass estimation errors.</span>
<span id="cb27-1601"><a href="#cb27-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1602"><a href="#cb27-1602" aria-hidden="true" tabindex="-1"></a><span class="ot">[^index-1]: </span>In version 1.5.3,<span class="in">`sits`</span> supports access to the following ARD image cloud providers:</span>
<span id="cb27-1603"><a href="#cb27-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1604"><a href="#cb27-1604" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Amazon Web Services (AWS): Open data Sentinel-2/2A Level-2A collections for the Earth’s land surface.</span></span>
<span id="cb27-1605"><a href="#cb27-1605" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Brazil Data Cube (BDC): Open data collections of Sentinel-2/2A, Landsat-8, CBERS-4/4A, and MOD13Q1 products for Brazil. These collections are organized as regular data cubes.</span></span>
<span id="cb27-1606"><a href="#cb27-1606" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Copernicus Data Space Ecosystem (CDSE): Open data collections of Sentinel-1 RTC and Sentinel-2/2A images.</span></span>
<span id="cb27-1607"><a href="#cb27-1607" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Digital Earth Africa (DEAFRICA): Open data collections of Sentinel-1 RTC, Sentinel-2/2A, Landsat-5/7/8/9 for Africa. Additional products include ALOS_PALSAR mosaics, DEM_COP_30, NDVI_ANOMALY based on Landsat data, and monthly and daily rainfall data from CHIRPS.</span></span>
<span id="cb27-1608"><a href="#cb27-1608" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Digital Earth Australia (DEAUSTRALIA): Open data ARD collections of Sentinel-2A/2B and Landsat-5/7/8/9 images, yearly geomedians of Landsat 5/7/8 images; yearly fractional land cover from 1986 to 2024.</span></span>
<span id="cb27-1609"><a href="#cb27-1609" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Harmonized Landsat-Sentinel (HLS): HLS, provided by NASA, is an open data collection that processes Landsat 8 and Sentinel-2 imagery to a common standard.</span></span>
<span id="cb27-1610"><a href="#cb27-1610" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Microsoft Planetary Computer (MPC): Open data collections of Sentinel-1 GRD, Sentinel-1 RTC, Sentinel-2/2A, Landsat-4/5/7/8/9 images for the Earth’s land areas. Also supported are the Copernicus DEM-30 and MOD13Q1, MOD10A1, MOD09A1 products, and the Harmonized Landsat-Sentinel collections (HLSL30 and HLSS30).</span></span>
<span id="cb27-1611"><a href="#cb27-1611" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Swiss Data Cube (SDC): Collection of Sentinel-2/2A and Landsat-8 images for Switzerland.</span></span>
<span id="cb27-1612"><a href="#cb27-1612" aria-hidden="true" tabindex="-1"></a><span class="in">    -   Terrascope: Cloud service with EO products, which includes the ESA World Cover map.</span></span>
<span id="cb27-1613"><a href="#cb27-1613" aria-hidden="true" tabindex="-1"></a><span class="in">    -   USGS: Landsat-4/5/7/8/9 collections available in AWS, which require access payment.</span></span>
<span id="cb27-1614"><a href="#cb27-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1615"><a href="#cb27-1615" aria-hidden="true" tabindex="-1"></a><span class="in">    In addition, `sits` supports the use of Planet monthly mosaics stored as local files. For a detailed description of the providers and collections supported by `sits`, please run `sits_list_collections()`.</span></span>
<span id="cb27-1616"><a href="#cb27-1616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1617"><a href="#cb27-1617" aria-hidden="true" tabindex="-1"></a><span class="ot">[^index-2]: </span>For addressing the most problematic uncertainty tasks needing longitudinal analyses of extended timelines (1984-2024), such as disaggregation of wildfire uncertainty and the inter-annual variability of natural disturbances, we recommend practicing data cube operations with Landsat imagery <span class="co">[</span><span class="ot">@ipccReportConferenceParties2012, pp. 847; @ipccChapter2Generic2019, pp. 2.67; @ipcc2013RevisedSupplementary2014, pp. O.9; @unfccc2010report, pp. 17-18</span><span class="co">]</span>.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://github.com/training-resource/uncertainty">Source</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/training-resource/uncertainty/edit/main/03-activity-data/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/training-resource/uncertainty/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>