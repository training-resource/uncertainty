<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>3&nbsp; Activity Data – REDD+ Uncertainty</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../references/index.html" rel="next">
<link href="../02-emission-factors/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dcd723bd3e2d8e65306aa707aebc1039.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-1d21bedf07900770407f0b9fb3305521.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="3&nbsp; Activity Data – REDD+ Uncertainty">
<meta property="og:description" content="">
<meta property="og:site_name" content="REDD+ Uncertainty">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../03-activity-data/index.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Activity Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">REDD+ Uncertainty</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/training-resource/uncertainty" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-allometry/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Allometry</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-emission-factors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Emission Factors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-activity-data/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Activity Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title"><strong>On this page</strong></h2>
   
  <ul>
<li>
<a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
<li><a href="#environment-setup" id="toc-environment-setup" class="nav-link" data-scroll-target="#environment-setup">Environment Setup</a></li>
  </ul>
</li>
  <li><a href="#ipcc-lulc-approaches" id="toc-ipcc-lulc-approaches" class="nav-link" data-scroll-target="#ipcc-lulc-approaches"><span class="header-section-number">3.1</span> IPCC LULC Approaches:</a></li>
  <li><a href="#sec-ad-sources" id="toc-sec-ad-sources" class="nav-link" data-scroll-target="#sec-ad-sources"><span class="header-section-number">3.2</span> Sources of Uncertainty</a></li>
  <li>
<a href="#sec-lc-uncertainty" id="toc-sec-lc-uncertainty" class="nav-link" data-scroll-target="#sec-lc-uncertainty"><span class="header-section-number">3.3</span> Land Classification Uncertainty</a>
  <ul class="collapse">
<li><a href="#sec-confusion-matrix" id="toc-sec-confusion-matrix" class="nav-link" data-scroll-target="#sec-confusion-matrix"><span class="header-section-number">3.3.1</span> Confusion Matrix Analysis</a></li>
  <li><a href="#sec-lc-monte-carlo" id="toc-sec-lc-monte-carlo" class="nav-link" data-scroll-target="#sec-lc-monte-carlo"><span class="header-section-number">3.3.2</span> Monte Carlo Simulation</a></li>
  <li><a href="#sec-stratified-sampling" id="toc-sec-stratified-sampling" class="nav-link" data-scroll-target="#sec-stratified-sampling"><span class="header-section-number">3.3.3</span> Accuracy Assessment Stratified</a></li>
  </ul>
</li>
  <li>
<a href="#sec-change-detection" id="toc-sec-change-detection" class="nav-link" data-scroll-target="#sec-change-detection"><span class="header-section-number">3.4</span> Land Change Uncertainty</a>
  <ul class="collapse">
<li><a href="#sec-temporal-consistency" id="toc-sec-temporal-consistency" class="nav-link" data-scroll-target="#sec-temporal-consistency"><span class="header-section-number">3.4.1</span> Temporal Registration Error</a></li>
  <li><a href="#sec-min-detectable-change" id="toc-sec-min-detectable-change" class="nav-link" data-scroll-target="#sec-min-detectable-change"><span class="header-section-number">3.4.2</span> Minimum Detectable Change</a></li>
  </ul>
</li>
  <li>
<a href="#sec-spatial-aggregation" id="toc-sec-spatial-aggregation" class="nav-link" data-scroll-target="#sec-spatial-aggregation"><span class="header-section-number">3.5</span> Spatial Aggregation Uncertainty</a>
  <ul class="collapse">
<li><a href="#sec-pixel-area" id="toc-sec-pixel-area" class="nav-link" data-scroll-target="#sec-pixel-area"><span class="header-section-number">3.5.1</span> Pixel Area Projection</a></li>
  <li><a href="#sec-zonal-statistics" id="toc-sec-zonal-statistics" class="nav-link" data-scroll-target="#sec-zonal-statistics"><span class="header-section-number">3.5.2</span> Zonal Statistics</a></li>
  </ul>
</li>
  <li>
<a href="#sec-reference-data" id="toc-sec-reference-data" class="nav-link" data-scroll-target="#sec-reference-data"><span class="header-section-number">3.6</span> Reference Data Quality</a>
  <ul class="collapse">
<li><a href="#sec-sample-size-calculation" id="toc-sec-sample-size-calculation" class="nav-link" data-scroll-target="#sec-sample-size-calculation"><span class="header-section-number">3.6.1</span> Required Sample Size</a></li>
  <li><a href="#sec-temporal-consistency-ref" id="toc-sec-temporal-consistency-ref" class="nav-link" data-scroll-target="#sec-temporal-consistency-ref"><span class="header-section-number">3.6.2</span> Temporal Consistency</a></li>
  </ul>
</li>
  <li>
<a href="#sec-ad-integrated-workflow" id="toc-sec-ad-integrated-workflow" class="nav-link" data-scroll-target="#sec-ad-integrated-workflow"><span class="header-section-number">3.7</span> Reproducible Workflow</a>
  <ul class="collapse">
<li><a href="#sec-ad-monte-carlo-complete" id="toc-sec-ad-monte-carlo-complete" class="nav-link" data-scroll-target="#sec-ad-monte-carlo-complete"><span class="header-section-number">3.7.1</span> Monte Carlo Implementation</a></li>
  </ul>
</li>
  <li>
<a href="#sec-ad-art-trees" id="toc-sec-ad-art-trees" class="nav-link" data-scroll-target="#sec-ad-art-trees"><span class="header-section-number">3.8</span> ART-TREES Compliance</a>
  <ul class="collapse">
<li><a href="#sec-ad-documentation" id="toc-sec-ad-documentation" class="nav-link" data-scroll-target="#sec-ad-documentation"><span class="header-section-number">3.8.1</span> Documentation</a></li>
  <li><a href="#sec-ad-reporting-format" id="toc-sec-ad-reporting-format" class="nav-link" data-scroll-target="#sec-ad-reporting-format"><span class="header-section-number">3.8.2</span> Reporting Format</a></li>
  </ul>
</li>
  <li>
<a href="#sec-ad-summary" id="toc-sec-ad-summary" class="nav-link" data-scroll-target="#sec-ad-summary"><span class="header-section-number">3.9</span> Next Steps &amp; Notes</a>
  <ul class="collapse">
<li><a href="#sec-ad-success-factors" id="toc-sec-ad-success-factors" class="nav-link" data-scroll-target="#sec-ad-success-factors"><span class="header-section-number">3.9.1</span> Critical Success Factors</a></li>
  <li><a href="#next-chapter" id="toc-next-chapter" class="nav-link" data-scroll-target="#next-chapter"><span class="header-section-number">3.9.2</span> Next Chapter</a></li>
  </ul>
</li>
  <li><a href="#sec-ad-references" id="toc-sec-ad-references" class="nav-link" data-scroll-target="#sec-ad-references"><span class="header-section-number">3.10</span> References</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/training-resource/uncertainty/edit/main/03-activity-data/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/training-resource/uncertainty/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Activity Data</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="overview" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="overview">Overview</h2>
<p>Activity data (AD) represents the spatial extent and temporal dynamics of land-use change in REDD+ accounting. This chapter addresses uncertainty quantification in land cover classification, change detection, and spatial aggregation—typically the largest single contributor to total REDD+ uncertainty (40-60% of combined variance). As approaches to uncertainty calibrations practiced in Activity Data vary, we organized these around the following technical areas and components:</p>
<ol type="1">
<li>Land representation: Spatial distribution of forest and non-forest land</li>
<li>Land-use transitions: Conversion between IPCC land categories</li>
<li>Stratification: Forest type, management status, ecological zones</li>
<li>Temporal dynamics: Annual or multi-year change detection</li>
</ol>
<section id="environment-setup" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="environment-setup">Environment Setup</h3>
<pre class="{web-r}"><code>#| warning: false
#| message: false
#| echo: true
#| comment: NA

easypackages::packages(
  "bslib", 
  "cols4all", "covr", "cowplot", 
  "dendextend", "digest","DiagrammeR","dtwclust", "downlit", 
  "e1071", "exactextractr","elevatr", 
  "FNN", "future", "forestdata",
  "gdalcubes", "gdalUtilities", "geojsonsf", "geos", "ggplot2", "ggstats", 
  "ggspatial", "ggmap", "ggplotify", "ggpubr", "ggrepel", "giscoR", 
  "hdf5r", "httr", "httr2", "htmltools",
  "jsonlite", 
  "kohonen", 
  "leaflet.providers", "leafem", "libgeos","luz","lwgeom", "leaflet", "leafgl",
  "mapedit", "mapview", "maptiles", "methods", "mgcv", 
  "ncdf4", "nnet", 
  "openxlsx", "parallel", "plotly", 
  "randomForest", "rasterVis", "raster", "Rcpp", "RcppArmadillo", 
  "RcppCensSpatial","rayshader", "RcppEigen", "RcppParallel", 
  "RColorBrewer", "reactable", "rgl", "rsconnect","RStoolbox", "rts", 
  "s2", "sf", "scales", "sits","spdep", "stars", "stringr","supercells", 
  "terra", "testthat", "tidyverse", "tidyterra","tools", 
  "tmap", "tmaptools", "terrainr", 
  "xgboost",
  prompt = F)

#mapviewOptions(fgb = FALSE)
sf::sf_use_s2(use_s2 = FALSE)</code></pre>
<div class="cell">
<style type="text/css">
div.column {
    display: inline-block;
    vertical-align: top;
    width: 50%;
}

#TOC::before {
  content: "";
  display: block;
  height:200px;
  width: 200px;
  background-image: url('https://raw.githubusercontent.com/seamusrobertmurphy/map-templates/refs/heads/main/assets/outputs/01-site-map.png');
  background-size: contain;
  background-position: 50% 50%;
  padding-top: 80px !important;
  background-repeat: no-repeat;
}
</style>
</div>
<hr></section></section><section id="ipcc-lulc-approaches" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="ipcc-lulc-approaches">
<span class="header-section-number">3.1</span> IPCC LULC Approaches:</h2>
<p>The architecture of land-use transition monitoring systems are key to uncertainty estimation. In terms of IPCC guidelines, we must first distinguish which land-use transition matrix our MRV system is built upon:</p>
<table class="caption-top table">
<thead><tr class="header">
<th>Approach</th>
<th>Data Requirement</th>
<th>Spatial Explicitness</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Approach 1</td>
<td>Total areas by category</td>
<td>None (aggregated statistics)</td>
</tr>
<tr class="even">
<td>Approach 2</td>
<td>Transition matrices</td>
<td>Sampling-based</td>
</tr>
<tr class="odd">
<td>Approach 3</td>
<td>Wall-to-wall maps</td>
<td>Spatially explicit</td>
</tr>
</tbody>
</table>
<p>REDD+ standard: Most carbon projects use Approach 3 with remote sensing classification, combining high spatial resolution with complete coverage.</p>
</section><section id="sec-ad-sources" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="sec-ad-sources">
<span class="header-section-number">3.2</span> Sources of Uncertainty</h2>
<p>Classification accuracy:</p>
<ul>
<li>Producer’s accuracy: Omission error (missing true forest)</li>
<li>User’s accuracy: Commission error (false forest pixels)</li>
<li>Mixed pixels: Sub-pixel heterogeneity at edges</li>
</ul>
<p>Change detection errors:</p>
<ul>
<li>Temporal inconsistency: Sensor differences, atmospheric effects</li>
<li>Phenological confusion: Seasonal vegetation changes vs.&nbsp;permanent clearing</li>
<li>Gradual degradation: Difficult to detect with binary classifiers</li>
</ul>
<p>Spatial representation:</p>
<ul>
<li>Geometric accuracy: Co-registration errors between dates</li>
<li>Projection distortion: Area calculation at different latitudes</li>
<li>Minimum mapping unit: Small patches below detection threshold</li>
</ul>
<p>Reference data limitations:</p>
<ul>
<li>Sample size: Insufficient validation points for rare classes</li>
<li>Temporal lag: Reference date ≠ map date</li>
<li>Interpretation error: Photo-interpreter disagreement</li>
</ul>
<hr></section><section id="sec-lc-uncertainty" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="sec-lc-uncertainty">
<span class="header-section-number">3.3</span> Land Classification Uncertainty</h2>
<section id="sec-confusion-matrix" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="sec-confusion-matrix">
<span class="header-section-number">3.3.1</span> Confusion Matrix Analysis</h3>
<p>The confusion matrix (error matrix) provides the foundation for uncertainty quantification:</p>
<pre class="{web-r}"><code><a href="https://github.com/topepo/caret/">#| eval: true
#| label: ad-confusion-matrix-example
#| code-summary: "Create confusion matrix from validation data"

library(caret)
library(tidyverse)

# Example validation dataset
# reference = ground truth, predicted = classification result
validation_data &lt;- data.frame(
  reference = c(rep("Forest", 180), rep("Non-Forest", 20),
                rep("Forest", 15), rep("Non-Forest", 185)),
  predicted = c(rep("Forest", 180), rep("Forest", 20),
                rep("Non-Forest", 15), rep("Non-Forest", 185))
)

# Create confusion matrix
conf_matrix &lt;- confusionMatrix(
  data = factor(validation_data$predicted, levels = c("Forest", "Non-Forest")),
  reference = factor(validation_data$reference, levels = c("Forest", "Non-Forest"))
)

print(conf_matrix)</a></code></pre>
<p>Output interpretation:</p>
<pre><code>Confusion Matrix and Statistics

              Reference
Prediction     Forest Non-Forest
  Forest         180         20
  Non-Forest      15        185
                                          
               Accuracy : 0.9125          
                 95% CI : (0.8797, 0.9388)
    No Information Rate : 0.4875          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
  Producer's Acc (Forest) : 0.923 (180/195)
  User's Acc (Forest)     : 0.900 (180/200)
  Producer's Acc (Non-Forest) : 0.902 (185/205)
  User's Acc (Non-Forest)     : 0.925 (185/200)</code></pre>
<p>Key metrics:</p>
<ul>
<li>Overall accuracy: 0.9125 (91.25% correct)</li>
<li>Kappa coefficient: 0.825 (substantial agreement)</li>
<li>Omission error (Forest): 7.7% (15/195) - forest pixels classified as non-forest</li>
<li>Commission error (Forest): 10% (20/200) - non-forest pixels classified as forest</li>
</ul></section><section id="sec-lc-monte-carlo" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="sec-lc-monte-carlo">
<span class="header-section-number">3.3.2</span> Monte Carlo Simulation</h3>
<p>Objective: Propagate classification errors to area estimates</p>
<p>Method: Bootstrap resampling of confusion matrix</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to simulate area estimates with classification uncertainty</span></span>
<span><span class="va">simulate_area_uncertainty</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">confusion_matrix</span>, <span class="va">n_sim</span> <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Extract confusion matrix counts</span></span>
<span>  <span class="va">conf_table</span> <span class="op">&lt;-</span> <span class="va">confusion_matrix</span><span class="op">$</span><span class="va">table</span></span>
<span>  <span class="va">n_classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">conf_table</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate column totals (reference totals)</span></span>
<span>  <span class="va">ref_totals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">conf_table</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate producer's accuracy for each class</span></span>
<span>  <span class="va">producers_acc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">conf_table</span><span class="op">)</span> <span class="op">/</span> <span class="va">ref_totals</span></span>
<span>  </span>
<span>  <span class="co"># Simulate classification outcomes</span></span>
<span>  <span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">n_sim</span>, ncol <span class="op">=</span> <span class="va">n_classes</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sim_results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">conf_table</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># For each class, sample from binomial distribution</span></span>
<span>    <span class="co"># n = reference count, p = producer's accuracy</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_classes</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">sim_results</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, size <span class="op">=</span> <span class="va">ref_totals</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, prob <span class="op">=</span> <span class="va">producers_acc</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Calculate statistics</span></span>
<span>  <span class="va">area_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">sim_results</span><span class="op">)</span></span>
<span>  <span class="va">area_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sim_results</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></span>
<span>  <span class="va">area_ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sim_results</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">conf_table</span><span class="op">)</span>,</span>
<span>    mean_pixels <span class="op">=</span> <span class="va">area_mean</span>,</span>
<span>    sd_pixels <span class="op">=</span> <span class="va">area_sd</span>,</span>
<span>    ci_lower <span class="op">=</span> <span class="va">area_ci</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,</span>
<span>    ci_upper <span class="op">=</span> <span class="va">area_ci</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>,</span>
<span>    uncertainty_pct <span class="op">=</span> <span class="op">(</span><span class="va">area_ci</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span> <span class="op">-</span> <span class="va">area_ci</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">area_mean</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    summary <span class="op">=</span> <span class="va">results</span>,</span>
<span>    simulations <span class="op">=</span> <span class="va">sim_results</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Run simulation</span></span>
<span><span class="va">mc_results</span> <span class="op">&lt;-</span> <span class="fu">simulate_area_uncertainty</span><span class="op">(</span><span class="va">conf_matrix</span>, n_sim <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">mc_results</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example output:</p>
<pre><code>        class mean_pixels sd_pixels ci_lower ci_upper uncertainty_pct
1      Forest         180      3.85      173      187            3.9%
2  Non-Forest         185      3.92      178      192            3.8%</code></pre>
<p>Interpretation:</p>
<ul>
<li>Forest area uncertainty: ±3.9% (90% CI)</li>
<li>Propagates to emissions estimates:</li>
</ul>
<p><span class="math display">\[\sigma_{emissions} = A \times U_A\]</span></p>
</section><section id="sec-stratified-sampling" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="sec-stratified-sampling">
<span class="header-section-number">3.3.3</span> Accuracy Assessment Stratified</h3>
<p>Challenge: Rare classes (e.g., degradation) undersampled in random validation</p>
<p>Solution: Stratified random sampling with proportional or optimized allocation</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate optimal sample size per stratum</span></span>
<span><span class="co"># Neyman allocation: n_h = n * (N_h * S_h) / sum(N_h * S_h)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stratum information</span></span>
<span><span class="va">strata_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  stratum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Stable Forest"</span>, <span class="st">"Deforestation"</span>, <span class="st">"Degradation"</span>, <span class="st">"Stable Non-Forest"</span><span class="op">)</span>,</span>
<span>  area_ha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">450000</span>, <span class="fl">5000</span>, <span class="fl">15000</span>, <span class="fl">30000</span><span class="op">)</span>,  <span class="co"># N_h</span></span>
<span>  expected_variance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.20</span>, <span class="fl">0.05</span><span class="op">)</span>  <span class="co"># S_h (estimated)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Total sample budget</span></span>
<span><span class="va">total_samples</span> <span class="op">&lt;-</span> <span class="fl">400</span></span>
<span></span>
<span><span class="co"># Neyman allocation</span></span>
<span><span class="va">strata_data</span> <span class="op">&lt;-</span> <span class="va">strata_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    product <span class="op">=</span> <span class="va">area_ha</span> <span class="op">*</span> <span class="va">expected_variance</span>,</span>
<span>    allocation <span class="op">=</span> <span class="op">(</span><span class="va">product</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">product</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">total_samples</span>,</span>
<span>    samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">allocation</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">strata_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Proportional allocation (for comparison)</span></span>
<span><span class="va">strata_data</span><span class="op">$</span><span class="va">proportional</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">strata_data</span><span class="op">$</span><span class="va">area_ha</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">strata_data</span><span class="op">$</span><span class="va">area_ha</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">total_samples</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">strata_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">stratum</span>, <span class="va">samples</span>, <span class="va">proportional</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Output:</p>
<pre><code>            stratum  samples proportional
1    Stable Forest      108          360
2    Deforestation       60           4
3      Degradation       86          12
4 Stable Non-Forest       36          24</code></pre>
<p>Key insight: Neyman allocation dramatically increases sampling in rare but variable strata (deforestation, degradation), improving overall uncertainty.</p>
<hr></section></section><section id="sec-change-detection" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="sec-change-detection">
<span class="header-section-number">3.4</span> Land Change Uncertainty</h2>
<section id="sec-temporal-consistency" class="level3" data-number="3.4.1"><h3 data-number="3.4.1" class="anchored" data-anchor-id="sec-temporal-consistency">
<span class="header-section-number">3.4.1</span> Temporal Registration Error</h3>
<p>Geometric co-registration error propagates to change detection:</p>
<p><span class="math display">\[
U_{change}^2 = U_{t1}^2 + U_{t2}^2 + 2 \times U_{registration}^2
\]</span></p>
<p>Where: - <span class="math inline">\(U_{t1}\)</span>: Classification uncertainty at time 1 - <span class="math inline">\(U_{t2}\)</span>: Classification uncertainty at time 2<br>
- <span class="math inline">\(U_{registration}\)</span>: Positional error between dates</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate registration error</span></span>
<span><span class="va">simulate_registration_error</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raster_t1</span>, <span class="va">raster_t2</span>, <span class="va">error_pixels</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Original change map</span></span>
<span>  <span class="va">change_original</span> <span class="op">&lt;-</span> <span class="va">raster_t2</span> <span class="op">-</span> <span class="va">raster_t1</span></span>
<span>  </span>
<span>  <span class="co"># Apply random shift to t2 (simulating misregistration)</span></span>
<span>  <span class="co"># Shift by 'error_pixels' in random direction</span></span>
<span>  <span class="va">n_sim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span>  <span class="va">change_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">n_sim</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Random shift direction</span></span>
<span>    <span class="va">shift_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="op">-</span><span class="va">error_pixels</span><span class="op">:</span><span class="va">error_pixels</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">shift_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="op">-</span><span class="va">error_pixels</span><span class="op">:</span><span class="va">error_pixels</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Shift raster_t2</span></span>
<span>    <span class="va">raster_t2_shifted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/shift.html">shift</a></span><span class="op">(</span><span class="va">raster_t2</span>, dx <span class="op">=</span> <span class="va">shift_x</span>, dy <span class="op">=</span> <span class="va">shift_y</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Recalculate change</span></span>
<span>    <span class="va">change_shifted</span> <span class="op">&lt;-</span> <span class="va">raster_t2_shifted</span> <span class="op">-</span> <span class="va">raster_t1</span></span>
<span>    </span>
<span>    <span class="co"># Calculate disagreement with original</span></span>
<span>    <span class="va">disagreement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">change_shifted</span> <span class="op">-</span> <span class="va">change_original</span><span class="op">)</span></span>
<span>    <span class="va">change_error</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html">global</a></span><span class="op">(</span><span class="va">disagreement</span>, <span class="st">"mean"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    mean_error <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">change_error</span><span class="op">)</span>,</span>
<span>    sd_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">change_error</span><span class="op">)</span>,</span>
<span>    ci_90 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/quantile.html">quantile</a></span><span class="op">(</span><span class="va">change_error</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example usage</span></span>
<span><span class="co"># registration_uncertainty &lt;- simulate_registration_error(forest_2010, forest_2020, error_pixels = 1)</span></span>
<span><span class="co"># print(paste("Registration error:", round(registration_uncertainty$mean_error * 100, 2), "%"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-min-detectable-change" class="level3" data-number="3.4.2"><h3 data-number="3.4.2" class="anchored" data-anchor-id="sec-min-detectable-change">
<span class="header-section-number">3.4.2</span> Minimum Detectable Change</h3>
<p>Statistical power analysis for change detection:</p>
<p><span class="math display">\[
\text{MDD} = (Z_{\alpha/2} + Z_{\beta}) \times \sqrt{\sigma_1^2 + \sigma_2^2}
\]</span></p>
<p>Where: - MDD: Minimum detectable difference - <span class="math inline">\(Z_{\alpha/2}\)</span>: Critical value for significance level (e.g., 1.645 for 90%) - <span class="math inline">\(Z_{\beta}\)</span>: Critical value for power (e.g., 0.84 for 80% power) - <span class="math inline">\(\sigma_1, \sigma_2\)</span>: Standard deviations of measurements</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to calculate MDD</span></span>
<span><span class="va">calculate_mdd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sigma1</span>, <span class="va">sigma2</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.10</span>, <span class="va">power</span> <span class="op">=</span> <span class="fl">0.80</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Z-scores for significance and power</span></span>
<span>  <span class="va">z_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># Two-tailed</span></span>
<span>  <span class="va">z_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Pooled standard deviation</span></span>
<span>  <span class="va">sigma_pooled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">sigma1</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">sigma2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Minimum detectable difference</span></span>
<span>  <span class="va">mdd</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">z_alpha</span> <span class="op">+</span> <span class="va">z_beta</span><span class="op">)</span> <span class="op">*</span> <span class="va">sigma_pooled</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    mdd <span class="op">=</span> <span class="va">mdd</span>,</span>
<span>    mdd_relative <span class="op">=</span> <span class="va">mdd</span> <span class="op">/</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sigma1</span>, <span class="va">sigma2</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    z_alpha <span class="op">=</span> <span class="va">z_alpha</span>,</span>
<span>    z_beta <span class="op">=</span> <span class="va">z_beta</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example: Forest cover change detection</span></span>
<span><span class="co"># Assuming 5% uncertainty in each time period</span></span>
<span><span class="va">mdd_forest</span> <span class="op">&lt;-</span> <span class="fu">calculate_mdd</span><span class="op">(</span>sigma1 <span class="op">=</span> <span class="fl">5</span>, sigma2 <span class="op">=</span> <span class="fl">5</span>, alpha <span class="op">=</span> <span class="fl">0.10</span>, power <span class="op">=</span> <span class="fl">0.80</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Minimum detectable change: %.2f%% (absolute)\n"</span>, <span class="va">mdd_forest</span><span class="op">$</span><span class="va">mdd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Relative to mean uncertainty: %.1f%%\n"</span>, <span class="va">mdd_forest</span><span class="op">$</span><span class="va">mdd_relative</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Output:</p>
<pre><code>Minimum detectable change: 11.66% (absolute)
Relative to mean uncertainty: 233.1%</code></pre>
<p>Interpretation: With 5% classification uncertainty at each date, changes &lt;11.66% cannot be detected with statistical confidence. This sets a minimum mapping unit for credible change detection.</p>
<hr></section></section><section id="sec-spatial-aggregation" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="sec-spatial-aggregation">
<span class="header-section-number">3.5</span> Spatial Aggregation Uncertainty</h2>
<section id="sec-pixel-area" class="level3" data-number="3.5.1"><h3 data-number="3.5.1" class="anchored" data-anchor-id="sec-pixel-area">
<span class="header-section-number">3.5.1</span> Pixel Area Projection</h3>
<p>Challenge: Pixel area varies with latitude in most projections</p>
<p>Solution: Calculate pixel-specific area weights</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function to calculate true pixel area accounting for projection</span></span>
<span><span class="va">calculate_pixel_areas</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raster_template</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Get cell size in map units</span></span>
<span>  <span class="va">cell_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html">res</a></span><span class="op">(</span><span class="va">raster_template</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Get latitudes of cell centers</span></span>
<span>  <span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">raster_template</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html">ncell</a></span><span class="op">(</span><span class="va">raster_template</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">lats</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Earth's radius (meters)</span></span>
<span>  <span class="va">earth_radius</span> <span class="op">&lt;-</span> <span class="fl">6371000</span></span>
<span>  </span>
<span>  <span class="co"># Convert degrees to radians</span></span>
<span>  <span class="va">lat_rad</span> <span class="op">&lt;-</span> <span class="va">lats</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span></span>
<span>  </span>
<span>  <span class="co"># Calculate north-south distance (constant)</span></span>
<span>  <span class="va">ns_distance</span> <span class="op">&lt;-</span> <span class="va">earth_radius</span> <span class="op">*</span> <span class="op">(</span><span class="va">cell_size</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate east-west distance (varies with latitude)</span></span>
<span>  <span class="va">ew_distance</span> <span class="op">&lt;-</span> <span class="va">earth_radius</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">lat_rad</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">cell_size</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Pixel area in hectares</span></span>
<span>  <span class="va">pixel_area_ha</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">ns_distance</span> <span class="op">*</span> <span class="va">ew_distance</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10000</span></span>
<span>  </span>
<span>  <span class="co"># Create raster of pixel areas</span></span>
<span>  <span class="va">area_raster</span> <span class="op">&lt;-</span> <span class="va">raster_template</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html">values</a></span><span class="op">(</span><span class="va">area_raster</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">pixel_area_ha</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">area_raster</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate total forest area with area correction</span></span>
<span><span class="va">calculate_forest_area</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">forest_raster</span>, <span class="va">area_raster</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Forest pixels (value = 1)</span></span>
<span>  <span class="va">forest_pixels</span> <span class="op">&lt;-</span> <span class="va">forest_raster</span> <span class="op">==</span> <span class="fl">1</span></span>
<span>  </span>
<span>  <span class="co"># Multiply by pixel-specific areas</span></span>
<span>  <span class="va">forest_area_map</span> <span class="op">&lt;-</span> <span class="va">forest_pixels</span> <span class="op">*</span> <span class="va">area_raster</span></span>
<span>  </span>
<span>  <span class="co"># Sum to get total area</span></span>
<span>  <span class="va">total_area_ha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html">global</a></span><span class="op">(</span><span class="va">forest_area_map</span>, <span class="st">"sum"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Also calculate assuming uniform pixel size (uncorrected)</span></span>
<span>  <span class="va">nominal_pixel_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html">res</a></span><span class="op">(</span><span class="va">forest_raster</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10000</span>  <span class="co"># ha</span></span>
<span>  <span class="va">uncorrected_area_ha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html">values</a></span><span class="op">(</span><span class="va">forest_pixels</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="va">nominal_pixel_area</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    corrected_area_ha <span class="op">=</span> <span class="va">total_area_ha</span>,</span>
<span>    uncorrected_area_ha <span class="op">=</span> <span class="va">uncorrected_area_ha</span>,</span>
<span>    difference_pct <span class="op">=</span> <span class="op">(</span><span class="va">uncorrected_area_ha</span> <span class="op">-</span> <span class="va">total_area_ha</span><span class="op">)</span> <span class="op">/</span> <span class="va">total_area_ha</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example</span></span>
<span><span class="co"># area_raster &lt;- calculate_pixel_areas(forest_2020)</span></span>
<span><span class="co"># forest_area &lt;- calculate_forest_area(forest_2020, area_raster)</span></span>
<span><span class="co"># cat(sprintf("Area correction: %.2f%% difference\n", forest_area$difference_pct))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Typical magnitude: 0.5-2% for tropical projects (near equator), up to 5-10% for boreal projects (high latitudes).</p>
</section><section id="sec-zonal-statistics" class="level3" data-number="3.5.2"><h3 data-number="3.5.2" class="anchored" data-anchor-id="sec-zonal-statistics">
<span class="header-section-number">3.5.2</span> Zonal Statistics</h3>
<p>Edge effects at jurisdictional boundaries:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://isciences.gitlab.io/exactextractr/">exactextractr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function to assess boundary uncertainty</span></span>
<span><span class="va">assess_boundary_uncertainty</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">raster_data</span>, <span class="va">boundary_polygon</span>, <span class="va">buffer_m</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Original zonal statistic</span></span>
<span>  <span class="va">original_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://isciences.gitlab.io/exactextractr/reference/exact_extract.html">exact_extract</a></span><span class="op">(</span></span>
<span>    <span class="va">raster_data</span>, </span>
<span>    <span class="va">boundary_polygon</span>, </span>
<span>    fun <span class="op">=</span> <span class="st">'sum'</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Create multiple buffered boundaries (simulate positional uncertainty)</span></span>
<span>  <span class="va">n_sim</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>  <span class="va">buffered_sums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">n_sim</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Random buffer (-buffer_m to +buffer_m)</span></span>
<span>    <span class="va">random_buffer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="va">buffer_m</span>, <span class="va">buffer_m</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Apply buffer</span></span>
<span>    <span class="va">buffered_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="va">boundary_polygon</span>, dist <span class="op">=</span> <span class="va">random_buffer</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Recalculate sum</span></span>
<span>    <span class="va">buffered_sums</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://isciences.gitlab.io/exactextractr/reference/exact_extract.html">exact_extract</a></span><span class="op">(</span></span>
<span>      <span class="va">raster_data</span>,</span>
<span>      <span class="va">buffered_boundary</span>,</span>
<span>      fun <span class="op">=</span> <span class="st">'sum'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Calculate uncertainty</span></span>
<span>  <span class="va">boundary_uncertainty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">buffered_sums</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">buffered_sums</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    original_value <span class="op">=</span> <span class="va">original_sum</span>,</span>
<span>    mean_simulated <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">buffered_sums</span><span class="op">)</span>,</span>
<span>    sd_simulated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">buffered_sums</span><span class="op">)</span>,</span>
<span>    uncertainty_pct <span class="op">=</span> <span class="va">boundary_uncertainty</span>,</span>
<span>    ci_90 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/quantile.html">quantile</a></span><span class="op">(</span><span class="va">buffered_sums</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example usage</span></span>
<span><span class="co"># boundary_uncert &lt;- assess_boundary_uncertainty(</span></span>
<span><span class="co">#   raster_data = forest_cover,</span></span>
<span><span class="co">#   boundary_polygon = project_boundary,</span></span>
<span><span class="co">#   buffer_m = 50  # 50m positional uncertainty</span></span>
<span><span class="co"># )</span></span>
<span><span class="co"># print(paste("Boundary uncertainty:", round(boundary_uncert$uncertainty_pct, 2), "%"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mitigation strategies: - Use high-precision GPS for boundary demarcation (±5m accuracy) - Apply buffer zones to exclude edge pixels - Document boundary uncertainty in monitoring plan</p>
<hr></section></section><section id="sec-reference-data" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="sec-reference-data">
<span class="header-section-number">3.6</span> Reference Data Quality</h2>
<section id="sec-sample-size-calculation" class="level3" data-number="3.6.1"><h3 data-number="3.6.1" class="anchored" data-anchor-id="sec-sample-size-calculation">
<span class="header-section-number">3.6.1</span> Required Sample Size</h3>
<p>Objective: Determine validation sample size for desired confidence interval</p>
<p>Formula (simple random sampling):</p>
<p><span class="math display">\[
n = \frac{Z^2 \times p \times (1-p)}{E^2}
\]</span></p>
<p>Where: - <span class="math inline">\(n\)</span>: Required sample size - <span class="math inline">\(Z\)</span>: Z-score for confidence level (1.645 for 90%) - <span class="math inline">\(p\)</span>: Expected proportion (e.g., 0.50 for maximum variance) - <span class="math inline">\(E\)</span>: Desired margin of error (e.g., 0.05 for ±5%)</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to calculate sample size</span></span>
<span><span class="va">calculate_sample_size</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">confidence</span> <span class="op">=</span> <span class="fl">0.90</span>, <span class="va">margin_error</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">proportion</span> <span class="op">=</span> <span class="fl">0.50</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Z-score for confidence level</span></span>
<span>  <span class="va">z_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">confidence</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate sample size</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">z_score</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">proportion</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">margin_error</span><span class="op">^</span><span class="fl">2</span></span>
<span>  </span>
<span>  <span class="co"># Round up</span></span>
<span>  <span class="va">n_rounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    sample_size <span class="op">=</span> <span class="va">n_rounded</span>,</span>
<span>    confidence <span class="op">=</span> <span class="va">confidence</span>,</span>
<span>    margin_error <span class="op">=</span> <span class="va">margin_error</span>,</span>
<span>    z_score <span class="op">=</span> <span class="va">z_score</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate for different scenarios</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>  confidence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.90</span>, <span class="fl">0.95</span><span class="op">)</span>,</span>
<span>  margin_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span><span class="op">)</span>,</span>
<span>  proportion <span class="op">=</span> <span class="fl">0.50</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">scenarios</span><span class="op">$</span><span class="va">required_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">scenarios</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">calculate_sample_size</span><span class="op">(</span></span>
<span>    confidence <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    margin_error <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    proportion <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">sample_size</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">scenarios</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Confidence"</span>, <span class="st">"Margin of Error"</span>, <span class="st">"Proportion"</span>, <span class="st">"Sample Size"</span><span class="op">)</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Required Validation Sample Sizes"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Output:</p>
<pre><code>| Confidence | Margin of Error | Proportion | Sample Size |
|------------|-----------------|------------|-------------|
| 90%        | 3%              | 0.50       | 752         |
| 90%        | 5%              | 0.50       | 271         |
| 90%        | 10%             | 0.50       | 68          |
| 95%        | 3%              | 0.50       | 1068        |
| 95%        | 5%              | 0.50       | 385         |
| 95%        | 10%             | 0.50       | 97          |</code></pre>
<p>Practical guidance: - Minimum: 100 samples per class for rare categories - Typical: 300-500 samples for overall accuracy ±5% at 90% confidence - Optimal: 1000+ samples for detecting &lt;2% changes</p>
</section><section id="sec-temporal-consistency-ref" class="level3" data-number="3.6.2"><h3 data-number="3.6.2" class="anchored" data-anchor-id="sec-temporal-consistency-ref">
<span class="header-section-number">3.6.2</span> Temporal Consistency</h3>
<p>Challenge: Reference imagery date ≠ classification date</p>
<p>Acceptable lag: ±1 year for stable landscapes, ±6 months for dynamic areas</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Simulate accuracy degradation with temporal lag</span></span>
<span><span class="va">assess_temporal_lag</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">base_accuracy</span> <span class="op">=</span> <span class="fl">0.92</span>, <span class="va">lag_months</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, <span class="fl">6</span><span class="op">)</span>, <span class="va">degradation_rate</span> <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Accuracy decreases with lag</span></span>
<span>  <span class="va">accuracy_lagged</span> <span class="op">&lt;-</span> <span class="va">base_accuracy</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">degradation_rate</span> <span class="op">*</span> <span class="va">lag_months</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Create results table</span></span>
<span>  <span class="va">lag_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    lag_months <span class="op">=</span> <span class="va">lag_months</span>,</span>
<span>    accuracy <span class="op">=</span> <span class="va">accuracy_lagged</span>,</span>
<span>    accuracy_loss <span class="op">=</span> <span class="op">(</span><span class="va">base_accuracy</span> <span class="op">-</span> <span class="va">accuracy_lagged</span><span class="op">)</span> <span class="op">/</span> <span class="va">base_accuracy</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">lag_results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate temporal lag effects</span></span>
<span><span class="va">lag_impact</span> <span class="op">&lt;-</span> <span class="fu">assess_temporal_lag</span><span class="op">(</span>base_accuracy <span class="op">=</span> <span class="fl">0.92</span>, lag_months <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">lag_impact</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lag_months</span>, y <span class="op">=</span> <span class="va">accuracy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.90</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">12</span>, y <span class="op">=</span> <span class="fl">0.905</span>, label <span class="op">=</span> <span class="st">"90% threshold"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Classification Accuracy vs. Reference Data Temporal Lag"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Lag (months)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Classification Accuracy"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mitigation: - Use near-contemporary reference data (±6 months) - Apply phenological normalization - Document and report temporal lag in uncertainty assessment</p>
<hr></section></section><section id="sec-ad-integrated-workflow" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="sec-ad-integrated-workflow">
<span class="header-section-number">3.7</span> Reproducible Workflow</h2>
<section id="sec-ad-monte-carlo-complete" class="level3" data-number="3.7.1"><h3 data-number="3.7.1" class="anchored" data-anchor-id="sec-ad-monte-carlo-complete">
<span class="header-section-number">3.7.1</span> Monte Carlo Implementation</h3>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># =============================================================================</span></span>
<span><span class="co"># INTEGRATED ACTIVITY DATA UNCERTAINTY ASSESSMENT</span></span>
<span><span class="co"># Combines: Classification + Change Detection + Spatial Aggregation</span></span>
<span><span class="co"># =============================================================================</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span>  <span class="co"># For mvrnorm</span></span>
<span></span>
<span><span class="co"># Function: Integrated uncertainty assessment</span></span>
<span><span class="va">integrated_activity_data_uncertainty</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">confusion_matrix</span>,</span>
<span>  <span class="va">area_t1_ha</span>,</span>
<span>  <span class="va">area_t2_ha</span>,</span>
<span>  <span class="va">registration_error_m</span> <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  <span class="va">pixel_size_m</span> <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  <span class="va">n_sim</span> <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Extract classification uncertainties</span></span>
<span>  <span class="va">conf_table</span> <span class="op">&lt;-</span> <span class="va">confusion_matrix</span><span class="op">$</span><span class="va">table</span></span>
<span>  <span class="va">producers_acc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">conf_table</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rowSums.html">colSums</a></span><span class="op">(</span><span class="va">conf_table</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate classification CV (coefficient of variation)</span></span>
<span>  <span class="va">cv_classification</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">producers_acc</span><span class="op">)</span> <span class="op">/</span> <span class="va">producers_acc</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Registration error as proportion of pixel</span></span>
<span>  <span class="va">cv_registration</span> <span class="op">&lt;-</span> <span class="va">registration_error_m</span> <span class="op">/</span> <span class="va">pixel_size_m</span></span>
<span>  </span>
<span>  <span class="co"># Monte Carlo simulation</span></span>
<span>  <span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">n_sim</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sim_results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"area_t1"</span>, <span class="st">"area_t2"</span>, <span class="st">"change"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Sample classification uncertainty (lognormal to ensure positive)</span></span>
<span>    <span class="va">error_t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">area_t1_ha</span> <span class="op">*</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">cv_classification</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">error_t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">area_t2_ha</span> <span class="op">*</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">cv_classification</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Sample registration error</span></span>
<span>    <span class="va">error_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">area_t1_ha</span>, <span class="va">area_t2_ha</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">cv_registration</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Simulate areas</span></span>
<span>    <span class="va">sim_area_t1</span> <span class="op">&lt;-</span> <span class="va">area_t1_ha</span> <span class="op">+</span> <span class="va">error_t1</span></span>
<span>    <span class="va">sim_area_t2</span> <span class="op">&lt;-</span> <span class="va">area_t2_ha</span> <span class="op">+</span> <span class="va">error_t2</span> <span class="op">+</span> <span class="va">error_reg</span></span>
<span>    </span>
<span>    <span class="co"># Calculate change</span></span>
<span>    <span class="va">sim_change</span> <span class="op">&lt;-</span> <span class="va">sim_area_t2</span> <span class="op">-</span> <span class="va">sim_area_t1</span></span>
<span>    </span>
<span>    <span class="va">sim_results</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sim_area_t1</span>, <span class="va">sim_area_t2</span>, <span class="va">sim_change</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Calculate statistics</span></span>
<span>  <span class="va">results_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Area_t1"</span>, <span class="st">"Area_t2"</span>, <span class="st">"Change"</span><span class="op">)</span>,</span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rowSums.html">colMeans</a></span><span class="op">(</span><span class="va">sim_results</span><span class="op">)</span>,</span>
<span>    sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sim_results</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span>,</span>
<span>    ci_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sim_results</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    ci_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sim_results</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fl">0.95</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      cv_pct <span class="op">=</span> <span class="va">sd</span> <span class="op">/</span> <span class="va">mean</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>      hw_90 <span class="op">=</span> <span class="op">(</span><span class="va">ci_upper</span> <span class="op">-</span> <span class="va">ci_lower</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>      uncertainty_pct <span class="op">=</span> <span class="va">hw_90</span> <span class="op">/</span> <span class="va">mean</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    summary <span class="op">=</span> <span class="va">results_summary</span>,</span>
<span>    simulations <span class="op">=</span> <span class="va">sim_results</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example usage</span></span>
<span><span class="co"># Load confusion matrix (from previous section)</span></span>
<span><span class="co"># conf_matrix &lt;- [your confusion matrix]</span></span>
<span></span>
<span><span class="co"># Run integrated assessment</span></span>
<span><span class="va">uncertainty_results</span> <span class="op">&lt;-</span> <span class="fu">integrated_activity_data_uncertainty</span><span class="op">(</span></span>
<span>  confusion_matrix <span class="op">=</span> <span class="va">conf_matrix</span>,</span>
<span>  area_t1_ha <span class="op">=</span> <span class="fl">100000</span>,  <span class="co"># Initial forest area</span></span>
<span>  area_t2_ha <span class="op">=</span> <span class="fl">95000</span>,   <span class="co"># Final forest area</span></span>
<span>  registration_error_m <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  pixel_size_m <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">uncertainty_results</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize uncertainty distribution</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>change <span class="op">=</span> <span class="va">uncertainty_results</span><span class="op">$</span><span class="va">simulations</span><span class="op">[</span>, <span class="st">"change"</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">change</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span>, fill <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">uncertainty_results</span><span class="op">$</span><span class="va">simulations</span><span class="op">[</span>, <span class="st">"change"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">uncertainty_results</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">ci_lower</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">0.8</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">uncertainty_results</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">0.8</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Activity Data Uncertainty: Forest Area Change"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Mean: %.0f ha (90%% CI: %.0f - %.0f ha)"</span>,</span>
<span>                      <span class="va">uncertainty_results</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                      <span class="va">uncertainty_results</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">ci_lower</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                      <span class="va">uncertainty_results</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Change in Forest Area (ha)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Frequency"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr></section></section><section id="sec-ad-art-trees" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="sec-ad-art-trees">
<span class="header-section-number">3.8</span> ART-TREES Compliance</h2>
<section id="sec-ad-documentation" class="level3" data-number="3.8.1"><h3 data-number="3.8.1" class="anchored" data-anchor-id="sec-ad-documentation">
<span class="header-section-number">3.8.1</span> Documentation</h3>
<p>Monitoring Plan must include:</p>
<ol type="1">
<li>Classification methodology:</li>
</ol>
<ul>
<li>Algorithm (Random Forest, SVM, CNN, etc.)</li>
<li>Training data sample size and distribution</li>
<li>Accuracy assessment protocol</li>
</ul>
<ol start="2" type="1">
<li>Validation approach:</li>
</ol>
<ul>
<li>Sample design (stratified random, systematic)</li>
<li>Sample size justification (power analysis)</li>
<li>Reference data sources and dates</li>
</ul>
<ol start="3" type="1">
<li>Uncertainty quantification:</li>
</ol>
<ul>
<li>Monte Carlo simulation specification (n=10,000)</li>
<li>Error propagation methods</li>
<li>Confidence interval calculation</li>
</ul>
<ol start="4" type="1">
<li>Quality assurance:</li>
</ol>
<ul>
<li>Independent verification of classifications</li>
<li>Cross-validation results</li>
<li>Temporal consistency checks</li>
</ul></section><section id="sec-ad-reporting-format" class="level3" data-number="3.8.2"><h3 data-number="3.8.2" class="anchored" data-anchor-id="sec-ad-reporting-format">
<span class="header-section-number">3.8.2</span> Reporting Format</h3>
<p>CRF Table: Activity Data Uncertainty</p>
<hr></section></section><section id="sec-ad-summary" class="level2" data-number="3.9"><h2 data-number="3.9" class="anchored" data-anchor-id="sec-ad-summary">
<span class="header-section-number">3.9</span> Next Steps &amp; Notes</h2>
<section id="sec-ad-success-factors" class="level3" data-number="3.9.1"><h3 data-number="3.9.1" class="anchored" data-anchor-id="sec-ad-success-factors">
<span class="header-section-number">3.9.1</span> Critical Success Factors</h3>
<p>For &lt;10% activity data uncertainty: 1. Overall classification accuracy &gt;90% 2. Validation sample size &gt;400 points 3. Stratified sampling for rare classes 4. Geometric co-registration &lt;1 pixel 5. Reference data temporal lag &lt;6 months</p>
<p>For 10-20% uncertainty (acceptable Tier 2): - Overall accuracy 85-90% - Validation samples 200-400 - Registration &lt;2 pixels</p>
<p>For &gt;20% uncertainty (Tier 1, high deductions): - Overall accuracy &lt;85% - Inadequate validation - Significant temporal/spatial misalignment</p>
</section><section id="next-chapter" class="level3" data-number="3.9.2"><h3 data-number="3.9.2" class="anchored" data-anchor-id="next-chapter">
<span class="header-section-number">3.9.2</span> Next Chapter</h3>
<p>Chapter 2: Allometry Uncertainty will address:</p>
<ol type="1">
<li>Model selection: Geographic transferability, species specificity</li>
<li>Parameter estimation: Regression uncertainty, prediction intervals</li>
<li>Measurement error: DBH precision, height bias, wood density variability</li>
<li>Bias correction: Log-transformation, non-linear models</li>
</ol>
<p>Critical linkage: Activity data provides spatial extent; allometry converts that extent to biomass. Combined uncertainty:</p>
<p><span class="math display">\[
U_{total}^2 = U_{activity}^2 + U_{allometry}^2 + 2 \times \text{Cov}(A, B)
\]</span></p>
<p>Next steps: Quantify allometric uncertainty to enable full error propagation in Chapter 4.</p>
<hr></section></section><section id="sec-ad-references" class="level2" data-number="3.10"><h2 data-number="3.10" class="anchored" data-anchor-id="sec-ad-references">
<span class="header-section-number">3.10</span> References</h2>
<p>Olofsson, P., Foody, G.M., Herold, M., Stehman, S.V., Woodcock, C.E., &amp; Wulder, M.A.&nbsp;(2014). Good practices for estimating area and assessing accuracy of land change. Remote Sensing of Environment, 148, 42-57.</p>
<p>Stehman, S.V. (2014). Estimating area and map accuracy for stratified random sampling when the strata are different from the map classes. International Journal of Remote Sensing, 35(13), 4923-4939.</p>
<p>Pontius Jr., R.G., &amp; Millones, M. (2011). Death to Kappa: birth of quantity disagreement and allocation disagreement for accuracy assessment. International Journal of Remote Sensing, 32(15), 4407-4429.</p>
<p>GFOI (2016). Integration of remote-sensing and ground-based observations for estimation of emissions and removals of greenhouse gases in forests: Methods and Guidance from the Global Forest Observations Initiative. Edition 2.0. Rome: Food and Agriculture Organization.</p>
<p>GOFC-GOLD (2016). A sourcebook of methods and procedures for monitoring and reporting anthropogenic greenhouse gas emissions and removals associated with deforestation, gains and losses of carbon stocks in forests remaining forests, and forestation. GOFC-GOLD Report version COP22-1. Alberta, Canada: GOFC-GOLD Land Cover Project Office.</p>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../02-emission-factors/index.html" class="pagination-link" aria-label="Emission Factors">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Emission Factors</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../references/index.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">References</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Activity Data"</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "**On this page**"</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: pygments</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: article</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 60</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">  - webr</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../references/references.bib</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> ../references/apa.csl</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="an">citeproc:</span><span class="co"> true</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview {.unnumbered}</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>Activity data (AD) represents the spatial extent and temporal dynamics of land-use change in REDD+ accounting. This chapter addresses uncertainty quantification in land cover classification, change detection, and spatial aggregation—typically the largest single contributor to total REDD+ uncertainty (40-60% of combined variance). As approaches to uncertainty calibrations practiced in Activity Data vary, we organized these around the following technical areas and components:</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Land representation: Spatial distribution of forest and non-forest land</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Land-use transitions: Conversion between IPCC land categories</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Stratification: Forest type, management status, ecological zones</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Temporal dynamics: Annual or multi-year change detection</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="fu">### Environment Setup {.unnumbered}</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{web-r}</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: true</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="in">#| comment: NA</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="in">easypackages::packages(</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="in">  "bslib", </span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="in">  "cols4all", "covr", "cowplot", </span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="in">  "dendextend", "digest","DiagrammeR","dtwclust", "downlit", </span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="in">  "e1071", "exactextractr","elevatr", </span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="in">  "FNN", "future", "forestdata",</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="in">  "gdalcubes", "gdalUtilities", "geojsonsf", "geos", "ggplot2", "ggstats", </span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="in">  "ggspatial", "ggmap", "ggplotify", "ggpubr", "ggrepel", "giscoR", </span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="in">  "hdf5r", "httr", "httr2", "htmltools",</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="in">  "jsonlite", </span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="in">  "kohonen", </span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="in">  "leaflet.providers", "leafem", "libgeos","luz","lwgeom", "leaflet", "leafgl",</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="in">  "mapedit", "mapview", "maptiles", "methods", "mgcv", </span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="in">  "ncdf4", "nnet", </span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="in">  "openxlsx", "parallel", "plotly", </span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a><span class="in">  "randomForest", "rasterVis", "raster", "Rcpp", "RcppArmadillo", </span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="in">  "RcppCensSpatial","rayshader", "RcppEigen", "RcppParallel", </span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="in">  "RColorBrewer", "reactable", "rgl", "rsconnect","RStoolbox", "rts", </span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a><span class="in">  "s2", "sf", "scales", "sits","spdep", "stars", "stringr","supercells", </span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a><span class="in">  "terra", "testthat", "tidyverse", "tidyterra","tools", </span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="in">  "tmap", "tmaptools", "terrainr", </span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a><span class="in">  "xgboost",</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="in">  prompt = F)</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a><span class="in">#mapviewOptions(fgb = FALSE)</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a><span class="in">sf::sf_use_s2(use_s2 = FALSE)</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>),</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>        <span class="at">htmltools.dir.version =</span> <span class="cn">FALSE</span>, </span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">htmltools.preserve.raw =</span> <span class="cn">FALSE</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>, </span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>, </span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">error =</span> <span class="cn">FALSE</span>, </span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="cn">NA</span>, </span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">tidy.opts =</span> <span class="fu">list</span>(<span class="at">width.cutoff =</span> <span class="dv">60</span>)</span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{css, echo=FALSE, class.source = 'foldable'}</span></span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>div<span class="op">.</span><span class="fu">column</span> <span class="op">{</span></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a>    display<span class="op">:</span> inline<span class="op">-</span>block<span class="op">;</span></span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a>    vertical<span class="op">-</span>align<span class="op">:</span> top<span class="op">;</span></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a>    width<span class="op">:</span> <span class="dv">50</span><span class="op">%;</span></span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>#TOC<span class="op">::</span>before <span class="op">{</span></span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>  content<span class="op">:</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>  display<span class="op">:</span> block<span class="op">;</span></span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>  height<span class="op">:</span><span class="dv">200</span>px<span class="op">;</span></span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a>  width<span class="op">:</span> <span class="dv">200</span>px<span class="op">;</span></span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>  background<span class="op">-</span>image<span class="op">:</span> <span class="fu">url</span><span class="op">(</span>'https<span class="op">:</span><span class="co">//raw.githubusercontent.com/seamusrobertmurphy/map-templates/refs/heads/main/assets/outputs/01-site-map.png');</span></span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>  background<span class="op">-</span>size<span class="op">:</span> contain<span class="op">;</span></span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a>  background<span class="op">-</span>position<span class="op">:</span> <span class="dv">50</span><span class="op">%</span> <span class="dv">50</span><span class="op">%;</span></span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a>  padding<span class="op">-</span>top<span class="op">:</span> <span class="dv">80</span>px <span class="op">!</span>important<span class="op">;</span></span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a>  background<span class="op">-</span>repeat<span class="op">:</span> no<span class="op">-</span>repeat<span class="op">;</span></span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a><span class="fu">## IPCC LULC Approaches:</span></span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a>The architecture of land-use transition monitoring systems are key to uncertainty estimation. In terms of IPCC guidelines, we must first distinguish which land-use transition matrix our MRV system is built upon:</span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach   <span class="pp">|</span> Data Requirement        <span class="pp">|</span> Spatial Explicitness         <span class="pp">|</span></span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------|-------------------------|------------------------------|</span></span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach 1 <span class="pp">|</span> Total areas by category <span class="pp">|</span> None (aggregated statistics) <span class="pp">|</span></span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach 2 <span class="pp">|</span> Transition matrices     <span class="pp">|</span> Sampling-based               <span class="pp">|</span></span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach 3 <span class="pp">|</span> Wall-to-wall maps       <span class="pp">|</span> Spatially explicit           <span class="pp">|</span></span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a>REDD+ standard: Most carbon projects use Approach 3 with remote sensing classification, combining high spatial resolution with complete coverage.</span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sources of Uncertainty {#sec-ad-sources}</span></span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a>Classification accuracy:</span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Producer's accuracy: Omission error (missing true forest)</span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>User's accuracy: Commission error (false forest pixels)</span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Mixed pixels: Sub-pixel heterogeneity at edges</span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a>Change detection errors:</span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal inconsistency: Sensor differences, atmospheric effects</span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Phenological confusion: Seasonal vegetation changes vs. permanent clearing</span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Gradual degradation: Difficult to detect with binary classifiers</span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a>Spatial representation:</span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Geometric accuracy: Co-registration errors between dates</span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Projection distortion: Area calculation at different latitudes</span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Minimum mapping unit: Small patches below detection threshold</span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a>Reference data limitations:</span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sample size: Insufficient validation points for rare classes</span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal lag: Reference date ≠ map date</span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation error: Photo-interpreter disagreement</span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a><span class="fu">## Land Classification Uncertainty {#sec-lc-uncertainty}</span></span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a><span class="fu">### Confusion Matrix Analysis {#sec-confusion-matrix}</span></span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a>The confusion matrix (error matrix) provides the foundation for uncertainty quantification:</span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{web-r}</span></span>
<span id="cb17-163"><a href="#cb17-163" aria-hidden="true" tabindex="-1"></a><span class="in">#| eval: true</span></span>
<span id="cb17-164"><a href="#cb17-164" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: ad-confusion-matrix-example</span></span>
<span id="cb17-165"><a href="#cb17-165" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Create confusion matrix from validation data"</span></span>
<span id="cb17-166"><a href="#cb17-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-167"><a href="#cb17-167" aria-hidden="true" tabindex="-1"></a><span class="in">library(caret)</span></span>
<span id="cb17-168"><a href="#cb17-168" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb17-169"><a href="#cb17-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-170"><a href="#cb17-170" aria-hidden="true" tabindex="-1"></a><span class="in"># Example validation dataset</span></span>
<span id="cb17-171"><a href="#cb17-171" aria-hidden="true" tabindex="-1"></a><span class="in"># reference = ground truth, predicted = classification result</span></span>
<span id="cb17-172"><a href="#cb17-172" aria-hidden="true" tabindex="-1"></a><span class="in">validation_data &lt;- data.frame(</span></span>
<span id="cb17-173"><a href="#cb17-173" aria-hidden="true" tabindex="-1"></a><span class="in">  reference = c(rep("Forest", 180), rep("Non-Forest", 20),</span></span>
<span id="cb17-174"><a href="#cb17-174" aria-hidden="true" tabindex="-1"></a><span class="in">                rep("Forest", 15), rep("Non-Forest", 185)),</span></span>
<span id="cb17-175"><a href="#cb17-175" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted = c(rep("Forest", 180), rep("Forest", 20),</span></span>
<span id="cb17-176"><a href="#cb17-176" aria-hidden="true" tabindex="-1"></a><span class="in">                rep("Non-Forest", 15), rep("Non-Forest", 185))</span></span>
<span id="cb17-177"><a href="#cb17-177" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb17-178"><a href="#cb17-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-179"><a href="#cb17-179" aria-hidden="true" tabindex="-1"></a><span class="in"># Create confusion matrix</span></span>
<span id="cb17-180"><a href="#cb17-180" aria-hidden="true" tabindex="-1"></a><span class="in">conf_matrix &lt;- confusionMatrix(</span></span>
<span id="cb17-181"><a href="#cb17-181" aria-hidden="true" tabindex="-1"></a><span class="in">  data = factor(validation_data$predicted, levels = c("Forest", "Non-Forest")),</span></span>
<span id="cb17-182"><a href="#cb17-182" aria-hidden="true" tabindex="-1"></a><span class="in">  reference = factor(validation_data$reference, levels = c("Forest", "Non-Forest"))</span></span>
<span id="cb17-183"><a href="#cb17-183" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb17-184"><a href="#cb17-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-185"><a href="#cb17-185" aria-hidden="true" tabindex="-1"></a><span class="in">print(conf_matrix)</span></span>
<span id="cb17-186"><a href="#cb17-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-187"><a href="#cb17-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-188"><a href="#cb17-188" aria-hidden="true" tabindex="-1"></a>Output interpretation:</span>
<span id="cb17-189"><a href="#cb17-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-190"><a href="#cb17-190" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb17-191"><a href="#cb17-191" aria-hidden="true" tabindex="-1"></a><span class="in">Confusion Matrix and Statistics</span></span>
<span id="cb17-192"><a href="#cb17-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-193"><a href="#cb17-193" aria-hidden="true" tabindex="-1"></a><span class="in">              Reference</span></span>
<span id="cb17-194"><a href="#cb17-194" aria-hidden="true" tabindex="-1"></a><span class="in">Prediction     Forest Non-Forest</span></span>
<span id="cb17-195"><a href="#cb17-195" aria-hidden="true" tabindex="-1"></a><span class="in">  Forest         180         20</span></span>
<span id="cb17-196"><a href="#cb17-196" aria-hidden="true" tabindex="-1"></a><span class="in">  Non-Forest      15        185</span></span>
<span id="cb17-197"><a href="#cb17-197" aria-hidden="true" tabindex="-1"></a><span class="in">                                          </span></span>
<span id="cb17-198"><a href="#cb17-198" aria-hidden="true" tabindex="-1"></a><span class="in">               Accuracy : 0.9125          </span></span>
<span id="cb17-199"><a href="#cb17-199" aria-hidden="true" tabindex="-1"></a><span class="in">                 95% CI : (0.8797, 0.9388)</span></span>
<span id="cb17-200"><a href="#cb17-200" aria-hidden="true" tabindex="-1"></a><span class="in">    No Information Rate : 0.4875          </span></span>
<span id="cb17-201"><a href="#cb17-201" aria-hidden="true" tabindex="-1"></a><span class="in">    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       </span></span>
<span id="cb17-202"><a href="#cb17-202" aria-hidden="true" tabindex="-1"></a><span class="in">                                          </span></span>
<span id="cb17-203"><a href="#cb17-203" aria-hidden="true" tabindex="-1"></a><span class="in">  Producer's Acc (Forest) : 0.923 (180/195)</span></span>
<span id="cb17-204"><a href="#cb17-204" aria-hidden="true" tabindex="-1"></a><span class="in">  User's Acc (Forest)     : 0.900 (180/200)</span></span>
<span id="cb17-205"><a href="#cb17-205" aria-hidden="true" tabindex="-1"></a><span class="in">  Producer's Acc (Non-Forest) : 0.902 (185/205)</span></span>
<span id="cb17-206"><a href="#cb17-206" aria-hidden="true" tabindex="-1"></a><span class="in">  User's Acc (Non-Forest)     : 0.925 (185/200)</span></span>
<span id="cb17-207"><a href="#cb17-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-208"><a href="#cb17-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-209"><a href="#cb17-209" aria-hidden="true" tabindex="-1"></a>Key metrics:</span>
<span id="cb17-210"><a href="#cb17-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-211"><a href="#cb17-211" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Overall accuracy: 0.9125 (91.25% correct)</span>
<span id="cb17-212"><a href="#cb17-212" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Kappa coefficient: 0.825 (substantial agreement)</span>
<span id="cb17-213"><a href="#cb17-213" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Omission error (Forest): 7.7% (15/195) - forest pixels classified as non-forest</span>
<span id="cb17-214"><a href="#cb17-214" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Commission error (Forest): 10% (20/200) - non-forest pixels classified as forest</span>
<span id="cb17-215"><a href="#cb17-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-216"><a href="#cb17-216" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monte Carlo Simulation {#sec-lc-monte-carlo}</span></span>
<span id="cb17-217"><a href="#cb17-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-218"><a href="#cb17-218" aria-hidden="true" tabindex="-1"></a>Objective: Propagate classification errors to area estimates</span>
<span id="cb17-219"><a href="#cb17-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-220"><a href="#cb17-220" aria-hidden="true" tabindex="-1"></a>Method: Bootstrap resampling of confusion matrix</span>
<span id="cb17-221"><a href="#cb17-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-224"><a href="#cb17-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-225"><a href="#cb17-225" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-226"><a href="#cb17-226" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-monte-carlo-classification</span></span>
<span id="cb17-227"><a href="#cb17-227" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Monte Carlo simulation of LULC uncertainty"</span></span>
<span id="cb17-228"><a href="#cb17-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-229"><a href="#cb17-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to simulate area estimates with classification uncertainty</span></span>
<span id="cb17-230"><a href="#cb17-230" aria-hidden="true" tabindex="-1"></a>simulate_area_uncertainty <span class="ot">&lt;-</span> <span class="cf">function</span>(confusion_matrix, <span class="at">n_sim =</span> <span class="dv">10000</span>) {</span>
<span id="cb17-231"><a href="#cb17-231" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-232"><a href="#cb17-232" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract confusion matrix counts</span></span>
<span id="cb17-233"><a href="#cb17-233" aria-hidden="true" tabindex="-1"></a>  conf_table <span class="ot">&lt;-</span> confusion_matrix<span class="sc">$</span>table</span>
<span id="cb17-234"><a href="#cb17-234" aria-hidden="true" tabindex="-1"></a>  n_classes <span class="ot">&lt;-</span> <span class="fu">nrow</span>(conf_table)</span>
<span id="cb17-235"><a href="#cb17-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-236"><a href="#cb17-236" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate column totals (reference totals)</span></span>
<span id="cb17-237"><a href="#cb17-237" aria-hidden="true" tabindex="-1"></a>  ref_totals <span class="ot">&lt;-</span> <span class="fu">colSums</span>(conf_table)</span>
<span id="cb17-238"><a href="#cb17-238" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-239"><a href="#cb17-239" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate producer's accuracy for each class</span></span>
<span id="cb17-240"><a href="#cb17-240" aria-hidden="true" tabindex="-1"></a>  producers_acc <span class="ot">&lt;-</span> <span class="fu">diag</span>(conf_table) <span class="sc">/</span> ref_totals</span>
<span id="cb17-241"><a href="#cb17-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-242"><a href="#cb17-242" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate classification outcomes</span></span>
<span id="cb17-243"><a href="#cb17-243" aria-hidden="true" tabindex="-1"></a>  sim_results <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_sim, <span class="at">ncol =</span> n_classes)</span>
<span id="cb17-244"><a href="#cb17-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(sim_results) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(conf_table)</span>
<span id="cb17-245"><a href="#cb17-245" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-246"><a href="#cb17-246" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb17-247"><a href="#cb17-247" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each class, sample from binomial distribution</span></span>
<span id="cb17-248"><a href="#cb17-248" aria-hidden="true" tabindex="-1"></a>    <span class="co"># n = reference count, p = producer's accuracy</span></span>
<span id="cb17-249"><a href="#cb17-249" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_classes) {</span>
<span id="cb17-250"><a href="#cb17-250" aria-hidden="true" tabindex="-1"></a>      sim_results[i, j] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> ref_totals[j], <span class="at">prob =</span> producers_acc[j])</span>
<span id="cb17-251"><a href="#cb17-251" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-252"><a href="#cb17-252" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-253"><a href="#cb17-253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-254"><a href="#cb17-254" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate statistics</span></span>
<span id="cb17-255"><a href="#cb17-255" aria-hidden="true" tabindex="-1"></a>  area_mean <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(sim_results)</span>
<span id="cb17-256"><a href="#cb17-256" aria-hidden="true" tabindex="-1"></a>  area_sd <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim_results, <span class="dv">2</span>, sd)</span>
<span id="cb17-257"><a href="#cb17-257" aria-hidden="true" tabindex="-1"></a>  area_ci <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim_results, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>))</span>
<span id="cb17-258"><a href="#cb17-258" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-259"><a href="#cb17-259" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-260"><a href="#cb17-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="fu">colnames</span>(conf_table),</span>
<span id="cb17-261"><a href="#cb17-261" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_pixels =</span> area_mean,</span>
<span id="cb17-262"><a href="#cb17-262" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_pixels =</span> area_sd,</span>
<span id="cb17-263"><a href="#cb17-263" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> area_ci[<span class="dv">1</span>, ],</span>
<span id="cb17-264"><a href="#cb17-264" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> area_ci[<span class="dv">2</span>, ],</span>
<span id="cb17-265"><a href="#cb17-265" aria-hidden="true" tabindex="-1"></a>    <span class="at">uncertainty_pct =</span> (area_ci[<span class="dv">2</span>, ] <span class="sc">-</span> area_ci[<span class="dv">1</span>, ]) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> area_mean) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb17-266"><a href="#cb17-266" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-267"><a href="#cb17-267" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-268"><a href="#cb17-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb17-269"><a href="#cb17-269" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary =</span> results,</span>
<span id="cb17-270"><a href="#cb17-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">simulations =</span> sim_results</span>
<span id="cb17-271"><a href="#cb17-271" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-272"><a href="#cb17-272" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-273"><a href="#cb17-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-274"><a href="#cb17-274" aria-hidden="true" tabindex="-1"></a><span class="co"># Run simulation</span></span>
<span id="cb17-275"><a href="#cb17-275" aria-hidden="true" tabindex="-1"></a>mc_results <span class="ot">&lt;-</span> <span class="fu">simulate_area_uncertainty</span>(conf_matrix, <span class="at">n_sim =</span> <span class="dv">10000</span>)</span>
<span id="cb17-276"><a href="#cb17-276" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mc_results<span class="sc">$</span>summary)</span>
<span id="cb17-277"><a href="#cb17-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-278"><a href="#cb17-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-279"><a href="#cb17-279" aria-hidden="true" tabindex="-1"></a>Example output:</span>
<span id="cb17-280"><a href="#cb17-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-281"><a href="#cb17-281" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb17-282"><a href="#cb17-282" aria-hidden="true" tabindex="-1"></a><span class="in">        class mean_pixels sd_pixels ci_lower ci_upper uncertainty_pct</span></span>
<span id="cb17-283"><a href="#cb17-283" aria-hidden="true" tabindex="-1"></a><span class="in">1      Forest         180      3.85      173      187            3.9%</span></span>
<span id="cb17-284"><a href="#cb17-284" aria-hidden="true" tabindex="-1"></a><span class="in">2  Non-Forest         185      3.92      178      192            3.8%</span></span>
<span id="cb17-285"><a href="#cb17-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-286"><a href="#cb17-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-287"><a href="#cb17-287" aria-hidden="true" tabindex="-1"></a>Interpretation:</span>
<span id="cb17-288"><a href="#cb17-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-289"><a href="#cb17-289" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Forest area uncertainty: ±3.9% (90% CI)</span>
<span id="cb17-290"><a href="#cb17-290" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Propagates to emissions estimates:</span>
<span id="cb17-291"><a href="#cb17-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-292"><a href="#cb17-292" aria-hidden="true" tabindex="-1"></a>$$\sigma_{emissions} = A \times U_A$$</span>
<span id="cb17-293"><a href="#cb17-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-294"><a href="#cb17-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### Accuracy Assessment Stratified {#sec-stratified-sampling}</span></span>
<span id="cb17-295"><a href="#cb17-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-296"><a href="#cb17-296" aria-hidden="true" tabindex="-1"></a>Challenge: Rare classes (e.g., degradation) undersampled in random validation</span>
<span id="cb17-297"><a href="#cb17-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-298"><a href="#cb17-298" aria-hidden="true" tabindex="-1"></a>Solution: Stratified random sampling with proportional or optimized allocation</span>
<span id="cb17-299"><a href="#cb17-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-302"><a href="#cb17-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-303"><a href="#cb17-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-304"><a href="#cb17-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-stratified-sampling</span></span>
<span id="cb17-305"><a href="#cb17-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Optimal sample allocation across strata"</span></span>
<span id="cb17-306"><a href="#cb17-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-307"><a href="#cb17-307" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate optimal sample size per stratum</span></span>
<span id="cb17-308"><a href="#cb17-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Neyman allocation: n_h = n * (N_h * S_h) / sum(N_h * S_h)</span></span>
<span id="cb17-309"><a href="#cb17-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-310"><a href="#cb17-310" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-311"><a href="#cb17-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-312"><a href="#cb17-312" aria-hidden="true" tabindex="-1"></a><span class="co"># Stratum information</span></span>
<span id="cb17-313"><a href="#cb17-313" aria-hidden="true" tabindex="-1"></a>strata_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-314"><a href="#cb17-314" aria-hidden="true" tabindex="-1"></a>  <span class="at">stratum =</span> <span class="fu">c</span>(<span class="st">"Stable Forest"</span>, <span class="st">"Deforestation"</span>, <span class="st">"Degradation"</span>, <span class="st">"Stable Non-Forest"</span>),</span>
<span id="cb17-315"><a href="#cb17-315" aria-hidden="true" tabindex="-1"></a>  <span class="at">area_ha =</span> <span class="fu">c</span>(<span class="dv">450000</span>, <span class="dv">5000</span>, <span class="dv">15000</span>, <span class="dv">30000</span>),  <span class="co"># N_h</span></span>
<span id="cb17-316"><a href="#cb17-316" aria-hidden="true" tabindex="-1"></a>  <span class="at">expected_variance =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.20</span>, <span class="fl">0.05</span>)  <span class="co"># S_h (estimated)</span></span>
<span id="cb17-317"><a href="#cb17-317" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-318"><a href="#cb17-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-319"><a href="#cb17-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Total sample budget</span></span>
<span id="cb17-320"><a href="#cb17-320" aria-hidden="true" tabindex="-1"></a>total_samples <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb17-321"><a href="#cb17-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-322"><a href="#cb17-322" aria-hidden="true" tabindex="-1"></a><span class="co"># Neyman allocation</span></span>
<span id="cb17-323"><a href="#cb17-323" aria-hidden="true" tabindex="-1"></a>strata_data <span class="ot">&lt;-</span> strata_data <span class="sc">%&gt;%</span></span>
<span id="cb17-324"><a href="#cb17-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-325"><a href="#cb17-325" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> area_ha <span class="sc">*</span> expected_variance,</span>
<span id="cb17-326"><a href="#cb17-326" aria-hidden="true" tabindex="-1"></a>    <span class="at">allocation =</span> (product <span class="sc">/</span> <span class="fu">sum</span>(product)) <span class="sc">*</span> total_samples,</span>
<span id="cb17-327"><a href="#cb17-327" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> <span class="fu">round</span>(allocation)</span>
<span id="cb17-328"><a href="#cb17-328" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-329"><a href="#cb17-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-330"><a href="#cb17-330" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strata_data)</span>
<span id="cb17-331"><a href="#cb17-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-332"><a href="#cb17-332" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportional allocation (for comparison)</span></span>
<span id="cb17-333"><a href="#cb17-333" aria-hidden="true" tabindex="-1"></a>strata_data<span class="sc">$</span>proportional <span class="ot">&lt;-</span> <span class="fu">round</span>((strata_data<span class="sc">$</span>area_ha <span class="sc">/</span> <span class="fu">sum</span>(strata_data<span class="sc">$</span>area_ha)) <span class="sc">*</span> total_samples)</span>
<span id="cb17-334"><a href="#cb17-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-335"><a href="#cb17-335" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strata_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(stratum, samples, proportional))</span>
<span id="cb17-336"><a href="#cb17-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-337"><a href="#cb17-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-338"><a href="#cb17-338" aria-hidden="true" tabindex="-1"></a>Output:</span>
<span id="cb17-339"><a href="#cb17-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-340"><a href="#cb17-340" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb17-341"><a href="#cb17-341" aria-hidden="true" tabindex="-1"></a><span class="in">            stratum  samples proportional</span></span>
<span id="cb17-342"><a href="#cb17-342" aria-hidden="true" tabindex="-1"></a><span class="in">1    Stable Forest      108          360</span></span>
<span id="cb17-343"><a href="#cb17-343" aria-hidden="true" tabindex="-1"></a><span class="in">2    Deforestation       60           4</span></span>
<span id="cb17-344"><a href="#cb17-344" aria-hidden="true" tabindex="-1"></a><span class="in">3      Degradation       86          12</span></span>
<span id="cb17-345"><a href="#cb17-345" aria-hidden="true" tabindex="-1"></a><span class="in">4 Stable Non-Forest       36          24</span></span>
<span id="cb17-346"><a href="#cb17-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-347"><a href="#cb17-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-348"><a href="#cb17-348" aria-hidden="true" tabindex="-1"></a>Key insight: Neyman allocation dramatically increases sampling in rare but variable strata (deforestation, degradation), improving overall uncertainty.</span>
<span id="cb17-349"><a href="#cb17-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-350"><a href="#cb17-350" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb17-351"><a href="#cb17-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-352"><a href="#cb17-352" aria-hidden="true" tabindex="-1"></a><span class="fu">## Land Change Uncertainty {#sec-change-detection}</span></span>
<span id="cb17-353"><a href="#cb17-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-354"><a href="#cb17-354" aria-hidden="true" tabindex="-1"></a><span class="fu">### Temporal Registration Error {#sec-temporal-consistency}</span></span>
<span id="cb17-355"><a href="#cb17-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-356"><a href="#cb17-356" aria-hidden="true" tabindex="-1"></a>Geometric co-registration error propagates to change detection:</span>
<span id="cb17-357"><a href="#cb17-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-358"><a href="#cb17-358" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb17-359"><a href="#cb17-359" aria-hidden="true" tabindex="-1"></a>U_{change}^2 = U_{t1}^2 + U_{t2}^2 + 2 \times U_{registration}^2</span>
<span id="cb17-360"><a href="#cb17-360" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb17-361"><a href="#cb17-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-362"><a href="#cb17-362" aria-hidden="true" tabindex="-1"></a>Where: - $U_{t1}$: Classification uncertainty at time 1 - $U_{t2}$: Classification uncertainty at time 2\</span>
<span id="cb17-363"><a href="#cb17-363" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$U_{registration}$: Positional error between dates</span>
<span id="cb17-364"><a href="#cb17-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-367"><a href="#cb17-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-368"><a href="#cb17-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-369"><a href="#cb17-369" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-registration-error</span></span>
<span id="cb17-370"><a href="#cb17-370" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Assess impact of registration error on change detection"</span></span>
<span id="cb17-371"><a href="#cb17-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-372"><a href="#cb17-372" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb17-373"><a href="#cb17-373" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb17-374"><a href="#cb17-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-375"><a href="#cb17-375" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate registration error</span></span>
<span id="cb17-376"><a href="#cb17-376" aria-hidden="true" tabindex="-1"></a>simulate_registration_error <span class="ot">&lt;-</span> <span class="cf">function</span>(raster_t1, raster_t2, <span class="at">error_pixels =</span> <span class="dv">2</span>) {</span>
<span id="cb17-377"><a href="#cb17-377" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-378"><a href="#cb17-378" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Original change map</span></span>
<span id="cb17-379"><a href="#cb17-379" aria-hidden="true" tabindex="-1"></a>  change_original <span class="ot">&lt;-</span> raster_t2 <span class="sc">-</span> raster_t1</span>
<span id="cb17-380"><a href="#cb17-380" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-381"><a href="#cb17-381" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply random shift to t2 (simulating misregistration)</span></span>
<span id="cb17-382"><a href="#cb17-382" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Shift by 'error_pixels' in random direction</span></span>
<span id="cb17-383"><a href="#cb17-383" aria-hidden="true" tabindex="-1"></a>  n_sim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb17-384"><a href="#cb17-384" aria-hidden="true" tabindex="-1"></a>  change_error <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sim)</span>
<span id="cb17-385"><a href="#cb17-385" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-386"><a href="#cb17-386" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb17-387"><a href="#cb17-387" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random shift direction</span></span>
<span id="cb17-388"><a href="#cb17-388" aria-hidden="true" tabindex="-1"></a>    shift_x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="sc">-</span>error_pixels<span class="sc">:</span>error_pixels, <span class="dv">1</span>)</span>
<span id="cb17-389"><a href="#cb17-389" aria-hidden="true" tabindex="-1"></a>    shift_y <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="sc">-</span>error_pixels<span class="sc">:</span>error_pixels, <span class="dv">1</span>)</span>
<span id="cb17-390"><a href="#cb17-390" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-391"><a href="#cb17-391" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Shift raster_t2</span></span>
<span id="cb17-392"><a href="#cb17-392" aria-hidden="true" tabindex="-1"></a>    raster_t2_shifted <span class="ot">&lt;-</span> <span class="fu">shift</span>(raster_t2, <span class="at">dx =</span> shift_x, <span class="at">dy =</span> shift_y)</span>
<span id="cb17-393"><a href="#cb17-393" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-394"><a href="#cb17-394" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recalculate change</span></span>
<span id="cb17-395"><a href="#cb17-395" aria-hidden="true" tabindex="-1"></a>    change_shifted <span class="ot">&lt;-</span> raster_t2_shifted <span class="sc">-</span> raster_t1</span>
<span id="cb17-396"><a href="#cb17-396" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-397"><a href="#cb17-397" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate disagreement with original</span></span>
<span id="cb17-398"><a href="#cb17-398" aria-hidden="true" tabindex="-1"></a>    disagreement <span class="ot">&lt;-</span> <span class="fu">abs</span>(change_shifted <span class="sc">-</span> change_original)</span>
<span id="cb17-399"><a href="#cb17-399" aria-hidden="true" tabindex="-1"></a>    change_error[i] <span class="ot">&lt;-</span> <span class="fu">global</span>(disagreement, <span class="st">"mean"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb17-400"><a href="#cb17-400" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-401"><a href="#cb17-401" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-402"><a href="#cb17-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb17-403"><a href="#cb17-403" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_error =</span> <span class="fu">mean</span>(change_error),</span>
<span id="cb17-404"><a href="#cb17-404" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_error =</span> <span class="fu">sd</span>(change_error),</span>
<span id="cb17-405"><a href="#cb17-405" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_90 =</span> <span class="fu">quantile</span>(change_error, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>))</span>
<span id="cb17-406"><a href="#cb17-406" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-407"><a href="#cb17-407" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-408"><a href="#cb17-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-409"><a href="#cb17-409" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb17-410"><a href="#cb17-410" aria-hidden="true" tabindex="-1"></a><span class="co"># registration_uncertainty &lt;- simulate_registration_error(forest_2010, forest_2020, error_pixels = 1)</span></span>
<span id="cb17-411"><a href="#cb17-411" aria-hidden="true" tabindex="-1"></a><span class="co"># print(paste("Registration error:", round(registration_uncertainty$mean_error * 100, 2), "%"))</span></span>
<span id="cb17-412"><a href="#cb17-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-413"><a href="#cb17-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-414"><a href="#cb17-414" aria-hidden="true" tabindex="-1"></a><span class="fu">### Minimum Detectable Change {#sec-min-detectable-change}</span></span>
<span id="cb17-415"><a href="#cb17-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-416"><a href="#cb17-416" aria-hidden="true" tabindex="-1"></a>Statistical power analysis for change detection:</span>
<span id="cb17-417"><a href="#cb17-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-418"><a href="#cb17-418" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb17-419"><a href="#cb17-419" aria-hidden="true" tabindex="-1"></a>\text{MDD} = (Z_{\alpha/2} + Z_{\beta}) \times \sqrt{\sigma_1^2 + \sigma_2^2}</span>
<span id="cb17-420"><a href="#cb17-420" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb17-421"><a href="#cb17-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-422"><a href="#cb17-422" aria-hidden="true" tabindex="-1"></a>Where: - MDD: Minimum detectable difference - $Z_{\alpha/2}$: Critical value for significance level (e.g., 1.645 for 90%) - $Z_{\beta}$: Critical value for power (e.g., 0.84 for 80% power) - $\sigma_1, \sigma_2$: Standard deviations of measurements</span>
<span id="cb17-423"><a href="#cb17-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-426"><a href="#cb17-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-427"><a href="#cb17-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-428"><a href="#cb17-428" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-min-detectable-change</span></span>
<span id="cb17-429"><a href="#cb17-429" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Calculate minimum detectable change"</span></span>
<span id="cb17-430"><a href="#cb17-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-431"><a href="#cb17-431" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate MDD</span></span>
<span id="cb17-432"><a href="#cb17-432" aria-hidden="true" tabindex="-1"></a>calculate_mdd <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma1, sigma2, <span class="at">alpha =</span> <span class="fl">0.10</span>, <span class="at">power =</span> <span class="fl">0.80</span>) {</span>
<span id="cb17-433"><a href="#cb17-433" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-434"><a href="#cb17-434" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Z-scores for significance and power</span></span>
<span id="cb17-435"><a href="#cb17-435" aria-hidden="true" tabindex="-1"></a>  z_alpha <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>)  <span class="co"># Two-tailed</span></span>
<span id="cb17-436"><a href="#cb17-436" aria-hidden="true" tabindex="-1"></a>  z_beta <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(power)</span>
<span id="cb17-437"><a href="#cb17-437" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-438"><a href="#cb17-438" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pooled standard deviation</span></span>
<span id="cb17-439"><a href="#cb17-439" aria-hidden="true" tabindex="-1"></a>  sigma_pooled <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sigma1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sigma2<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb17-440"><a href="#cb17-440" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-441"><a href="#cb17-441" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Minimum detectable difference</span></span>
<span id="cb17-442"><a href="#cb17-442" aria-hidden="true" tabindex="-1"></a>  mdd <span class="ot">&lt;-</span> (z_alpha <span class="sc">+</span> z_beta) <span class="sc">*</span> sigma_pooled</span>
<span id="cb17-443"><a href="#cb17-443" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-444"><a href="#cb17-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb17-445"><a href="#cb17-445" aria-hidden="true" tabindex="-1"></a>    <span class="at">mdd =</span> mdd,</span>
<span id="cb17-446"><a href="#cb17-446" aria-hidden="true" tabindex="-1"></a>    <span class="at">mdd_relative =</span> mdd <span class="sc">/</span> <span class="fu">mean</span>(<span class="fu">c</span>(sigma1, sigma2)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb17-447"><a href="#cb17-447" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_alpha =</span> z_alpha,</span>
<span id="cb17-448"><a href="#cb17-448" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_beta =</span> z_beta</span>
<span id="cb17-449"><a href="#cb17-449" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-450"><a href="#cb17-450" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-451"><a href="#cb17-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-452"><a href="#cb17-452" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Forest cover change detection</span></span>
<span id="cb17-453"><a href="#cb17-453" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming 5% uncertainty in each time period</span></span>
<span id="cb17-454"><a href="#cb17-454" aria-hidden="true" tabindex="-1"></a>mdd_forest <span class="ot">&lt;-</span> <span class="fu">calculate_mdd</span>(<span class="at">sigma1 =</span> <span class="dv">5</span>, <span class="at">sigma2 =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="fl">0.10</span>, <span class="at">power =</span> <span class="fl">0.80</span>)</span>
<span id="cb17-455"><a href="#cb17-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-456"><a href="#cb17-456" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Minimum detectable change: %.2f%% (absolute)</span><span class="sc">\n</span><span class="st">"</span>, mdd_forest<span class="sc">$</span>mdd))</span>
<span id="cb17-457"><a href="#cb17-457" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Relative to mean uncertainty: %.1f%%</span><span class="sc">\n</span><span class="st">"</span>, mdd_forest<span class="sc">$</span>mdd_relative))</span>
<span id="cb17-458"><a href="#cb17-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-459"><a href="#cb17-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-460"><a href="#cb17-460" aria-hidden="true" tabindex="-1"></a>Output:</span>
<span id="cb17-461"><a href="#cb17-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-462"><a href="#cb17-462" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb17-463"><a href="#cb17-463" aria-hidden="true" tabindex="-1"></a><span class="in">Minimum detectable change: 11.66% (absolute)</span></span>
<span id="cb17-464"><a href="#cb17-464" aria-hidden="true" tabindex="-1"></a><span class="in">Relative to mean uncertainty: 233.1%</span></span>
<span id="cb17-465"><a href="#cb17-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-466"><a href="#cb17-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-467"><a href="#cb17-467" aria-hidden="true" tabindex="-1"></a>Interpretation: With 5% classification uncertainty at each date, changes <span class="sc">\&lt;</span>11.66% cannot be detected with statistical confidence. This sets a minimum mapping unit for credible change detection.</span>
<span id="cb17-468"><a href="#cb17-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-469"><a href="#cb17-469" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb17-470"><a href="#cb17-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-471"><a href="#cb17-471" aria-hidden="true" tabindex="-1"></a><span class="fu">## Spatial Aggregation Uncertainty {#sec-spatial-aggregation}</span></span>
<span id="cb17-472"><a href="#cb17-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-473"><a href="#cb17-473" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pixel Area Projection {#sec-pixel-area}</span></span>
<span id="cb17-474"><a href="#cb17-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-475"><a href="#cb17-475" aria-hidden="true" tabindex="-1"></a>Challenge: Pixel area varies with latitude in most projections</span>
<span id="cb17-476"><a href="#cb17-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-477"><a href="#cb17-477" aria-hidden="true" tabindex="-1"></a>Solution: Calculate pixel-specific area weights</span>
<span id="cb17-478"><a href="#cb17-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-481"><a href="#cb17-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-482"><a href="#cb17-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-483"><a href="#cb17-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-pixel-area-correction</span></span>
<span id="cb17-484"><a href="#cb17-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Correct pixel areas for latitude"</span></span>
<span id="cb17-485"><a href="#cb17-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-486"><a href="#cb17-486" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb17-487"><a href="#cb17-487" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb17-488"><a href="#cb17-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-489"><a href="#cb17-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate true pixel area accounting for projection</span></span>
<span id="cb17-490"><a href="#cb17-490" aria-hidden="true" tabindex="-1"></a>calculate_pixel_areas <span class="ot">&lt;-</span> <span class="cf">function</span>(raster_template) {</span>
<span id="cb17-491"><a href="#cb17-491" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-492"><a href="#cb17-492" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get cell size in map units</span></span>
<span id="cb17-493"><a href="#cb17-493" aria-hidden="true" tabindex="-1"></a>  cell_size <span class="ot">&lt;-</span> <span class="fu">res</span>(raster_template)</span>
<span id="cb17-494"><a href="#cb17-494" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-495"><a href="#cb17-495" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get latitudes of cell centers</span></span>
<span id="cb17-496"><a href="#cb17-496" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">xyFromCell</span>(raster_template, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncell</span>(raster_template))</span>
<span id="cb17-497"><a href="#cb17-497" aria-hidden="true" tabindex="-1"></a>  lats <span class="ot">&lt;-</span> coords[, <span class="dv">2</span>]</span>
<span id="cb17-498"><a href="#cb17-498" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-499"><a href="#cb17-499" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Earth's radius (meters)</span></span>
<span id="cb17-500"><a href="#cb17-500" aria-hidden="true" tabindex="-1"></a>  earth_radius <span class="ot">&lt;-</span> <span class="dv">6371000</span></span>
<span id="cb17-501"><a href="#cb17-501" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-502"><a href="#cb17-502" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert degrees to radians</span></span>
<span id="cb17-503"><a href="#cb17-503" aria-hidden="true" tabindex="-1"></a>  lat_rad <span class="ot">&lt;-</span> lats <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb17-504"><a href="#cb17-504" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-505"><a href="#cb17-505" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate north-south distance (constant)</span></span>
<span id="cb17-506"><a href="#cb17-506" aria-hidden="true" tabindex="-1"></a>  ns_distance <span class="ot">&lt;-</span> earth_radius <span class="sc">*</span> (cell_size[<span class="dv">2</span>] <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>)</span>
<span id="cb17-507"><a href="#cb17-507" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-508"><a href="#cb17-508" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate east-west distance (varies with latitude)</span></span>
<span id="cb17-509"><a href="#cb17-509" aria-hidden="true" tabindex="-1"></a>  ew_distance <span class="ot">&lt;-</span> earth_radius <span class="sc">*</span> <span class="fu">cos</span>(lat_rad) <span class="sc">*</span> (cell_size[<span class="dv">1</span>] <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span>)</span>
<span id="cb17-510"><a href="#cb17-510" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-511"><a href="#cb17-511" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pixel area in hectares</span></span>
<span id="cb17-512"><a href="#cb17-512" aria-hidden="true" tabindex="-1"></a>  pixel_area_ha <span class="ot">&lt;-</span> (ns_distance <span class="sc">*</span> ew_distance) <span class="sc">/</span> <span class="dv">10000</span></span>
<span id="cb17-513"><a href="#cb17-513" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-514"><a href="#cb17-514" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create raster of pixel areas</span></span>
<span id="cb17-515"><a href="#cb17-515" aria-hidden="true" tabindex="-1"></a>  area_raster <span class="ot">&lt;-</span> raster_template</span>
<span id="cb17-516"><a href="#cb17-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">values</span>(area_raster) <span class="ot">&lt;-</span> pixel_area_ha</span>
<span id="cb17-517"><a href="#cb17-517" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-518"><a href="#cb17-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(area_raster)</span>
<span id="cb17-519"><a href="#cb17-519" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-520"><a href="#cb17-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-521"><a href="#cb17-521" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total forest area with area correction</span></span>
<span id="cb17-522"><a href="#cb17-522" aria-hidden="true" tabindex="-1"></a>calculate_forest_area <span class="ot">&lt;-</span> <span class="cf">function</span>(forest_raster, area_raster) {</span>
<span id="cb17-523"><a href="#cb17-523" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-524"><a href="#cb17-524" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Forest pixels (value = 1)</span></span>
<span id="cb17-525"><a href="#cb17-525" aria-hidden="true" tabindex="-1"></a>  forest_pixels <span class="ot">&lt;-</span> forest_raster <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb17-526"><a href="#cb17-526" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-527"><a href="#cb17-527" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Multiply by pixel-specific areas</span></span>
<span id="cb17-528"><a href="#cb17-528" aria-hidden="true" tabindex="-1"></a>  forest_area_map <span class="ot">&lt;-</span> forest_pixels <span class="sc">*</span> area_raster</span>
<span id="cb17-529"><a href="#cb17-529" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-530"><a href="#cb17-530" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sum to get total area</span></span>
<span id="cb17-531"><a href="#cb17-531" aria-hidden="true" tabindex="-1"></a>  total_area_ha <span class="ot">&lt;-</span> <span class="fu">global</span>(forest_area_map, <span class="st">"sum"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb17-532"><a href="#cb17-532" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-533"><a href="#cb17-533" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Also calculate assuming uniform pixel size (uncorrected)</span></span>
<span id="cb17-534"><a href="#cb17-534" aria-hidden="true" tabindex="-1"></a>  nominal_pixel_area <span class="ot">&lt;-</span> <span class="fu">prod</span>(<span class="fu">res</span>(forest_raster)) <span class="sc">/</span> <span class="dv">10000</span>  <span class="co"># ha</span></span>
<span id="cb17-535"><a href="#cb17-535" aria-hidden="true" tabindex="-1"></a>  uncorrected_area_ha <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">values</span>(forest_pixels), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> nominal_pixel_area</span>
<span id="cb17-536"><a href="#cb17-536" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-537"><a href="#cb17-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb17-538"><a href="#cb17-538" aria-hidden="true" tabindex="-1"></a>    <span class="at">corrected_area_ha =</span> total_area_ha,</span>
<span id="cb17-539"><a href="#cb17-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">uncorrected_area_ha =</span> uncorrected_area_ha,</span>
<span id="cb17-540"><a href="#cb17-540" aria-hidden="true" tabindex="-1"></a>    <span class="at">difference_pct =</span> (uncorrected_area_ha <span class="sc">-</span> total_area_ha) <span class="sc">/</span> total_area_ha <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb17-541"><a href="#cb17-541" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-542"><a href="#cb17-542" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-543"><a href="#cb17-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-544"><a href="#cb17-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb17-545"><a href="#cb17-545" aria-hidden="true" tabindex="-1"></a><span class="co"># area_raster &lt;- calculate_pixel_areas(forest_2020)</span></span>
<span id="cb17-546"><a href="#cb17-546" aria-hidden="true" tabindex="-1"></a><span class="co"># forest_area &lt;- calculate_forest_area(forest_2020, area_raster)</span></span>
<span id="cb17-547"><a href="#cb17-547" aria-hidden="true" tabindex="-1"></a><span class="co"># cat(sprintf("Area correction: %.2f%% difference\n", forest_area$difference_pct))</span></span>
<span id="cb17-548"><a href="#cb17-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-549"><a href="#cb17-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-550"><a href="#cb17-550" aria-hidden="true" tabindex="-1"></a>Typical magnitude: 0.5-2% for tropical projects (near equator), up to 5-10% for boreal projects (high latitudes).</span>
<span id="cb17-551"><a href="#cb17-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-552"><a href="#cb17-552" aria-hidden="true" tabindex="-1"></a><span class="fu">### Zonal Statistics {#sec-zonal-statistics}</span></span>
<span id="cb17-553"><a href="#cb17-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-554"><a href="#cb17-554" aria-hidden="true" tabindex="-1"></a>Edge effects at jurisdictional boundaries:</span>
<span id="cb17-555"><a href="#cb17-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-558"><a href="#cb17-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-559"><a href="#cb17-559" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-560"><a href="#cb17-560" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-boundary-uncertainty</span></span>
<span id="cb17-561"><a href="#cb17-561" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Quantify boundary uncertainty effects"</span></span>
<span id="cb17-562"><a href="#cb17-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-563"><a href="#cb17-563" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span>
<span id="cb17-564"><a href="#cb17-564" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb17-565"><a href="#cb17-565" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb17-566"><a href="#cb17-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-567"><a href="#cb17-567" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to assess boundary uncertainty</span></span>
<span id="cb17-568"><a href="#cb17-568" aria-hidden="true" tabindex="-1"></a>assess_boundary_uncertainty <span class="ot">&lt;-</span> <span class="cf">function</span>(raster_data, boundary_polygon, <span class="at">buffer_m =</span> <span class="dv">100</span>) {</span>
<span id="cb17-569"><a href="#cb17-569" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-570"><a href="#cb17-570" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Original zonal statistic</span></span>
<span id="cb17-571"><a href="#cb17-571" aria-hidden="true" tabindex="-1"></a>  original_sum <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(</span>
<span id="cb17-572"><a href="#cb17-572" aria-hidden="true" tabindex="-1"></a>    raster_data, </span>
<span id="cb17-573"><a href="#cb17-573" aria-hidden="true" tabindex="-1"></a>    boundary_polygon, </span>
<span id="cb17-574"><a href="#cb17-574" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> <span class="st">'sum'</span></span>
<span id="cb17-575"><a href="#cb17-575" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-576"><a href="#cb17-576" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-577"><a href="#cb17-577" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create multiple buffered boundaries (simulate positional uncertainty)</span></span>
<span id="cb17-578"><a href="#cb17-578" aria-hidden="true" tabindex="-1"></a>  n_sim <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb17-579"><a href="#cb17-579" aria-hidden="true" tabindex="-1"></a>  buffered_sums <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sim)</span>
<span id="cb17-580"><a href="#cb17-580" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-581"><a href="#cb17-581" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb17-582"><a href="#cb17-582" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random buffer (-buffer_m to +buffer_m)</span></span>
<span id="cb17-583"><a href="#cb17-583" aria-hidden="true" tabindex="-1"></a>    random_buffer <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="sc">-</span>buffer_m, buffer_m)</span>
<span id="cb17-584"><a href="#cb17-584" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-585"><a href="#cb17-585" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply buffer</span></span>
<span id="cb17-586"><a href="#cb17-586" aria-hidden="true" tabindex="-1"></a>    buffered_boundary <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(boundary_polygon, <span class="at">dist =</span> random_buffer)</span>
<span id="cb17-587"><a href="#cb17-587" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-588"><a href="#cb17-588" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recalculate sum</span></span>
<span id="cb17-589"><a href="#cb17-589" aria-hidden="true" tabindex="-1"></a>    buffered_sums[i] <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(</span>
<span id="cb17-590"><a href="#cb17-590" aria-hidden="true" tabindex="-1"></a>      raster_data,</span>
<span id="cb17-591"><a href="#cb17-591" aria-hidden="true" tabindex="-1"></a>      buffered_boundary,</span>
<span id="cb17-592"><a href="#cb17-592" aria-hidden="true" tabindex="-1"></a>      <span class="at">fun =</span> <span class="st">'sum'</span></span>
<span id="cb17-593"><a href="#cb17-593" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-594"><a href="#cb17-594" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-595"><a href="#cb17-595" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-596"><a href="#cb17-596" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate uncertainty</span></span>
<span id="cb17-597"><a href="#cb17-597" aria-hidden="true" tabindex="-1"></a>  boundary_uncertainty <span class="ot">&lt;-</span> <span class="fu">sd</span>(buffered_sums) <span class="sc">/</span> <span class="fu">mean</span>(buffered_sums) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb17-598"><a href="#cb17-598" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-599"><a href="#cb17-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb17-600"><a href="#cb17-600" aria-hidden="true" tabindex="-1"></a>    <span class="at">original_value =</span> original_sum,</span>
<span id="cb17-601"><a href="#cb17-601" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_simulated =</span> <span class="fu">mean</span>(buffered_sums),</span>
<span id="cb17-602"><a href="#cb17-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_simulated =</span> <span class="fu">sd</span>(buffered_sums),</span>
<span id="cb17-603"><a href="#cb17-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">uncertainty_pct =</span> boundary_uncertainty,</span>
<span id="cb17-604"><a href="#cb17-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_90 =</span> <span class="fu">quantile</span>(buffered_sums, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>))</span>
<span id="cb17-605"><a href="#cb17-605" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-606"><a href="#cb17-606" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-607"><a href="#cb17-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-608"><a href="#cb17-608" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb17-609"><a href="#cb17-609" aria-hidden="true" tabindex="-1"></a><span class="co"># boundary_uncert &lt;- assess_boundary_uncertainty(</span></span>
<span id="cb17-610"><a href="#cb17-610" aria-hidden="true" tabindex="-1"></a><span class="co">#   raster_data = forest_cover,</span></span>
<span id="cb17-611"><a href="#cb17-611" aria-hidden="true" tabindex="-1"></a><span class="co">#   boundary_polygon = project_boundary,</span></span>
<span id="cb17-612"><a href="#cb17-612" aria-hidden="true" tabindex="-1"></a><span class="co">#   buffer_m = 50  # 50m positional uncertainty</span></span>
<span id="cb17-613"><a href="#cb17-613" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb17-614"><a href="#cb17-614" aria-hidden="true" tabindex="-1"></a><span class="co"># print(paste("Boundary uncertainty:", round(boundary_uncert$uncertainty_pct, 2), "%"))</span></span>
<span id="cb17-615"><a href="#cb17-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-616"><a href="#cb17-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-617"><a href="#cb17-617" aria-hidden="true" tabindex="-1"></a>Mitigation strategies: - Use high-precision GPS for boundary demarcation (±5m accuracy) - Apply buffer zones to exclude edge pixels - Document boundary uncertainty in monitoring plan</span>
<span id="cb17-618"><a href="#cb17-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-619"><a href="#cb17-619" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb17-620"><a href="#cb17-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-621"><a href="#cb17-621" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reference Data Quality {#sec-reference-data}</span></span>
<span id="cb17-622"><a href="#cb17-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-623"><a href="#cb17-623" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required Sample Size {#sec-sample-size-calculation}</span></span>
<span id="cb17-624"><a href="#cb17-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-625"><a href="#cb17-625" aria-hidden="true" tabindex="-1"></a>Objective: Determine validation sample size for desired confidence interval</span>
<span id="cb17-626"><a href="#cb17-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-627"><a href="#cb17-627" aria-hidden="true" tabindex="-1"></a>Formula (simple random sampling):</span>
<span id="cb17-628"><a href="#cb17-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-629"><a href="#cb17-629" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb17-630"><a href="#cb17-630" aria-hidden="true" tabindex="-1"></a>n = \frac{Z^2 \times p \times (1-p)}{E^2}</span>
<span id="cb17-631"><a href="#cb17-631" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb17-632"><a href="#cb17-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-633"><a href="#cb17-633" aria-hidden="true" tabindex="-1"></a>Where: - $n$: Required sample size - $Z$: Z-score for confidence level (1.645 for 90%) - $p$: Expected proportion (e.g., 0.50 for maximum variance) - $E$: Desired margin of error (e.g., 0.05 for ±5%)</span>
<span id="cb17-634"><a href="#cb17-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-637"><a href="#cb17-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-638"><a href="#cb17-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-639"><a href="#cb17-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-sample-size-calculation</span></span>
<span id="cb17-640"><a href="#cb17-640" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Calculate required validation sample size"</span></span>
<span id="cb17-641"><a href="#cb17-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-642"><a href="#cb17-642" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate sample size</span></span>
<span id="cb17-643"><a href="#cb17-643" aria-hidden="true" tabindex="-1"></a>calculate_sample_size <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">confidence =</span> <span class="fl">0.90</span>, <span class="at">margin_error =</span> <span class="fl">0.05</span>, <span class="at">proportion =</span> <span class="fl">0.50</span>) {</span>
<span id="cb17-644"><a href="#cb17-644" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-645"><a href="#cb17-645" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Z-score for confidence level</span></span>
<span id="cb17-646"><a href="#cb17-646" aria-hidden="true" tabindex="-1"></a>  z_score <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> confidence) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb17-647"><a href="#cb17-647" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-648"><a href="#cb17-648" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate sample size</span></span>
<span id="cb17-649"><a href="#cb17-649" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> (z_score<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> proportion <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> proportion)) <span class="sc">/</span> margin_error<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb17-650"><a href="#cb17-650" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-651"><a href="#cb17-651" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Round up</span></span>
<span id="cb17-652"><a href="#cb17-652" aria-hidden="true" tabindex="-1"></a>  n_rounded <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n)</span>
<span id="cb17-653"><a href="#cb17-653" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-654"><a href="#cb17-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb17-655"><a href="#cb17-655" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_size =</span> n_rounded,</span>
<span id="cb17-656"><a href="#cb17-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">confidence =</span> confidence,</span>
<span id="cb17-657"><a href="#cb17-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin_error =</span> margin_error,</span>
<span id="cb17-658"><a href="#cb17-658" aria-hidden="true" tabindex="-1"></a>    <span class="at">z_score =</span> z_score</span>
<span id="cb17-659"><a href="#cb17-659" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-660"><a href="#cb17-660" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-661"><a href="#cb17-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-662"><a href="#cb17-662" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate for different scenarios</span></span>
<span id="cb17-663"><a href="#cb17-663" aria-hidden="true" tabindex="-1"></a>scenarios <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb17-664"><a href="#cb17-664" aria-hidden="true" tabindex="-1"></a>  <span class="at">confidence =</span> <span class="fu">c</span>(<span class="fl">0.90</span>, <span class="fl">0.95</span>),</span>
<span id="cb17-665"><a href="#cb17-665" aria-hidden="true" tabindex="-1"></a>  <span class="at">margin_error =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>),</span>
<span id="cb17-666"><a href="#cb17-666" aria-hidden="true" tabindex="-1"></a>  <span class="at">proportion =</span> <span class="fl">0.50</span></span>
<span id="cb17-667"><a href="#cb17-667" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-668"><a href="#cb17-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-669"><a href="#cb17-669" aria-hidden="true" tabindex="-1"></a>scenarios<span class="sc">$</span>required_n <span class="ot">&lt;-</span> <span class="fu">apply</span>(scenarios, <span class="dv">1</span>, <span class="cf">function</span>(x) {</span>
<span id="cb17-670"><a href="#cb17-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate_sample_size</span>(</span>
<span id="cb17-671"><a href="#cb17-671" aria-hidden="true" tabindex="-1"></a>    <span class="at">confidence =</span> x[<span class="dv">1</span>],</span>
<span id="cb17-672"><a href="#cb17-672" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin_error =</span> x[<span class="dv">2</span>],</span>
<span id="cb17-673"><a href="#cb17-673" aria-hidden="true" tabindex="-1"></a>    <span class="at">proportion =</span> x[<span class="dv">3</span>]</span>
<span id="cb17-674"><a href="#cb17-674" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>sample_size</span>
<span id="cb17-675"><a href="#cb17-675" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb17-676"><a href="#cb17-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-677"><a href="#cb17-677" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb17-678"><a href="#cb17-678" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb17-679"><a href="#cb17-679" aria-hidden="true" tabindex="-1"></a>  scenarios,</span>
<span id="cb17-680"><a href="#cb17-680" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Confidence"</span>, <span class="st">"Margin of Error"</span>, <span class="st">"Proportion"</span>, <span class="st">"Sample Size"</span>),</span>
<span id="cb17-681"><a href="#cb17-681" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Required Validation Sample Sizes"</span></span>
<span id="cb17-682"><a href="#cb17-682" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-683"><a href="#cb17-683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-684"><a href="#cb17-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-685"><a href="#cb17-685" aria-hidden="true" tabindex="-1"></a>Output:</span>
<span id="cb17-686"><a href="#cb17-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-687"><a href="#cb17-687" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb17-688"><a href="#cb17-688" aria-hidden="true" tabindex="-1"></a><span class="in">| Confidence | Margin of Error | Proportion | Sample Size |</span></span>
<span id="cb17-689"><a href="#cb17-689" aria-hidden="true" tabindex="-1"></a><span class="in">|------------|-----------------|------------|-------------|</span></span>
<span id="cb17-690"><a href="#cb17-690" aria-hidden="true" tabindex="-1"></a><span class="in">| 90%        | 3%              | 0.50       | 752         |</span></span>
<span id="cb17-691"><a href="#cb17-691" aria-hidden="true" tabindex="-1"></a><span class="in">| 90%        | 5%              | 0.50       | 271         |</span></span>
<span id="cb17-692"><a href="#cb17-692" aria-hidden="true" tabindex="-1"></a><span class="in">| 90%        | 10%             | 0.50       | 68          |</span></span>
<span id="cb17-693"><a href="#cb17-693" aria-hidden="true" tabindex="-1"></a><span class="in">| 95%        | 3%              | 0.50       | 1068        |</span></span>
<span id="cb17-694"><a href="#cb17-694" aria-hidden="true" tabindex="-1"></a><span class="in">| 95%        | 5%              | 0.50       | 385         |</span></span>
<span id="cb17-695"><a href="#cb17-695" aria-hidden="true" tabindex="-1"></a><span class="in">| 95%        | 10%             | 0.50       | 97          |</span></span>
<span id="cb17-696"><a href="#cb17-696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-697"><a href="#cb17-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-698"><a href="#cb17-698" aria-hidden="true" tabindex="-1"></a>Practical guidance: - Minimum: 100 samples per class for rare categories - Typical: 300-500 samples for overall accuracy ±5% at 90% confidence - Optimal: 1000+ samples for detecting <span class="sc">\&lt;</span>2% changes</span>
<span id="cb17-699"><a href="#cb17-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-700"><a href="#cb17-700" aria-hidden="true" tabindex="-1"></a><span class="fu">### Temporal Consistency {#sec-temporal-consistency-ref}</span></span>
<span id="cb17-701"><a href="#cb17-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-702"><a href="#cb17-702" aria-hidden="true" tabindex="-1"></a>Challenge: Reference imagery date ≠ classification date</span>
<span id="cb17-703"><a href="#cb17-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-704"><a href="#cb17-704" aria-hidden="true" tabindex="-1"></a>Acceptable lag: ±1 year for stable landscapes, ±6 months for dynamic areas</span>
<span id="cb17-705"><a href="#cb17-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-708"><a href="#cb17-708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-709"><a href="#cb17-709" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-710"><a href="#cb17-710" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-temporal-lag-assessment</span></span>
<span id="cb17-711"><a href="#cb17-711" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Assess impact of temporal lag in reference data"</span></span>
<span id="cb17-712"><a href="#cb17-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-713"><a href="#cb17-713" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate accuracy degradation with temporal lag</span></span>
<span id="cb17-714"><a href="#cb17-714" aria-hidden="true" tabindex="-1"></a>assess_temporal_lag <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">base_accuracy =</span> <span class="fl">0.92</span>, <span class="at">lag_months =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">6</span>), <span class="at">degradation_rate =</span> <span class="fl">0.01</span>) {</span>
<span id="cb17-715"><a href="#cb17-715" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-716"><a href="#cb17-716" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Accuracy decreases with lag</span></span>
<span id="cb17-717"><a href="#cb17-717" aria-hidden="true" tabindex="-1"></a>  accuracy_lagged <span class="ot">&lt;-</span> base_accuracy <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>degradation_rate <span class="sc">*</span> lag_months)</span>
<span id="cb17-718"><a href="#cb17-718" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-719"><a href="#cb17-719" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create results table</span></span>
<span id="cb17-720"><a href="#cb17-720" aria-hidden="true" tabindex="-1"></a>  lag_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-721"><a href="#cb17-721" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag_months =</span> lag_months,</span>
<span id="cb17-722"><a href="#cb17-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">accuracy =</span> accuracy_lagged,</span>
<span id="cb17-723"><a href="#cb17-723" aria-hidden="true" tabindex="-1"></a>    <span class="at">accuracy_loss =</span> (base_accuracy <span class="sc">-</span> accuracy_lagged) <span class="sc">/</span> base_accuracy <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb17-724"><a href="#cb17-724" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-725"><a href="#cb17-725" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-726"><a href="#cb17-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lag_results)</span>
<span id="cb17-727"><a href="#cb17-727" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-728"><a href="#cb17-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-729"><a href="#cb17-729" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate temporal lag effects</span></span>
<span id="cb17-730"><a href="#cb17-730" aria-hidden="true" tabindex="-1"></a>lag_impact <span class="ot">&lt;-</span> <span class="fu">assess_temporal_lag</span>(<span class="at">base_accuracy =</span> <span class="fl">0.92</span>, <span class="at">lag_months =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">6</span>))</span>
<span id="cb17-731"><a href="#cb17-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-732"><a href="#cb17-732" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb17-733"><a href="#cb17-733" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-734"><a href="#cb17-734" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lag_impact, <span class="fu">aes</span>(<span class="at">x =</span> lag_months, <span class="at">y =</span> accuracy)) <span class="sc">+</span></span>
<span id="cb17-735"><a href="#cb17-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb17-736"><a href="#cb17-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-737"><a href="#cb17-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.90</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb17-738"><a href="#cb17-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">12</span>, <span class="at">y =</span> <span class="fl">0.905</span>, <span class="at">label =</span> <span class="st">"90% threshold"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb17-739"><a href="#cb17-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-740"><a href="#cb17-740" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Classification Accuracy vs. Reference Data Temporal Lag"</span>,</span>
<span id="cb17-741"><a href="#cb17-741" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Lag (months)"</span>,</span>
<span id="cb17-742"><a href="#cb17-742" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Classification Accuracy"</span></span>
<span id="cb17-743"><a href="#cb17-743" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-744"><a href="#cb17-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb17-745"><a href="#cb17-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-746"><a href="#cb17-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-747"><a href="#cb17-747" aria-hidden="true" tabindex="-1"></a>Mitigation: - Use near-contemporary reference data (±6 months) - Apply phenological normalization - Document and report temporal lag in uncertainty assessment</span>
<span id="cb17-748"><a href="#cb17-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-749"><a href="#cb17-749" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb17-750"><a href="#cb17-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-751"><a href="#cb17-751" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reproducible Workflow {#sec-ad-integrated-workflow}</span></span>
<span id="cb17-752"><a href="#cb17-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-753"><a href="#cb17-753" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monte Carlo Implementation {#sec-ad-monte-carlo-complete}</span></span>
<span id="cb17-754"><a href="#cb17-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-757"><a href="#cb17-757" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-758"><a href="#cb17-758" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-759"><a href="#cb17-759" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-complete-monte-carlo</span></span>
<span id="cb17-760"><a href="#cb17-760" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Integrated activity data uncertainty quantification"</span></span>
<span id="cb17-761"><a href="#cb17-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-762"><a href="#cb17-762" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb17-763"><a href="#cb17-763" aria-hidden="true" tabindex="-1"></a><span class="co"># INTEGRATED ACTIVITY DATA UNCERTAINTY ASSESSMENT</span></span>
<span id="cb17-764"><a href="#cb17-764" aria-hidden="true" tabindex="-1"></a><span class="co"># Combines: Classification + Change Detection + Spatial Aggregation</span></span>
<span id="cb17-765"><a href="#cb17-765" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb17-766"><a href="#cb17-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-767"><a href="#cb17-767" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-768"><a href="#cb17-768" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)  <span class="co"># For mvrnorm</span></span>
<span id="cb17-769"><a href="#cb17-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-770"><a href="#cb17-770" aria-hidden="true" tabindex="-1"></a><span class="co"># Function: Integrated uncertainty assessment</span></span>
<span id="cb17-771"><a href="#cb17-771" aria-hidden="true" tabindex="-1"></a>integrated_activity_data_uncertainty <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb17-772"><a href="#cb17-772" aria-hidden="true" tabindex="-1"></a>  confusion_matrix,</span>
<span id="cb17-773"><a href="#cb17-773" aria-hidden="true" tabindex="-1"></a>  area_t1_ha,</span>
<span id="cb17-774"><a href="#cb17-774" aria-hidden="true" tabindex="-1"></a>  area_t2_ha,</span>
<span id="cb17-775"><a href="#cb17-775" aria-hidden="true" tabindex="-1"></a>  <span class="at">registration_error_m =</span> <span class="dv">30</span>,</span>
<span id="cb17-776"><a href="#cb17-776" aria-hidden="true" tabindex="-1"></a>  <span class="at">pixel_size_m =</span> <span class="dv">30</span>,</span>
<span id="cb17-777"><a href="#cb17-777" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sim =</span> <span class="dv">10000</span></span>
<span id="cb17-778"><a href="#cb17-778" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb17-779"><a href="#cb17-779" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-780"><a href="#cb17-780" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract classification uncertainties</span></span>
<span id="cb17-781"><a href="#cb17-781" aria-hidden="true" tabindex="-1"></a>  conf_table <span class="ot">&lt;-</span> confusion_matrix<span class="sc">$</span>table</span>
<span id="cb17-782"><a href="#cb17-782" aria-hidden="true" tabindex="-1"></a>  producers_acc <span class="ot">&lt;-</span> <span class="fu">diag</span>(conf_table) <span class="sc">/</span> <span class="fu">colSums</span>(conf_table)</span>
<span id="cb17-783"><a href="#cb17-783" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-784"><a href="#cb17-784" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate classification CV (coefficient of variation)</span></span>
<span id="cb17-785"><a href="#cb17-785" aria-hidden="true" tabindex="-1"></a>  cv_classification <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((<span class="dv">1</span> <span class="sc">-</span> producers_acc) <span class="sc">/</span> producers_acc)</span>
<span id="cb17-786"><a href="#cb17-786" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-787"><a href="#cb17-787" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Registration error as proportion of pixel</span></span>
<span id="cb17-788"><a href="#cb17-788" aria-hidden="true" tabindex="-1"></a>  cv_registration <span class="ot">&lt;-</span> registration_error_m <span class="sc">/</span> pixel_size_m</span>
<span id="cb17-789"><a href="#cb17-789" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-790"><a href="#cb17-790" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Monte Carlo simulation</span></span>
<span id="cb17-791"><a href="#cb17-791" aria-hidden="true" tabindex="-1"></a>  sim_results <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_sim, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb17-792"><a href="#cb17-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(sim_results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area_t1"</span>, <span class="st">"area_t2"</span>, <span class="st">"change"</span>)</span>
<span id="cb17-793"><a href="#cb17-793" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-794"><a href="#cb17-794" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb17-795"><a href="#cb17-795" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample classification uncertainty (lognormal to ensure positive)</span></span>
<span id="cb17-796"><a href="#cb17-796" aria-hidden="true" tabindex="-1"></a>    error_t1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> area_t1_ha <span class="sc">*</span> <span class="fu">mean</span>(cv_classification))</span>
<span id="cb17-797"><a href="#cb17-797" aria-hidden="true" tabindex="-1"></a>    error_t2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> area_t2_ha <span class="sc">*</span> <span class="fu">mean</span>(cv_classification))</span>
<span id="cb17-798"><a href="#cb17-798" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-799"><a href="#cb17-799" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample registration error</span></span>
<span id="cb17-800"><a href="#cb17-800" aria-hidden="true" tabindex="-1"></a>    error_reg <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fu">mean</span>(<span class="fu">c</span>(area_t1_ha, area_t2_ha)) <span class="sc">*</span> cv_registration)</span>
<span id="cb17-801"><a href="#cb17-801" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-802"><a href="#cb17-802" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate areas</span></span>
<span id="cb17-803"><a href="#cb17-803" aria-hidden="true" tabindex="-1"></a>    sim_area_t1 <span class="ot">&lt;-</span> area_t1_ha <span class="sc">+</span> error_t1</span>
<span id="cb17-804"><a href="#cb17-804" aria-hidden="true" tabindex="-1"></a>    sim_area_t2 <span class="ot">&lt;-</span> area_t2_ha <span class="sc">+</span> error_t2 <span class="sc">+</span> error_reg</span>
<span id="cb17-805"><a href="#cb17-805" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-806"><a href="#cb17-806" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate change</span></span>
<span id="cb17-807"><a href="#cb17-807" aria-hidden="true" tabindex="-1"></a>    sim_change <span class="ot">&lt;-</span> sim_area_t2 <span class="sc">-</span> sim_area_t1</span>
<span id="cb17-808"><a href="#cb17-808" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-809"><a href="#cb17-809" aria-hidden="true" tabindex="-1"></a>    sim_results[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(sim_area_t1, sim_area_t2, sim_change)</span>
<span id="cb17-810"><a href="#cb17-810" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-811"><a href="#cb17-811" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-812"><a href="#cb17-812" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate statistics</span></span>
<span id="cb17-813"><a href="#cb17-813" aria-hidden="true" tabindex="-1"></a>  results_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-814"><a href="#cb17-814" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">c</span>(<span class="st">"Area_t1"</span>, <span class="st">"Area_t2"</span>, <span class="st">"Change"</span>),</span>
<span id="cb17-815"><a href="#cb17-815" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">colMeans</span>(sim_results),</span>
<span id="cb17-816"><a href="#cb17-816" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">apply</span>(sim_results, <span class="dv">2</span>, sd),</span>
<span id="cb17-817"><a href="#cb17-817" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> <span class="fu">apply</span>(sim_results, <span class="dv">2</span>, quantile, <span class="fl">0.05</span>),</span>
<span id="cb17-818"><a href="#cb17-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> <span class="fu">apply</span>(sim_results, <span class="dv">2</span>, quantile, <span class="fl">0.95</span>)</span>
<span id="cb17-819"><a href="#cb17-819" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-820"><a href="#cb17-820" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb17-821"><a href="#cb17-821" aria-hidden="true" tabindex="-1"></a>      <span class="at">cv_pct =</span> sd <span class="sc">/</span> mean <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb17-822"><a href="#cb17-822" aria-hidden="true" tabindex="-1"></a>      <span class="at">hw_90 =</span> (ci_upper <span class="sc">-</span> ci_lower) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb17-823"><a href="#cb17-823" aria-hidden="true" tabindex="-1"></a>      <span class="at">uncertainty_pct =</span> hw_90 <span class="sc">/</span> mean <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb17-824"><a href="#cb17-824" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-825"><a href="#cb17-825" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-826"><a href="#cb17-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb17-827"><a href="#cb17-827" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary =</span> results_summary,</span>
<span id="cb17-828"><a href="#cb17-828" aria-hidden="true" tabindex="-1"></a>    <span class="at">simulations =</span> sim_results</span>
<span id="cb17-829"><a href="#cb17-829" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-830"><a href="#cb17-830" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-831"><a href="#cb17-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-832"><a href="#cb17-832" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb17-833"><a href="#cb17-833" aria-hidden="true" tabindex="-1"></a><span class="co"># Load confusion matrix (from previous section)</span></span>
<span id="cb17-834"><a href="#cb17-834" aria-hidden="true" tabindex="-1"></a><span class="co"># conf_matrix &lt;- [your confusion matrix]</span></span>
<span id="cb17-835"><a href="#cb17-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-836"><a href="#cb17-836" aria-hidden="true" tabindex="-1"></a><span class="co"># Run integrated assessment</span></span>
<span id="cb17-837"><a href="#cb17-837" aria-hidden="true" tabindex="-1"></a>uncertainty_results <span class="ot">&lt;-</span> <span class="fu">integrated_activity_data_uncertainty</span>(</span>
<span id="cb17-838"><a href="#cb17-838" aria-hidden="true" tabindex="-1"></a>  <span class="at">confusion_matrix =</span> conf_matrix,</span>
<span id="cb17-839"><a href="#cb17-839" aria-hidden="true" tabindex="-1"></a>  <span class="at">area_t1_ha =</span> <span class="dv">100000</span>,  <span class="co"># Initial forest area</span></span>
<span id="cb17-840"><a href="#cb17-840" aria-hidden="true" tabindex="-1"></a>  <span class="at">area_t2_ha =</span> <span class="dv">95000</span>,   <span class="co"># Final forest area</span></span>
<span id="cb17-841"><a href="#cb17-841" aria-hidden="true" tabindex="-1"></a>  <span class="at">registration_error_m =</span> <span class="dv">30</span>,</span>
<span id="cb17-842"><a href="#cb17-842" aria-hidden="true" tabindex="-1"></a>  <span class="at">pixel_size_m =</span> <span class="dv">30</span>,</span>
<span id="cb17-843"><a href="#cb17-843" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sim =</span> <span class="dv">10000</span></span>
<span id="cb17-844"><a href="#cb17-844" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-845"><a href="#cb17-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-846"><a href="#cb17-846" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb17-847"><a href="#cb17-847" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(uncertainty_results<span class="sc">$</span>summary)</span>
<span id="cb17-848"><a href="#cb17-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-849"><a href="#cb17-849" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize uncertainty distribution</span></span>
<span id="cb17-850"><a href="#cb17-850" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-851"><a href="#cb17-851" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">change =</span> uncertainty_results<span class="sc">$</span>simulations[, <span class="st">"change"</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb17-852"><a href="#cb17-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> change)) <span class="sc">+</span></span>
<span id="cb17-853"><a href="#cb17-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb17-854"><a href="#cb17-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(uncertainty_results<span class="sc">$</span>simulations[, <span class="st">"change"</span>]),</span>
<span id="cb17-855"><a href="#cb17-855" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb17-856"><a href="#cb17-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> uncertainty_results<span class="sc">$</span>summary<span class="sc">$</span>ci_lower[<span class="dv">3</span>],</span>
<span id="cb17-857"><a href="#cb17-857" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb17-858"><a href="#cb17-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> uncertainty_results<span class="sc">$</span>summary<span class="sc">$</span>ci_upper[<span class="dv">3</span>],</span>
<span id="cb17-859"><a href="#cb17-859" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">size =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb17-860"><a href="#cb17-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-861"><a href="#cb17-861" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Activity Data Uncertainty: Forest Area Change"</span>,</span>
<span id="cb17-862"><a href="#cb17-862" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"Mean: %.0f ha (90%% CI: %.0f - %.0f ha)"</span>,</span>
<span id="cb17-863"><a href="#cb17-863" aria-hidden="true" tabindex="-1"></a>                      uncertainty_results<span class="sc">$</span>summary<span class="sc">$</span>mean[<span class="dv">3</span>],</span>
<span id="cb17-864"><a href="#cb17-864" aria-hidden="true" tabindex="-1"></a>                      uncertainty_results<span class="sc">$</span>summary<span class="sc">$</span>ci_lower[<span class="dv">3</span>],</span>
<span id="cb17-865"><a href="#cb17-865" aria-hidden="true" tabindex="-1"></a>                      uncertainty_results<span class="sc">$</span>summary<span class="sc">$</span>ci_upper[<span class="dv">3</span>]),</span>
<span id="cb17-866"><a href="#cb17-866" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Change in Forest Area (ha)"</span>,</span>
<span id="cb17-867"><a href="#cb17-867" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span></span>
<span id="cb17-868"><a href="#cb17-868" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-869"><a href="#cb17-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb17-870"><a href="#cb17-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-871"><a href="#cb17-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-872"><a href="#cb17-872" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb17-873"><a href="#cb17-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-874"><a href="#cb17-874" aria-hidden="true" tabindex="-1"></a><span class="fu">## ART-TREES Compliance {#sec-ad-art-trees}</span></span>
<span id="cb17-875"><a href="#cb17-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-876"><a href="#cb17-876" aria-hidden="true" tabindex="-1"></a><span class="fu">### Documentation {#sec-ad-documentation}</span></span>
<span id="cb17-877"><a href="#cb17-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-878"><a href="#cb17-878" aria-hidden="true" tabindex="-1"></a>Monitoring Plan must include:</span>
<span id="cb17-879"><a href="#cb17-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-880"><a href="#cb17-880" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Classification methodology:</span>
<span id="cb17-881"><a href="#cb17-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-882"><a href="#cb17-882" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Algorithm (Random Forest, SVM, CNN, etc.)</span>
<span id="cb17-883"><a href="#cb17-883" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Training data sample size and distribution</span>
<span id="cb17-884"><a href="#cb17-884" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Accuracy assessment protocol</span>
<span id="cb17-885"><a href="#cb17-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-886"><a href="#cb17-886" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Validation approach:</span>
<span id="cb17-887"><a href="#cb17-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-888"><a href="#cb17-888" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sample design (stratified random, systematic)</span>
<span id="cb17-889"><a href="#cb17-889" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sample size justification (power analysis)</span>
<span id="cb17-890"><a href="#cb17-890" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Reference data sources and dates</span>
<span id="cb17-891"><a href="#cb17-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-892"><a href="#cb17-892" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Uncertainty quantification:</span>
<span id="cb17-893"><a href="#cb17-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-894"><a href="#cb17-894" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Monte Carlo simulation specification (n=10,000)</span>
<span id="cb17-895"><a href="#cb17-895" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Error propagation methods</span>
<span id="cb17-896"><a href="#cb17-896" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Confidence interval calculation</span>
<span id="cb17-897"><a href="#cb17-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-898"><a href="#cb17-898" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Quality assurance:</span>
<span id="cb17-899"><a href="#cb17-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-900"><a href="#cb17-900" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Independent verification of classifications</span>
<span id="cb17-901"><a href="#cb17-901" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cross-validation results</span>
<span id="cb17-902"><a href="#cb17-902" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal consistency checks</span>
<span id="cb17-903"><a href="#cb17-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-904"><a href="#cb17-904" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reporting Format {#sec-ad-reporting-format}</span></span>
<span id="cb17-905"><a href="#cb17-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-906"><a href="#cb17-906" aria-hidden="true" tabindex="-1"></a>CRF Table: Activity Data Uncertainty</span>
<span id="cb17-907"><a href="#cb17-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-910"><a href="#cb17-910" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-911"><a href="#cb17-911" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb17-912"><a href="#cb17-912" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ad-crf-table</span></span>
<span id="cb17-913"><a href="#cb17-913" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb17-914"><a href="#cb17-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-915"><a href="#cb17-915" aria-hidden="true" tabindex="-1"></a><span class="co"># Example CRF-compatible output</span></span>
<span id="cb17-916"><a href="#cb17-916" aria-hidden="true" tabindex="-1"></a>ad_crf_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-917"><a href="#cb17-917" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parameter =</span> <span class="fu">c</span>(</span>
<span id="cb17-918"><a href="#cb17-918" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Forest area (t1)"</span>,</span>
<span id="cb17-919"><a href="#cb17-919" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Forest area (t2)"</span>,</span>
<span id="cb17-920"><a href="#cb17-920" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Deforestation"</span>,</span>
<span id="cb17-921"><a href="#cb17-921" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Classification accuracy"</span>,</span>
<span id="cb17-922"><a href="#cb17-922" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Overall uncertainty (90% CI)"</span></span>
<span id="cb17-923"><a href="#cb17-923" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-924"><a href="#cb17-924" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(<span class="dv">100000</span>, <span class="dv">95000</span>, <span class="dv">5000</span>, <span class="fl">92.5</span>, <span class="cn">NA</span>),</span>
<span id="cb17-925"><a href="#cb17-925" aria-hidden="true" tabindex="-1"></a>  <span class="at">Unit =</span> <span class="fu">c</span>(<span class="st">"ha"</span>, <span class="st">"ha"</span>, <span class="st">"ha"</span>, <span class="st">"%"</span>, <span class="st">"%"</span>),</span>
<span id="cb17-926"><a href="#cb17-926" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lower_CI =</span> <span class="fu">c</span>(<span class="dv">98500</span>, <span class="dv">93400</span>, <span class="dv">4600</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb17-927"><a href="#cb17-927" aria-hidden="true" tabindex="-1"></a>  <span class="at">Upper_CI =</span> <span class="fu">c</span>(<span class="dv">101500</span>, <span class="dv">96600</span>, <span class="dv">5400</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb17-928"><a href="#cb17-928" aria-hidden="true" tabindex="-1"></a>  <span class="at">Uncertainty_pct =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.7</span>, <span class="fl">8.0</span>, <span class="cn">NA</span>, <span class="fl">8.5</span>)</span>
<span id="cb17-929"><a href="#cb17-929" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-930"><a href="#cb17-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-931"><a href="#cb17-931" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb17-932"><a href="#cb17-932" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb17-933"><a href="#cb17-933" aria-hidden="true" tabindex="-1"></a>  ad_crf_table,</span>
<span id="cb17-934"><a href="#cb17-934" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Activity Data Uncertainty Summary (Example)"</span>,</span>
<span id="cb17-935"><a href="#cb17-935" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Parameter"</span>, <span class="st">"Value"</span>, <span class="st">"Unit"</span>, <span class="st">"Lower 90% CI"</span>, <span class="st">"Upper 90% CI"</span>, <span class="st">"Uncertainty (%)"</span>)</span>
<span id="cb17-936"><a href="#cb17-936" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-937"><a href="#cb17-937" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-938"><a href="#cb17-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-939"><a href="#cb17-939" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb17-940"><a href="#cb17-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-941"><a href="#cb17-941" aria-hidden="true" tabindex="-1"></a><span class="fu">## Next Steps &amp; Notes {#sec-ad-summary}</span></span>
<span id="cb17-942"><a href="#cb17-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-943"><a href="#cb17-943" aria-hidden="true" tabindex="-1"></a><span class="fu">### Critical Success Factors {#sec-ad-success-factors}</span></span>
<span id="cb17-944"><a href="#cb17-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-945"><a href="#cb17-945" aria-hidden="true" tabindex="-1"></a>For <span class="sc">\&lt;</span>10% activity data uncertainty: 1. Overall classification accuracy <span class="sc">\&gt;</span>90% 2. Validation sample size <span class="sc">\&gt;</span>400 points 3. Stratified sampling for rare classes 4. Geometric co-registration <span class="sc">\&lt;</span>1 pixel 5. Reference data temporal lag <span class="sc">\&lt;</span>6 months</span>
<span id="cb17-946"><a href="#cb17-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-947"><a href="#cb17-947" aria-hidden="true" tabindex="-1"></a>For 10-20% uncertainty (acceptable Tier 2): - Overall accuracy 85-90% - Validation samples 200-400 - Registration <span class="sc">\&lt;</span>2 pixels</span>
<span id="cb17-948"><a href="#cb17-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-949"><a href="#cb17-949" aria-hidden="true" tabindex="-1"></a>For <span class="sc">\&gt;</span>20% uncertainty (Tier 1, high deductions): - Overall accuracy <span class="sc">\&lt;</span>85% - Inadequate validation - Significant temporal/spatial misalignment</span>
<span id="cb17-950"><a href="#cb17-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-951"><a href="#cb17-951" aria-hidden="true" tabindex="-1"></a><span class="fu">### Next Chapter </span></span>
<span id="cb17-952"><a href="#cb17-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-953"><a href="#cb17-953" aria-hidden="true" tabindex="-1"></a>Chapter 2: Allometry Uncertainty will address:</span>
<span id="cb17-954"><a href="#cb17-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-955"><a href="#cb17-955" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Model selection: Geographic transferability, species specificity</span>
<span id="cb17-956"><a href="#cb17-956" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Parameter estimation: Regression uncertainty, prediction intervals</span>
<span id="cb17-957"><a href="#cb17-957" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Measurement error: DBH precision, height bias, wood density variability</span>
<span id="cb17-958"><a href="#cb17-958" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Bias correction: Log-transformation, non-linear models</span>
<span id="cb17-959"><a href="#cb17-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-960"><a href="#cb17-960" aria-hidden="true" tabindex="-1"></a>Critical linkage: Activity data provides spatial extent; allometry converts that extent to biomass. Combined uncertainty:</span>
<span id="cb17-961"><a href="#cb17-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-962"><a href="#cb17-962" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb17-963"><a href="#cb17-963" aria-hidden="true" tabindex="-1"></a>U_{total}^2 = U_{activity}^2 + U_{allometry}^2 + 2 \times \text{Cov}(A, B)</span>
<span id="cb17-964"><a href="#cb17-964" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb17-965"><a href="#cb17-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-966"><a href="#cb17-966" aria-hidden="true" tabindex="-1"></a>Next steps: Quantify allometric uncertainty to enable full error propagation in Chapter 4.</span>
<span id="cb17-967"><a href="#cb17-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-968"><a href="#cb17-968" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb17-969"><a href="#cb17-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-970"><a href="#cb17-970" aria-hidden="true" tabindex="-1"></a><span class="fu">## References {#sec-ad-references}</span></span>
<span id="cb17-971"><a href="#cb17-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-972"><a href="#cb17-972" aria-hidden="true" tabindex="-1"></a>Olofsson, P., Foody, G.M., Herold, M., Stehman, S.V., Woodcock, C.E., &amp; Wulder, M.A. (2014). Good practices for estimating area and assessing accuracy of land change. Remote Sensing of Environment, 148, 42-57.</span>
<span id="cb17-973"><a href="#cb17-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-974"><a href="#cb17-974" aria-hidden="true" tabindex="-1"></a>Stehman, S.V. (2014). Estimating area and map accuracy for stratified random sampling when the strata are different from the map classes. International Journal of Remote Sensing, 35(13), 4923-4939.</span>
<span id="cb17-975"><a href="#cb17-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-976"><a href="#cb17-976" aria-hidden="true" tabindex="-1"></a>Pontius Jr., R.G., &amp; Millones, M. (2011). Death to Kappa: birth of quantity disagreement and allocation disagreement for accuracy assessment. International Journal of Remote Sensing, 32(15), 4407-4429.</span>
<span id="cb17-977"><a href="#cb17-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-978"><a href="#cb17-978" aria-hidden="true" tabindex="-1"></a>GFOI (2016). Integration of remote-sensing and ground-based observations for estimation of emissions and removals of greenhouse gases in forests: Methods and Guidance from the Global Forest Observations Initiative. Edition 2.0. Rome: Food and Agriculture Organization.</span>
<span id="cb17-979"><a href="#cb17-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-980"><a href="#cb17-980" aria-hidden="true" tabindex="-1"></a>GOFC-GOLD (2016). A sourcebook of methods and procedures for monitoring and reporting anthropogenic greenhouse gas emissions and removals associated with deforestation, gains and losses of carbon stocks in forests remaining forests, and forestation. GOFC-GOLD Report version COP22-1. Alberta, Canada: GOFC-GOLD Land Cover Project Office.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://github.com/training-resource/uncertainty">Source</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/training-resource/uncertainty/edit/main/03-activity-data/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/training-resource/uncertainty/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p><a href="https://linkedin.com/in/seamusrobertmurphy">LinkedIn</a> | <a href="https://drive.google.com/uc?export=download&amp;id=13YLhsRCAMMHQw-jd2SJdaRJH9udBGytP">Resume</a> | <a href="https://scholar.google.com/citations?hl=en&amp;user=jDGq9I4AAAAJ">Scholar</a></p>
</div>
  </div>
</footer>


</body></html>