<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>3. Activity Data – REDD+ Uncertainty Training</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../04-monte-carlo/index.html" rel="next">
<link href="../02-emission-factors/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-49a404399acb846fa9462a115fe112f4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="../site_libs/htmltools-fill/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets/htmlwidgets.js"></script><script src="../site_libs/jquery/jquery-3.6.0.min.js"></script><link href="../site_libs/leaflet/leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet/leaflet.js"></script><link href="../site_libs/leafletfix/leafletfix.css" rel="stylesheet">
<script src="../site_libs/proj4/proj4.min.js"></script><script src="../site_libs/Proj4Leaflet/proj4leaflet.js"></script><link href="../site_libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-binding/leaflet.js"></script><script src="../site_libs/leaflet-providers/leaflet-providers_2.0.0.js"></script><script src="../site_libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script><script src="../site_libs/Leaflet.glify/addGlifyPoints.js"></script><script src="../site_libs/Leaflet.glify/addGlifyPolygons.js"></script><script src="../site_libs/Leaflet.glify/addGlifyPolylines.js"></script><script src="../site_libs/Leaflet.glify/glify-browser.js"></script><link href="../site_libs/tabwid/tabwid.css" rel="stylesheet">
<script src="../site_libs/tabwid/tabwid.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="3. Activity Data – REDD+ Uncertainty Training">
<meta property="og:description" content="">
<meta property="og:image" content="index_files/figure-html/unnamed-chunk-5-1.png">
<meta property="og:site_name" content="REDD+ Uncertainty Training">
</head>
<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../03-activity-data/index.html"><span class="chapter-title">3. Activity Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">REDD+ Uncertainty</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/training-resource/uncertainty" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-allometry/index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1. Allometry</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-emission-factors/index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2. Emission Factors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-activity-data/index.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">3. Activity Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-monte-carlo/index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4. Monte Carlo</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references/index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">References</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../AA-Appendix/glossary-terms.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Glossary of Terms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../AA-Appendix/additional-reading.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Additional Reading</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title"><strong>On this page</strong></h2>
   
  <ul>
<li>
<a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
<li><a href="#ipcc-approaches" id="toc-ipcc-approaches" class="nav-link" data-scroll-target="#ipcc-approaches">IPCC Approaches</a></li>
  <li><a href="#environment-setup" id="toc-environment-setup" class="nav-link" data-scroll-target="#environment-setup">Environment Setup</a></li>
  </ul>
</li>
  <li><a href="#time-series-structure" id="toc-time-series-structure" class="nav-link" data-scroll-target="#time-series-structure">3.1 Time Series Structure</a></li>
  <li><a href="#assemble-data-cube" id="toc-assemble-data-cube" class="nav-link" data-scroll-target="#assemble-data-cube">3.2 Assemble Data Cube</a></li>
  <li><a href="#normalize-data-cube" id="toc-normalize-data-cube" class="nav-link" data-scroll-target="#normalize-data-cube">3.3 Normalize Data Cube</a></li>
  <li><a href="#training-data-samples" id="toc-training-data-samples" class="nav-link" data-scroll-target="#training-data-samples">3.4 Training Data Samples</a></li>
  <li><a href="#classify-data-cube" id="toc-classify-data-cube" class="nav-link" data-scroll-target="#classify-data-cube">3.5 Classify Data Cube</a></li>
  <li><a href="#probability-data-cube" id="toc-probability-data-cube" class="nav-link" data-scroll-target="#probability-data-cube">3.6 Probability Data Cube</a></li>
  <li>
<a href="#training-data-enhancements" id="toc-training-data-enhancements" class="nav-link" data-scroll-target="#training-data-enhancements">3.7 Training Data Enhancements</a>
  <ul class="collapse">
<li><a href="#pixel-entropy-sampling" id="toc-pixel-entropy-sampling" class="nav-link" data-scroll-target="#pixel-entropy-sampling">Pixel Entropy Sampling</a></li>
  <li><a href="#hierarchical-clustering" id="toc-hierarchical-clustering" class="nav-link" data-scroll-target="#hierarchical-clustering">Hierarchical Clustering</a></li>
  <li><a href="#class-imbalances" id="toc-class-imbalances" class="nav-link" data-scroll-target="#class-imbalances">Class Imbalances</a></li>
  <li><a href="#geographic-variance" id="toc-geographic-variance" class="nav-link" data-scroll-target="#geographic-variance">Geographic Variance</a></li>
  <li><a href="#noise-filtering" id="toc-noise-filtering" class="nav-link" data-scroll-target="#noise-filtering">Noise Filtering</a></li>
  </ul>
</li>
  <li><a href="#smooth-data-cube" id="toc-smooth-data-cube" class="nav-link" data-scroll-target="#smooth-data-cube">3.8 Smooth Data Cube</a></li>
  <li>
<a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">3.8 Cross-Validation</a>
  <ul class="collapse">
<li><a href="#monte-carlo-cross-validation" id="toc-monte-carlo-cross-validation" class="nav-link" data-scroll-target="#monte-carlo-cross-validation">Monte Carlo Cross-Validation</a></li>
  </ul>
</li>
  <li>
<a href="#accuracy-assessment" id="toc-accuracy-assessment" class="nav-link" data-scroll-target="#accuracy-assessment">3.9 Accuracy Assessment</a>
  <ul class="collapse">
<li><a href="#confusion-matrix" id="toc-confusion-matrix" class="nav-link" data-scroll-target="#confusion-matrix">Confusion Matrix</a></li>
  </ul>
</li>
  <li><a href="#sec-summary" id="toc-sec-summary" class="nav-link" data-scroll-target="#sec-summary">3.10 Chapter Summary</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/training-resource/uncertainty/edit/main/03-activity-data/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/training-resource/uncertainty/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">3. Activity Data</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="overview" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="overview">Overview</h2>
<p>Activity data (AD) represents the spatial extent and temporal dynamics of land-use change in REDD+ accounting. This chapter addresses uncertainty quantification in land cover classification, change detection, and spatial aggregation. These components typically constitute the greatest contribution to total REDD+ uncertainty <span class="citation" data-cites="ballantyne2015audit">(<a href="../references/index.html#ref-ballantyne2015audit" role="doc-biblioref">Ballantyne et al., 2015</a>)</span>.</p>
<section id="ipcc-approaches" class="level3"><h3 class="anchored" data-anchor-id="ipcc-approaches">IPCC Approaches</h3>
<p>The IPCC defines three hierarchical approaches for activity data collection that differ in spatial explicitness and uncertainty characteristics <span class="citation" data-cites="ipccChapter2Generic2019">(<a href="../references/index.html#ref-ipccChapter2Generic2019" role="doc-biblioref">IPCC, 2019</a>)</span>:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 33%">
<col style="width: 30%">
<col style="width: 18%">
</colgroup>
<thead><tr class="header">
<th>Approach</th>
<th>Data Type</th>
<th>Spatial Resolution</th>
<th>Uncertainty</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Approach 1</td>
<td>Area statistics</td>
<td>Aggregated totals</td>
<td>Highest</td>
</tr>
<tr class="even">
<td>Approach 2</td>
<td>Sample-based matrices</td>
<td>Point/grid sampling</td>
<td>Moderate</td>
</tr>
<tr class="odd">
<td>Approach 3</td>
<td>Wall-to-wall maps</td>
<td>Spatially explicit</td>
<td>Lowest</td>
</tr>
</tbody>
</table>
<p>This chapter implements Approach 3 methods using satellite time series classification, which ART-TREES programs predominantly adopt due to requirements for spatially explicit monitoring, pixel-level change detection, and integration with emission factor stratification. The data cube framework and machine learning workflows demonstrated in sections 3.2-3.9 operationalize Approach 3 while providing the uncertainty quantification infrastructure required under ART-TREES Section 8. The chapter is structured around a data cube framework for organizing and analyzing spatiotemporal land cover data, followed by uncertainty estimation techniques aligned with IPCC methodologies. We organize the technical content into the following components:</p>
<ol type="1">
<li>Data Cube Architecture: Spatiotemporal array structures for satellite time series</li>
<li>IPCC Monitoring Approaches: Transition matrices and spatial explicitness (Approaches 1-3)</li>
<li>Pixel-Level Uncertainty Tracking: Model residuals for spatial error mapping</li>
<li>Random Forest Optimization: Monte Carlo calibration of classification algorithms</li>
<li>Accuracy Assessment: Confusion matrices and validation metrics</li>
</ol></section><section id="environment-setup" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="environment-setup">Environment Setup</h3>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">easypackages</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/easypackages/man/packages.html">packages</a></span><span class="op">(</span></span>
<span>  <span class="st">"bslib"</span>, <span class="st">"caret"</span>, <span class="st">"cols4all"</span>, <span class="st">"covr"</span>, <span class="st">"cowplot"</span>, <span class="st">"dendextend"</span>, <span class="st">"digest"</span>,<span class="st">"DiagrammeR"</span>, </span>
<span>  <span class="st">"dtwclust"</span>, <span class="st">"downlit"</span>, <span class="st">"devtools"</span>, <span class="st">"e1071"</span>, <span class="st">"exactextractr"</span>,<span class="st">"elevatr"</span>, <span class="st">"FNN"</span>, </span>
<span>  <span class="st">"future"</span>, <span class="st">"forestdata"</span>,<span class="st">"gdalcubes"</span>, <span class="st">"gdalUtilities"</span>, <span class="st">"geojsonsf"</span>, <span class="st">"geos"</span>, </span>
<span>  <span class="st">"ggplot2"</span>, <span class="st">"ggstats"</span>, <span class="st">"ggspatial"</span>, <span class="st">"ggmap"</span>, <span class="st">"ggplotify"</span>, <span class="st">"ggpubr"</span>, <span class="st">"ggrepel"</span>, </span>
<span>  <span class="st">"giscoR"</span>, <span class="st">"hdf5r"</span>, <span class="st">"httr"</span>, <span class="st">"httr2"</span>, <span class="st">"htmltools"</span>, <span class="st">"jsonlite"</span>, <span class="st">"kohonen"</span>, <span class="st">"leafem"</span>, </span>
<span>  <span class="st">"leaflet.providers"</span>, <span class="st">"libgeos"</span>,<span class="st">"luz"</span>,<span class="st">"lwgeom"</span>, <span class="st">"leaflet"</span>, <span class="st">"leafgl"</span>, <span class="st">"MLmetrics"</span>,</span>
<span>  <span class="st">"mapedit"</span>, <span class="st">"mapview"</span>, <span class="st">"maptiles"</span>, <span class="st">"methods"</span>, <span class="st">"mgcv"</span>, <span class="st">"ncdf4"</span>, <span class="st">"nnet"</span>, <span class="st">"openxlsx"</span>, </span>
<span>  <span class="st">"parallel"</span>, <span class="st">"plotly"</span>, <span class="st">"randomForestExplainer"</span>,<span class="st">"randomForest"</span>, <span class="st">"rasterVis"</span>, <span class="st">"raster"</span>, </span>
<span>  <span class="st">"Rcpp"</span>, <span class="st">"RcppArmadillo"</span>, <span class="st">"RcppCensSpatial"</span>, <span class="st">"rayshader"</span>, <span class="st">"RcppEigen"</span>, <span class="st">"RcppParallel"</span>, </span>
<span>  <span class="st">"RColorBrewer"</span>, <span class="st">"reactable"</span>, <span class="st">"rgl"</span>, <span class="st">"rsconnect"</span>,<span class="st">"RStoolbox"</span>, <span class="st">"rts"</span>, <span class="st">"s2"</span>, <span class="st">"sf"</span>, </span>
<span>  <span class="st">"scales"</span>, <span class="st">"sits"</span>, <span class="st">"sitsdata"</span>, <span class="st">"spdep"</span>, <span class="st">"stars"</span>, <span class="st">"stringr"</span>,<span class="st">"supercells"</span>, <span class="st">"smotefamily"</span>, </span>
<span>  <span class="st">"terra"</span>, <span class="st">"testthat"</span>, <span class="st">"tidyverse"</span>, <span class="st">"tidyterra"</span>, <span class="st">"tools"</span>, <span class="st">"torch"</span>, <span class="st">"tmap"</span>, <span class="st">"tmaptools"</span>, </span>
<span>  <span class="st">"terrainr"</span>, <span class="st">"xgboost"</span>, <span class="st">"webshot"</span>, <span class="st">"webshot2"</span>,</span>
<span>  prompt <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2</a></span><span class="op">(</span>use_s2 <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr></section></section><section id="time-series-structure" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="time-series-structure">3.1 Time Series Structure</h2>
<p>Data cubes provide a structured framework for organizing and analyzing satellite imagery time series. We define data cubes as multidimensional arrays with dimensions associated with space and time, where land cover observations become “attributes” that have duration along the temporal dimension.</p>
<p>For purpose of REDD+ land monitoring, a data cube structure consists of:</p>
<ul>
<li>Spatial dimensions: Longitude (x) and latitude (y)</li>
<li>Temporal dimension: Observation dates (t)</li>
<li>Spectral dimension: Sensor bands (λ)</li>
<li>Attributes: Land cover class, uncertainty metrics, model residuals</li>
</ul>
<p>In the following sections (3.2-3.7), we demonstrate user-friendly operations from the <code>sits</code> and <code>gdalcubes</code> packages for time series workflows <span class="citation" data-cites="sits gdalcubes">(<a href="../references/index.html#ref-gdalcubes" role="doc-biblioref">Appel &amp; Pebesma, 2019a</a>; <a href="../references/index.html#ref-sits" role="doc-biblioref">Simoes et al., 2021b</a>)</span>. These tools integrate machine learning classification with data cube management and raster processing. This approach is particularly valuable for REDD+ workflows because it supports uncertainty-based optimization of both data cube architecture and classifier training <span class="citation" data-cites="appel2019demand">(<a href="../references/index.html#ref-appel2019demand" role="doc-biblioref">Appel &amp; Pebesma, 2019b</a>)</span>. Sections 3.8-3.9 then cover advanced procedures from the <code>caret</code> and <code>terra</code> packages, including cross-validation and Monte Carlo training simulations for accuracy assessment and model calibration.</p>
</section><section id="assemble-data-cube" class="level2"><h2 class="anchored" data-anchor-id="assemble-data-cube">3.2 Assemble Data Cube</h2>
<p>The <code>sits</code> package installation comes pre-loaded with an API connections<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> to ARD collections (<a href="https://ceos.org/ard/">Analysis-Ready-Data</a>) via STAC protocols (<a href="https://stacspec.org/en">SpatioTemporal Asset Catalogs</a>). This built-in component allows programmatic access to cloud-hosted imagery from AWS, Microsoft Planetary Computer, EarthData, Copernicus many other leading warehouses. However, raw ARD collections present several challenges for classification workflows:</p>
<ul>
<li>Spatial harmonization: Band-specific resolutions require harmonization to common grid avoiding edge anomalies and gaps</li>
<li>Temporal harmonization: Revisit cycles vary due to orbital geometry, platform scheduling, and atmospheric conditions</li>
<li>Cloud removal: Atmospheric interference introduces missing observations that corrupt spectral time series</li>
</ul>
<p>For REDD+ monitoring, temporal gaps create systematic underestimation of forest loss when clearing events coincide with cloud-covered periods; a known source of activity data bias requiring explicit quantification in uncertainty budgets. The <code>sits_regularize()</code> function provides wrapper to <code>gdalcubes</code> operations that transforms heterogeneous imagery into regular or normalized data cubes through coupled spatial and temporal harmonizations.</p>
<ul>
<li>Spatial harmonization reprojects all inputs to a common coordinate reference system and resamples to uniform pixel spacing. For instance, fusing Sentinel-1 SAR with Sentinel-2 optical data requires reprojection to the MGRS grid at consistent resolution (typically 10m), ensuring geometric alignment and eliminating co-registration errors that propagate into classification uncertainty.</li>
<li>Temporal harmonization establishes fixed observation intervals (16-day, monthly, seasonal) via cloud-optimized compositing. Within each interval, the algorithm ranks available scenes by cloud cover percentage, using the clearest image as reference and filling gaps from progressively cloudier acquisitions. Pixels with persistent cloud contamination are flagged as NA and gap-filled through temporal interpolation during feature extraction.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ARD Tile Grids
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sentinel-2 acquisitions are organized according to the Military Grid Reference System (MGRS), which partitions global coverage into 60 longitudinal zones spanning 8° each. Within zones, 6° latitudinal blocks are further subdivided into 110 km × 110 km tiles with 10 km overlap to ensure seamless mosaicking. This tiling structure is critical for REDD+ monitoring systems that track forest change across administrative boundaries, as tile edges can introduce geometric discontinuities if not properly managed during data cube construction.</p>
<p>Landsat missions (4,5,7,8,9) employ the Worldwide Reference System-2 (WRS-2), which references scenes by path (descending orbital track) and row (latitudinal frame center). The WRS-2 grid comprises 233 paths globally, each containing 119 rows. All WRS-2 imagery is delivered with geometric correction to UTM projection, facilitating direct integration with ground reference data and cadastral boundaries commonly used in jurisdictional REDD+ accounting. For operational monitoring systems, understanding these tiling schemes is essential for:</p>
<ul>
<li>Stratification: Validation samples must account for tile boundaries to avoid spatial clustering</li>
<li>Co-registration: Cross-sensor fusion (Landsat-Sentinel) requires explicit handling of differing grid systems</li>
<li>Computation: Processing workflows optimized for native tile extents reduce unnecessary resampling and associated geometric errors</li>
</ul>
</div>
</div>
<p>This analysis replicates methods from <span class="citation" data-cites="simoes2021satellite">Simoes et al. (<a href="../references/index.html#ref-simoes2021satellite" role="doc-biblioref">2021a</a>)</span>, which assembles a data cube from MPC’s collection of Sentinel-2 ARD-imagery comprising a single tiled area in the state of Rondonia for the full calendar year of 2022.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Following assmbly, we normalize raw imagery into a bi-monthly regularized cube below.</p>
<p><em>Caution: This code cell requires longer runtime (~12 mins).</em></p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create data cube from Microsoft Planetary Computer ARD</span></span>
<span><span class="va">cube_s2_raw</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source            <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection    <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  tiles             <span class="op">=</span> <span class="st">"20LMR"</span>,</span>
<span>  bands             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date    <span class="op">=</span> <span class="st">"2022-01-01"</span>,</span>
<span>  end_date      <span class="op">=</span> <span class="st">"2022-12-31"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Check timelines of assembled tiles</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">cube_s2_raw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="normalize-data-cube" class="level2"><h2 class="anchored" data-anchor-id="normalize-data-cube">3.3 Normalize Data Cube</h2>
<p>Although default <code>sits</code> operations assemble cubes in the cloud, increased temporal and spatial extents and finer resolutions often require signficant processing times. Especially with larger data cube operations, we recommend assembling data cubes in the cloud and downloading copies of the cube imagery to your drive before normalizing imagery into a regular cube from the local directory of downloads. This speeds up operations and avoids network interruptions or queue lags.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Copy cube to local files</span></span>
<span><span class="va">cube_s2_local</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cube_copy.html">sits_cube_copy</a></span><span class="op">(</span></span>
<span>  cube              <span class="op">=</span> <span class="va">cube_s2_raw</span>,</span>
<span>  output_dir    <span class="op">=</span> <span class="st">"./assets/images/raw/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Normalize cube from local files</span></span>
<span><span class="va">cube_s2_reg</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_regularize.html">sits_regularize</a></span><span class="op">(</span></span>
<span>    cube                <span class="op">=</span> <span class="va">cube_s2_local</span>,</span>
<span>    output_dir  <span class="op">=</span> <span class="st">"./assets/images/reg/"</span>,</span>
<span>    res                 <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    period      <span class="op">=</span> <span class="st">"P16D"</span>,</span>
<span>    multicores  <span class="op">=</span> <span class="fl">6</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute spectral index bands for cube</span></span>
<span><span class="va">cube_s2_reg</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span></span>
<span>    data                <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    NDVI                <span class="op">=</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B04</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="va">B04</span><span class="op">)</span>,</span>
<span>  output_dir    <span class="op">=</span> <span class="st">"./assets/images/reg/"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cube_s2_reg</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span></span>
<span>    data                <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    NBR                 <span class="op">=</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B12</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="va">B12</span><span class="op">)</span>,</span>
<span>  output_dir    <span class="op">=</span> <span class="st">"./assets/images/reg/"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cube_s2_reg</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span></span>
<span>    data                <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    EVI                 <span class="op">=</span> <span class="fl">2.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B04</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="fl">6.0</span> <span class="op">*</span> <span class="va">B04</span> <span class="op">-</span> <span class="fl">7.5</span> <span class="op">*</span> <span class="va">B02</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>  output_dir    <span class="op">=</span> <span class="st">"./assets/images/reg/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check cube structure</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">cube_s2_reg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot single-date RGB image</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_reg</span>, </span>
<span>         red <span class="op">=</span> <span class="st">"B11"</span>, </span>
<span>         green <span class="op">=</span> <span class="st">"B8A"</span>, </span>
<span>         blue <span class="op">=</span> <span class="st">"B02"</span>, </span>
<span>         date <span class="op">=</span> <span class="st">"2022-07-16"</span></span>
<span>         <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<pre><code>NA 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |======================================================================| 100%
NA Rows: 1
NA Columns: 11
NA $ source     &lt;chr&gt; "MPC"
NA $ collection &lt;chr&gt; "SENTINEL-2-L2A"
NA $ satellite  &lt;chr&gt; "SENTINEL-2"
NA $ sensor     &lt;chr&gt; "MSI"
NA $ tile       &lt;chr&gt; "20LMR"
NA $ xmin       &lt;dbl&gt; 399960
NA $ xmax       &lt;dbl&gt; 509760
NA $ ymin       &lt;dbl&gt; 8990200
NA $ ymax       &lt;dbl&gt; 9100000
NA $ crs        &lt;chr&gt; "PROJCRS[\"WGS 84 / UTM zone 20S\",\n    BASEGEOGCRS[\"WGS …
NA $ file_info  &lt;list&gt; [&lt;tbl_df[299 x 13]&gt;]</code></pre>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</section><section id="training-data-samples" class="level2"><h2 class="anchored" data-anchor-id="training-data-samples">3.4 Training Data Samples</h2>
<p>Training data quality directly determines classification accuracy and, consequently, activity data uncertainty. This analysis uses the <code>samples_deforestation_rondonia</code> dataset (n=6,007 signatures) distributed with the <code>sitsdata</code> package, comprising nine forest disturbance classes collected through expert visual interpretation of Sentinel-2 imagery representing deforestation events across Rondônia state in the Brazilian Amazon:</p>
<ul>
<li>
<code>Clear_Cut_Bare_Soil</code>: Post-clearing exposed soil</li>
<li>
<code>Clear_Cut_Burned_Area</code>: Burned clearing residues</li>
<li>
<code>Clear_Cut_Vegetation</code>: Regrowth or residual vegetation post-harvest</li>
<li>
<code>Forest</code>: Intact forest including <code>Mountainside_Forest</code>, <code>Riparian_Forest</code>
</li>
<li>
<code>Water</code>, <code>Wetland</code>, <code>Seasonally_Flooded</code>: Hydrological features</li>
</ul>
<p>The time series spans 2022-01-05 to 2022-12-23 at 16-day intervals, containing 10 Sentinel-2 bands (<code>B02</code>, <code>B03</code>, <code>B04</code>, <code>B05</code>, <code>B06</code>, <code>B07</code>, <code>B8A</code>, <code>B08</code>, <code>B11</code> and <code>B12</code>). Temporal validity aligns with the agricultural calendar to capture seasonal dynamics of land conversion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Demo Training Samples</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"samples_deforestation_rondonia"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">summary</span>(samples_deforestation_rondonia)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 9 × 3</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   label                 count   prop</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                 <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span> Clear_Cut_Bare_Soil     <span class="dv">944</span> <span class="fl">0.157</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span> Clear_Cut_Burned_Area   <span class="dv">983</span> <span class="fl">0.164</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span> Clear_Cut_Vegetation    <span class="dv">603</span> <span class="fl">0.100</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span> Forest                  <span class="dv">964</span> <span class="fl">0.160</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span> Mountainside_Forest     <span class="dv">211</span> <span class="fl">0.0351</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span> Riparian_Forest        <span class="dv">1247</span> <span class="fl">0.208</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">7</span> Seasonally_Flooded      <span class="dv">731</span> <span class="fl">0.122</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">8</span> Water                   <span class="dv">109</span> <span class="fl">0.0181</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">9</span> Wetland                 <span class="dv">215</span> <span class="fl">0.0358</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">head</span>(samples_deforestation_rondonia)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="co"># A tibble: 6 × 7</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>   longitude latitude start_date end_date   label               cube  time_series</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span>       <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>date<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>               <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>list<span class="sc">&gt;</span>     </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">1</span>     <span class="sc">-</span><span class="fl">66.5</span>    <span class="sc">-</span><span class="fl">9.63</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">2</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.70</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">3</span>     <span class="sc">-</span><span class="fl">66.4</span>    <span class="sc">-</span><span class="fl">9.81</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Forest              SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">4</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.64</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Bare_Soil SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">5</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Vegetati… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span>   </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="dv">6</span>     <span class="sc">-</span><span class="fl">66.3</span>    <span class="sc">-</span><span class="fl">9.73</span> <span class="dv">2022-01-05</span> <span class="dv">2022-12-23</span> Clear_Cut_Burned_A… SENT… <span class="sc">&lt;</span>tibble<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualizing class-specific temporal trajectories aids in assessing spectral separability; a key determinant of classification uncertainty. The <code>sits_patterns()</code> function fits generalized additive models (GAM) to training data, producing smoothed temporal signatures that represent idealized class behavior. We derive vegetation indices (NDVI, EVI, NBR) to enhance interpretability.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Compute spectral indexes for training samples</span></span>
<span><span class="va">training_samples_with_indices</span> <span class="op">&lt;-</span> <span class="va">samples_deforestation_rondonia</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span>NDVI <span class="op">=</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B04</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="va">B04</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span>NBR <span class="op">=</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B12</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="va">B12</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_apply.html">sits_apply</a></span><span class="op">(</span>EVI <span class="op">=</span> <span class="fl">2.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B04</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">B08</span> <span class="op">+</span> <span class="fl">6.0</span> <span class="op">*</span> <span class="va">B04</span> <span class="op">-</span> <span class="fl">7.5</span> <span class="op">*</span> <span class="va">B02</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Generate and plot patterns</span></span>
<span><span class="va">training_samples_indices</span> <span class="op">&lt;-</span> <span class="va">training_samples_with_indices</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_select.html">sits_select</a></span><span class="op">(</span>bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NDVI"</span>, <span class="st">"EVI"</span>, <span class="st">"NBR"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_patterns.html">sits_patterns</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Temporal signatures conform to documented Amazonian deforestation phenology: forest clearing initiates during dry season onset (May-June), followed by burning in late dry season (August-September), evidenced by abrupt SWIR (B11) decline in <code>Clear_Cut_Burned_Area</code> signatures. Regrowth trajectories (<code>Clear_Cut_Vegetation</code>) exhibit NIR (B8A) recovery through the monitoring period. These temporal contrasts provide the spectral-temporal feature space for subsequent classification.</p>
<hr></section><section id="classify-data-cube" class="level2"><h2 class="anchored" data-anchor-id="classify-data-cube">3.5 Classify Data Cube</h2>
<p>Random Forest models provide robust baseline classifiers for activity data, balancing computational efficiency with adequate performance for Tier 2-3 REDD+ requirements. The <code>sits_train()</code> function implements parallelized Random Forest training with default hyperparameters optimized for satellite time series.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Train model using Random Forest algorithm</span></span>
<span><span class="va">model_randomForest</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_train.html">sits_train</a></span><span class="op">(</span></span>
<span>  samples <span class="op">=</span> <span class="va">samples_deforestation_rondonia</span>,</span>
<span>  ml_method     <span class="op">=</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_rfor.html">sits_rfor</a></span><span class="op">(</span></span>
<span>    num_trees <span class="op">=</span> <span class="fl">120</span>,</span>
<span>    mtry            <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the model results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_randomForest</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Variable importance metrics identify which spatiotemporal features contribute most to class discrimination. For REDD+ operations, understanding feature importance supports:</p>
<ol type="1">
<li>Uncertainty attribution: High-importance features with measurement error propagate more uncertainty</li>
<li>Sensor planning: Identifies critical spectral bands for maintaining classification accuracy</li>
<li>Transfer learning: Guides feature selection when adapting models to new regions</li>
<li>Validation design: Informs stratification schemes for accuracy assessment</li>
</ol></section><section id="probability-data-cube" class="level2"><h2 class="anchored" data-anchor-id="probability-data-cube">3.6 Probability Data Cube</h2>
<p>Classification outputs are generated as probability cubes rather than discrete label maps to preserve model uncertainty information. The <code>sits_classify()</code> function applies trained models to regularized data cubes using fault-tolerant parallel processing, producing per-class probability layers that quantify model confidence at the pixel level.</p>
<p>The <code>sits</code> package implements parallel computing to minimize communication overhead, which enables multi-core systems without configuration.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Classify data cube</span></span>
<span><span class="va">cube_s2_probs</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_classify.html">sits_classify</a></span><span class="op">(</span></span>
<span>    data            <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    ml_model        <span class="op">=</span> <span class="va">model_randomForest</span>,</span>
<span>    output_dir  <span class="op">=</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span>    version         <span class="op">=</span> <span class="st">"rf-1228"</span>, <span class="co"># adds suffix to output filename</span></span>
<span>    multicores  <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    memsize         <span class="op">=</span> <span class="fl">16</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_probs</span>, </span>
<span>         labels <span class="op">=</span> <span class="st">"Forest"</span>, </span>
<span>         palette <span class="op">=</span> <span class="st">"YlGn"</span></span>
<span>         <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="assets/images/png/activity-data-d.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Each pixel in the probability cube contains <code>n</code> probability values (where <code>n</code> = number of classes), summing to 1.0. Low maximum probability values indicate pixels with high classification uncertainty, typically occurring at class boundaries, in mixed pixels, or where spectral-temporal signatures deviate from training data. These pixel-level uncertainty metrics support subsequent:</p>
<ul>
<li>Adaptive stratification: High-uncertainty pixels receive higher validation sampling density</li>
<li>Uncertainty propagation: Probability distributions feed Monte Carlo emission simulations</li>
<li>Quality control: Spatial patterns of low confidence identify systematic classification errors</li>
<li>Temporal tracking: Probability time series detect gradual transitions missed by discrete labeling</li>
</ul>
<p>Probability cubes thus serve as the foundation for rigorous uncertainty quantification in subsequent workflow stages.</p>
</section><section id="training-data-enhancements" class="level2"><h2 class="anchored" data-anchor-id="training-data-enhancements">3.7 Training Data Enhancements</h2>
<p>Classification accuracy in REDD+ monitoring depends critically on training sample quality. Large, well-labeled datasets improve model performance regardless of algorithm choice, while noisy or mislabeled samples degrade classification accuracy and inflate activity data uncertainty <span class="citation" data-cites="maxwell2018implementation frenay2013classification">(<a href="../references/index.html#ref-frenay2013classification" role="doc-biblioref">Frénay &amp; Verleysen, 2013</a>; <a href="../references/index.html#ref-maxwell2018implementation" role="doc-biblioref">Maxwell et al., 2018</a>)</span>. This section demonstrates processing methods to identify problematic samples, reduce class imbalance, and address geographic variance before re-training models.</p>
<section id="pixel-entropy-sampling" class="level3"><h3 class="anchored" data-anchor-id="pixel-entropy-sampling">Pixel Entropy Sampling</h3>
<p>Active learning uses pixel-level classification uncertainty to systematically improve classification accuracy through iterative model refinement <span class="citation" data-cites="crawford2013active cao2012automatic">(<a href="../references/index.html#ref-cao2012automatic" role="doc-biblioref">Cao et al., 2012</a>; <a href="../references/index.html#ref-crawford2013active" role="doc-biblioref">Crawford et al., 2013</a>)</span>. When there is a finite set of alternative classes, the expected value of conflict is given by the Shannon entropy <span class="citation" data-cites="shannonMathematicalTheoryCommunication1948">(<a href="../references/index.html#ref-shannonMathematicalTheoryCommunication1948" role="doc-biblioref">Shannon, 1948</a>)</span>. Entropy may be used to describe the variations in class membership probabilities associated with each pixel. The <code>sits_uncertainty()</code> function quantifies four types of uncertainty metrics:</p>
<p><span class="math display">\[
\text{H} = -\sum_{i=1}^n Pr(i) \times \log(Pr(i))
\]</span></p>
<p>where <span class="math inline">\(Pr(i)\)</span> represents the highest membership probability for pixel <span class="math inline">\(i\)</span> across <span class="math inline">\(n\)</span> classes. For REDD+ applications, the <code>margin</code> of confidence typically provides the most actionable results, such as for highlighting transition zones where forest degradation or regeneration creates spectral ambiguity between classes.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generate uncertainty cube and sample high-uncertainty pixels</span></span>
<span><span class="va">cube_s2_uncertainty</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_uncertainty.html">sits_uncertainty</a></span><span class="op">(</span></span>
<span>    cube <span class="op">=</span> <span class="va">cube_s2_probs</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"margin"</span>, </span>
<span>    output_dir <span class="op">=</span> <span class="st">"./assets/images/uncertainty/"</span>,</span>
<span>    multicores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    memsize <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize high-uncertainty areas</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_uncertainty</span>, palette <span class="op">=</span> <span class="st">"Oranges"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="assets/images/png/activity-data-l1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find samples with high uncertainty</span></span>
<span><span class="va">new_samples_locations</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_uncertainty_sampling.html">sits_uncertainty_sampling</a></span><span class="op">(</span></span>
<span>    uncert_cube <span class="op">=</span> <span class="va">cube_s2_uncertainty</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    min_uncert <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    sampling_window <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Visualize new training points</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_view.html">sits_view</a></span><span class="op">(</span><span class="va">new_samples_locations</span><span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write</a></span><span class="op">(</span><span class="va">new_samples_locations</span>, </span>
<span>    <span class="st">"./assets/samples/new_samples_location.gpkg"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p></p>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-47498d4d7f2e796930b5" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-47498d4d7f2e796930b5">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"ESRI",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OSM",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addWMSTiles","args":["https://tiles.maps.eox.at/wms/",null,"Sentinel-2",{"styles":"","format":"image/jpeg","transparent":false,"version":"1.1.1","layers":"s2cloudless-2023_3857"}]},{"method":"addGlifyPoints","args":[[[-8.865204360326592,-63.05193062426965],[-8.932762872354346,-63.58715952693512],[-8.920924237767505,-63.03665710502161],[-8.74298744495157,-63.28938753169655],[-8.727718467378574,-63.04463841165219],[-8.66269568720946,-63.24824058944249],[-8.85434854007654,-63.90349417934754],[-8.876005634833911,-63.66891880288559],[-8.75889463629147,-63.80016924688943],[-8.771665138819419,-63.1088358857449],[-8.932293971811541,-63.146541853698054],[-8.285943316398056,-62.94288104188018],[-8.963486690680497,-63.31284821916283],[-8.613216807757402,-63.36399507668817],[-8.98827645959854,-63.70241891703824],[-8.639415026485057,-63.54416262336702],[-9.046882062674422,-63.703624033867854],[-8.495473486649024,-63.50452733307768],[-8.714039479049402,-63.29409249077777],[-8.644569975453837,-63.60488376920641],[-8.681223512935079,-62.93773210728629],[-8.958784990846418,-63.3108428866539],[-8.666885303571165,-63.56219918780816],[-8.61236429770593,-63.88764499282152],[-8.943174620029662,-63.73362222913118],[-8.754749716772915,-63.874888811581116],[-8.37404224687062,-62.92343076897986],[-9.074940672131165,-63.78229546926195],[-8.66202058794895,-63.15661609190626],[-8.353618670065224,-63.84091727409769],[-8.18050901209247,-63.34743271822889],[-8.540545904356739,-63.61053419774469],[-8.702933141212831,-63.055362526296754],[-8.792468938035773,-63.83279057456713],[-8.654236129981761,-63.408935814869736],[-8.787585910763458,-63.38380353221982],[-8.80515981994328,-63.73189335549186],[-8.744386643867069,-63.89740951798618],[-8.68555668792435,-63.83673439700127],[-8.925547438754153,-63.68119686122428],[-8.622298076572957,-63.493606419853414],[-8.859458182548689,-63.613779257676995],[-9.127003533420297,-63.87559576683033],[-8.595437668401976,-63.17949070235243],[-9.044067571723122,-63.19663176552305],[-8.856516076106603,-62.92005965237009],[-8.751778538758433,-63.04627781791331],[-9.045938725180276,-63.81007363434201],[-8.410345182991712,-63.44155890047696],[-8.998358424952734,-63.628749462628384],[-9.001965942706324,-63.634760070412014],[-8.976747088916849,-63.76934860724028],[-8.555489721022031,-63.08605577089851],[-8.55029234090743,-63.499692364759014],[-9.013948701828026,-63.6087611022763],[-8.479203234096127,-63.49614783053467],[-8.261022404334868,-63.73957438580507],[-8.771669096258753,-63.094106231703364],[-8.44125680438345,-63.46121592009698],[-8.63055268126347,-63.1313357847885],[-8.943515725070958,-63.74399222878843],[-9.054251455523008,-63.36333602979027],[-8.795143606628868,-63.20304550740291],[-8.957360331493774,-63.693990853023486],[-8.84347078865704,-63.75088314776545],[-8.495768692672707,-63.85394309367669],[-8.670985705917888,-63.70727243257301],[-8.290977823779466,-63.77794897863737],[-8.982181342598,-63.228257663879646],[-8.58160683782484,-63.71710202193795],[-8.623158616249263,-63.526689552986866],[-8.340581632282229,-63.00771984791931],[-8.86555541942294,-63.38206521532219],[-8.205992352848593,-63.37469157802149],[-8.953921541589246,-63.59083199488312],[-9.113640339033715,-63.698112080184934],[-8.61313032042519,-63.244754554939675],[-8.418843557291506,-63.790373785789164],[-9.102869909819697,-63.40415482866463],[-8.383592154713496,-63.567053360014036],[-8.947150125308761,-62.929136672098885],[-8.152405728754223,-63.15786414626506],[-8.355806144466321,-63.51397349221841],[-8.670009944631182,-62.955913817717885],[-8.635455765815017,-63.05426195869049],[-8.461710755467115,-63.587153109032826],[-9.015711956347046,-63.52069549114328],[-8.93829855686387,-63.360309574853645],[-8.956420146753599,-63.326123505529836],[-8.273306620599586,-63.35550435960534],[-9.052862358195195,-63.299094268797646],[-8.4050443332426,-63.48787814026574],[-8.194580346763404,-62.91947076933446],[-8.332537604869154,-63.45872650890691],[-8.191509778880262,-62.94961286463008],[-9.082976515981063,-63.399400572915894],[-8.178482853986486,-62.939083482001095],[-8.78015934309212,-63.13447943698987],[-8.938976665441585,-63.75235111555604],[-8.363735114385664,-63.047139256465144],[-8.223605084095837,-63.29698893240817],[-8.597281768439293,-63.07225113226216],[-8.76860516125415,-63.01482047971336],[-8.91416765633715,-63.219847125512565],[-8.760390464059128,-63.86035620508793],[-8.979827029307724,-63.43312896244814],[-8.857773996306841,-63.74436464295696],[-8.880513058160203,-63.77042013133352],[-8.821650156338075,-63.71664970617007],[-8.870433167283291,-63.125235439454066],[-9.10582703776253,-63.88118596234646],[-8.778786980144089,-63.313237424626195],[-9.117919960240458,-63.370680833011335],[-8.764425707235862,-63.38868942879614],[-8.353257553604937,-63.52614017893193],[-8.526924200667608,-63.83420557998908],[-8.236559308547333,-62.99845643604219],[-8.511883209584235,-63.39297392930204],[-9.12746313572349,-63.65773218208299],[-8.809077340617662,-63.19505104116225],[-8.733329043030858,-63.00809140195956],[-8.230982075714474,-63.347113387439514],[-8.701097046180053,-63.4017141586981],[-8.514583679541124,-63.15473839539013],[-8.331893386276166,-62.93869668967178],[-8.294970507072609,-63.40256303150068],[-8.779919653397956,-63.86312863727038],[-9.036879524315795,-63.73108137056231],[-8.552598745200324,-63.0684260987624],[-8.572438470716406,-63.86574434604216],[-8.661642383833154,-63.76833311239947],[-8.443634387462826,-63.43868968184709],[-8.604863436384939,-63.75804015459638],[-8.528535836920588,-63.383359383540714],[-8.946792226938589,-63.04612025314859],[-8.651444274537083,-63.60471295533856],[-9.02585337534276,-63.360396047225734],[-8.574860593244576,-63.52535063619433],[-8.576997980220067,-63.66438833044699],[-8.341506702974767,-63.52031207813165],[-9.016894107367133,-63.7739822387941],[-8.24408383637682,-63.24306981318535],[-8.390629897296598,-63.43881168747807],[-9.086225661880535,-63.180456448893324],[-9.022090920586304,-63.607501011103615],[-8.739427342131966,-63.199560465967586],[-8.15815167955446,-63.7068873078391],[-8.218959678013341,-63.20346865765567],[-9.050064809350554,-63.5325733838453],[-8.272069617895443,-63.732694263555985],[-8.902317945888159,-63.62094470755593],[-8.28954092509141,-63.772679639929244],[-8.415198419896415,-63.46845193667383],[-8.670153025268354,-63.41113454094092],[-8.380003622225212,-63.394293781125306],[-8.58657974835394,-63.165127654498434],[-8.80605247754269,-62.99245261780273],[-8.910572278574723,-63.65970442484068],[-9.051053961141273,-63.69762703046941],[-8.67684523730089,-63.554942248827594],[-8.385989117515763,-63.01898394060284],[-8.766934401720864,-63.761093129965644],[-8.784274041458547,-63.435081697181865],[-8.212173381437827,-63.74365982033843],[-8.204729663284107,-63.75817127188708],[-8.921642925613009,-63.373391314072066],[-9.034127391938517,-63.40571570411222],[-8.625732404016937,-63.326925093300844],[-9.054249230665329,-63.033576720927385],[-8.253161799618336,-63.68399327780422],[-8.55719511213095,-63.88733508353249],[-8.6927944787399,-63.09572275049742],[-8.878593064866642,-63.035925291278076],[-8.209343243309526,-63.89035947955727],[-8.677519190936913,-63.871800689990295],[-8.549344529022646,-62.944659835458104],[-8.14497790591879,-63.571977511912266],[-8.227023592729406,-63.32132438465002],[-8.471511376128857,-63.56536449282924],[-8.322852649766249,-62.99300704082016],[-8.690422105008288,-63.157718708894976],[-8.433743542731067,-63.38253870669112],[-8.595671375474039,-63.36179720543271],[-8.271213508753982,-63.45702088618814],[-8.51666438842993,-63.48438423279242],[-8.766231415025729,-63.83691407452267],[-8.987729586763743,-63.60253114777443],[-8.57526548218614,-63.89519145486849],[-8.831602656766643,-63.80414441339882],[-8.255957383016348,-63.73956495811104],[-8.539958422083847,-63.638337386735984],[-8.82170155416678,-63.86413472389055],[-8.190389082725956,-63.1760364791203],[-8.750695760821538,-62.98827146986103],[-8.622258674420593,-63.74280688142042],[-8.396912723863737,-63.48060144809253],[-8.662149439894117,-63.86940218929052],[-8.794288476073932,-63.642585455886376],[-8.83943910604914,-63.57591680049035],[-8.961735681240071,-63.67562433184296],[-8.168352557363109,-62.9434425719054],[-8.343748050189605,-63.46346219892579],[-8.937525506978687,-63.75434919515363],[-8.359127266040325,-63.46130058608592],[-8.984504207629596,-63.688402279382544],[-8.180345689378965,-63.73833559695427],[-8.597888370151516,-63.80782520148496],[-8.158040429216076,-63.0585531381793],[-8.697866979933627,-63.060816142981494],[-8.29240351437973,-63.43525141041214],[-8.214698831997826,-63.74747751116193],[-8.81360028200587,-63.1943259430872],[-9.07470908115197,-63.50239920308962],[-8.808001511755776,-63.175590957612464],[-8.907279394806784,-63.24240021542652],[-8.700457927352549,-63.3115357333869],[-8.668483526754839,-63.249880553222624],[-9.04463958928771,-63.53147355440207],[-8.788320255966125,-62.94698898953867],[-8.689186716489843,-62.964092935027864],[-8.536616230202215,-63.440067382507976],[-8.537910188509844,-63.67286159237643],[-9.035548715594107,-63.428464000006976],[-8.759197905216698,-63.02009351918108],[-9.071796510123132,-63.81395310753843],[-8.945624939086319,-63.25061246067897],[-8.722295271272943,-63.907355833857224],[-8.767875566605692,-62.93117129581735],[-8.937754630324346,-63.631737820734195],[-9.094728683533333,-63.907546891836994],[-8.653906663456782,-62.93646406704354],[-8.938928514113131,-63.25515609079914],[-8.596039270673367,-63.35525419838636],[-8.644862385283401,-63.057353674955536],[-8.6304369490763,-63.32565670163225],[-8.722996031784369,-63.12791326255073],[-8.571525465641109,-63.23982062546931],[-8.739083545663144,-63.548124674218464],[-8.27061543911696,-63.329350369452854],[-8.451287787785406,-62.914512556563196],[-8.827952215143718,-63.3578375073613],[-8.653409186703486,-63.894466390645654],[-9.010586155219176,-63.56199261115618],[-9.065146240717441,-63.31948737372601],[-9.074279129784605,-63.412312477704916],[-8.86211497733355,-63.38533564847107],[-8.863454942328424,-63.87732689116848],[-8.730864748526855,-63.87846924001082],[-8.2453059184793,-63.72792368778156],[-8.794764075216829,-63.68077424650406],[-8.987785496083355,-63.849788019235284],[-8.502006747020731,-63.61574262461128],[-8.86605236422285,-63.21199704700335],[-9.071232217644738,-63.73897599137412],[-9.036870449954034,-63.8981217916821],[-9.097250270235746,-63.414704804295425],[-8.263693780003035,-62.961408271326135],[-8.716447631162671,-63.42554850398402],[-8.271485376674695,-63.75502960822873],[-8.796049380615893,-63.42018333337273],[-8.615103830263008,-63.876201023529816],[-8.235711745374825,-63.49475065911006],[-8.922875897929506,-63.75322764238475],[-8.64446144325724,-63.41456051182276],[-8.65372310440466,-62.92210262836794],[-8.366079970704975,-62.912169708552234],[-8.498424599539852,-63.26357972689581],[-8.352150908392632,-62.915987446622445],[-8.193839280315109,-63.143354376829365],[-9.113463957127877,-63.298416458539045],[-8.903375391618079,-63.735543618724115],[-8.676682384896484,-63.65747276215865],[-8.227483833209607,-63.41175558925681],[-8.282241493529787,-63.26470534492152],[-8.968322226845203,-62.98680901209596],[-8.462510443885616,-63.047696299003206],[-8.228447033760517,-63.349835013060044],[-9.028783963193872,-63.48595831551486],[-8.633095204763812,-63.098434366299315],[-8.512175744777222,-63.45639406909034],[-8.664516968648199,-63.22860797209744],[-9.008855776926294,-63.507948622183015],[-8.794831097534509,-62.93607652022417],[-9.054237099263972,-63.37753076825231],[-8.679094270518709,-63.49822529634633],[-8.688605107668577,-63.17589864088279],[-9.04202915187302,-63.68723742692776],[-8.789462865996734,-63.800962072128215],[-8.336963440189159,-62.990827088597726],[-8.749969903716792,-63.042822686335775],[-8.160804066336546,-63.33089386764715],[-8.200005369209341,-63.39266191623895],[-9.032222713267657,-63.31945832870147],[-8.76878169061303,-63.059372860509065],[-8.63855608038039,-63.51107812274938],[-8.72720026995873,-63.89845925179638],[-8.632375435658048,-63.749551988314366],[-8.726851857478453,-63.72283133386844],[-8.626434126188233,-63.63357416359552],[-8.803238094891357,-63.46056393918396]],[{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275},{"r":1.0,"g":0.7019607843137254,"b":0.7098039215686275}],null,null,1,10,"samples",null,{"stroke":false},"overlayPane"]},{"method":"addLegend","args":[{"colors":["#FFB3B5"],"labels":["NoClass"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"Classes","extra":null,"layerId":null,"className":"info legend","group":null}]},{"method":"addLayersControl","args":[["ESRI","OSM","Sentinel-2"],"samples",{"collapsed":false,"autoZIndex":true,"position":"topright"}]}],"flyToBounds":[-9.12746313572349,-63.90754689183699,-8.14497790591879,-62.91216970855223,[]],"limits":{"lat":[-9.12746313572349,-8.14497790591879],"lng":[-63.90754689183699,-62.91216970855223]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract new spectral signatures</span></span>
<span><span class="va">new_samples</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_get_data.html">sits_get_data</a></span><span class="op">(</span></span>
<span>    cube <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    samples <span class="op">=</span> <span class="va">new_samples_locations</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#new_samples$label &lt;- "Wetland"</span></span>
<span><span class="va">new_samples_aligned</span> <span class="op">&lt;-</span> <span class="fu">sits_select</span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_samples</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, </span>
<span>                    <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"B8A"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge with original samples</span></span>
<span><span class="va">new_samples_merge</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">samples_deforestation_rondonia</span>,</span>
<span>  <span class="va">new_samples_aligned</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train new model &amp; evaluate</span></span>
<span><span class="va">model_randomForest_v2</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_train.html">sits_train</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="va">new_samples_merge</span>, </span>
<span>  ml_method <span class="op">=</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_rfor.html">sits_rfor</a></span><span class="op">(</span>num_trees <span class="op">=</span> <span class="fl">120</span>,mtry <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classify new cube</span></span>
<span><span class="co"># Classify data cube</span></span>
<span><span class="va">cube_s2_probs_v2</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_classify.html">sits_classify</a></span><span class="op">(</span></span>
<span>    data            <span class="op">=</span> <span class="va">cube_s2_reg</span>,</span>
<span>    ml_model        <span class="op">=</span> <span class="va">model_randomForest_v2</span>,</span>
<span>    output_dir  <span class="op">=</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span>    version         <span class="op">=</span> <span class="st">"rf-1228-v2"</span>, <span class="co"># adds suffix to output filename</span></span>
<span>    multicores  <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    memsize         <span class="op">=</span> <span class="fl">16</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Derive new uncertainty cube and compare</span></span>
<span><span class="va">cube_s2_uncertainty_v2</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_uncertainty.html">sits_uncertainty</a></span><span class="op">(</span></span>
<span>    <span class="va">cube_s2_probs_v2</span>, </span>
<span>    type <span class="op">=</span> <span class="st">"margin"</span>, </span>
<span>  output_dir <span class="op">=</span> <span class="st">"./assets/images/uncertainty_v2/"</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize side-by-side</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_uncertainty</span>, palette <span class="op">=</span> <span class="st">"Reds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2_uncertainty_v2</span>, palette <span class="op">=</span> <span class="st">"Oranges"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">

</div>
<div id="fig-entropy-b" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-entropy-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<img src="assets/images/png/activity-data-l1.png" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-entropy-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1
</figcaption></figure>
</div>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Search for convergence (extract filepath first)</span></span>
<span><span class="va">get_uncert_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">uncert_cube</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">files</span> <span class="op">&lt;-</span> <span class="va">uncert_cube</span><span class="op">$</span><span class="va">file_info</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">path</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html">values</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate statistics</span></span>
<span><span class="va">uncert_v1_vals</span> <span class="op">&lt;-</span> <span class="fu">get_uncert_values</span><span class="op">(</span><span class="va">cube_s2_uncertainty</span><span class="op">)</span></span>
<span><span class="va">uncert_v2_vals</span> <span class="op">&lt;-</span> <span class="fu">get_uncert_values</span><span class="op">(</span><span class="va">cube_s2_uncertainty_v2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">uncertainty_check</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  iteration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"v1"</span>, <span class="st">"v2"</span><span class="op">)</span>,</span>
<span>  mean_uncert <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">uncert_v1_vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">uncert_v2_vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  sd_uncert <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">uncert_v1_vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">uncert_v2_vals</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  pct_high_uncert <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">uncert_v1_vals</span> <span class="op">&gt;</span> <span class="fl">0.4</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">uncert_v1_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">uncert_v2_vals</span> <span class="op">&gt;</span> <span class="fl">0.4</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">uncert_v2_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">uncertainty_check</span>, <span class="st">"./assets/samples/uncertainty_check.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-8ef0fc4e{}.cl-8ee952b4{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-8eec6616{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-8eec6634{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-8eec88d0{width:0.497in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec88da{width:0.829in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec88e4{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec88ee{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec88ef{width:1.372in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec88f8{width:0.497in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec8902{width:0.829in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec890c{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec8916{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec8920{width:1.372in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec892a{width:0.497in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec8934{width:0.829in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec893e{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec893f{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8eec8966{width:1.372in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-8ef0fc4e">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-8eec88d0"><p class="cl-8eec6616"><span class="cl-8ee952b4">...1</span></p></th>
<th class="cl-8eec88da"><p class="cl-8eec6634"><span class="cl-8ee952b4">iteration</span></p></th>
<th class="cl-8eec88e4"><p class="cl-8eec6616"><span class="cl-8ee952b4">mean_uncert</span></p></th>
<th class="cl-8eec88ee"><p class="cl-8eec6616"><span class="cl-8ee952b4">sd_uncert</span></p></th>
<th class="cl-8eec88ef"><p class="cl-8eec6616"><span class="cl-8ee952b4">pct_high_uncert</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-8eec88f8"><p class="cl-8eec6616"><span class="cl-8ee952b4">1</span></p></td>
<td class="cl-8eec8902"><p class="cl-8eec6634"><span class="cl-8ee952b4">v1</span></p></td>
<td class="cl-8eec890c"><p class="cl-8eec6616"><span class="cl-8ee952b4">4,508.770</span></p></td>
<td class="cl-8eec8916"><p class="cl-8eec6616"><span class="cl-8ee952b4">2,741.364</span></p></td>
<td class="cl-8eec8920"><p class="cl-8eec6616"><span class="cl-8ee952b4">99.66006</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-8eec892a"><p class="cl-8eec6616"><span class="cl-8ee952b4">2</span></p></td>
<td class="cl-8eec8934"><p class="cl-8eec6634"><span class="cl-8ee952b4">v2</span></p></td>
<td class="cl-8eec893e"><p class="cl-8eec6616"><span class="cl-8ee952b4">5,465.921</span></p></td>
<td class="cl-8eec893f"><p class="cl-8eec6616"><span class="cl-8ee952b4">2,729.796</span></p></td>
<td class="cl-8eec8966"><p class="cl-8eec6616"><span class="cl-8ee952b4">99.82174</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Short class relabelling, the above method showcases an iterative revision workflow typically used to integrate new samples and retrain models until uncertainty stabilizes. For ART-TREES compliance, uncertainty reduction directly decreases activity data deductions and simplifies third-party verification.</p>
</section><section id="hierarchical-clustering" class="level3"><h3 class="anchored" data-anchor-id="hierarchical-clustering">Hierarchical Clustering</h3>
<p>We implement below two clustering approaches for evaluating training data quality: Agglomerative Hierarchical Clustering <span class="citation" data-cites="yao2016application">(<a href="../references/index.html#ref-yao2016application" role="doc-biblioref">Yao et al., 2016</a>, AHC)</span> for datasets under 10,000 samples, and Self-Organizing Maps (SOM) for larger collections <span class="citation" data-cites="neagoe2014concurrent gonccalves2008unsupervised">(<a href="../references/index.html#ref-gonccalves2008unsupervised" role="doc-biblioref">Gonçalves et al., 2008</a>; <a href="../references/index.html#ref-neagoe2014concurrent" role="doc-biblioref">Neagoe et al., 2014</a>)</span>. AHC has computational complexity of <span class="math inline">\(\mathcal{O}(n^2)\)</span> requiring substantial memory, while SOM scales linearly, making it preferable for operational REDD+ monitoring systems.</p>
<p>Hierarchical Clustering computes dissimilarity between samples using dynamic time warping (DTW), which reliably measures differences in satellite time series <span class="citation" data-cites="petitjean2012satellite maus2019dtwsat">(<a href="../references/index.html#ref-maus2019dtwsat" role="doc-biblioref">Maus et al., 2019</a>; <a href="../references/index.html#ref-petitjean2012satellite" role="doc-biblioref">Petitjean et al., 2012</a>)</span>. The <code>sits_cluster_dendro()</code> function generates dendrograms that reveal sample groupings and potential mislabeling:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Cluster samples using DTW distance and Ward linkage</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cluster_dendro.html">sits_cluster_dendro</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="va">training_samples_with_indices</span>, </span>
<span>    bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NDVI"</span>, <span class="st">"EVI"</span><span class="op">)</span>,</span>
<span>    dist_method <span class="op">=</span> <span class="st">"dtw_basic"</span>,</span>
<span>    linkage <span class="op">=</span> <span class="st">"ward.D2"</span><span class="op">)</span></span>
<span>    </span>
<span><span class="co"># Examine cluster composition</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cluster_frequency.html">sits_cluster_frequency</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="assets/images/png/activity-data-g.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<pre><code>                           1    2    3    4    5    6    7 Total
  Clear_Cut_Bare_Soil    121    9  104  705    5    0    0   944
  Clear_Cut_Burned_Area   79    5   23  874    0    0    2   983
  Clear_Cut_Vegetation   259  164   43  103    0    0   34   603
  Forest                 174  732    5    6    0    0   47   964
  Mountainside_Forest     12  145    2    0    0    0   52   211
  Riparian_Forest         39  327   11    6    0    0  864  1247
  Seasonally_Flooded     414   94  160   25   29    0    9   731
  Water                    0    0    1    2    2  104    0   109
  Wetland                 56    1   55   19   53   31    0   215
  Total                 1154 1477  404 1740   89  135 1008  6007</code></pre>
<p>The adjusted rand index (ARI) identifies optimal cluster count <span class="citation" data-cites="rand1971objective">(<a href="../references/index.html#ref-rand1971objective" role="doc-biblioref">Rand, 1971</a>)</span>. Clusters with mixed labels indicate either:</p>
<ul>
<li>mislabeled samples requiring removal,</li>
<li>spectral confusion between classes,</li>
<li>natural variability in land cover signatures. s</li>
</ul>
<p>The <code>sits_cluster_clean()</code> function removes minority labels within clusters, retaining only dominant classes to reduce training noise.</p>
<p>Self-Organizing Maps provide efficient quality assessment for large datasets through unsupervised learning that projects high-dimensional time series onto 2D grids. The <code>sits_som_map()</code> function identifies outliers and evaluates class separability:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove cluster#5 from the samples</span></span>
<span><span class="va">clusters_new</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">clusters</span>, <span class="va">cluster</span> <span class="op">!=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">clusters_clean</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cluster_clean.html">sits_cluster_clean</a></span><span class="op">(</span><span class="va">clusters_new</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check clusters samples frequency</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_cluster_frequency.html">sits_cluster_frequency</a></span><span class="op">(</span><span class="va">clusters_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate SOM with optimal grid dimensions</span></span>
<span><span class="va">som_map</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_map.html">sits_som_map</a></span><span class="op">(</span></span>
<span>    <span class="va">training_samples_with_indices</span>, </span>
<span>  grid_xdim <span class="op">=</span> <span class="fl">10</span>, </span>
<span>  grid_ydim <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean samples by removing mixed neurons</span></span>
<span><span class="va">samples_clean</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_clean_samples.html">sits_som_clean_samples</a></span><span class="op">(</span><span class="va">som_map</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize sample clustering &amp; class confusions</span></span>
<span><span class="va">som_eval</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_evaluate_cluster.html">sits_som_evaluate_cluster</a></span><span class="op">(</span><span class="va">som_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">som_eval</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">som_map</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>                         1  2  3  4 Total
  Clear_Cut_Burned_Area  0  5  0  0     5
  Forest                 0  0  0  6     6
  Mountainside_Forest   12  0  2  0    14
  Total                 12  5  2  6    25</code></pre>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-som-a" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-som-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/png/activity-data-h1.png" id="fig-som-a" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-som-a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2
</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-som-freq" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-som-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/png/activity-data-h2.png" id="fig-som-freq" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-som-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3
</figcaption></figure>
</div>
</div>
</div>
</div>
<p>Neurons containing multiple classes reveal spectral overlap requiring investigation. The SOM-based cleaning removes samples from mixed neurons, improving class separability while preserving within-class variability essential for generalization.</p>
</section><section id="class-imbalances" class="level3"><h3 class="anchored" data-anchor-id="class-imbalances">Class Imbalances</h3>
<p>Imbalanced training sets—where some classes have many more samples than others—bias classifiers toward over-represented classes, inflating omission errors for rare forest types. The <code>sits_reduce_imbalance()</code> function implements under-sampling and over-sampling strategies:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Balance samples across classes</span></span>
<span><span class="va">samples_balanced</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_reduce_imbalance.html">sits_reduce_imbalance</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="va">training_samples_with_indices</span>,</span>
<span>    n_samples_over <span class="op">=</span> <span class="fl">200</span>,   <span class="co"># Oversample rare classes</span></span>
<span>    n_samples_under <span class="op">=</span> <span class="fl">400</span>,  <span class="co"># Undersample common classes</span></span>
<span>    multicores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Re-evaluate using SOM clustering</span></span>
<span><span class="va">som_map_balanced</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_map.html">sits_som_map</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">samples_balanced</span>,</span>
<span>    grid_xdim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    grid_ydim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>    distance <span class="op">=</span> <span class="st">"dtw"</span>,</span>
<span>    rlen <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Store estimates in tibble</span></span>
<span><span class="va">som_eval_balanced</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_som_evaluate_cluster.html">sits_som_evaluate_cluster</a></span><span class="op">(</span></span>
<span>    <span class="va">som_map_balanced</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">som_eval</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">som_eval_balanced</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">samples_balanced</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-som-b" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-som-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/png/activity-data-i1.png" id="fig-som-b" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-som-b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4
</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-som-c" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-som-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/png/activity-data-h1.png" id="fig-som-c" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-som-c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5
</figcaption></figure>
</div>
</div>
</div>
</div>
<pre><code># A tibble: 9 × 3
  label                 count   prop
  &lt;chr&gt;                 &lt;int&gt;  &lt;dbl&gt;
1 Clear_Cut_Bare_Soil     400 0.134 
2 Clear_Cut_Burned_Area   388 0.130 
3 Clear_Cut_Vegetation    392 0.131 
4 Forest                  400 0.134 
5 Mountainside_Forest     211 0.0707
6 Riparian_Forest         396 0.133 
7 Seasonally_Flooded      384 0.129 
8 Water                   200 0.0670
9 Wetland                 215 0.0720</code></pre>
<p>Under-sampling randomly removes samples from majority classes to match minority class frequencies, reducing computational load but discarding potentially informative data. Over-sampling uses SMOTE [Synthetic Minority Over-sampling Technique; <span class="citation" data-cites="smotefamily">Siriseriwan (<a href="../references/index.html#ref-smotefamily" role="doc-biblioref">2024</a>)</span>; <span class="citation" data-cites="DMwR">Torgo (<a href="../references/index.html#ref-DMwR" role="doc-biblioref">2010</a>)</span>] to generate synthetic samples for rare classes, improving classifier sensitivity without losing real observations. For REDD+ applications, maintaining adequate representation of degraded forest classes often requires combined strategies.</p>
</section><section id="geographic-variance" class="level3"><h3 class="anchored" data-anchor-id="geographic-variance">Geographic Variance</h3>
<p>Training samples must capture spatial variability across jurisdictions. Clustered sampling creates geographic gaps where model predictions have higher uncertainty <span class="citation" data-cites="meyer2022machine">(<a href="../references/index.html#ref-meyer2022machine" role="doc-biblioref">Meyer &amp; Pebesma, 2022</a>)</span>. The <code>sits_geo_dist()</code> function compares sample-to-sample distances against prediction-location-to-sample distances:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Derive jurisdiction boundary</span></span>
<span><span class="va">bbox_cube</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_bbox.html">sits_bbox</a></span><span class="op">(</span><span class="va">cube_s2_reg</span><span class="op">)</span> </span>
<span><span class="va">bbox_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">aoi</span><span class="op">$</span><span class="va">xmin</span>, </span>
<span>    ymin <span class="op">=</span> <span class="va">aoi</span><span class="op">$</span><span class="va">ymin</span>, </span>
<span>    xmax <span class="op">=</span> <span class="va">aoi</span><span class="op">$</span><span class="va">xmax</span>, </span>
<span>    ymax <span class="op">=</span> <span class="va">aoi</span><span class="op">$</span><span class="va">ymax</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">$</span><span class="va">crs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to sf </span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="va">bbox_sf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assess geographic coverage</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_geo_dist.html">sits_geo_dist</a></span><span class="op">(</span></span>
<span>    <span class="va">training_samples_with_indices</span>, roi <span class="op">=</span> <span class="va">aoi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="assets/images/png/activity-data-j.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Mismatched distributions indicate insufficient spatial coverage. Areas with few nearby training samples will exhibit higher classification uncertainty, requiring either additional field sampling or explicit uncertainty quantification in those regions during accuracy assessment.</p>
</section><section id="noise-filtering" class="level3"><h3 class="anchored" data-anchor-id="noise-filtering">Noise Filtering</h3>
<p>Atmospheric contamination and sensor artifacts introduce noise requiring smoothing before feature extraction. The package supports Savitzky-Golay (<code>sits_sgolay()</code>) and Whittaker (<code>sits_whittaker()</code>) filters. Both methods reduce noise while preserving phenological patterns:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Apply Whittaker filter with conservative smoothing</span></span>
<span><span class="va">samples_balanced_ndvi</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_select.html">sits_select</a></span><span class="op">(</span></span>
<span>    <span class="va">samples_balanced</span>, bands <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply Whitakker filter</span></span>
<span><span class="va">samples_balanced_whit</span> <span class="op">&lt;-</span> <span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_whittaker.html">sits_whittaker</a></span><span class="op">(</span></span>
<span>    <span class="va">samples_balanced_ndvi</span>, lambda <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge to visualize</span></span>
<span><span class="fu">sits</span><span class="fu">::</span><span class="fu"><a href="https://e-sensing.github.io/sits/reference/sits_merge.html">sits_merge</a></span><span class="op">(</span></span>
<span>    <span class="va">samples_balanced_ndvi</span>, </span>
<span>    <span class="va">samples_balanced_whit</span>,</span>
<span>    suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">".WHIT"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-layout-panel" data-layout-ncol="4">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k1a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k1b.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k2a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k2b.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k3a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k3b.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k4a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k4b.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k5a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k5b.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k6a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k6b.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k7a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k7b.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k8a.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="assets/images/png/activity-data-k8b.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Over-smoothing (high lambda values) eliminates legitimate phenological variation, reducing model discriminatory power. Conservative filtering (lambda ≤ 1.0) balances noise reduction with pattern preservation <span class="citation" data-cites="Atkinson2012 Zhou2016">(<a href="../references/index.html#ref-Atkinson2012" role="doc-biblioref"><strong>Atkinson2012?</strong></a>; <a href="../references/index.html#ref-Zhou2016" role="doc-biblioref"><strong>Zhou2016?</strong></a>)</span>.</p>
<p>Integration with Uncertainty Workflows: Quality-controlled training data directly reduces classification uncertainty by minimizing systematic errors from mislabeling and improving model generalization. Combined with the cross-validation procedures in Section 3.8 and accuracy assessment in Section 3.9, these enhancement methods establish a rigorous foundation for defensible activity data uncertainty quantification under ART-TREES requirements.</p>
</section></section><section id="smooth-data-cube" class="level2"><h2 class="anchored" data-anchor-id="smooth-data-cube">3.8 Smooth Data Cube</h2>
<p>Pixel-based classification inherently produces salt-and-pepper noise due to within-class spectral variability and mixed pixels. Isolated misclassified pixels, such as outliers surrounded by different classes, represent systematic over-fitting to training data rather than true landscape heterogeneity. For REDD+ applications, these artifacts inflate area uncertainty and complicate change detection. To address this, the <code>sits_smooth()</code> function implements Bayesian post-processing that incorporates spatial context from neighboring pixels to refine probability estimates. The smoothing process:</p>
<ol type="1">
<li>Computes spatially-weighted probability adjustments based on neighborhood composition</li>
<li>Updates pixel probabilities using Bayesian inference combining original estimates with spatial priors</li>
<li>Produces refined probability cube with reduced outlier effect while preserving legitimate small patches</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="assets/images/png/activity-data-e.png" class="img-fluid figure-img"></p>
<figcaption>Smoothed probability map for class <code>Forest</code>.</figcaption></figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Smoothing Risks
</div>
</div>
<div class="callout-body-container callout-body">
<p>Spatial smoothing affects activity data uncertainty in competing directions:</p>
<ul>
<li>Reduces random error: Eliminates isolated misclassifications that inflate variance</li>
<li>Introduces spatial bias: May smooth over legitimate small-scale heterogeneity</li>
<li>Improves validation agreement: Better alignment with typical human interpretation scales</li>
<li>Modifies probability distributions: Changes the shape of pixel-level uncertainty estimates</li>
</ul>
<p>For REDD+ reporting, smoothed probability cubes typically yield lower reported uncertainties due to reduced classification noise, but verification bodies may require documentation of smoothing parameters demonstrating methodological choices.</p>
</div>
</div>
<hr>
<p>Final classified maps are derived from smoothed probability cubes through maximum likelihood labeling: each pixel is assigned the class with highest posterior probability. The <code>sits_label_classification()</code> function performs this deterministic assignment while maintaining provenance links to underlying probability distributions.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="assets/images/png/activity-data-f.png" class="img-fluid figure-img"></p>
<figcaption>Classified cube obtained by Random Forest model.</figcaption></figure>
</div>
<p>The classified cube produced by <code>sits</code> workflows provides the activity data foundation for REDD+ accounting, but uncertainty quantification requires additional analysis beyond the discrete classification procedures. Sections 3.2-3.5 demonstrate more more advanced operations using <code>caret</code> <span class="citation" data-cites="kuhn2011caret">(<a href="../references/index.html#ref-kuhn2011caret" role="doc-biblioref">Kuhn, 2011</a>)</span>, <code>ForestToolbox</code> <span class="citation" data-cites="ForesToolboxRS">(<a href="../references/index.html#ref-ForesToolboxRS" role="doc-biblioref">Tarazona Coronel et al., 2021</a>)</span>, and <code>terra</code> packages <span class="citation" data-cites="terra-2">(<a href="../references/index.html#ref-terra-2" role="doc-biblioref">Hijmans, 2025</a>)</span> required to:</p>
<ol type="1">
<li>Extract pixel-level probability distributions for Monte Carlo sampling (Section 3.3)</li>
<li>Implement stratified validation with area-adjusted accuracy assessment (Section 3.4)</li>
<li>Calibrate Random Forest hyperparameters through iterative uncertainty minimization (Section 3.5)</li>
</ol>
<hr></section><section id="cross-validation" class="level2"><h2 class="anchored" data-anchor-id="cross-validation">3.8 Cross-Validation</h2>
<p>Cross-validation quantifies model generalization capacity by partitioning training data into independent subsets for iterative testing. This section demonstrates <code>caret</code>-based validation approaches for uncertainty assessment aligned with ART-TREES requirements.</p>
<p>Extract statistical summaries from <code>sits</code> time series for <code>caret</code> compatibility:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract features from cube samples</span></span>
<span><span class="va">extract_features</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sits_samples</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">features_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sits_samples</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ts</span> <span class="op">&lt;-</span> <span class="va">sits_samples</span><span class="op">$</span><span class="va">time_series</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>      label <span class="op">=</span> <span class="va">sits_samples</span><span class="op">$</span><span class="va">label</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>      mean_B8A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      sd_B8A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      mean_B11 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B11</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      sd_B11 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B11</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      mean_NDVI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span> <span class="op">-</span> <span class="va">ts</span><span class="op">$</span><span class="va">B04</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span> <span class="op">+</span> <span class="va">ts</span><span class="op">$</span><span class="va">B04</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      sd_NDVI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span> <span class="op">-</span> <span class="va">ts</span><span class="op">$</span><span class="va">B04</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">ts</span><span class="op">$</span><span class="va">B8A</span> <span class="op">+</span> <span class="va">ts</span><span class="op">$</span><span class="va">B04</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">features_list</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">train_features</span> <span class="op">&lt;-</span> <span class="fu">extract_features</span><span class="op">(</span><span class="va">samples_deforestation_rondonia</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="monte-carlo-cross-validation" class="level3"><h3 class="anchored" data-anchor-id="monte-carlo-cross-validation">Monte Carlo Cross-Validation</h3>
<p>In the following, we implement a Monte Carlo training simulation for robust uncertainty and stability metrics across repeated random partitions. For demonstration purposes, this simulation is fitted with only 10 iterations. We recommend increasing this to 10,000 iterations to meet ART-TREES requirements :</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Configure Monte Carlo simulation</span></span>
<span><span class="va">mc_simulation</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"LGOCV"</span>,</span>
<span>  number <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Increase to 10,000 iterations for ART-TREES submissions</span></span>
<span>  p <span class="op">=</span> <span class="fl">0.75</span>, <span class="co"># 75:25% split</span></span>
<span>  savePredictions <span class="op">=</span> <span class="st">"final"</span>,</span>
<span>  classProbs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  summaryFunction <span class="op">=</span> <span class="fu">caret</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/caret/man/postResample.html">multiClassSummary</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train over monte carlo simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">model_randomRandom_mc</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span></span>
<span>  <span class="va">label</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">train_features</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"rf"</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">mc_simulation</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"Kappa"</span>,</span>
<span>  ntree <span class="op">=</span> <span class="fl">120</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarize stability</span></span>
<span><span class="va">model_randomRandom_mc_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Accuracy"</span>, <span class="st">"Kappa"</span><span class="op">)</span>,</span>
<span>  mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">model_randomRandom_mc</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">Accuracy</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">model_randomRandom_mc</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">Kappa</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">model_randomRandom_mc</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">Accuracy</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">model_randomRandom_mc</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">Kappa</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="va">model_randomRandom_mc_summary</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-a6d699a4{}.cl-a6d05738{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a6d2f506{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6d2f51a{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6d311c6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6d311e4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6d311ee{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6d311ef{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6d311f8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6d31202{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-a6d699a4">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-a6d311c6"><p class="cl-a6d2f506"><span class="cl-a6d05738">metric</span></p></th>
<th class="cl-a6d311e4"><p class="cl-a6d2f51a"><span class="cl-a6d05738">mean</span></p></th>
<th class="cl-a6d311e4"><p class="cl-a6d2f51a"><span class="cl-a6d05738">sd</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-a6d311ee"><p class="cl-a6d2f506"><span class="cl-a6d05738">Accuracy</span></p></td>
<td class="cl-a6d311ef"><p class="cl-a6d2f51a"><span class="cl-a6d05738">0.7091516</span></p></td>
<td class="cl-a6d311ef"><p class="cl-a6d2f51a"><span class="cl-a6d05738">0.01467986</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-a6d311f8"><p class="cl-a6d2f506"><span class="cl-a6d05738">Kappa</span></p></td>
<td class="cl-a6d31202"><p class="cl-a6d2f51a"><span class="cl-a6d05738">0.6560266</span></p></td>
<td class="cl-a6d31202"><p class="cl-a6d2f51a"><span class="cl-a6d05738">0.01749026</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="accuracy-assessment" class="level2"><h2 class="anchored" data-anchor-id="accuracy-assessment">3.9 Accuracy Assessment</h2>
<p>Accuracy assessment quantifies classification performance against independent reference data. Stratified train-test partitioning ensures adequate representation across forest disturbance classes.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ensure consistent factor levels</span></span>
<span><span class="va">all_classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">train_features</span><span class="op">$</span><span class="va">label</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stratified partition</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span></span>
<span>  <span class="va">train_features</span><span class="op">$</span><span class="va">label</span>,</span>
<span>  p <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  list <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">train_features</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">train_features</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Ensure labels are factors with same levels</span></span>
<span><span class="va">train_data</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">$</span><span class="va">label</span>, levels <span class="op">=</span> <span class="va">all_classes</span><span class="op">)</span></span>
<span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span>, levels <span class="op">=</span> <span class="va">all_classes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train model</span></span>
<span><span class="va">accuracy_model</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span></span>
<span>  <span class="va">label</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">train_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"rf"</span>,</span>
<span>  ntree <span class="op">=</span> <span class="fl">120</span>,</span>
<span>  importance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  trControl <span class="op">=</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predict</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">accuracy_model</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure predictions have same levels</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">predictions</span>, levels <span class="op">=</span> <span class="va">all_classes</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="confusion-matrix" class="level3"><h3 class="anchored" data-anchor-id="confusion-matrix">Confusion Matrix</h3>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generate confusion matrix</span></span>
<span><span class="va">confMatrix</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">predictions</span>,</span>
<span>  reference <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">label</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">confMatrix</span><span class="op">)</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Clear_Cut_Bare_Soil Forest Clear_Cut_Vegetation</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                   130      2                    8</span></span>
<span><span class="co">##   Forest                                  0    166                   11</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                   16      1                   74</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                  41      0                    4</span></span>
<span><span class="co">##   Wetland                                 1      0                    0</span></span>
<span><span class="co">##   Water                                   0      0                    0</span></span>
<span><span class="co">##   Mountainside_Forest                     0      0                    1</span></span>
<span><span class="co">##   Seasonally_Flooded                      0      7                    8</span></span>
<span><span class="co">##   Riparian_Forest                         0     16                   14</span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Clear_Cut_Burned_Area Wetland Water Mountainside_Forest</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                      31       2     0                   0</span></span>
<span><span class="co">##   Forest                                    0       1     0                  15</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                     10       1     0                   3</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                   144       0     0                   0</span></span>
<span><span class="co">##   Wetland                                   3      27     0                   0</span></span>
<span><span class="co">##   Water                                     0       1    21                   0</span></span>
<span><span class="co">##   Mountainside_Forest                       0       0     0                   3</span></span>
<span><span class="co">##   Seasonally_Flooded                        6      11     0                   1</span></span>
<span><span class="co">##   Riparian_Forest                           2       0     0                  20</span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Seasonally_Flooded Riparian_Forest</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                    6               3</span></span>
<span><span class="co">##   Forest                                19              20</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                   7               5</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                  2               0</span></span>
<span><span class="co">##   Wetland                                1               0</span></span>
<span><span class="co">##   Water                                  0               0</span></span>
<span><span class="co">##   Mountainside_Forest                    2               0</span></span>
<span><span class="co">##   Seasonally_Flooded                   101               2</span></span>
<span><span class="co">##   Riparian_Forest                        8             219</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Overall Statistics</span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##                Accuracy : 0.7393         </span></span>
<span><span class="co">##                  95% CI : (0.7135, 0.764)</span></span>
<span><span class="co">##     No Information Rate : 0.208          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16      </span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##                   Kappa : 0.6916         </span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : NA             </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistics by Class:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                      Class: Clear_Cut_Bare_Soil Class: Forest</span></span>
<span><span class="co">## Sensitivity                              0.6915        0.8646</span></span>
<span><span class="co">## Specificity                              0.9485        0.9343</span></span>
<span><span class="co">## Pos Pred Value                           0.7143        0.7155</span></span>
<span><span class="co">## Neg Pred Value                           0.9429        0.9731</span></span>
<span><span class="co">## Prevalence                               0.1571        0.1604</span></span>
<span><span class="co">## Detection Rate                           0.1086        0.1387</span></span>
<span><span class="co">## Detection Prevalence                     0.1520        0.1938</span></span>
<span><span class="co">## Balanced Accuracy                        0.8200        0.8995</span></span>
<span><span class="co">##                      Class: Clear_Cut_Vegetation Class: Clear_Cut_Burned_Area</span></span>
<span><span class="co">## Sensitivity                              0.61667                       0.7347</span></span>
<span><span class="co">## Specificity                              0.96007                       0.9530</span></span>
<span><span class="co">## Pos Pred Value                           0.63248                       0.7539</span></span>
<span><span class="co">## Neg Pred Value                           0.95741                       0.9483</span></span>
<span><span class="co">## Prevalence                               0.10025                       0.1637</span></span>
<span><span class="co">## Detection Rate                           0.06182                       0.1203</span></span>
<span><span class="co">## Detection Prevalence                     0.09774                       0.1596</span></span>
<span><span class="co">## Balanced Accuracy                        0.78837                       0.8439</span></span>
<span><span class="co">##                      Class: Wetland Class: Water Class: Mountainside_Forest</span></span>
<span><span class="co">## Sensitivity                 0.62791      1.00000                   0.071429</span></span>
<span><span class="co">## Specificity                 0.99567      0.99915                   0.997403</span></span>
<span><span class="co">## Pos Pred Value              0.84375      0.95455                   0.500000</span></span>
<span><span class="co">## Neg Pred Value              0.98627      1.00000                   0.967254</span></span>
<span><span class="co">## Prevalence                  0.03592      0.01754                   0.035088</span></span>
<span><span class="co">## Detection Rate              0.02256      0.01754                   0.002506</span></span>
<span><span class="co">## Detection Prevalence        0.02673      0.01838                   0.005013</span></span>
<span><span class="co">## Balanced Accuracy           0.81179      0.99957                   0.534416</span></span>
<span><span class="co">##                      Class: Seasonally_Flooded Class: Riparian_Forest</span></span>
<span><span class="co">## Sensitivity                            0.69178                 0.8795</span></span>
<span><span class="co">## Specificity                            0.96670                 0.9367</span></span>
<span><span class="co">## Pos Pred Value                         0.74265                 0.7849</span></span>
<span><span class="co">## Neg Pred Value                         0.95759                 0.9673</span></span>
<span><span class="co">## Prevalence                             0.12197                 0.2080</span></span>
<span><span class="co">## Detection Rate                         0.08438                 0.1830</span></span>
<span><span class="co">## Detection Prevalence                   0.11362                 0.2331</span></span>
<span><span class="co">## Balanced Accuracy                      0.82924                 0.9081</span></span>
<span></span>
<span><span class="co"># Extract metrics</span></span>
<span><span class="va">accuracy_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Overall Accuracy"</span>, <span class="st">"Kappa"</span>, <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="va">confMatrix</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="st">"Accuracy"</span><span class="op">]</span>,</span>
<span>    <span class="va">confMatrix</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="st">"Kappa"</span><span class="op">]</span>,</span>
<span>    <span class="va">confMatrix</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="st">"AccuracyLower"</span><span class="op">]</span>,</span>
<span>    <span class="va">confMatrix</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="st">"AccuracyUpper"</span><span class="op">]</span></span>
<span>  <span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">accuracy_metrics</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">flextable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/autofit.html">autofit</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid">
<style>.cl-a80ad4d4{}.cl-a804910a{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a8071cd6{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a8071cea{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a8073914{width:1.44in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a807391e{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a8073928{width:1.44in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a8073929{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a8073932{width:1.44in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a807393c{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a8073946{width:1.44in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a8073950{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a807395a{width:1.44in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a8073964{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<table data-quarto-disable-processing="true" class="cl-a80ad4d4">
<thead><tr style="overflow-wrap:break-word;">
<th class="cl-a8073914"><p class="cl-a8071cd6"><span class="cl-a804910a">metric</span></p></th>
<th class="cl-a807391e"><p class="cl-a8071cea"><span class="cl-a804910a">value</span></p></th>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-a8073928"><p class="cl-a8071cd6"><span class="cl-a804910a">Overall Accuracy</span></p></td>
<td class="cl-a8073929"><p class="cl-a8071cea"><span class="cl-a804910a">0.7393</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-a8073932"><p class="cl-a8071cd6"><span class="cl-a804910a">Kappa</span></p></td>
<td class="cl-a807393c"><p class="cl-a8071cea"><span class="cl-a804910a">0.6916</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-a8073946"><p class="cl-a8071cd6"><span class="cl-a804910a">95% CI Lower</span></p></td>
<td class="cl-a8073950"><p class="cl-a8071cea"><span class="cl-a804910a">0.7135</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-a807395a"><p class="cl-a8071cd6"><span class="cl-a804910a">95% CI Upper</span></p></td>
<td class="cl-a8073964"><p class="cl-a8071cea"><span class="cl-a804910a">0.7640</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">confMatrix</span></span>
<span><span class="co">## Confusion Matrix and Statistics</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Clear_Cut_Bare_Soil Forest Clear_Cut_Vegetation</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                   130      2                    8</span></span>
<span><span class="co">##   Forest                                  0    166                   11</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                   16      1                   74</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                  41      0                    4</span></span>
<span><span class="co">##   Wetland                                 1      0                    0</span></span>
<span><span class="co">##   Water                                   0      0                    0</span></span>
<span><span class="co">##   Mountainside_Forest                     0      0                    1</span></span>
<span><span class="co">##   Seasonally_Flooded                      0      7                    8</span></span>
<span><span class="co">##   Riparian_Forest                         0     16                   14</span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Clear_Cut_Burned_Area Wetland Water Mountainside_Forest</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                      31       2     0                   0</span></span>
<span><span class="co">##   Forest                                    0       1     0                  15</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                     10       1     0                   3</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                   144       0     0                   0</span></span>
<span><span class="co">##   Wetland                                   3      27     0                   0</span></span>
<span><span class="co">##   Water                                     0       1    21                   0</span></span>
<span><span class="co">##   Mountainside_Forest                       0       0     0                   3</span></span>
<span><span class="co">##   Seasonally_Flooded                        6      11     0                   1</span></span>
<span><span class="co">##   Riparian_Forest                           2       0     0                  20</span></span>
<span><span class="co">##                        Reference</span></span>
<span><span class="co">## Prediction              Seasonally_Flooded Riparian_Forest</span></span>
<span><span class="co">##   Clear_Cut_Bare_Soil                    6               3</span></span>
<span><span class="co">##   Forest                                19              20</span></span>
<span><span class="co">##   Clear_Cut_Vegetation                   7               5</span></span>
<span><span class="co">##   Clear_Cut_Burned_Area                  2               0</span></span>
<span><span class="co">##   Wetland                                1               0</span></span>
<span><span class="co">##   Water                                  0               0</span></span>
<span><span class="co">##   Mountainside_Forest                    2               0</span></span>
<span><span class="co">##   Seasonally_Flooded                   101               2</span></span>
<span><span class="co">##   Riparian_Forest                        8             219</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Overall Statistics</span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##                Accuracy : 0.7393         </span></span>
<span><span class="co">##                  95% CI : (0.7135, 0.764)</span></span>
<span><span class="co">##     No Information Rate : 0.208          </span></span>
<span><span class="co">##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16      </span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##                   Kappa : 0.6916         </span></span>
<span><span class="co">##                                          </span></span>
<span><span class="co">##  Mcnemar's Test P-Value : NA             </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Statistics by Class:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                      Class: Clear_Cut_Bare_Soil Class: Forest</span></span>
<span><span class="co">## Sensitivity                              0.6915        0.8646</span></span>
<span><span class="co">## Specificity                              0.9485        0.9343</span></span>
<span><span class="co">## Pos Pred Value                           0.7143        0.7155</span></span>
<span><span class="co">## Neg Pred Value                           0.9429        0.9731</span></span>
<span><span class="co">## Prevalence                               0.1571        0.1604</span></span>
<span><span class="co">## Detection Rate                           0.1086        0.1387</span></span>
<span><span class="co">## Detection Prevalence                     0.1520        0.1938</span></span>
<span><span class="co">## Balanced Accuracy                        0.8200        0.8995</span></span>
<span><span class="co">##                      Class: Clear_Cut_Vegetation Class: Clear_Cut_Burned_Area</span></span>
<span><span class="co">## Sensitivity                              0.61667                       0.7347</span></span>
<span><span class="co">## Specificity                              0.96007                       0.9530</span></span>
<span><span class="co">## Pos Pred Value                           0.63248                       0.7539</span></span>
<span><span class="co">## Neg Pred Value                           0.95741                       0.9483</span></span>
<span><span class="co">## Prevalence                               0.10025                       0.1637</span></span>
<span><span class="co">## Detection Rate                           0.06182                       0.1203</span></span>
<span><span class="co">## Detection Prevalence                     0.09774                       0.1596</span></span>
<span><span class="co">## Balanced Accuracy                        0.78837                       0.8439</span></span>
<span><span class="co">##                      Class: Wetland Class: Water Class: Mountainside_Forest</span></span>
<span><span class="co">## Sensitivity                 0.62791      1.00000                   0.071429</span></span>
<span><span class="co">## Specificity                 0.99567      0.99915                   0.997403</span></span>
<span><span class="co">## Pos Pred Value              0.84375      0.95455                   0.500000</span></span>
<span><span class="co">## Neg Pred Value              0.98627      1.00000                   0.967254</span></span>
<span><span class="co">## Prevalence                  0.03592      0.01754                   0.035088</span></span>
<span><span class="co">## Detection Rate              0.02256      0.01754                   0.002506</span></span>
<span><span class="co">## Detection Prevalence        0.02673      0.01838                   0.005013</span></span>
<span><span class="co">## Balanced Accuracy           0.81179      0.99957                   0.534416</span></span>
<span><span class="co">##                      Class: Seasonally_Flooded Class: Riparian_Forest</span></span>
<span><span class="co">## Sensitivity                            0.69178                 0.8795</span></span>
<span><span class="co">## Specificity                            0.96670                 0.9367</span></span>
<span><span class="co">## Pos Pred Value                         0.74265                 0.7849</span></span>
<span><span class="co">## Neg Pred Value                         0.95759                 0.9673</span></span>
<span><span class="co">## Prevalence                             0.12197                 0.2080</span></span>
<span><span class="co">## Detection Rate                         0.08438                 0.1830</span></span>
<span><span class="co">## Detection Prevalence                   0.11362                 0.2331</span></span>
<span><span class="co">## Balanced Accuracy                      0.82924                 0.9081</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="sec-summary" class="level2"><h2 class="anchored" data-anchor-id="sec-summary">3.10 Chapter Summary</h2>
<p>This chapter established a comprehensive framework for activity data uncertainty quantification in REDD+ monitoring systems. Key contributions include:</p>
<ol type="1">
<li>Data cube architecture: Structured approach to spatiotemporal land cover analysis</li>
<li>IPCC methodology alignment: Clear guidance on Approach 3 requirements</li>
<li>Pixel-level uncertainty tracking: Model residuals for adaptive sampling</li>
<li>Random Forest optimization: Monte Carlo calibration workflows</li>
<li>Rigorous accuracy assessment: Confusion matrices with area adjustment</li>
</ol>
<p>Activity data provides spatial extent; allometry converts extent to biomass. Combined uncertainty requires:</p>
<p><span class="math display">\[
U_{total}^2 = U_{activity}^2 + U_{allometry}^2 + 2 \times \text{Cov}(A, B)
\]</span></p>
<p>Where covariance term captures spatial correlation between classification errors and biomass estimation errors.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-gdalcubes" class="csl-entry" role="listitem">
Appel, M., &amp; Pebesma, E. (2019a). <em>On-demand processing of data cubes from satellite image collections with the gdalcubes library</em>. <em>4</em>. <a href="https://doi.org/10.3390/data4030092">https://doi.org/10.3390/data4030092</a>
</div>
<div id="ref-appel2019demand" class="csl-entry" role="listitem">
Appel, M., &amp; Pebesma, E. (2019b). On-demand processing of data cubes from satellite image collections with the gdalcubes library. <em>Data</em>, <em>4</em>(3), 92.
</div>
<div id="ref-ballantyne2015audit" class="csl-entry" role="listitem">
Ballantyne, A., Andres, R., Houghton, R., Stocker, B., Wanninkhof, R., Anderegg, W., Cooper, L., DeGrandpre, M., Tans, P., Miller, J., &amp; al., et. (2015). Audit of the global carbon budget: Estimate errors and their impact on uptake uncertainty. <em>Biogeosciences (Online)</em>, <em>12</em>(8), 2565–2584.
</div>
<div id="ref-cao2012automatic" class="csl-entry" role="listitem">
Cao, S., Yu, Q., &amp; Zhang, J. (2012). Automatic division for pure/mixed pixels based on probabilities entropy and spatial heterogeneity. <em>2012 First International Conference on Agro-Geoinformatics (Agro-Geoinformatics)</em>, 1–4.
</div>
<div id="ref-crawford2013active" class="csl-entry" role="listitem">
Crawford, M. M., Tuia, D., &amp; Yang, H. L. (2013). Active learning: Any value for classification of remotely sensed data? <em>Proceedings of the IEEE</em>, <em>101</em>(3), 593–608.
</div>
<div id="ref-frenay2013classification" class="csl-entry" role="listitem">
Frénay, B., &amp; Verleysen, M. (2013). Classification in the presence of label noise: A survey. <em>IEEE Transactions on Neural Networks and Learning Systems</em>, <em>25</em>(5), 845–869.
</div>
<div id="ref-gonccalves2008unsupervised" class="csl-entry" role="listitem">
Gonçalves, M., Netto, M., Costa, J., &amp; Zullo Junior, J. (2008). An unsupervised method of classifying remotely sensed images using kohonen self-organizing maps and agglomerative hierarchical clustering methods. <em>International Journal of Remote Sensing</em>, <em>29</em>(11), 3171–3207.
</div>
<div id="ref-terra-2" class="csl-entry" role="listitem">
Hijmans, R. J. (2025). <em>Terra: Spatial data analysis</em>. <a href="https://CRAN.R-project.org/package=terra">https://CRAN.R-project.org/package=terra</a>
</div>
<div id="ref-ipcc2013RevisedSupplementary2014" class="csl-entry" role="listitem">
IPCC. (n.d.). <em>2013 revised supplementary methods and good practice guidance arising from the kyoto protocol</em>.
</div>
<div id="ref-ipccReportConferenceParties2012" class="csl-entry" role="listitem">
IPCC. (2012). <em>Report of the conference of the parties serving as the meeting of the parties to the kyoto protocol on its seventh session,</em>. <em>FCCC/KP/CMP/2011/10</em>(Durban Meeting November 28th to December 11th, 2011), 824.
</div>
<div id="ref-ipccChapter2Generic2019" class="csl-entry" role="listitem">
IPCC. (2019). Chapter 2: Generic methodologies applicable to multiple land-use categories. In <em>2019 refinement to the 2006 IPCC guidelines for national greenhouse gas inventories</em> (Agriculture, Forestry and Other Land Use, Vol. 4). Intergovernmental Panel on Climate Change. <a href="https://www.ipcc-nggip.iges.or.jp/public/2019rf/pdf/4_Volume4/19R_V4_Ch02_Generic%20Methods.pdf">https://www.ipcc-nggip.iges.or.jp/public/2019rf/pdf/4_Volume4/19R_V4_Ch02_Generic%20Methods.pdf</a>
</div>
<div id="ref-kuhn2011caret" class="csl-entry" role="listitem">
Kuhn, M. (2011). <em>The caret package</em>.
</div>
<div id="ref-maus2019dtwsat" class="csl-entry" role="listitem">
Maus, V., Câmara, G., Appel, M., &amp; Pebesma, E. (2019). Dtwsat: Time-weighted dynamic time warping for satellite image time series analysis in r. <em>Journal of Statistical Software</em>, <em>88</em>, 1–31.
</div>
<div id="ref-maxwell2018implementation" class="csl-entry" role="listitem">
Maxwell, A. E., Warner, T. A., &amp; Fang, F. (2018). Implementation of machine-learning classification in remote sensing: An applied review. <em>International Journal of Remote Sensing</em>, <em>39</em>(9), 2784–2817.
</div>
<div id="ref-meyer2022machine" class="csl-entry" role="listitem">
Meyer, H., &amp; Pebesma, E. (2022). Machine learning-based global maps of ecological variables and the challenge of assessing them. <em>Nature Communications</em>, <em>13</em>(1), 2208.
</div>
<div id="ref-neagoe2014concurrent" class="csl-entry" role="listitem">
Neagoe, V.-E., Stoica, R.-M., Ciurea, A.-I., Bruzzone, L., &amp; Bovolo, F. (2014). Concurrent self-organizing maps for supervised/unsupervised change detection in remote sensing images. <em>IEEE Journal of Selected Topics in Applied Earth Observations and Remote Sensing</em>, <em>7</em>(8), 3525–3533.
</div>
<div id="ref-petitjean2012satellite" class="csl-entry" role="listitem">
Petitjean, F., Inglada, J., &amp; Gançarski, P. (2012). Satellite image time series analysis under time warping. <em>IEEE Transactions on Geoscience and Remote Sensing</em>, <em>50</em>(8), 3081–3095.
</div>
<div id="ref-rand1971objective" class="csl-entry" role="listitem">
Rand, W. M. (1971). Objective criteria for the evaluation of clustering methods. <em>Journal of the American Statistical Association</em>, <em>66</em>(336), 846–850.
</div>
<div id="ref-shannonMathematicalTheoryCommunication1948" class="csl-entry" role="listitem">
Shannon, C. E. (1948). A mathematical theory of communication. <em>Bell System Technical Journal</em>, <em>27</em>(3), 379–423. <a href="https://doi.org/10.1002/j.1538-7305.1948.tb01338.x">https://doi.org/10.1002/j.1538-7305.1948.tb01338.x</a>
</div>
<div id="ref-simoes2021satellite" class="csl-entry" role="listitem">
Simoes, R., Camara, G., Queiroz, G., Souza, F., Andrade, P. R., Santos, L., Carvalho, A., &amp; Ferreira, K. (2021a). Satellite image time series analysis for big earth observation data. <em>Remote Sensing</em>, <em>13</em>(13), 2428.
</div>
<div id="ref-sits" class="csl-entry" role="listitem">
Simoes, R., Camara, G., Queiroz, G., Souza, F., Andrade, P., Santos, L., Carvalho, A., &amp; Ferreira, K. (2021b). <em>Satellite image time series analysis for big earth observation data</em>. <em>13</em>, 2428. <a href="https://doi.org/10.3390/rs13132428">https://doi.org/10.3390/rs13132428</a>
</div>
<div id="ref-smotefamily" class="csl-entry" role="listitem">
Siriseriwan, W. (2024). <em>Smotefamily: A collection of oversampling techniques for class imbalance problem based on SMOTE</em>. <a href="https://CRAN.R-project.org/package=smotefamily">https://CRAN.R-project.org/package=smotefamily</a>
</div>
<div id="ref-ForesToolboxRS" class="csl-entry" role="listitem">
Tarazona Coronel, Y., Zabala, A., Pons, X., Broquetas, A., Nowosad, J., &amp; A. Zurqani, H. (2021). <em>Fusing landsat and <span></span>SAR<span></span> data for mapping tropical deforestation through machine learning classification and the <span></span>PVts<span></span>-β non-seasonal detection approach</em>. <a href="https://doi.org/10.1080/07038992.2021.1941823">https://doi.org/10.1080/07038992.2021.1941823</a>
</div>
<div id="ref-DMwR" class="csl-entry" role="listitem">
Torgo, L. (2010). <em>Data mining with r, learning with case studies</em>. <a href="http://www.dcc.fc.up.pt/~ltorgo/DataMiningWithR">http://www.dcc.fc.up.pt/~ltorgo/DataMiningWithR</a>
</div>
<div id="ref-unfccc2010report" class="csl-entry" role="listitem">
UNFCCC, C. (2010). Report of the conference of the parties on its fifteenth session, held in copenhagen from 7 to 19 december 2009. <em>FCCC/CP/2009/11/Add. 1</em>.
</div>
<div id="ref-yao2016application" class="csl-entry" role="listitem">
Yao, W., Loffeld, O., &amp; Datcu, M. (2016). Application and evaluation of a hierarchical patch clustering method for remote sensing images. <em>IEEE Journal of Selected Topics in Applied Earth Observations and Remote Sensing</em>, <em>9</em>(6), 2279–2289.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1">
<p><strong>In version 1.5.3,<code>sits</code> supports access to the following ARD image cloud providers:</strong></p>
<ul>
<li><strong>Amazon Web Services (AWS): Open data Sentinel-2/2A Level-2A collections for the Earth’s land surface.</strong></li>
<li><strong>Brazil Data Cube (BDC): Open data collections of Sentinel-2/2A, Landsat-8, CBERS-4/4A, and MOD13Q1 products for Brazil. These collections are organized as regular data cubes.</strong></li>
<li><strong>Copernicus Data Space Ecosystem (CDSE): Open data collections of Sentinel-1 RTC and Sentinel-2/2A images.</strong></li>
<li><strong>Digital Earth Africa (DEAFRICA): Open data collections of Sentinel-1 RTC, Sentinel-2/2A, Landsat-5/7/8/9 for Africa. Additional products include ALOS_PALSAR mosaics, DEM_COP_30, NDVI_ANOMALY based on Landsat data, and monthly and daily rainfall data from CHIRPS.</strong></li>
<li><strong>Digital Earth Australia (DEAUSTRALIA): Open data ARD collections of Sentinel-2A/2B and Landsat-5/7/8/9 images, yearly geomedians of Landsat 5/7/8 images; yearly fractional land cover from 1986 to 2024.</strong></li>
<li><strong>Harmonized Landsat-Sentinel (HLS): HLS, provided by NASA, is an open data collection that processes Landsat 8 and Sentinel-2 imagery to a common standard.</strong></li>
<li><strong>Microsoft Planetary Computer (MPC): Open data collections of Sentinel-1 GRD, Sentinel-1 RTC, Sentinel-2/2A, Landsat-4/5/7/8/9 images for the Earth’s land areas. Also supported are the Copernicus DEM-30 and MOD13Q1, MOD10A1, MOD09A1 products, and the Harmonized Landsat-Sentinel collections (HLSL30 and HLSS30).</strong></li>
<li><strong>Swiss Data Cube (SDC): Collection of Sentinel-2/2A and Landsat-8 images for Switzerland.</strong></li>
<li><strong>Terrascope: Cloud service with EO products, which includes the ESA World Cover map.</strong></li>
<li><strong>USGS: Landsat-4/5/7/8/9 collections available in AWS, which require access payment.</strong></li>
</ul>
<p><strong>In addition, <code>sits</code> supports the use of Planet monthly mosaics stored as local files. For a detailed description of the providers and collections supported by <code>sits</code>, please run <code>sits_list_collections()</code>.</strong><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn2"><p>For addressing the most problematic uncertainty tasks needing longitudinal analyses of extended timelines (1984-2024), such as disaggregation of wildfire uncertainty and the inter-annual variability of natural disturbances, we recommend practicing data cube operations with Landsat imagery <span class="citation" data-cites="ipccReportConferenceParties2012 ipccChapter2Generic2019 ipcc2013RevisedSupplementary2014 unfccc2010report">(<a href="../references/index.html#ref-ipcc2013RevisedSupplementary2014" role="doc-biblioref">IPCC, n.d., p. O.9</a>; <a href="../references/index.html#ref-ipccReportConferenceParties2012" role="doc-biblioref">2012, p. 847</a>; <a href="../references/index.html#ref-ipccChapter2Generic2019" role="doc-biblioref">2019, p. 2.67</a>; <a href="../references/index.html#ref-unfccc2010report" role="doc-biblioref">UNFCCC, 2010, pp. 17–18</a>)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../02-emission-factors/index.html" class="pagination-link" aria-label="2. Emission Factors">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">2. Emission Factors</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../04-monte-carlo/index.html" class="pagination-link" aria-label="4. Monte Carlo">
        <span class="nav-page-text"><span class="chapter-title">4. Monte Carlo</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "3. Activity Data"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">  docx:</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">    reference-doc: ../references/style.docx</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: github</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk:</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">    prefer-html: true</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "png"</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">    dpi: 300</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../references/references.bib</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> ../references/apa.csl</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview {.unnumbered}</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>Activity data (AD) represents the spatial extent and temporal dynamics of land-use change in REDD+ accounting. This chapter addresses uncertainty quantification in land cover classification, change detection, and spatial aggregation. These components typically constitute the greatest contribution to total REDD+ uncertainty <span class="co">[</span><span class="ot">@ballantyne2015audit</span><span class="co">]</span>.</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="fu">### IPCC Approaches</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>The IPCC defines three hierarchical approaches for activity data collection that differ in spatial explicitness and uncertainty characteristics <span class="co">[</span><span class="ot">@ipccChapter2Generic2019</span><span class="co">]</span>:</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach   <span class="pp">|</span> Data Type             <span class="pp">|</span> Spatial Resolution  <span class="pp">|</span> Uncertainty <span class="pp">|</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------|-----------------------|---------------------|-------------|</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach 1 <span class="pp">|</span> Area statistics       <span class="pp">|</span> Aggregated totals   <span class="pp">|</span> Highest     <span class="pp">|</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach 2 <span class="pp">|</span> Sample-based matrices <span class="pp">|</span> Point/grid sampling <span class="pp">|</span> Moderate    <span class="pp">|</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Approach 3 <span class="pp">|</span> Wall-to-wall maps     <span class="pp">|</span> Spatially explicit  <span class="pp">|</span> Lowest      <span class="pp">|</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>This chapter implements Approach 3 methods using satellite time series classification, which ART-TREES programs predominantly adopt due to requirements for spatially explicit monitoring, pixel-level change detection, and integration with emission factor stratification. The data cube framework and machine learning workflows demonstrated in sections 3.2-3.9 operationalize Approach 3 while providing the uncertainty quantification infrastructure required under ART-TREES Section 8. The chapter is structured around a data cube framework for organizing and analyzing spatiotemporal land cover data, followed by uncertainty estimation techniques aligned with IPCC methodologies. We organize the technical content into the following components:</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Data Cube Architecture: Spatiotemporal array structures for satellite time series</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>IPCC Monitoring Approaches: Transition matrices and spatial explicitness (Approaches 1-3)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Pixel-Level Uncertainty Tracking: Model residuals for spatial error mapping</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Random Forest Optimization: Monte Carlo calibration of classification algorithms</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Accuracy Assessment: Confusion matrices and validation metrics</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="fu">### Environment Setup {.unnumbered}</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>easypackages<span class="sc">::</span><span class="fu">packages</span>(</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bslib"</span>, <span class="st">"caret"</span>, <span class="st">"cols4all"</span>, <span class="st">"covr"</span>, <span class="st">"cowplot"</span>, <span class="st">"dendextend"</span>, <span class="st">"digest"</span>,<span class="st">"DiagrammeR"</span>, </span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dtwclust"</span>, <span class="st">"downlit"</span>, <span class="st">"devtools"</span>, <span class="st">"e1071"</span>, <span class="st">"exactextractr"</span>,<span class="st">"elevatr"</span>, <span class="st">"FNN"</span>, </span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>  <span class="st">"future"</span>, <span class="st">"forestdata"</span>,<span class="st">"gdalcubes"</span>, <span class="st">"gdalUtilities"</span>, <span class="st">"geojsonsf"</span>, <span class="st">"geos"</span>, </span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ggplot2"</span>, <span class="st">"ggstats"</span>, <span class="st">"ggspatial"</span>, <span class="st">"ggmap"</span>, <span class="st">"ggplotify"</span>, <span class="st">"ggpubr"</span>, <span class="st">"ggrepel"</span>, </span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>  <span class="st">"giscoR"</span>, <span class="st">"hdf5r"</span>, <span class="st">"httr"</span>, <span class="st">"httr2"</span>, <span class="st">"htmltools"</span>, <span class="st">"jsonlite"</span>, <span class="st">"kohonen"</span>, <span class="st">"leafem"</span>, </span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>  <span class="st">"leaflet.providers"</span>, <span class="st">"libgeos"</span>,<span class="st">"luz"</span>,<span class="st">"lwgeom"</span>, <span class="st">"leaflet"</span>, <span class="st">"leafgl"</span>, <span class="st">"MLmetrics"</span>,</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mapedit"</span>, <span class="st">"mapview"</span>, <span class="st">"maptiles"</span>, <span class="st">"methods"</span>, <span class="st">"mgcv"</span>, <span class="st">"ncdf4"</span>, <span class="st">"nnet"</span>, <span class="st">"openxlsx"</span>, </span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>  <span class="st">"parallel"</span>, <span class="st">"plotly"</span>, <span class="st">"randomForestExplainer"</span>,<span class="st">"randomForest"</span>, <span class="st">"rasterVis"</span>, <span class="st">"raster"</span>, </span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Rcpp"</span>, <span class="st">"RcppArmadillo"</span>, <span class="st">"RcppCensSpatial"</span>, <span class="st">"rayshader"</span>, <span class="st">"RcppEigen"</span>, <span class="st">"RcppParallel"</span>, </span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RColorBrewer"</span>, <span class="st">"reactable"</span>, <span class="st">"rgl"</span>, <span class="st">"rsconnect"</span>,<span class="st">"RStoolbox"</span>, <span class="st">"rts"</span>, <span class="st">"s2"</span>, <span class="st">"sf"</span>, </span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>  <span class="st">"scales"</span>, <span class="st">"sits"</span>, <span class="st">"sitsdata"</span>, <span class="st">"spdep"</span>, <span class="st">"stars"</span>, <span class="st">"stringr"</span>,<span class="st">"supercells"</span>, <span class="st">"smotefamily"</span>, </span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>  <span class="st">"terra"</span>, <span class="st">"testthat"</span>, <span class="st">"tidyverse"</span>, <span class="st">"tidyterra"</span>, <span class="st">"tools"</span>, <span class="st">"torch"</span>, <span class="st">"tmap"</span>, <span class="st">"tmaptools"</span>, </span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>  <span class="st">"terrainr"</span>, <span class="st">"xgboost"</span>, <span class="st">"webshot"</span>, <span class="st">"webshot2"</span>,</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">prompt =</span> F)</span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="at">use_s2 =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>),</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">htmltools.dir.version =</span> <span class="cn">FALSE</span>, </span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">htmltools.preserve.raw =</span> <span class="cn">FALSE</span></span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("ytarazona/ForesToolboxRS")</span></span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(ForesToolboxRS))</span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>, </span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>, </span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">error =</span> <span class="cn">FALSE</span>, </span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="cn">NA</span>, </span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">tidy.opts =</span> <span class="fu">list</span>(<span class="at">width.cutoff =</span> <span class="dv">60</span>)</span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.1 Time Series Structure {.unnumbered}</span></span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>Data cubes provide a structured framework for organizing and analyzing satellite imagery time series. We define data cubes as multidimensional arrays with dimensions associated with space and time, where land cover observations become "attributes" that have duration along the temporal dimension.</span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>For purpose of REDD+ land monitoring, a data cube structure consists of:</span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial dimensions: Longitude (x) and latitude (y)</span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal dimension: Observation dates (t)</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spectral dimension: Sensor bands (λ)</span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Attributes: Land cover class, uncertainty metrics, model residuals</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>In the following sections (3.2-3.7), we demonstrate user-friendly operations from the <span class="in">`sits`</span> and <span class="in">`gdalcubes`</span> packages for time series workflows <span class="co">[</span><span class="ot">@sits; @gdalcubes</span><span class="co">]</span>. These tools integrate machine learning classification with data cube management and raster processing. This approach is particularly valuable for REDD+ workflows because it supports uncertainty-based optimization of both data cube architecture and classifier training <span class="co">[</span><span class="ot">@appel2019demand</span><span class="co">]</span>. Sections 3.8-3.9 then cover advanced procedures from the <span class="in">`caret`</span> and <span class="in">`terra`</span> packages, including cross-validation and Monte Carlo training simulations for accuracy assessment and model calibration.</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.2 Assemble Data Cube</span></span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>The <span class="in">`sits`</span> package installation comes pre-loaded with an API connections<span class="ot">[^index-1]</span> to ARD collections (<span class="co">[</span><span class="ot">Analysis-Ready-Data</span><span class="co">](https://ceos.org/ard/)</span>) via STAC protocols (<span class="co">[</span><span class="ot">SpatioTemporal Asset Catalogs</span><span class="co">](https://stacspec.org/en)</span>). This built-in component allows programmatic access to cloud-hosted imagery from AWS, Microsoft Planetary Computer, EarthData, Copernicus many other leading warehouses. However, raw ARD collections present several challenges for classification workflows:</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial harmonization: Band-specific resolutions require harmonization to common grid avoiding edge anomalies and gaps</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal harmonization: Revisit cycles vary due to orbital geometry, platform scheduling, and atmospheric conditions</span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cloud removal: Atmospheric interference introduces missing observations that corrupt spectral time series</span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>For REDD+ monitoring, temporal gaps create systematic underestimation of forest loss when clearing events coincide with cloud-covered periods; a known source of activity data bias requiring explicit quantification in uncertainty budgets. The <span class="in">`sits_regularize()`</span> function provides wrapper to <span class="in">`gdalcubes`</span> operations that transforms heterogeneous imagery into regular or normalized data cubes through coupled spatial and temporal harmonizations.</span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial harmonization reprojects all inputs to a common coordinate reference system and resamples to uniform pixel spacing. For instance, fusing Sentinel-1 SAR with Sentinel-2 optical data requires reprojection to the MGRS grid at consistent resolution (typically 10m), ensuring geometric alignment and eliminating co-registration errors that propagate into classification uncertainty.</span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal harmonization establishes fixed observation intervals (16-day, monthly, seasonal) via cloud-optimized compositing. Within each interval, the algorithm ranks available scenes by cloud cover percentage, using the clearest image as reference and filling gaps from progressively cloudier acquisitions. Pixels with persistent cloud contamination are flagged as NA and gap-filled through temporal interpolation during feature extraction.</span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a><span class="fu">## ARD Tile Grids</span></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a>Sentinel-2 acquisitions are organized according to the Military Grid Reference System (MGRS), which partitions global coverage into 60 longitudinal zones spanning 8° each. Within zones, 6° latitudinal blocks are further subdivided into 110 km × 110 km tiles with 10 km overlap to ensure seamless mosaicking. This tiling structure is critical for REDD+ monitoring systems that track forest change across administrative boundaries, as tile edges can introduce geometric discontinuities if not properly managed during data cube construction.</span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a>Landsat missions (4,5,7,8,9) employ the Worldwide Reference System-2 (WRS-2), which references scenes by path (descending orbital track) and row (latitudinal frame center). The WRS-2 grid comprises 233 paths globally, each containing 119 rows. All WRS-2 imagery is delivered with geometric correction to UTM projection, facilitating direct integration with ground reference data and cadastral boundaries commonly used in jurisdictional REDD+ accounting. For operational monitoring systems, understanding these tiling schemes is essential for:</span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stratification: Validation samples must account for tile boundaries to avoid spatial clustering</span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Co-registration: Cross-sensor fusion (Landsat-Sentinel) requires explicit handling of differing grid systems</span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Computation: Processing workflows optimized for native tile extents reduce unnecessary resampling and associated geometric errors</span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a>This analysis replicates methods from @simoes2021satellite, which assembles a data cube from MPC's collection of Sentinel-2 ARD-imagery comprising a single tiled area in the state of Rondonia for the full calendar year of 2022.<span class="ot">[^index-2]</span> Following assmbly, we normalize raw imagery into a bi-monthly regularized cube below.</span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a>*Caution: This code cell requires longer runtime (\~12 mins).*</span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data cube from Microsoft Planetary Computer ARD</span></span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a>cube_s2_raw <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube</span>(</span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a>  <span class="at">source            =</span> <span class="st">"MPC"</span>,</span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a>  <span class="at">collection    =</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a>  <span class="at">tiles             =</span> <span class="st">"20LMR"</span>,</span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">bands             =</span> <span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"CLOUD"</span>),</span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">start_date    =</span> <span class="st">"2022-01-01"</span>,</span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a>  <span class="at">end_date      =</span> <span class="st">"2022-12-31"</span></span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Check timelines of assembled tiles</span></span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_timeline</span>(cube_s2_raw)</span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.3 Normalize Data Cube</span></span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a>Although default <span class="in">`sits`</span> operations assemble cubes in the cloud, increased temporal and spatial extents and finer resolutions often require signficant processing times. Especially with larger data cube operations, we recommend assembling data cubes in the cloud and downloading copies of the cube imagery to your drive before normalizing imagery into a regular cube from the local directory of downloads. This speeds up operations and avoids network interruptions or queue lags.</span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy cube to local files</span></span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a>cube_s2_local <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube_copy</span>(</span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a>  <span class="at">cube              =</span> cube_s2_raw,</span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/raw/"</span>)</span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize cube from local files</span></span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_regularize</span>(</span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube                =</span> cube_s2_local,</span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/reg/"</span>,</span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a>    <span class="at">res                 =</span> <span class="dv">40</span>,</span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a>    <span class="at">period      =</span> <span class="st">"P16D"</span>,</span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">6</span></span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute spectral index bands for cube</span></span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">data                =</span> cube_s2_reg,</span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">NDVI                =</span> (B08 <span class="sc">-</span> B04)<span class="sc">/</span>(B08 <span class="sc">+</span> B04),</span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">data                =</span> cube_s2_reg,</span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">NBR                 =</span> (B08 <span class="sc">-</span> B12) <span class="sc">/</span> (B08 <span class="sc">+</span> B12),</span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_apply</span>(</span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a>    <span class="at">data                =</span> cube_s2_reg,</span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a>    <span class="at">EVI                 =</span> <span class="fl">2.5</span> <span class="sc">*</span> (B08 <span class="sc">-</span> B04) <span class="sc">/</span> ((B08 <span class="sc">+</span> <span class="fl">6.0</span> <span class="sc">*</span> B04 <span class="sc">-</span> <span class="fl">7.5</span> <span class="sc">*</span> B02) <span class="sc">+</span> <span class="fl">1.0</span>),</span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir    =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cube structure</span></span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(cube_s2_reg)</span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot single-date RGB image</span></span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_reg, </span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a>         <span class="at">red =</span> <span class="st">"B11"</span>, </span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a>         <span class="at">green =</span> <span class="st">"B8A"</span>, </span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a>         <span class="at">blue =</span> <span class="st">"B02"</span>, </span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="st">"2022-07-16"</span></span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-215"><a href="#cb26-215" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-216"><a href="#cb26-216" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Access local data cube</span></span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a>cube_s2_reg <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cube</span>(</span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">source          =</span> <span class="st">"MPC"</span>,</span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a>  <span class="at">collection    =</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_dir      =</span> <span class="st">"./assets/images/reg/"</span>)</span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-227"><a href="#cb26-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-228"><a href="#cb26-228" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cube structure</span></span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(cube_s2_reg)</span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot one temporal instance</span></span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_reg, </span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a>         <span class="at">red =</span> <span class="st">"B11"</span>, </span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a>         <span class="at">green =</span> <span class="st">"B8A"</span>, </span>
<span id="cb26-235"><a href="#cb26-235" aria-hidden="true" tabindex="-1"></a>         <span class="at">blue =</span> <span class="st">"B02"</span>, </span>
<span id="cb26-236"><a href="#cb26-236" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="st">"2022-07-16"</span></span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-243"><a href="#cb26-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-244"><a href="#cb26-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-248"><a href="#cb26-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-249"><a href="#cb26-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-250"><a href="#cb26-250" aria-hidden="true" tabindex="-1"></a><span class="co"># Files are also available remotely from sitsdata directory </span></span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/Rondonia-20LMR/"</span>, <span class="at">package =</span> <span class="st">"sitsdata"</span>)</span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data cube</span></span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a>rondonia_20LMR <span class="ot">&lt;-</span> <span class="fu">sits_cube</span>(</span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a>    <span class="at">source =</span> <span class="st">"MPC"</span>,</span>
<span id="cb26-256"><a href="#cb26-256" aria-hidden="true" tabindex="-1"></a>    <span class="at">collection =</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span id="cb26-257"><a href="#cb26-257" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_dir =</span> data_dir</span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the cube</span></span>
<span id="cb26-261"><a href="#cb26-261" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rondonia_20LMR, <span class="at">date =</span> <span class="st">"2022-07-16"</span>, <span class="at">band =</span> <span class="st">"NDVI"</span>)</span>
<span id="cb26-262"><a href="#cb26-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.4 Training Data Samples</span></span>
<span id="cb26-265"><a href="#cb26-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-266"><a href="#cb26-266" aria-hidden="true" tabindex="-1"></a>Training data quality directly determines classification accuracy and, consequently, activity data uncertainty. This analysis uses the <span class="in">`samples_deforestation_rondonia`</span> dataset (n=6,007 signatures) distributed with the <span class="in">`sitsdata`</span> package, comprising nine forest disturbance classes collected through expert visual interpretation of Sentinel-2 imagery representing deforestation events across Rondônia state in the Brazilian Amazon:</span>
<span id="cb26-267"><a href="#cb26-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Clear_Cut_Bare_Soil`</span>: Post-clearing exposed soil</span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Clear_Cut_Burned_Area`</span>: Burned clearing residues</span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Clear_Cut_Vegetation`</span>: Regrowth or residual vegetation post-harvest</span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Forest`</span>: Intact forest including <span class="in">`Mountainside_Forest`</span>, <span class="in">`Riparian_Forest`</span></span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Water`</span>, <span class="in">`Wetland`</span>, <span class="in">`Seasonally_Flooded`</span>: Hydrological features</span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a>The time series spans 2022-01-05 to 2022-12-23 at 16-day intervals, containing 10 Sentinel-2 bands (<span class="in">`B02`</span>, <span class="in">`B03`</span>, <span class="in">`B04`</span>, <span class="in">`B05`</span>, <span class="in">`B06`</span>, <span class="in">`B07`</span>, <span class="in">`B8A`</span>, <span class="in">`B08`</span>, <span class="in">`B11`</span> and <span class="in">`B12`</span>). Temporal validity aligns with the agricultural calendar to capture seasonal dynamics of land conversion.</span>
<span id="cb26-275"><a href="#cb26-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-278"><a href="#cb26-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Demo Training Samples</span></span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"samples_deforestation_rondonia"</span>)</span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">summary</span>(samples_deforestation_rondonia)</span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">head</span>(samples_deforestation_rondonia)</span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-291"><a href="#cb26-291" aria-hidden="true" tabindex="-1"></a>Visualizing class-specific temporal trajectories aids in assessing spectral separability; a key determinant of classification uncertainty. The <span class="in">`sits_patterns()`</span> function fits generalized additive models (GAM) to training data, producing smoothed temporal signatures that represent idealized class behavior. We derive vegetation indices (NDVI, EVI, NBR) to enhance interpretability.</span>
<span id="cb26-292"><a href="#cb26-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-302"><a href="#cb26-302" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute spectral indexes for training samples</span></span>
<span id="cb26-303"><a href="#cb26-303" aria-hidden="true" tabindex="-1"></a>training_samples_with_indices <span class="ot">&lt;-</span> samples_deforestation_rondonia <span class="sc">|&gt;</span> </span>
<span id="cb26-304"><a href="#cb26-304" aria-hidden="true" tabindex="-1"></a>    sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">NDVI =</span> (B08 <span class="sc">-</span> B04)<span class="sc">/</span>(B08 <span class="sc">+</span> B04)) <span class="sc">|&gt;</span> </span>
<span id="cb26-305"><a href="#cb26-305" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">NBR =</span> (B08 <span class="sc">-</span> B12) <span class="sc">/</span> (B08 <span class="sc">+</span> B12)) <span class="sc">|&gt;</span> </span>
<span id="cb26-306"><a href="#cb26-306" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_apply</span>(<span class="at">EVI =</span> <span class="fl">2.5</span> <span class="sc">*</span> (B08 <span class="sc">-</span> B04) <span class="sc">/</span> ((B08 <span class="sc">+</span> <span class="fl">6.0</span> <span class="sc">*</span> B04 <span class="sc">-</span> <span class="fl">7.5</span> <span class="sc">*</span> B02) <span class="sc">+</span> <span class="fl">1.0</span>)) </span>
<span id="cb26-307"><a href="#cb26-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-308"><a href="#cb26-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and plot patterns</span></span>
<span id="cb26-309"><a href="#cb26-309" aria-hidden="true" tabindex="-1"></a>training_samples_indices <span class="ot">&lt;-</span> training_samples_with_indices <span class="sc">|&gt;</span> </span>
<span id="cb26-310"><a href="#cb26-310" aria-hidden="true" tabindex="-1"></a>    sits<span class="sc">::</span><span class="fu">sits_select</span>(<span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"NDVI"</span>, <span class="st">"EVI"</span>, <span class="st">"NBR"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb26-311"><a href="#cb26-311" aria-hidden="true" tabindex="-1"></a>  sits<span class="sc">::</span><span class="fu">sits_patterns</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb26-312"><a href="#cb26-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-313"><a href="#cb26-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-314"><a href="#cb26-314" aria-hidden="true" tabindex="-1"></a>Temporal signatures conform to documented Amazonian deforestation phenology: forest clearing initiates during dry season onset (May-June), followed by burning in late dry season (August-September), evidenced by abrupt SWIR (B11) decline in <span class="in">`Clear_Cut_Burned_Area`</span> signatures. Regrowth trajectories (<span class="in">`Clear_Cut_Vegetation`</span>) exhibit NIR (B8A) recovery through the monitoring period. These temporal contrasts provide the spectral-temporal feature space for subsequent classification.</span>
<span id="cb26-315"><a href="#cb26-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-316"><a href="#cb26-316" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-317"><a href="#cb26-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-318"><a href="#cb26-318" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.5 Classify Data Cube</span></span>
<span id="cb26-319"><a href="#cb26-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-320"><a href="#cb26-320" aria-hidden="true" tabindex="-1"></a>Random Forest models provide robust baseline classifiers for activity data, balancing computational efficiency with adequate performance for Tier 2-3 REDD+ requirements. The <span class="in">`sits_train()`</span> function implements parallelized Random Forest training with default hyperparameters optimized for satellite time series.</span>
<span id="cb26-321"><a href="#cb26-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-324"><a href="#cb26-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-325"><a href="#cb26-325" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-326"><a href="#cb26-326" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-327"><a href="#cb26-327" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-328"><a href="#cb26-328" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb26-329"><a href="#cb26-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-330"><a href="#cb26-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-331"><a href="#cb26-331" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model using Random Forest algorithm</span></span>
<span id="cb26-332"><a href="#cb26-332" aria-hidden="true" tabindex="-1"></a>model_randomForest <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_train</span>(</span>
<span id="cb26-333"><a href="#cb26-333" aria-hidden="true" tabindex="-1"></a>  <span class="at">samples =</span> samples_deforestation_rondonia,</span>
<span id="cb26-334"><a href="#cb26-334" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_method     =</span> sits<span class="sc">::</span><span class="fu">sits_rfor</span>(</span>
<span id="cb26-335"><a href="#cb26-335" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_trees =</span> <span class="dv">120</span>,</span>
<span id="cb26-336"><a href="#cb26-336" aria-hidden="true" tabindex="-1"></a>    <span class="at">mtry            =</span> <span class="dv">10</span>)</span>
<span id="cb26-337"><a href="#cb26-337" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-338"><a href="#cb26-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-339"><a href="#cb26-339" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the model results</span></span>
<span id="cb26-340"><a href="#cb26-340" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_randomForest)</span>
<span id="cb26-341"><a href="#cb26-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-342"><a href="#cb26-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-343"><a href="#cb26-343" aria-hidden="true" tabindex="-1"></a>Variable importance metrics identify which spatiotemporal features contribute most to class discrimination. For REDD+ operations, understanding feature importance supports:</span>
<span id="cb26-344"><a href="#cb26-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-345"><a href="#cb26-345" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Uncertainty attribution: High-importance features with measurement error propagate more uncertainty</span>
<span id="cb26-346"><a href="#cb26-346" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Sensor planning: Identifies critical spectral bands for maintaining classification accuracy</span>
<span id="cb26-347"><a href="#cb26-347" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Transfer learning: Guides feature selection when adapting models to new regions</span>
<span id="cb26-348"><a href="#cb26-348" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Validation design: Informs stratification schemes for accuracy assessment</span>
<span id="cb26-349"><a href="#cb26-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-350"><a href="#cb26-350" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.6 Probability Data Cube</span></span>
<span id="cb26-351"><a href="#cb26-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-352"><a href="#cb26-352" aria-hidden="true" tabindex="-1"></a>Classification outputs are generated as probability cubes rather than discrete label maps to preserve model uncertainty information. The <span class="in">`sits_classify()`</span> function applies trained models to regularized data cubes using fault-tolerant parallel processing, producing per-class probability layers that quantify model confidence at the pixel level.</span>
<span id="cb26-353"><a href="#cb26-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-354"><a href="#cb26-354" aria-hidden="true" tabindex="-1"></a>The <span class="in">`sits`</span> package implements parallel computing to minimize communication overhead, which enables multi-core systems without configuration.</span>
<span id="cb26-355"><a href="#cb26-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-358"><a href="#cb26-358" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-359"><a href="#cb26-359" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-360"><a href="#cb26-360" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-361"><a href="#cb26-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-362"><a href="#cb26-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb26-363"><a href="#cb26-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-364"><a href="#cb26-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-365"><a href="#cb26-365" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify data cube</span></span>
<span id="cb26-366"><a href="#cb26-366" aria-hidden="true" tabindex="-1"></a>cube_s2_probs <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_classify</span>(</span>
<span id="cb26-367"><a href="#cb26-367" aria-hidden="true" tabindex="-1"></a>    <span class="at">data            =</span> cube_s2_reg,</span>
<span id="cb26-368"><a href="#cb26-368" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_model        =</span> model_randomForest,</span>
<span id="cb26-369"><a href="#cb26-369" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span id="cb26-370"><a href="#cb26-370" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-1228"</span>, <span class="co"># adds suffix to output filename</span></span>
<span id="cb26-371"><a href="#cb26-371" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb26-372"><a href="#cb26-372" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span></span>
<span id="cb26-373"><a href="#cb26-373" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-374"><a href="#cb26-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-375"><a href="#cb26-375" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_probs, </span>
<span id="cb26-376"><a href="#cb26-376" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels =</span> <span class="st">"Forest"</span>, </span>
<span id="cb26-377"><a href="#cb26-377" aria-hidden="true" tabindex="-1"></a>         <span class="at">palette =</span> <span class="st">"YlGn"</span></span>
<span id="cb26-378"><a href="#cb26-378" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb26-379"><a href="#cb26-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-380"><a href="#cb26-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-381"><a href="#cb26-381" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-d.png)</span>{fig-align="center"}</span>
<span id="cb26-382"><a href="#cb26-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-383"><a href="#cb26-383" aria-hidden="true" tabindex="-1"></a>Each pixel in the probability cube contains <span class="in">`n`</span> probability values (where <span class="in">`n`</span> = number of classes), summing to 1.0. Low maximum probability values indicate pixels with high classification uncertainty, typically occurring at class boundaries, in mixed pixels, or where spectral-temporal signatures deviate from training data. These pixel-level uncertainty metrics support subsequent:</span>
<span id="cb26-384"><a href="#cb26-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-385"><a href="#cb26-385" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adaptive stratification: High-uncertainty pixels receive higher validation sampling density</span>
<span id="cb26-386"><a href="#cb26-386" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Uncertainty propagation: Probability distributions feed Monte Carlo emission simulations</span>
<span id="cb26-387"><a href="#cb26-387" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Quality control: Spatial patterns of low confidence identify systematic classification errors</span>
<span id="cb26-388"><a href="#cb26-388" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Temporal tracking: Probability time series detect gradual transitions missed by discrete labeling</span>
<span id="cb26-389"><a href="#cb26-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-390"><a href="#cb26-390" aria-hidden="true" tabindex="-1"></a>Probability cubes thus serve as the foundation for rigorous uncertainty quantification in subsequent workflow stages.</span>
<span id="cb26-391"><a href="#cb26-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-392"><a href="#cb26-392" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.7 Training Data Enhancements</span></span>
<span id="cb26-393"><a href="#cb26-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-394"><a href="#cb26-394" aria-hidden="true" tabindex="-1"></a>Classification accuracy in REDD+ monitoring depends critically on training sample quality. Large, well-labeled datasets improve model performance regardless of algorithm choice, while noisy or mislabeled samples degrade classification accuracy and inflate activity data uncertainty <span class="co">[</span><span class="ot">@maxwell2018implementation; @frenay2013classification</span><span class="co">]</span>. This section demonstrates processing methods to identify problematic samples, reduce class imbalance, and address geographic variance before re-training models.</span>
<span id="cb26-395"><a href="#cb26-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-396"><a href="#cb26-396" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pixel Entropy Sampling</span></span>
<span id="cb26-397"><a href="#cb26-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-398"><a href="#cb26-398" aria-hidden="true" tabindex="-1"></a>Active learning uses pixel-level classification uncertainty to systematically improve classification accuracy through iterative model refinement <span class="co">[</span><span class="ot">@crawford2013active; @cao2012automatic</span><span class="co">]</span>. When there is a finite set of alternative classes, the expected value of conflict is given by the Shannon entropy <span class="co">[</span><span class="ot">@shannonMathematicalTheoryCommunication1948</span><span class="co">]</span>. Entropy may be used to describe the variations in class membership probabilities associated with each pixel. The <span class="in">`sits_uncertainty()`</span> function quantifies four types of uncertainty metrics:</span>
<span id="cb26-399"><a href="#cb26-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-400"><a href="#cb26-400" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-401"><a href="#cb26-401" aria-hidden="true" tabindex="-1"></a>\text{H} = -\sum_{i=1}^n Pr(i) \times \log(Pr(i))</span>
<span id="cb26-402"><a href="#cb26-402" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-403"><a href="#cb26-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-404"><a href="#cb26-404" aria-hidden="true" tabindex="-1"></a>where $Pr(i)$ represents the highest membership probability for pixel $i$ across $n$ classes. For REDD+ applications, the <span class="in">`margin`</span> of confidence typically provides the most actionable results, such as for highlighting transition zones where forest degradation or regeneration creates spectral ambiguity between classes.</span>
<span id="cb26-405"><a href="#cb26-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-408"><a href="#cb26-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate uncertainty cube and sample high-uncertainty pixels</span></span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a>cube_s2_uncertainty <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty</span>(</span>
<span id="cb26-412"><a href="#cb26-412" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube =</span> cube_s2_probs,</span>
<span id="cb26-413"><a href="#cb26-413" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"margin"</span>, </span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">"./assets/images/uncertainty/"</span>,</span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize =</span> <span class="dv">16</span>)</span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize high-uncertainty areas</span></span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty, <span class="at">palette =</span> <span class="st">"Oranges"</span>)</span>
<span id="cb26-420"><a href="#cb26-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-421"><a href="#cb26-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-422"><a href="#cb26-422" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-l1.png)</span>{fig-align="center"}</span>
<span id="cb26-423"><a href="#cb26-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-426"><a href="#cb26-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-427"><a href="#cb26-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-428"><a href="#cb26-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Find samples with high uncertainty</span></span>
<span id="cb26-429"><a href="#cb26-429" aria-hidden="true" tabindex="-1"></a>new_samples_locations <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty_sampling</span>(</span>
<span id="cb26-430"><a href="#cb26-430" aria-hidden="true" tabindex="-1"></a>    <span class="at">uncert_cube =</span> cube_s2_uncertainty,</span>
<span id="cb26-431"><a href="#cb26-431" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">300</span>,</span>
<span id="cb26-432"><a href="#cb26-432" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_uncert =</span> <span class="fl">0.4</span>,</span>
<span id="cb26-433"><a href="#cb26-433" aria-hidden="true" tabindex="-1"></a>    <span class="at">sampling_window =</span> <span class="dv">10</span>) </span>
<span id="cb26-434"><a href="#cb26-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-435"><a href="#cb26-435" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize new training points</span></span>
<span id="cb26-436"><a href="#cb26-436" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_view</span>(new_samples_locations)</span>
<span id="cb26-437"><a href="#cb26-437" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(new_samples_locations, </span>
<span id="cb26-438"><a href="#cb26-438" aria-hidden="true" tabindex="-1"></a>    <span class="st">"./assets/samples/new_samples_location.gpkg"</span>)</span>
<span id="cb26-439"><a href="#cb26-439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-440"><a href="#cb26-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-443"><a href="#cb26-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-444"><a href="#cb26-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-445"><a href="#cb26-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-446"><a href="#cb26-446" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-447"><a href="#cb26-447" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-448"><a href="#cb26-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-449"><a href="#cb26-449" aria-hidden="true" tabindex="-1"></a>new_samples_locations <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"./assets/samples/new_samples_location.gpkg"</span>, <span class="at">quiet=</span>T)</span>
<span id="cb26-450"><a href="#cb26-450" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_view</span>(new_samples_locations)</span>
<span id="cb26-451"><a href="#cb26-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-452"><a href="#cb26-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-455"><a href="#cb26-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-456"><a href="#cb26-456" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-457"><a href="#cb26-457" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb26-458"><a href="#cb26-458" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract new spectral signatures</span></span>
<span id="cb26-459"><a href="#cb26-459" aria-hidden="true" tabindex="-1"></a>new_samples <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_get_data</span>(</span>
<span id="cb26-460"><a href="#cb26-460" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube =</span> cube_s2_reg,</span>
<span id="cb26-461"><a href="#cb26-461" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> new_samples_locations)</span>
<span id="cb26-462"><a href="#cb26-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-463"><a href="#cb26-463" aria-hidden="true" tabindex="-1"></a><span class="co">#new_samples$label &lt;- "Wetland"</span></span>
<span id="cb26-464"><a href="#cb26-464" aria-hidden="true" tabindex="-1"></a>new_samples_aligned <span class="ot">&lt;-</span> <span class="fu">sits_select</span>(<span class="at">data =</span> new_samples,</span>
<span id="cb26-465"><a href="#cb26-465" aria-hidden="true" tabindex="-1"></a>  <span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span>, </span>
<span id="cb26-466"><a href="#cb26-466" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"B07"</span>, <span class="st">"B08"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span>, <span class="st">"B8A"</span>))</span>
<span id="cb26-467"><a href="#cb26-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-468"><a href="#cb26-468" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with original samples</span></span>
<span id="cb26-469"><a href="#cb26-469" aria-hidden="true" tabindex="-1"></a>new_samples_merge <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb26-470"><a href="#cb26-470" aria-hidden="true" tabindex="-1"></a>    samples_deforestation_rondonia,</span>
<span id="cb26-471"><a href="#cb26-471" aria-hidden="true" tabindex="-1"></a>  new_samples_aligned)</span>
<span id="cb26-472"><a href="#cb26-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-473"><a href="#cb26-473" aria-hidden="true" tabindex="-1"></a><span class="co"># Train new model &amp; evaluate</span></span>
<span id="cb26-474"><a href="#cb26-474" aria-hidden="true" tabindex="-1"></a>model_randomForest_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_train</span>(</span>
<span id="cb26-475"><a href="#cb26-475" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> new_samples_merge, </span>
<span id="cb26-476"><a href="#cb26-476" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_method =</span> sits<span class="sc">::</span><span class="fu">sits_rfor</span>(<span class="at">num_trees =</span> <span class="dv">120</span>,<span class="at">mtry =</span> <span class="dv">10</span>))</span>
<span id="cb26-477"><a href="#cb26-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-478"><a href="#cb26-478" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify new cube</span></span>
<span id="cb26-479"><a href="#cb26-479" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify data cube</span></span>
<span id="cb26-480"><a href="#cb26-480" aria-hidden="true" tabindex="-1"></a>cube_s2_probs_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_classify</span>(</span>
<span id="cb26-481"><a href="#cb26-481" aria-hidden="true" tabindex="-1"></a>    <span class="at">data            =</span> cube_s2_reg,</span>
<span id="cb26-482"><a href="#cb26-482" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_model        =</span> model_randomForest_v2,</span>
<span id="cb26-483"><a href="#cb26-483" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/probs/"</span>,</span>
<span id="cb26-484"><a href="#cb26-484" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-1228-v2"</span>, <span class="co"># adds suffix to output filename</span></span>
<span id="cb26-485"><a href="#cb26-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb26-486"><a href="#cb26-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span></span>
<span id="cb26-487"><a href="#cb26-487" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-488"><a href="#cb26-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-489"><a href="#cb26-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive new uncertainty cube and compare</span></span>
<span id="cb26-490"><a href="#cb26-490" aria-hidden="true" tabindex="-1"></a>cube_s2_uncertainty_v2 <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_uncertainty</span>(</span>
<span id="cb26-491"><a href="#cb26-491" aria-hidden="true" tabindex="-1"></a>    cube_s2_probs_v2, </span>
<span id="cb26-492"><a href="#cb26-492" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"margin"</span>, </span>
<span id="cb26-493"><a href="#cb26-493" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">"./assets/images/uncertainty_v2/"</span>,</span>
<span id="cb26-494"><a href="#cb26-494" aria-hidden="true" tabindex="-1"></a>  <span class="at">multicores =</span> <span class="dv">4</span>,</span>
<span id="cb26-495"><a href="#cb26-495" aria-hidden="true" tabindex="-1"></a>  <span class="at">memsize =</span> <span class="dv">16</span>)</span>
<span id="cb26-496"><a href="#cb26-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-497"><a href="#cb26-497" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize side-by-side</span></span>
<span id="cb26-498"><a href="#cb26-498" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty, <span class="at">palette =</span> <span class="st">"Reds"</span>)</span>
<span id="cb26-499"><a href="#cb26-499" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_uncertainty_v2, <span class="at">palette =</span> <span class="st">"Oranges"</span>)</span>
<span id="cb26-500"><a href="#cb26-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-501"><a href="#cb26-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-502"><a href="#cb26-502" aria-hidden="true" tabindex="-1"></a>::: {#fig-entropy-b layout-ncol="2"}</span>
<span id="cb26-503"><a href="#cb26-503" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-l1.png)</span>{fig-align="center"} <span class="al">![](assets/images/png/activity-data-l2.png)</span>{fig-align="center"}</span>
<span id="cb26-504"><a href="#cb26-504" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-505"><a href="#cb26-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-508"><a href="#cb26-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-509"><a href="#cb26-509" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-510"><a href="#cb26-510" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for convergence (extract filepath first)</span></span>
<span id="cb26-511"><a href="#cb26-511" aria-hidden="true" tabindex="-1"></a>get_uncert_values <span class="ot">&lt;-</span> <span class="cf">function</span>(uncert_cube) {</span>
<span id="cb26-512"><a href="#cb26-512" aria-hidden="true" tabindex="-1"></a>  files <span class="ot">&lt;-</span> uncert_cube<span class="sc">$</span>file_info[[<span class="dv">1</span>]]<span class="sc">$</span>path</span>
<span id="cb26-513"><a href="#cb26-513" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(files)</span>
<span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">values</span>(r)</span>
<span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate statistics</span></span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a>uncert_v1_vals <span class="ot">&lt;-</span> <span class="fu">get_uncert_values</span>(cube_s2_uncertainty)</span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a>uncert_v2_vals <span class="ot">&lt;-</span> <span class="fu">get_uncert_values</span>(cube_s2_uncertainty_v2)</span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a>uncertainty_check <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration =</span> <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>),</span>
<span id="cb26-523"><a href="#cb26-523" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb26-524"><a href="#cb26-524" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(uncert_v1_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(uncert_v2_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(uncert_v1_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(uncert_v2_vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a>  <span class="at">pct_high_uncert =</span> <span class="fu">c</span>(</span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(uncert_v1_vals <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(uncert_v1_vals)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(uncert_v2_vals <span class="sc">&gt;</span> <span class="fl">0.4</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(uncert_v2_vals)) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(uncertainty_check, <span class="st">"./assets/samples/uncertainty_check.csv"</span>)</span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-539"><a href="#cb26-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-543"><a href="#cb26-543" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-544"><a href="#cb26-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-545"><a href="#cb26-545" aria-hidden="true" tabindex="-1"></a>uncertainty_check <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"assets/samples/uncertainty_check.csv"</span>) </span>
<span id="cb26-546"><a href="#cb26-546" aria-hidden="true" tabindex="-1"></a>uncertainty_check <span class="sc">|&gt;</span> </span>
<span id="cb26-547"><a href="#cb26-547" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">flextable</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-548"><a href="#cb26-548" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">autofit</span>()</span>
<span id="cb26-549"><a href="#cb26-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-550"><a href="#cb26-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-551"><a href="#cb26-551" aria-hidden="true" tabindex="-1"></a>Short class relabelling, the above method showcases an iterative revision workflow typically used to integrate new samples and retrain models until uncertainty stabilizes. For ART-TREES compliance, uncertainty reduction directly decreases activity data deductions and simplifies third-party verification.</span>
<span id="cb26-552"><a href="#cb26-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-553"><a href="#cb26-553" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hierarchical Clustering</span></span>
<span id="cb26-554"><a href="#cb26-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-555"><a href="#cb26-555" aria-hidden="true" tabindex="-1"></a>We implement below two clustering approaches for evaluating training data quality: Agglomerative Hierarchical Clustering <span class="co">[</span><span class="ot">@yao2016application, AHC</span><span class="co">]</span> for datasets under 10,000 samples, and Self-Organizing Maps (SOM) for larger collections <span class="co">[</span><span class="ot">@neagoe2014concurrent; @gonccalves2008unsupervised</span><span class="co">]</span>. AHC has computational complexity of $\mathcal{O}(n^2)$ requiring substantial memory, while SOM scales linearly, making it preferable for operational REDD+ monitoring systems.</span>
<span id="cb26-556"><a href="#cb26-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-557"><a href="#cb26-557" aria-hidden="true" tabindex="-1"></a>Hierarchical Clustering computes dissimilarity between samples using dynamic time warping (DTW), which reliably measures differences in satellite time series <span class="co">[</span><span class="ot">@petitjean2012satellite; @maus2019dtwsat</span><span class="co">]</span>. The <span class="in">`sits_cluster_dendro()`</span> function generates dendrograms that reveal sample groupings and potential mislabeling:</span>
<span id="cb26-558"><a href="#cb26-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-561"><a href="#cb26-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-562"><a href="#cb26-562" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-563"><a href="#cb26-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-564"><a href="#cb26-564" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster samples using DTW distance and Ward linkage</span></span>
<span id="cb26-565"><a href="#cb26-565" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cluster_dendro</span>(</span>
<span id="cb26-566"><a href="#cb26-566" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> training_samples_with_indices, </span>
<span id="cb26-567"><a href="#cb26-567" aria-hidden="true" tabindex="-1"></a>    <span class="at">bands =</span> <span class="fu">c</span>(<span class="st">"NDVI"</span>, <span class="st">"EVI"</span>),</span>
<span id="cb26-568"><a href="#cb26-568" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist_method =</span> <span class="st">"dtw_basic"</span>,</span>
<span id="cb26-569"><a href="#cb26-569" aria-hidden="true" tabindex="-1"></a>    <span class="at">linkage =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb26-570"><a href="#cb26-570" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-571"><a href="#cb26-571" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine cluster composition</span></span>
<span id="cb26-572"><a href="#cb26-572" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_cluster_frequency</span>(clusters)</span>
<span id="cb26-573"><a href="#cb26-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-574"><a href="#cb26-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-575"><a href="#cb26-575" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-g.png)</span>{fig-align="center"}</span>
<span id="cb26-576"><a href="#cb26-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-577"><a href="#cb26-577" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb26-578"><a href="#cb26-578" aria-hidden="true" tabindex="-1"></a><span class="in">                           1    2    3    4    5    6    7 Total</span></span>
<span id="cb26-579"><a href="#cb26-579" aria-hidden="true" tabindex="-1"></a><span class="in">  Clear_Cut_Bare_Soil    121    9  104  705    5    0    0   944</span></span>
<span id="cb26-580"><a href="#cb26-580" aria-hidden="true" tabindex="-1"></a><span class="in">  Clear_Cut_Burned_Area   79    5   23  874    0    0    2   983</span></span>
<span id="cb26-581"><a href="#cb26-581" aria-hidden="true" tabindex="-1"></a><span class="in">  Clear_Cut_Vegetation   259  164   43  103    0    0   34   603</span></span>
<span id="cb26-582"><a href="#cb26-582" aria-hidden="true" tabindex="-1"></a><span class="in">  Forest                 174  732    5    6    0    0   47   964</span></span>
<span id="cb26-583"><a href="#cb26-583" aria-hidden="true" tabindex="-1"></a><span class="in">  Mountainside_Forest     12  145    2    0    0    0   52   211</span></span>
<span id="cb26-584"><a href="#cb26-584" aria-hidden="true" tabindex="-1"></a><span class="in">  Riparian_Forest         39  327   11    6    0    0  864  1247</span></span>
<span id="cb26-585"><a href="#cb26-585" aria-hidden="true" tabindex="-1"></a><span class="in">  Seasonally_Flooded     414   94  160   25   29    0    9   731</span></span>
<span id="cb26-586"><a href="#cb26-586" aria-hidden="true" tabindex="-1"></a><span class="in">  Water                    0    0    1    2    2  104    0   109</span></span>
<span id="cb26-587"><a href="#cb26-587" aria-hidden="true" tabindex="-1"></a><span class="in">  Wetland                 56    1   55   19   53   31    0   215</span></span>
<span id="cb26-588"><a href="#cb26-588" aria-hidden="true" tabindex="-1"></a><span class="in">  Total                 1154 1477  404 1740   89  135 1008  6007</span></span>
<span id="cb26-589"><a href="#cb26-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-590"><a href="#cb26-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-591"><a href="#cb26-591" aria-hidden="true" tabindex="-1"></a>The adjusted rand index (ARI) identifies optimal cluster count <span class="co">[</span><span class="ot">@rand1971objective</span><span class="co">]</span>. Clusters with mixed labels indicate either:</span>
<span id="cb26-592"><a href="#cb26-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-593"><a href="#cb26-593" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>mislabeled samples requiring removal,</span>
<span id="cb26-594"><a href="#cb26-594" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>spectral confusion between classes,</span>
<span id="cb26-595"><a href="#cb26-595" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>natural variability in land cover signatures. s</span>
<span id="cb26-596"><a href="#cb26-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-597"><a href="#cb26-597" aria-hidden="true" tabindex="-1"></a>The <span class="in">`sits_cluster_clean()`</span> function removes minority labels within clusters, retaining only dominant classes to reduce training noise.</span>
<span id="cb26-598"><a href="#cb26-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-599"><a href="#cb26-599" aria-hidden="true" tabindex="-1"></a>Self-Organizing Maps provide efficient quality assessment for large datasets through unsupervised learning that projects high-dimensional time series onto 2D grids. The <span class="in">`sits_som_map()`</span> function identifies outliers and evaluates class separability:</span>
<span id="cb26-600"><a href="#cb26-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-603"><a href="#cb26-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-604"><a href="#cb26-604" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-605"><a href="#cb26-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-606"><a href="#cb26-606" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove cluster#5 from the samples</span></span>
<span id="cb26-607"><a href="#cb26-607" aria-hidden="true" tabindex="-1"></a>clusters_new <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(clusters, cluster <span class="sc">!=</span> <span class="dv">5</span>)</span>
<span id="cb26-608"><a href="#cb26-608" aria-hidden="true" tabindex="-1"></a>clusters_clean <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_cluster_clean</span>(clusters_new)</span>
<span id="cb26-609"><a href="#cb26-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-610"><a href="#cb26-610" aria-hidden="true" tabindex="-1"></a><span class="co"># Check clusters samples frequency</span></span>
<span id="cb26-611"><a href="#cb26-611" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_cluster_frequency</span>(clusters_clean)</span>
<span id="cb26-612"><a href="#cb26-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-613"><a href="#cb26-613" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate SOM with optimal grid dimensions</span></span>
<span id="cb26-614"><a href="#cb26-614" aria-hidden="true" tabindex="-1"></a>som_map <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_map</span>(</span>
<span id="cb26-615"><a href="#cb26-615" aria-hidden="true" tabindex="-1"></a>    training_samples_with_indices, </span>
<span id="cb26-616"><a href="#cb26-616" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid_xdim =</span> <span class="dv">10</span>, </span>
<span id="cb26-617"><a href="#cb26-617" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid_ydim =</span> <span class="dv">10</span>)</span>
<span id="cb26-618"><a href="#cb26-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-619"><a href="#cb26-619" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean samples by removing mixed neurons</span></span>
<span id="cb26-620"><a href="#cb26-620" aria-hidden="true" tabindex="-1"></a>samples_clean <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_clean_samples</span>(som_map)</span>
<span id="cb26-621"><a href="#cb26-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-622"><a href="#cb26-622" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize sample clustering &amp; class confusions</span></span>
<span id="cb26-623"><a href="#cb26-623" aria-hidden="true" tabindex="-1"></a>som_eval <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_evaluate_cluster</span>(som_map)</span>
<span id="cb26-624"><a href="#cb26-624" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval)</span>
<span id="cb26-625"><a href="#cb26-625" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_map)</span>
<span id="cb26-626"><a href="#cb26-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-627"><a href="#cb26-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-628"><a href="#cb26-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-629"><a href="#cb26-629" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb26-630"><a href="#cb26-630" aria-hidden="true" tabindex="-1"></a><span class="in">                         1  2  3  4 Total</span></span>
<span id="cb26-631"><a href="#cb26-631" aria-hidden="true" tabindex="-1"></a><span class="in">  Clear_Cut_Burned_Area  0  5  0  0     5</span></span>
<span id="cb26-632"><a href="#cb26-632" aria-hidden="true" tabindex="-1"></a><span class="in">  Forest                 0  0  0  6     6</span></span>
<span id="cb26-633"><a href="#cb26-633" aria-hidden="true" tabindex="-1"></a><span class="in">  Mountainside_Forest   12  0  2  0    14</span></span>
<span id="cb26-634"><a href="#cb26-634" aria-hidden="true" tabindex="-1"></a><span class="in">  Total                 12  5  2  6    25</span></span>
<span id="cb26-635"><a href="#cb26-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-636"><a href="#cb26-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-637"><a href="#cb26-637" aria-hidden="true" tabindex="-1"></a>::: {layout-ncol="2"}</span>
<span id="cb26-638"><a href="#cb26-638" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-h1.png)</span>{#fig-som-a}</span>
<span id="cb26-639"><a href="#cb26-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-640"><a href="#cb26-640" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-h2.png)</span>{#fig-som-freq}</span>
<span id="cb26-641"><a href="#cb26-641" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-642"><a href="#cb26-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-643"><a href="#cb26-643" aria-hidden="true" tabindex="-1"></a>Neurons containing multiple classes reveal spectral overlap requiring investigation. The SOM-based cleaning removes samples from mixed neurons, improving class separability while preserving within-class variability essential for generalization.</span>
<span id="cb26-644"><a href="#cb26-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-645"><a href="#cb26-645" aria-hidden="true" tabindex="-1"></a><span class="fu">### Class Imbalances</span></span>
<span id="cb26-646"><a href="#cb26-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-647"><a href="#cb26-647" aria-hidden="true" tabindex="-1"></a>Imbalanced training sets—where some classes have many more samples than others—bias classifiers toward over-represented classes, inflating omission errors for rare forest types. The <span class="in">`sits_reduce_imbalance()`</span> function implements under-sampling and over-sampling strategies:</span>
<span id="cb26-648"><a href="#cb26-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-651"><a href="#cb26-651" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-652"><a href="#cb26-652" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-653"><a href="#cb26-653" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance samples across classes</span></span>
<span id="cb26-654"><a href="#cb26-654" aria-hidden="true" tabindex="-1"></a>samples_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_reduce_imbalance</span>(</span>
<span id="cb26-655"><a href="#cb26-655" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> training_samples_with_indices,</span>
<span id="cb26-656"><a href="#cb26-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_samples_over =</span> <span class="dv">200</span>,   <span class="co"># Oversample rare classes</span></span>
<span id="cb26-657"><a href="#cb26-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_samples_under =</span> <span class="dv">400</span>,  <span class="co"># Undersample common classes</span></span>
<span id="cb26-658"><a href="#cb26-658" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores =</span> <span class="dv">4</span>)</span>
<span id="cb26-659"><a href="#cb26-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-660"><a href="#cb26-660" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-evaluate using SOM clustering</span></span>
<span id="cb26-661"><a href="#cb26-661" aria-hidden="true" tabindex="-1"></a>som_map_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_map</span>(</span>
<span id="cb26-662"><a href="#cb26-662" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> samples_balanced,</span>
<span id="cb26-663"><a href="#cb26-663" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid_xdim =</span> <span class="dv">10</span>,</span>
<span id="cb26-664"><a href="#cb26-664" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid_ydim =</span> <span class="dv">10</span>,</span>
<span id="cb26-665"><a href="#cb26-665" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">1.0</span>,</span>
<span id="cb26-666"><a href="#cb26-666" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance =</span> <span class="st">"dtw"</span>,</span>
<span id="cb26-667"><a href="#cb26-667" aria-hidden="true" tabindex="-1"></a>    <span class="at">rlen =</span> <span class="dv">20</span>)</span>
<span id="cb26-668"><a href="#cb26-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-669"><a href="#cb26-669" aria-hidden="true" tabindex="-1"></a><span class="co"># Store estimates in tibble</span></span>
<span id="cb26-670"><a href="#cb26-670" aria-hidden="true" tabindex="-1"></a>som_eval_balanced <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_som_evaluate_cluster</span>(</span>
<span id="cb26-671"><a href="#cb26-671" aria-hidden="true" tabindex="-1"></a>    som_map_balanced)</span>
<span id="cb26-672"><a href="#cb26-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-673"><a href="#cb26-673" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize results</span></span>
<span id="cb26-674"><a href="#cb26-674" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval) </span>
<span id="cb26-675"><a href="#cb26-675" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(som_eval_balanced) </span>
<span id="cb26-676"><a href="#cb26-676" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(samples_balanced)</span>
<span id="cb26-677"><a href="#cb26-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-678"><a href="#cb26-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-679"><a href="#cb26-679" aria-hidden="true" tabindex="-1"></a>::: {layout-ncol="2"}</span>
<span id="cb26-680"><a href="#cb26-680" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-i1.png)</span>{#fig-som-b}</span>
<span id="cb26-681"><a href="#cb26-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-682"><a href="#cb26-682" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-h1.png)</span>{#fig-som-c}</span>
<span id="cb26-683"><a href="#cb26-683" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-684"><a href="#cb26-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-685"><a href="#cb26-685" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb26-686"><a href="#cb26-686" aria-hidden="true" tabindex="-1"></a><span class="in"># A tibble: 9 × 3</span></span>
<span id="cb26-687"><a href="#cb26-687" aria-hidden="true" tabindex="-1"></a><span class="in">  label                 count   prop</span></span>
<span id="cb26-688"><a href="#cb26-688" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;chr&gt;                 &lt;int&gt;  &lt;dbl&gt;</span></span>
<span id="cb26-689"><a href="#cb26-689" aria-hidden="true" tabindex="-1"></a><span class="in">1 Clear_Cut_Bare_Soil     400 0.134 </span></span>
<span id="cb26-690"><a href="#cb26-690" aria-hidden="true" tabindex="-1"></a><span class="in">2 Clear_Cut_Burned_Area   388 0.130 </span></span>
<span id="cb26-691"><a href="#cb26-691" aria-hidden="true" tabindex="-1"></a><span class="in">3 Clear_Cut_Vegetation    392 0.131 </span></span>
<span id="cb26-692"><a href="#cb26-692" aria-hidden="true" tabindex="-1"></a><span class="in">4 Forest                  400 0.134 </span></span>
<span id="cb26-693"><a href="#cb26-693" aria-hidden="true" tabindex="-1"></a><span class="in">5 Mountainside_Forest     211 0.0707</span></span>
<span id="cb26-694"><a href="#cb26-694" aria-hidden="true" tabindex="-1"></a><span class="in">6 Riparian_Forest         396 0.133 </span></span>
<span id="cb26-695"><a href="#cb26-695" aria-hidden="true" tabindex="-1"></a><span class="in">7 Seasonally_Flooded      384 0.129 </span></span>
<span id="cb26-696"><a href="#cb26-696" aria-hidden="true" tabindex="-1"></a><span class="in">8 Water                   200 0.0670</span></span>
<span id="cb26-697"><a href="#cb26-697" aria-hidden="true" tabindex="-1"></a><span class="in">9 Wetland                 215 0.0720</span></span>
<span id="cb26-698"><a href="#cb26-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-699"><a href="#cb26-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-700"><a href="#cb26-700" aria-hidden="true" tabindex="-1"></a>Under-sampling randomly removes samples from majority classes to match minority class frequencies, reducing computational load but discarding potentially informative data. Over-sampling uses SMOTE <span class="co">[</span><span class="ot">Synthetic Minority Over-sampling Technique; @smotefamily; @DMwR</span><span class="co">]</span> to generate synthetic samples for rare classes, improving classifier sensitivity without losing real observations. For REDD+ applications, maintaining adequate representation of degraded forest classes often requires combined strategies.</span>
<span id="cb26-701"><a href="#cb26-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-702"><a href="#cb26-702" aria-hidden="true" tabindex="-1"></a><span class="fu">### Geographic Variance</span></span>
<span id="cb26-703"><a href="#cb26-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-704"><a href="#cb26-704" aria-hidden="true" tabindex="-1"></a>Training samples must capture spatial variability across jurisdictions. Clustered sampling creates geographic gaps where model predictions have higher uncertainty <span class="co">[</span><span class="ot">@meyer2022machine</span><span class="co">]</span>. The <span class="in">`sits_geo_dist()`</span> function compares sample-to-sample distances against prediction-location-to-sample distances:</span>
<span id="cb26-705"><a href="#cb26-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-708"><a href="#cb26-708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-709"><a href="#cb26-709" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-710"><a href="#cb26-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-711"><a href="#cb26-711" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive jurisdiction boundary</span></span>
<span id="cb26-712"><a href="#cb26-712" aria-hidden="true" tabindex="-1"></a>bbox_cube <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_bbox</span>(cube_s2_reg) </span>
<span id="cb26-713"><a href="#cb26-713" aria-hidden="true" tabindex="-1"></a>bbox_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(</span>
<span id="cb26-714"><a href="#cb26-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">xmin =</span> aoi<span class="sc">$</span>xmin, </span>
<span id="cb26-715"><a href="#cb26-715" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> aoi<span class="sc">$</span>ymin, </span>
<span id="cb26-716"><a href="#cb26-716" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> aoi<span class="sc">$</span>xmax, </span>
<span id="cb26-717"><a href="#cb26-717" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> aoi<span class="sc">$</span>ymax),</span>
<span id="cb26-718"><a href="#cb26-718" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(aoi<span class="sc">$</span>crs))</span>
<span id="cb26-719"><a href="#cb26-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-720"><a href="#cb26-720" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sf </span></span>
<span id="cb26-721"><a href="#cb26-721" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(sf<span class="sc">::</span><span class="fu">st_as_sfc</span>(bbox_sf))</span>
<span id="cb26-722"><a href="#cb26-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-723"><a href="#cb26-723" aria-hidden="true" tabindex="-1"></a><span class="co"># Assess geographic coverage</span></span>
<span id="cb26-724"><a href="#cb26-724" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_geo_dist</span>(</span>
<span id="cb26-725"><a href="#cb26-725" aria-hidden="true" tabindex="-1"></a>    training_samples_with_indices, <span class="at">roi =</span> aoi)</span>
<span id="cb26-726"><a href="#cb26-726" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(distances)</span>
<span id="cb26-727"><a href="#cb26-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-728"><a href="#cb26-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-729"><a href="#cb26-729" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-j.png)</span>{fig-align="center"}</span>
<span id="cb26-730"><a href="#cb26-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-731"><a href="#cb26-731" aria-hidden="true" tabindex="-1"></a>Mismatched distributions indicate insufficient spatial coverage. Areas with few nearby training samples will exhibit higher classification uncertainty, requiring either additional field sampling or explicit uncertainty quantification in those regions during accuracy assessment.</span>
<span id="cb26-732"><a href="#cb26-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-733"><a href="#cb26-733" aria-hidden="true" tabindex="-1"></a><span class="fu">### Noise Filtering</span></span>
<span id="cb26-734"><a href="#cb26-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-735"><a href="#cb26-735" aria-hidden="true" tabindex="-1"></a>Atmospheric contamination and sensor artifacts introduce noise requiring smoothing before feature extraction. The package supports Savitzky-Golay (<span class="in">`sits_sgolay()`</span>) and Whittaker (<span class="in">`sits_whittaker()`</span>) filters. Both methods reduce noise while preserving phenological patterns:</span>
<span id="cb26-736"><a href="#cb26-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-739"><a href="#cb26-739" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-740"><a href="#cb26-740" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-741"><a href="#cb26-741" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Whittaker filter with conservative smoothing</span></span>
<span id="cb26-742"><a href="#cb26-742" aria-hidden="true" tabindex="-1"></a>samples_balanced_ndvi <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_select</span>(</span>
<span id="cb26-743"><a href="#cb26-743" aria-hidden="true" tabindex="-1"></a>    samples_balanced, <span class="at">bands =</span> <span class="st">"NDVI"</span>)</span>
<span id="cb26-744"><a href="#cb26-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-745"><a href="#cb26-745" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Whitakker filter</span></span>
<span id="cb26-746"><a href="#cb26-746" aria-hidden="true" tabindex="-1"></a>samples_balanced_whit <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_whittaker</span>(</span>
<span id="cb26-747"><a href="#cb26-747" aria-hidden="true" tabindex="-1"></a>    samples_balanced_ndvi, <span class="at">lambda =</span> <span class="fl">0.5</span>)</span>
<span id="cb26-748"><a href="#cb26-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-749"><a href="#cb26-749" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge to visualize</span></span>
<span id="cb26-750"><a href="#cb26-750" aria-hidden="true" tabindex="-1"></a>sits<span class="sc">::</span><span class="fu">sits_merge</span>(</span>
<span id="cb26-751"><a href="#cb26-751" aria-hidden="true" tabindex="-1"></a>    samples_balanced_ndvi, </span>
<span id="cb26-752"><a href="#cb26-752" aria-hidden="true" tabindex="-1"></a>    samples_balanced_whit,</span>
<span id="cb26-753"><a href="#cb26-753" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">".WHIT"</span>)) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb26-754"><a href="#cb26-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-755"><a href="#cb26-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-756"><a href="#cb26-756" aria-hidden="true" tabindex="-1"></a>::: {layout-ncol="4"}</span>
<span id="cb26-757"><a href="#cb26-757" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k1a.png)</span></span>
<span id="cb26-758"><a href="#cb26-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-759"><a href="#cb26-759" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k1b.png)</span></span>
<span id="cb26-760"><a href="#cb26-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-761"><a href="#cb26-761" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k2a.png)</span></span>
<span id="cb26-762"><a href="#cb26-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-763"><a href="#cb26-763" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k2b.png)</span></span>
<span id="cb26-764"><a href="#cb26-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-765"><a href="#cb26-765" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k3a.png)</span></span>
<span id="cb26-766"><a href="#cb26-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-767"><a href="#cb26-767" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k3b.png)</span></span>
<span id="cb26-768"><a href="#cb26-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-769"><a href="#cb26-769" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k4a.png)</span></span>
<span id="cb26-770"><a href="#cb26-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-771"><a href="#cb26-771" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k4b.png)</span></span>
<span id="cb26-772"><a href="#cb26-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-773"><a href="#cb26-773" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k5a.png)</span></span>
<span id="cb26-774"><a href="#cb26-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-775"><a href="#cb26-775" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k5b.png)</span></span>
<span id="cb26-776"><a href="#cb26-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-777"><a href="#cb26-777" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k6a.png)</span></span>
<span id="cb26-778"><a href="#cb26-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-779"><a href="#cb26-779" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k6b.png)</span></span>
<span id="cb26-780"><a href="#cb26-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-781"><a href="#cb26-781" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k7a.png)</span></span>
<span id="cb26-782"><a href="#cb26-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-783"><a href="#cb26-783" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k7b.png)</span></span>
<span id="cb26-784"><a href="#cb26-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-785"><a href="#cb26-785" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k8a.png)</span></span>
<span id="cb26-786"><a href="#cb26-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-787"><a href="#cb26-787" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/images/png/activity-data-k8b.png)</span></span>
<span id="cb26-788"><a href="#cb26-788" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-789"><a href="#cb26-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-790"><a href="#cb26-790" aria-hidden="true" tabindex="-1"></a>Over-smoothing (high lambda values) eliminates legitimate phenological variation, reducing model discriminatory power. Conservative filtering (lambda ≤ 1.0) balances noise reduction with pattern preservation <span class="co">[</span><span class="ot">@Atkinson2012; @Zhou2016</span><span class="co">]</span>.</span>
<span id="cb26-791"><a href="#cb26-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-792"><a href="#cb26-792" aria-hidden="true" tabindex="-1"></a>Integration with Uncertainty Workflows: Quality-controlled training data directly reduces classification uncertainty by minimizing systematic errors from mislabeling and improving model generalization. Combined with the cross-validation procedures in Section 3.8 and accuracy assessment in Section 3.9, these enhancement methods establish a rigorous foundation for defensible activity data uncertainty quantification under ART-TREES requirements.</span>
<span id="cb26-793"><a href="#cb26-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-794"><a href="#cb26-794" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.8 Smooth Data Cube</span></span>
<span id="cb26-795"><a href="#cb26-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-796"><a href="#cb26-796" aria-hidden="true" tabindex="-1"></a>Pixel-based classification inherently produces salt-and-pepper noise due to within-class spectral variability and mixed pixels. Isolated misclassified pixels, such as outliers surrounded by different classes, represent systematic over-fitting to training data rather than true landscape heterogeneity. For REDD+ applications, these artifacts inflate area uncertainty and complicate change detection. To address this, the <span class="in">`sits_smooth()`</span> function implements Bayesian post-processing that incorporates spatial context from neighboring pixels to refine probability estimates. The smoothing process:</span>
<span id="cb26-797"><a href="#cb26-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-798"><a href="#cb26-798" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Computes spatially-weighted probability adjustments based on neighborhood composition</span>
<span id="cb26-799"><a href="#cb26-799" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Updates pixel probabilities using Bayesian inference combining original estimates with spatial priors</span>
<span id="cb26-800"><a href="#cb26-800" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Produces refined probability cube with reduced outlier effect while preserving legitimate small patches</span>
<span id="cb26-801"><a href="#cb26-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-804"><a href="#cb26-804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-805"><a href="#cb26-805" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-806"><a href="#cb26-806" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-807"><a href="#cb26-807" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-808"><a href="#cb26-808" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb26-809"><a href="#cb26-809" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb26-810"><a href="#cb26-810" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-811"><a href="#cb26-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-812"><a href="#cb26-812" aria-hidden="true" tabindex="-1"></a><span class="co"># Bayesian smoothing </span></span>
<span id="cb26-813"><a href="#cb26-813" aria-hidden="true" tabindex="-1"></a>cube_s2_bayes <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_smooth</span>(</span>
<span id="cb26-814"><a href="#cb26-814" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube            =</span> cube_s2_probs,</span>
<span id="cb26-815"><a href="#cb26-815" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/bayes/"</span>,</span>
<span id="cb26-816"><a href="#cb26-816" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-raster"</span>, <span class="co"># adds suffix to output raster</span></span>
<span id="cb26-817"><a href="#cb26-817" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb26-818"><a href="#cb26-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span></span>
<span id="cb26-819"><a href="#cb26-819" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-820"><a href="#cb26-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-821"><a href="#cb26-821" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_bayes, </span>
<span id="cb26-822"><a href="#cb26-822" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Forest"</span>), </span>
<span id="cb26-823"><a href="#cb26-823" aria-hidden="true" tabindex="-1"></a>         <span class="at">palette =</span> <span class="st">"YlGn"</span></span>
<span id="cb26-824"><a href="#cb26-824" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb26-825"><a href="#cb26-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-826"><a href="#cb26-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-827"><a href="#cb26-827" aria-hidden="true" tabindex="-1"></a><span class="al">![Smoothed probability map for class `Forest`.](assets/images/png/activity-data-e.png)</span>{fig-align="center"}</span>
<span id="cb26-828"><a href="#cb26-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-829"><a href="#cb26-829" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb26-830"><a href="#cb26-830" aria-hidden="true" tabindex="-1"></a><span class="fu">## Smoothing Risks</span></span>
<span id="cb26-831"><a href="#cb26-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-832"><a href="#cb26-832" aria-hidden="true" tabindex="-1"></a>Spatial smoothing affects activity data uncertainty in competing directions:</span>
<span id="cb26-833"><a href="#cb26-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-834"><a href="#cb26-834" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Reduces random error: Eliminates isolated misclassifications that inflate variance</span>
<span id="cb26-835"><a href="#cb26-835" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Introduces spatial bias: May smooth over legitimate small-scale heterogeneity</span>
<span id="cb26-836"><a href="#cb26-836" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Improves validation agreement: Better alignment with typical human interpretation scales</span>
<span id="cb26-837"><a href="#cb26-837" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Modifies probability distributions: Changes the shape of pixel-level uncertainty estimates</span>
<span id="cb26-838"><a href="#cb26-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-839"><a href="#cb26-839" aria-hidden="true" tabindex="-1"></a>For REDD+ reporting, smoothed probability cubes typically yield lower reported uncertainties due to reduced classification noise, but verification bodies may require documentation of smoothing parameters demonstrating methodological choices.</span>
<span id="cb26-840"><a href="#cb26-840" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-841"><a href="#cb26-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-842"><a href="#cb26-842" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-843"><a href="#cb26-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-844"><a href="#cb26-844" aria-hidden="true" tabindex="-1"></a>Final classified maps are derived from smoothed probability cubes through maximum likelihood labeling: each pixel is assigned the class with highest posterior probability. The <span class="in">`sits_label_classification()`</span> function performs this deterministic assignment while maintaining provenance links to underlying probability distributions.</span>
<span id="cb26-845"><a href="#cb26-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-848"><a href="#cb26-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-849"><a href="#cb26-849" aria-hidden="true" tabindex="-1"></a><span class="co">#| comment: NA</span></span>
<span id="cb26-850"><a href="#cb26-850" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb26-851"><a href="#cb26-851" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-852"><a href="#cb26-852" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb26-853"><a href="#cb26-853" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false </span></span>
<span id="cb26-854"><a href="#cb26-854" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-855"><a href="#cb26-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-856"><a href="#cb26-856" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive lulc-classified raster</span></span>
<span id="cb26-857"><a href="#cb26-857" aria-hidden="true" tabindex="-1"></a>cube_s2_lulc <span class="ot">&lt;-</span> sits<span class="sc">::</span><span class="fu">sits_label_classification</span>(</span>
<span id="cb26-858"><a href="#cb26-858" aria-hidden="true" tabindex="-1"></a>    <span class="at">cube                =</span> cube_s2_bayes,</span>
<span id="cb26-859"><a href="#cb26-859" aria-hidden="true" tabindex="-1"></a>    <span class="at">multicores  =</span> <span class="dv">4</span>,</span>
<span id="cb26-860"><a href="#cb26-860" aria-hidden="true" tabindex="-1"></a>    <span class="at">memsize         =</span> <span class="dv">16</span>,</span>
<span id="cb26-861"><a href="#cb26-861" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir  =</span> <span class="st">"./assets/images/classified/"</span>,</span>
<span id="cb26-862"><a href="#cb26-862" aria-hidden="true" tabindex="-1"></a>    <span class="at">version         =</span> <span class="st">"rf-raster"</span></span>
<span id="cb26-863"><a href="#cb26-863" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-864"><a href="#cb26-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-865"><a href="#cb26-865" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb26-866"><a href="#cb26-866" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_s2_lulc, <span class="at">legend_text_size =</span> <span class="fl">0.7</span>)</span>
<span id="cb26-867"><a href="#cb26-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-868"><a href="#cb26-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-869"><a href="#cb26-869" aria-hidden="true" tabindex="-1"></a><span class="al">![Classified cube obtained by Random Forest model.](assets/images/png/activity-data-f.png)</span></span>
<span id="cb26-870"><a href="#cb26-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-871"><a href="#cb26-871" aria-hidden="true" tabindex="-1"></a>The classified cube produced by <span class="in">`sits`</span> workflows provides the activity data foundation for REDD+ accounting, but uncertainty quantification requires additional analysis beyond the discrete classification procedures. Sections 3.2-3.5 demonstrate more more advanced operations using <span class="in">`caret`</span> <span class="co">[</span><span class="ot">@kuhn2011caret</span><span class="co">]</span>, <span class="in">`ForestToolbox`</span> <span class="co">[</span><span class="ot">@ForesToolboxRS</span><span class="co">]</span>, and <span class="in">`terra`</span> packages <span class="co">[</span><span class="ot">@terra-2</span><span class="co">]</span> required to:</span>
<span id="cb26-872"><a href="#cb26-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-873"><a href="#cb26-873" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Extract pixel-level probability distributions for Monte Carlo sampling (Section 3.3)</span>
<span id="cb26-874"><a href="#cb26-874" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Implement stratified validation with area-adjusted accuracy assessment (Section 3.4)</span>
<span id="cb26-875"><a href="#cb26-875" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Calibrate Random Forest hyperparameters through iterative uncertainty minimization (Section 3.5)</span>
<span id="cb26-876"><a href="#cb26-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-877"><a href="#cb26-877" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb26-878"><a href="#cb26-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-879"><a href="#cb26-879" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.8 Cross-Validation</span></span>
<span id="cb26-880"><a href="#cb26-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-881"><a href="#cb26-881" aria-hidden="true" tabindex="-1"></a>Cross-validation quantifies model generalization capacity by partitioning training data into independent subsets for iterative testing. This section demonstrates <span class="in">`caret`</span>-based validation approaches for uncertainty assessment aligned with ART-TREES requirements.</span>
<span id="cb26-882"><a href="#cb26-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-883"><a href="#cb26-883" aria-hidden="true" tabindex="-1"></a>Extract statistical summaries from <span class="in">`sits`</span> time series for <span class="in">`caret`</span> compatibility:</span>
<span id="cb26-884"><a href="#cb26-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-887"><a href="#cb26-887" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-888"><a href="#cb26-888" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb26-889"><a href="#cb26-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-890"><a href="#cb26-890" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract features from cube samples</span></span>
<span id="cb26-891"><a href="#cb26-891" aria-hidden="true" tabindex="-1"></a>extract_features <span class="ot">&lt;-</span> <span class="cf">function</span>(sits_samples) {</span>
<span id="cb26-892"><a href="#cb26-892" aria-hidden="true" tabindex="-1"></a>  features_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sits_samples), <span class="cf">function</span>(i) {</span>
<span id="cb26-893"><a href="#cb26-893" aria-hidden="true" tabindex="-1"></a>    ts <span class="ot">&lt;-</span> sits_samples<span class="sc">$</span>time_series[[i]]</span>
<span id="cb26-894"><a href="#cb26-894" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb26-895"><a href="#cb26-895" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> sits_samples<span class="sc">$</span>label[i],</span>
<span id="cb26-896"><a href="#cb26-896" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_B8A =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>B8A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-897"><a href="#cb26-897" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_B8A =</span> <span class="fu">sd</span>(ts<span class="sc">$</span>B8A, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-898"><a href="#cb26-898" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_B11 =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>B11, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-899"><a href="#cb26-899" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_B11 =</span> <span class="fu">sd</span>(ts<span class="sc">$</span>B11, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-900"><a href="#cb26-900" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_NDVI =</span> <span class="fu">mean</span>((ts<span class="sc">$</span>B8A <span class="sc">-</span> ts<span class="sc">$</span>B04) <span class="sc">/</span> (ts<span class="sc">$</span>B8A <span class="sc">+</span> ts<span class="sc">$</span>B04), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-901"><a href="#cb26-901" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_NDVI =</span> <span class="fu">sd</span>((ts<span class="sc">$</span>B8A <span class="sc">-</span> ts<span class="sc">$</span>B04) <span class="sc">/</span> (ts<span class="sc">$</span>B8A <span class="sc">+</span> ts<span class="sc">$</span>B04), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-902"><a href="#cb26-902" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-903"><a href="#cb26-903" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb26-904"><a href="#cb26-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, features_list)</span>
<span id="cb26-905"><a href="#cb26-905" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-906"><a href="#cb26-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-907"><a href="#cb26-907" aria-hidden="true" tabindex="-1"></a>train_features <span class="ot">&lt;-</span> <span class="fu">extract_features</span>(samples_deforestation_rondonia)</span>
<span id="cb26-908"><a href="#cb26-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-909"><a href="#cb26-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-910"><a href="#cb26-910" aria-hidden="true" tabindex="-1"></a><span class="fu">### Monte Carlo Cross-Validation</span></span>
<span id="cb26-911"><a href="#cb26-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-912"><a href="#cb26-912" aria-hidden="true" tabindex="-1"></a>In the following, we implement a Monte Carlo training simulation for robust uncertainty and stability metrics across repeated random partitions. For demonstration purposes, this simulation is fitted with only 10 iterations. We recommend increasing this to 10,000 iterations to meet ART-TREES requirements :</span>
<span id="cb26-913"><a href="#cb26-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-916"><a href="#cb26-916" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-917"><a href="#cb26-917" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb26-918"><a href="#cb26-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-919"><a href="#cb26-919" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure Monte Carlo simulation</span></span>
<span id="cb26-920"><a href="#cb26-920" aria-hidden="true" tabindex="-1"></a>mc_simulation <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(</span>
<span id="cb26-921"><a href="#cb26-921" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"LGOCV"</span>,</span>
<span id="cb26-922"><a href="#cb26-922" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>, <span class="co"># Increase to 10,000 iterations for ART-TREES submissions</span></span>
<span id="cb26-923"><a href="#cb26-923" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.75</span>, <span class="co"># 75:25% split</span></span>
<span id="cb26-924"><a href="#cb26-924" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb26-925"><a href="#cb26-925" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-926"><a href="#cb26-926" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> caret<span class="sc">::</span>multiClassSummary</span>
<span id="cb26-927"><a href="#cb26-927" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-928"><a href="#cb26-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-929"><a href="#cb26-929" aria-hidden="true" tabindex="-1"></a><span class="co"># Train over monte carlo simulation</span></span>
<span id="cb26-930"><a href="#cb26-930" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb26-931"><a href="#cb26-931" aria-hidden="true" tabindex="-1"></a>model_randomRandom_mc <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb26-932"><a href="#cb26-932" aria-hidden="true" tabindex="-1"></a>  label <span class="sc">~</span> .,</span>
<span id="cb26-933"><a href="#cb26-933" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_features,</span>
<span id="cb26-934"><a href="#cb26-934" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb26-935"><a href="#cb26-935" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> mc_simulation,</span>
<span id="cb26-936"><a href="#cb26-936" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Kappa"</span>,</span>
<span id="cb26-937"><a href="#cb26-937" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">120</span></span>
<span id="cb26-938"><a href="#cb26-938" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-939"><a href="#cb26-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-940"><a href="#cb26-940" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize stability</span></span>
<span id="cb26-941"><a href="#cb26-941" aria-hidden="true" tabindex="-1"></a>model_randomRandom_mc_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb26-942"><a href="#cb26-942" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">"Accuracy"</span>, <span class="st">"Kappa"</span>),</span>
<span id="cb26-943"><a href="#cb26-943" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">c</span>(<span class="fu">mean</span>(model_randomRandom_mc<span class="sc">$</span>resample<span class="sc">$</span>Accuracy), <span class="fu">mean</span>(model_randomRandom_mc<span class="sc">$</span>resample<span class="sc">$</span>Kappa)),</span>
<span id="cb26-944"><a href="#cb26-944" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">c</span>(<span class="fu">sd</span>(model_randomRandom_mc<span class="sc">$</span>resample<span class="sc">$</span>Accuracy), <span class="fu">sd</span>(model_randomRandom_mc<span class="sc">$</span>resample<span class="sc">$</span>Kappa))</span>
<span id="cb26-945"><a href="#cb26-945" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-946"><a href="#cb26-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-947"><a href="#cb26-947" aria-hidden="true" tabindex="-1"></a>flextable<span class="sc">::</span><span class="fu">flextable</span>(model_randomRandom_mc_summary)</span>
<span id="cb26-948"><a href="#cb26-948" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-949"><a href="#cb26-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-950"><a href="#cb26-950" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.9 Accuracy Assessment</span></span>
<span id="cb26-951"><a href="#cb26-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-952"><a href="#cb26-952" aria-hidden="true" tabindex="-1"></a>Accuracy assessment quantifies classification performance against independent reference data. Stratified train-test partitioning ensures adequate representation across forest disturbance classes.</span>
<span id="cb26-953"><a href="#cb26-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-956"><a href="#cb26-956" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-957"><a href="#cb26-957" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb26-958"><a href="#cb26-958" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure consistent factor levels</span></span>
<span id="cb26-959"><a href="#cb26-959" aria-hidden="true" tabindex="-1"></a>all_classes <span class="ot">&lt;-</span> <span class="fu">unique</span>(train_features<span class="sc">$</span>label)</span>
<span id="cb26-960"><a href="#cb26-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-961"><a href="#cb26-961" aria-hidden="true" tabindex="-1"></a><span class="co"># Stratified partition</span></span>
<span id="cb26-962"><a href="#cb26-962" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb26-963"><a href="#cb26-963" aria-hidden="true" tabindex="-1"></a>train_idx <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(</span>
<span id="cb26-964"><a href="#cb26-964" aria-hidden="true" tabindex="-1"></a>  train_features<span class="sc">$</span>label,</span>
<span id="cb26-965"><a href="#cb26-965" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.8</span>,</span>
<span id="cb26-966"><a href="#cb26-966" aria-hidden="true" tabindex="-1"></a>  <span class="at">list =</span> <span class="cn">FALSE</span></span>
<span id="cb26-967"><a href="#cb26-967" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-968"><a href="#cb26-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-969"><a href="#cb26-969" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_features[train_idx, ]</span>
<span id="cb26-970"><a href="#cb26-970" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> train_features[<span class="sc">-</span>train_idx, ]</span>
<span id="cb26-971"><a href="#cb26-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-972"><a href="#cb26-972" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure labels are factors with same levels</span></span>
<span id="cb26-973"><a href="#cb26-973" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_data<span class="sc">$</span>label, <span class="at">levels =</span> all_classes)</span>
<span id="cb26-974"><a href="#cb26-974" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_data<span class="sc">$</span>label, <span class="at">levels =</span> all_classes)</span>
<span id="cb26-975"><a href="#cb26-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-976"><a href="#cb26-976" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model</span></span>
<span id="cb26-977"><a href="#cb26-977" aria-hidden="true" tabindex="-1"></a>accuracy_model <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb26-978"><a href="#cb26-978" aria-hidden="true" tabindex="-1"></a>  label <span class="sc">~</span> .,</span>
<span id="cb26-979"><a href="#cb26-979" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb26-980"><a href="#cb26-980" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb26-981"><a href="#cb26-981" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">120</span>,</span>
<span id="cb26-982"><a href="#cb26-982" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-983"><a href="#cb26-983" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"none"</span>)</span>
<span id="cb26-984"><a href="#cb26-984" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-985"><a href="#cb26-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-986"><a href="#cb26-986" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb26-987"><a href="#cb26-987" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(accuracy_model, test_data)</span>
<span id="cb26-988"><a href="#cb26-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-989"><a href="#cb26-989" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure predictions have same levels</span></span>
<span id="cb26-990"><a href="#cb26-990" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">factor</span>(predictions, <span class="at">levels =</span> all_classes)</span>
<span id="cb26-991"><a href="#cb26-991" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-992"><a href="#cb26-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-993"><a href="#cb26-993" aria-hidden="true" tabindex="-1"></a><span class="fu">### Confusion Matrix</span></span>
<span id="cb26-994"><a href="#cb26-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-997"><a href="#cb26-997" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-998"><a href="#cb26-998" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb26-999"><a href="#cb26-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1000"><a href="#cb26-1000" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate confusion matrix</span></span>
<span id="cb26-1001"><a href="#cb26-1001" aria-hidden="true" tabindex="-1"></a>confMatrix <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb26-1002"><a href="#cb26-1002" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> predictions,</span>
<span id="cb26-1003"><a href="#cb26-1003" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> test_data<span class="sc">$</span>label</span>
<span id="cb26-1004"><a href="#cb26-1004" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-1005"><a href="#cb26-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1006"><a href="#cb26-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confMatrix)</span>
<span id="cb26-1007"><a href="#cb26-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1008"><a href="#cb26-1008" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract metrics</span></span>
<span id="cb26-1009"><a href="#cb26-1009" aria-hidden="true" tabindex="-1"></a>accuracy_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb26-1010"><a href="#cb26-1010" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">"Overall Accuracy"</span>, <span class="st">"Kappa"</span>, <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span>),</span>
<span id="cb26-1011"><a href="#cb26-1011" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">round</span>(<span class="fu">c</span>(</span>
<span id="cb26-1012"><a href="#cb26-1012" aria-hidden="true" tabindex="-1"></a>    confMatrix<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>],</span>
<span id="cb26-1013"><a href="#cb26-1013" aria-hidden="true" tabindex="-1"></a>    confMatrix<span class="sc">$</span>overall[<span class="st">"Kappa"</span>],</span>
<span id="cb26-1014"><a href="#cb26-1014" aria-hidden="true" tabindex="-1"></a>    confMatrix<span class="sc">$</span>overall[<span class="st">"AccuracyLower"</span>],</span>
<span id="cb26-1015"><a href="#cb26-1015" aria-hidden="true" tabindex="-1"></a>    confMatrix<span class="sc">$</span>overall[<span class="st">"AccuracyUpper"</span>]</span>
<span id="cb26-1016"><a href="#cb26-1016" aria-hidden="true" tabindex="-1"></a>  ), <span class="dv">4</span>)</span>
<span id="cb26-1017"><a href="#cb26-1017" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-1018"><a href="#cb26-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1019"><a href="#cb26-1019" aria-hidden="true" tabindex="-1"></a>accuracy_metrics <span class="sc">|&gt;</span></span>
<span id="cb26-1020"><a href="#cb26-1020" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">flextable</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-1021"><a href="#cb26-1021" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">autofit</span>()</span>
<span id="cb26-1022"><a href="#cb26-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1023"><a href="#cb26-1023" aria-hidden="true" tabindex="-1"></a>confMatrix</span>
<span id="cb26-1024"><a href="#cb26-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-1025"><a href="#cb26-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1026"><a href="#cb26-1026" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3.10 Chapter Summary {#sec-summary}</span></span>
<span id="cb26-1027"><a href="#cb26-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1028"><a href="#cb26-1028" aria-hidden="true" tabindex="-1"></a>This chapter established a comprehensive framework for activity data uncertainty quantification in REDD+ monitoring systems. Key contributions include:</span>
<span id="cb26-1029"><a href="#cb26-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1030"><a href="#cb26-1030" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Data cube architecture: Structured approach to spatiotemporal land cover analysis</span>
<span id="cb26-1031"><a href="#cb26-1031" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>IPCC methodology alignment: Clear guidance on Approach 3 requirements</span>
<span id="cb26-1032"><a href="#cb26-1032" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Pixel-level uncertainty tracking: Model residuals for adaptive sampling</span>
<span id="cb26-1033"><a href="#cb26-1033" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Random Forest optimization: Monte Carlo calibration workflows</span>
<span id="cb26-1034"><a href="#cb26-1034" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Rigorous accuracy assessment: Confusion matrices with area adjustment</span>
<span id="cb26-1035"><a href="#cb26-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1036"><a href="#cb26-1036" aria-hidden="true" tabindex="-1"></a>Activity data provides spatial extent; allometry converts extent to biomass. Combined uncertainty requires:</span>
<span id="cb26-1037"><a href="#cb26-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1038"><a href="#cb26-1038" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-1039"><a href="#cb26-1039" aria-hidden="true" tabindex="-1"></a>U_{total}^2 = U_{activity}^2 + U_{allometry}^2 + 2 \times \text{Cov}(A, B)</span>
<span id="cb26-1040"><a href="#cb26-1040" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-1041"><a href="#cb26-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1042"><a href="#cb26-1042" aria-hidden="true" tabindex="-1"></a>Where covariance term captures spatial correlation between classification errors and biomass estimation errors.</span>
<span id="cb26-1043"><a href="#cb26-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1044"><a href="#cb26-1044" aria-hidden="true" tabindex="-1"></a><span class="ot">[^index-1]: </span>**In version 1.5.3,`sits` supports access to the following ARD image cloud providers:**</span>
<span id="cb26-1045"><a href="#cb26-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1046"><a href="#cb26-1046" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **Amazon Web Services (AWS): Open data Sentinel-2/2A Level-2A collections for the Earth’s land surface.**</span></span>
<span id="cb26-1047"><a href="#cb26-1047" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **Brazil Data Cube (BDC): Open data collections of Sentinel-2/2A, Landsat-8, CBERS-4/4A, and MOD13Q1 products for Brazil. These collections are organized as regular data cubes.**</span></span>
<span id="cb26-1048"><a href="#cb26-1048" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **Copernicus Data Space Ecosystem (CDSE): Open data collections of Sentinel-1 RTC and Sentinel-2/2A images.**</span></span>
<span id="cb26-1049"><a href="#cb26-1049" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **Digital Earth Africa (DEAFRICA): Open data collections of Sentinel-1 RTC, Sentinel-2/2A, Landsat-5/7/8/9 for Africa. Additional products include ALOS_PALSAR mosaics, DEM_COP_30, NDVI_ANOMALY based on Landsat data, and monthly and daily rainfall data from CHIRPS.**</span></span>
<span id="cb26-1050"><a href="#cb26-1050" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **Digital Earth Australia (DEAUSTRALIA): Open data ARD collections of Sentinel-2A/2B and Landsat-5/7/8/9 images, yearly geomedians of Landsat 5/7/8 images; yearly fractional land cover from 1986 to 2024.**</span></span>
<span id="cb26-1051"><a href="#cb26-1051" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **Harmonized Landsat-Sentinel (HLS): HLS, provided by NASA, is an open data collection that processes Landsat 8 and Sentinel-2 imagery to a common standard.**</span></span>
<span id="cb26-1052"><a href="#cb26-1052" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **Microsoft Planetary Computer (MPC): Open data collections of Sentinel-1 GRD, Sentinel-1 RTC, Sentinel-2/2A, Landsat-4/5/7/8/9 images for the Earth’s land areas. Also supported are the Copernicus DEM-30 and MOD13Q1, MOD10A1, MOD09A1 products, and the Harmonized Landsat-Sentinel collections (HLSL30 and HLSS30).**</span></span>
<span id="cb26-1053"><a href="#cb26-1053" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **Swiss Data Cube (SDC): Collection of Sentinel-2/2A and Landsat-8 images for Switzerland.**</span></span>
<span id="cb26-1054"><a href="#cb26-1054" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **Terrascope: Cloud service with EO products, which includes the ESA World Cover map.**</span></span>
<span id="cb26-1055"><a href="#cb26-1055" aria-hidden="true" tabindex="-1"></a><span class="in">    -   **USGS: Landsat-4/5/7/8/9 collections available in AWS, which require access payment.**</span></span>
<span id="cb26-1056"><a href="#cb26-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1057"><a href="#cb26-1057" aria-hidden="true" tabindex="-1"></a><span class="in">    **In addition, `sits` supports the use of Planet monthly mosaics stored as local files. For a detailed description of the providers and collections supported by `sits`, please run `sits_list_collections()`.**</span></span>
<span id="cb26-1058"><a href="#cb26-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1059"><a href="#cb26-1059" aria-hidden="true" tabindex="-1"></a><span class="ot">[^index-2]: </span>For addressing the most problematic uncertainty tasks needing longitudinal analyses of extended timelines (1984-2024), such as disaggregation of wildfire uncertainty and the inter-annual variability of natural disturbances, we recommend practicing data cube operations with Landsat imagery <span class="co">[</span><span class="ot">@ipccReportConferenceParties2012, pp. 847; @ipccChapter2Generic2019, pp. 2.67; @ipcc2013RevisedSupplementary2014, pp. O.9; @unfccc2010report, pp. 17-18</span><span class="co">]</span>.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://github.com/training-resource/uncertainty">Source</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/training-resource/uncertainty/edit/main/03-activity-data/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/training-resource/uncertainty/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>